#### SQL Overview
This Learning Unit covers the following Learning Objectives:

1. Understand the basic syntax of SQL
2. Understand how to retrieve data from a table

Web applications leverage _databases_[1](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/introduction-to-sql-31491#fn-local_id_64-1) to store and retrieve information, enabling web applications to provide functionality such as user authentication, product management, blogs, user comments, and much more.

While there are many different data management integrations, some of the most frequently used are _relational databases_.[2](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/introduction-to-sql-31491#fn-local_id_64-2) The primary language used to interact with such databases is _Structured Query Language_ (SQL).[3](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/introduction-to-sql-31491#fn-local_id_64-3)

The expanded functionality provided by using a database also means the attack surface widens. _SQL injection_[4](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/introduction-to-sql-31491#fn-local_id_64-4) is a common web application vulnerability that occurs when unsanitized user input is inserted into _queries_[5](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/introduction-to-sql-31491#fn-local_id_64-5) and subsequently passed to a database for execution. Queries interact with a database by performing actions such as inserting or retrieving data. If we can inject malicious input into a query, we can "break out" of the original query intended by the developers and introduce our own malicious actions.

Attackers can exploit SQL injection vulnerabilities to bypass application controls or exfiltrate data. Depending on the environment, attackers may also be able to leverage these vulnerabilities to modify data or write files to the underlying server, which could lead to complete server compromise.

(Wikipedia, 2021), [https://en.wikipedia.org/wiki/Database](https://en.wikipedia.org/wiki/Database) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fnref-local_id_64-1)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/Relational_database](https://en.wikipedia.org/wiki/Relational_database) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fnref-local_id_64-2)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/SQL](https://en.wikipedia.org/wiki/SQL) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fnref-local_id_64-3)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/SQL_injection](https://en.wikipedia.org/wiki/SQL_injection) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fnref-local_id_64-4)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/SQL_syntax#Queries](https://en.wikipedia.org/wiki/SQL_syntax#Queries) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fnref-local_id_64-5)

--------------------
#### 7.1.1 Basic SQL Syntax
While there is a standard syntax[1](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fn-local_id_90-1) for SQL, most database software packages are implemented with some variations. However, the basics are generally the same. Let's cover some basic SQL concepts and syntax to develop more familiarity with it before moving on to exploitation.

A relational database consists of one or more _tables_,[2](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fn-local_id_90-2) each of which includes one or more _columns_.[3](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fn-local_id_90-3) Each entry in a table is called a _row_[4](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/sql-overview-31490#fn-local_id_90-4) or _record_. The easiest way to conceptualize a table is to actually interact with one. Let's use our sandbox application to access the SQL console at `http://sql-sandbox/sqlconsole`.

SQL SANDBOX
![[Pasted image 20240815155358.png]]
We'll start with a simple query. _Queries_[5](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fn-local_id_90-5) are instructions to the database engine that we can use to retrieve or manipulate data in the database. A _SELECT_ query retrieves data from one or more tables in a database; let's begin with this basic interaction.

***In the SQL standard, keywords are not case sensitive. However, it is a common practice to write them entirely in capitals. Some database software is case sensitive regarding column and table names.***

When we write a SELECT query, we need to specify _what_ data we want and _where_ we want it from. The "what" is formatted as a list of one or more columns. We can also use an asterisk (*) as a wildcard to query for all columns in a table. The "where" indicates which tables we want to use. We'll start with a basic example that selects data from one table.

```sql
SELECT * FROM menu;
```

We can paraphrase the query in the listing above as "retrieve all columns and records in the _menu_ table".

Depending on the database software, we may need to include a database or _schema_[6](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fn-local_id_90-6) as part of the table name.

Let's enter the query in the _Query_ field. We can leave "MySQL" as the _Database_ value and click _Submit Query_.

Contents of the menu table:
![[Pasted image 20240815155600.png]]

Figure 2 shows the columns _id_, _name_, _description_, and _price_. We'll observe three rows of data for three listed items: tacos, tostadas, and horchata de arroz.

In addition to retrieving all records from a table, we could also introduce a conditional clause to our query by using a _WHERE_ clause. A WHERE clause requires one or more columns and a conditional statement for each column. Let's append "WHERE id=10" to our query and click _Submit Query_ again.


```sql
SELECT * FROM menu WHERE id = 10;
```
Used to select only one row
![[Pasted image 20240815155731.png]]

We can paraphrase the query in Figure 3 as "retrieve all columns from the _menu_ table, showing only records with an _id_ of 10".

These are just some of the basics. We can also _INSERT_, _UPDATE_, and _DELETE_ data in tables. Rather than covering those statements here, we'll explore additional SQL syntax as needed as we learn different SQL injection techniques.


(Wikipedia, 2021), [https://en.wikipedia.org/wiki/SQL_syntax](https://en.wikipedia.org/wiki/SQL_syntax) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fnref-local_id_90-1)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/Table_(database)](https://en.wikipedia.org/wiki/Table_(database)) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fnref-local_id_90-2)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/Column_(database)](https://en.wikipedia.org/wiki/Column_(database)) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fnref-local_id_90-3)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/Row_(database)](https://en.wikipedia.org/wiki/Row_(database)) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fnref-local_id_90-4)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/SQL](https://en.wikipedia.org/wiki/SQL) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fnref-local_id_90-5)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/Database_schema](https://en.wikipedia.org/wiki/Database_schema) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/introduction-to-sql-30959/sql-overview-31316/basic-sql-syntax-30985#fnref-local_id_90-6)

##### Labs
1. `OS{MYSQLsecretFlag}`
![[Pasted image 20240815160035.png]]
```mysql
SELECT * FROM flags;
```
![[Pasted image 20240815160150.png]]
2. `OS{PostgreSQLsecretFlag}`
![[Pasted image 20240815160423.png]]
```postgresql
SELECT * FROM flags;
```
![[Pasted image 20240815160343.png]]

In Oracle SQL - how to list all `tables` - there is no `;`
```sql
SELECT table_name FROM all_tables
```
the table name for the flags is `FLAGS` - found a table named `HIDDENSECRETTABLE` as well
![[Pasted image 20240815162442.png]]
  3. `OS{OracleDBsecretFlag}`
![[Pasted image 20240815163203.png]]
```sql 
SELECT * FROM sys.FLAGS
```
In Oracle SQL the `TABLES` are always CAPITALIZED and contain `sys.` 
![[Pasted image 20240815163127.png]]
Flag for `HIDDENSECRETTABLE` in oracle
```sql
SELECT * FROM sys.HIDDENSECRETTABLE
```
`OS{ButItIsHiddenAndSecret!}`
![[Pasted image 20240815162946.png]]
4. `OS{MSSQLsecretFlag}`
![[Pasted image 20240815163516.png]]
SQL Server tables contain `app.dbo.` in front of the tables
```sql
SELECT * FROM app.dbo.flags
```
![[Pasted image 20240815163639.png]]

------------------
#### 7.1.2 Manual Database Enumeration

Basic SQL syntax is mostly universal. However, most database software will include additional keywords and functions that are specific to that particular implementation. In subsequent Learning Units, we will focus on some of the commands, functions, and keywords we can use to enumerate four common relational databases: MySQL, Microsoft SQL Server, PostgreSQL, and Oracle. Understanding their basic syntax is essential for us to properly exploit SQL injection vulnerabilities.

Although we can easily become overwhelmed by the small differences between these four databases, it is not important to memorize every detail. Instead, we should remember that there are differences between different database software. We will often need to customize an attack payload to the specific database we are attacking and we can refresh our memories by consulting documentation or searching for information online.

Subsequent Learning Units will use a SQL prompt for each database, but every statement can be executed from the SQL Console at http://sql-sandbox/sqlconsole.