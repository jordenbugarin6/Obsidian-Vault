This Learning Unit covers the following Learning Objectives:

1. Understand the basic syntax of Jinja
2. Understand how to discover a Jinja template in a black-box scenario

-------------
## 11.5.1. Jinja - Discovery

_Jinja_[1](https://portal.offsec.com/courses/web-200-28380/learning/server-side-template-injection-discovery-and-exploitation-30963/jinja-discovery-and-exploitation-31319/jinja-discovery-and-exploitation-31340#fn-local_id_87-1) is a popular templating engine for Python. We can find it in the sandbox by visiting the /jinja route. Unlike Pug, we'll find that Jinja's implementation is more similar to other templating engines.

We start by reviewing the Jinja syntax, then discuss how we can identify Jinja templates.
```python
01	<h1>Hey {{ name }}</h1>
02	{% if reasons %}
03	Here are a couple of reasons why you are great:
04	<ul>
05	{% for r in reasons %}
06		<li>{{r}}</li>
07	{% endfor %}
08	</ul>
09	{% endif %}
```
This template will be rendered with a _name_ variable and an array of strings from the _reasons_ variable. On the first line of Listing 32, we'll find an expression to display the name. On line 2, we observe an _if_ statement with its ending tag on line 9. Lines 5 through 7 contain a _for_ loop, listing the _reasons_ array.

To find out whether a target is running Jinja, we can leverage the fact that Python handles variables differently than languages like PHP, Java, and JavaScript. For example, if we were to use `{{5*5}}` as a payload, we would expect `"25"` as the output. However, what would the output be if we were to use `{{5*"5"}}`? Let's try it out.

![[Pasted image 20241028154938.png]]

In this case, the engine didn't multiply the variables; instead, it displayed `"5"` five times. This is a great indicator that the target is running Jinja.

Another indicator we can leverage is accessing global variables. These variables are often set by the framework in use. Jinja is developed by the same organization that developed the Flask framework, which is why they are usually paired together. Reviewing the documentation,[2](https://portal.offsec.com/courses/web-200-28380/learning/server-side-template-injection-discovery-and-exploitation-30963/jinja-discovery-and-exploitation-31319/jinja-discovery-30974#fn-local_id_87-2) we learn that Flask sets six global variables: _config_, _request_, _session_, _g_, _url_for()_, and _get_flashed_messages()_. Let's try to use {{ request }} as the payload.

![[Pasted image 20241028161136.png]]

Using this information, we now know that the application is running Jinja with the Flask framework.

It's important to note that not all applications using Jinja will have these variables. It's also important to check if other frameworks set similar variables.

Go to `http://template-sandbox/jinja` for the following exercise.

##### Labs
`OS{DivljeJagode}`
![[Pasted image 20241028162134.png]]
`{{SECRET_STRING}}`
![[Pasted image 20241028162200.png]]

---------
#### 11.5.2. Jinja - Exploitation

For Jinja, we'll take a bit of a different approach. While there is a payload that can be used to exploit and gain RCE with Jinja templates, it is much more complex than the other templating engines. For this reason, we won't investigate how to obtain RCE via Jinja; however, we can obtain other sensitive data.

***Obtaining RCE via injection in the Jinja templating engine is the type of complex technique reviewed in the WEB-300 course.***

As we mentioned, each framework might set its own global variables.[1](https://portal.offsec.com/courses/web-200-28380/learning/server-side-template-injection-discovery-and-exploitation-30963/jinja-discovery-and-exploitation-31319/jinja-discovery-30974#fn-local_id_104-1) Some variables, like _config_, may contain application secrets like private keys or database passwords. Let's try to access the `config` variable using an expression in Jinja. We'll use `{{config|pprint}}` as the payload. The config variable will be processed through the `pprint` filter to make the output easier for us to read.

##### Labs
`OS{Galija}`
![[Pasted image 20241028163408.png]]
Googled `hacktricks Jinja` to find this `python` script to dump all configs in jinja
```python
{{ config }} #In these object you can find all the configured env variables


{% for key, value in config.items() %}
    <dt>{{ key|e }}</dt>
    <dd>{{ value|e }}</dd>
{% endfor %}

```
at the bottom of the config we find the flag
![[Pasted image 20241028163543.png]]