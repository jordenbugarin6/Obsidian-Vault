#### `arsenal-kit-mod.py` 

#### Sha256sum
```bash
┌──(root💀gobots)-[09Apr2025 22:24:58]-[/opt/cobaltstrike]
└─# sha256sum arsenal-kit-mod.py 
82fd138764afc5605fdd7242799e99f8f22c16c88ab6d6d7eda41063b1b3d2ef  arsenal-kit-mod.py
```
#### Working Original Script - Before any full modifications
```python
import os
import shutil
import time
import subprocess
import threading
import itertools
import sys

# === CONFIGURATION ===
src_common_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/src-common"
resource_kit_target = "/opt/cobaltstrike/arsenal-kit/kits/resource/compress.ps1"

artifact_kit_original_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/artifact-kit-AV-switcher/artifact_kit_original_files"
artifact_kit_bypass_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/artifact-kit-AV-switcher/artifact_kit_bypass_files"
backup_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/artifact-kit-AV-switcher/backups"

resource_kit_original_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/artifact-kit-AV-switcher/resource_kit_original"
resource_kit_bypass_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/artifact-kit-AV-switcher/resource_kit_bypass"

build_script_dir = "/opt/cobaltstrike/arsenal-kit"
build_script = os.path.join(build_script_dir, "build_arsenal_kit.sh")

files_to_swap = ["patch.c", "bypass-pipe.c"]
resource_file_name = "compress.ps1"

# === HELPERS ===
def ensure_dirs():
    for d in [artifact_kit_original_dir, artifact_kit_bypass_dir, backup_dir, resource_kit_original_dir, resource_kit_bypass_dir]:
        if not os.path.exists(d):
            os.makedirs(d)
            print(f"📁 Created directory: {d}")

def timestamp():
    return time.strftime("%Y%m%d-%H%M%S")

def backup_files():
    ensure_dirs()
    ts = timestamp()
    for filename in files_to_swap:
        src = os.path.join(src_common_dir, filename)
        if os.path.exists(src):
            dst = os.path.join(backup_dir, f"{filename}.{ts}.bak")
            shutil.copy2(src, dst)
            print(f"📦 Backed up {filename} → {dst}")
        else:
            print(f"⚠ {filename} not found in {src_common_dir}, skipping backup.")

    if os.path.exists(resource_kit_target):
        dst = os.path.join(backup_dir, f"compress.ps1.{ts}.bak")
        shutil.copy2(resource_kit_target, dst)
        print(f"📦 Backed up compress.ps1 → {dst}")
    else:
        print(f"⚠ compress.ps1 not found at {resource_kit_target}, skipping backup.")

def switch_files(source_dir, resource_dir):
    print(f"\n🔁 Swapping artifact files from: {source_dir}")
    backup_files()
    for filename in files_to_swap:
        src = os.path.join(source_dir, filename)
        dst = os.path.join(src_common_dir, filename)
        if os.path.exists(src):
            shutil.copy2(src, dst)
            print(f"✅ Replaced {filename}")
        else:
            print(f"❌ {filename} not found in {source_dir}")

    resource_src = os.path.join(resource_dir, resource_file_name)
    if os.path.exists(resource_src):
        shutil.copy2(resource_src, resource_kit_target)
        print(f"✅ Replaced compress.ps1 from: {resource_dir}")
    else:
        print(f"❌ compress.ps1 not found in {resource_dir}")

# === Spinner ===
def spider_loader(stop_event):
    spider_frames = [
        "🕷        ",
        " 🕷       ",
        "  🕷      ",
        "   🕷     ",
        "    🕷    ",
        "     🕷   ",
        "      🕷  ",
        "       🕷 ",
        "        🕷",
        "       🕷 ",
        "      🕷  ",
        "     🕷   ",
        "    🕷    ",
        "   🕷     ",
        "  🕷      ",
        " 🕷       ",
        "🕷        "
    ]
    for frame in itertools.cycle(spider_frames):
        if stop_event.is_set():
            break
        sys.stdout.write(f"\r{frame} Building Arsenal Kit... ")
        sys.stdout.flush()
        time.sleep(0.1)
    sys.stdout.write("\r\033[K")  # Clear line

def rebuild_artifact_kit(mode_label):
    stop_event = threading.Event()
    thread = threading.Thread(target=spider_loader, args=(stop_event,))
    thread.start()

    try:
        subprocess.run(["bash", "build_arsenal_kit.sh"], cwd=build_script_dir, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, check=True)
    except subprocess.CalledProcessError as e:
        stop_event.set()
        thread.join()
        print(f"\n❌ Build failed: {e}")
        return
    except FileNotFoundError:
        stop_event.set()
        thread.join()
        print(f"\n❌ Could not find build script at: {build_script}")
        return

    stop_event.set()
    thread.join()
    print("✅ Arsenal Kit rebuilt successfully.")
    if mode_label == "original":
        print("🛡 AV Bypass Disabled.")
    elif mode_label == "bypass":
        print("🧬 AV Bypass Enabled.")

# === Menu ===
def show_menu():
    print("\n==== Artifact Kit Patch Switcher ====")
    print("1. Use ORIGINAL files (no AV bypass)")
    print("2. Use BYPASS files (AV evasion)")
    print("3. Exit")

def main():
    ensure_dirs()
    show_menu()
    choice = input("Choose an option (1-3): ").strip()
    if choice == "1":
        switch_files(artifact_kit_original_dir, resource_kit_original_dir)
        rebuild_artifact_kit("original")
    elif choice == "2":
        switch_files(artifact_kit_bypass_dir, resource_kit_bypass_dir)
        rebuild_artifact_kit("bypass")
    elif choice == "3":
        print("👋 Exiting...")
    else:
        print("❌ Invalid choice. Exiting.")

if __name__ == "__main__":
    main()

```
#### In action
![[Pasted image 20250409182624.png]]

#### Improved Script - completed - without switch options
- This sets up the directory in `/opt/cobaltstrike/arsenal-kit/arsenal-kit-mod/` 
```python
import os
import shutil
import time
import subprocess
import threading
import itertools
import sys

# === BASE DIRECTORY SETUP ===
base_dir = "/opt/cobaltstrike/arsenal-kit/arsenal-kit-mod"
artifact_dir = os.path.join(base_dir, "artifact-kit")
resource_dir = os.path.join(base_dir, "resource-kit")

# === COBALT STRIKE ACTIVE FILE LOCATIONS ===
artifact_kit_replace_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/src-common"
resource_kit_replace_path = "/opt/cobaltstrike/arsenal-kit/kits/resource/compress.ps1"

# === MOD KIT DIRECTORY STRUCTURE ===
artifact_kit_original_dir = os.path.join(artifact_dir, "originals")
artifact_kit_bypass_dir   = os.path.join(artifact_dir, "bypass")
artifact_backup_dir       = os.path.join(artifact_dir, "backups")

resource_kit_original_dir = os.path.join(resource_dir, "originals")
resource_kit_bypass_dir   = os.path.join(resource_dir, "bypass")
resource_backup_dir       = os.path.join(resource_dir, "backups")

# === BUILD SCRIPT LOCATION ===
build_script_dir = "/opt/cobaltstrike/arsenal-kit"
build_script = os.path.join(build_script_dir, "build_arsenal_kit.sh")

# === FILE CONFIG ===
files_to_swap = ["patch.c", "bypass-pipe.c"]
resource_file_name = "compress.ps1"

# === HELPERS ===
def ensure_dirs():
    for d in [
        artifact_kit_original_dir,
        artifact_kit_bypass_dir,
        artifact_backup_dir,
        resource_kit_original_dir,
        resource_kit_bypass_dir,
        resource_backup_dir
    ]:
        if not os.path.exists(d):
            os.makedirs(d)
            print(f"📁 Created directory: {d}")

def timestamp():
    return time.strftime("%Y%m%d-%H%M%S")

def backup_files():
    ensure_dirs()
    ts = timestamp()
    # Backup artifact-kit files
    for filename in files_to_swap:
        src = os.path.join(artifact_kit_replace_dir, filename)
        if os.path.exists(src):
            dst = os.path.join(artifact_backup_dir, f"{filename}.{ts}.bak")
            shutil.copy2(src, dst)
            print(f"📦 Backed up {filename} → {dst}")
        else:
            print(f"⚠ {filename} not found in {artifact_kit_replace_dir}, skipping backup.")
    # Backup compress.ps1 separately
    if os.path.exists(resource_kit_replace_path):
        dst = os.path.join(resource_backup_dir, f"{resource_file_name}.{ts}.bak")
        shutil.copy2(resource_kit_replace_path, dst)
        print(f"📦 Backed up {resource_file_name} → {dst}")
    else:
        print(f"⚠ {resource_file_name} not found at {resource_kit_replace_path}, skipping backup.")

def switch_files(source_dir, resource_dir):
    print(f"\n🔁 Swapping artifact files from: {source_dir}")
    backup_files()
    for filename in files_to_swap:
        src = os.path.join(source_dir, filename)
        dst = os.path.join(artifact_kit_replace_dir, filename)
        if os.path.exists(src):
            shutil.copy2(src, dst)
            print(f"✅ Replaced {filename}")
        else:
            print(f"❌ {filename} not found in {source_dir}")

    resource_src = os.path.join(resource_dir, resource_file_name)
    if os.path.exists(resource_src):
        shutil.copy2(resource_src, resource_kit_replace_path)
        print(f"✅ Replaced {resource_file_name}")
    else:
        print(f"❌ {resource_file_name} not found in {resource_dir}")

# === Spinner ===
def spider_loader(stop_event):
    spider_frames = [
        "🕷        "," 🕷       ","  🕷      ","   🕷     ","    🕷    ","     🕷   ","      🕷  ","       🕷 ","        🕷",
        "       🕷 ","      🕷  ","     🕷   ","    🕷    ","   🕷     ","  🕷      "," 🕷       ","🕷        "
    ]
    for frame in itertools.cycle(spider_frames):
        if stop_event.is_set():
            break
        sys.stdout.write(f"\r{frame} Building Arsenal Kit... ")
        sys.stdout.flush()
        time.sleep(0.1)
    sys.stdout.write("\r\033[K")  # Clear line

def rebuild_artifact_kit(mode_label):
    stop_event = threading.Event()
    thread = threading.Thread(target=spider_loader, args=(stop_event,))
    thread.start()

    try:
        subprocess.run(["bash", "build_arsenal_kit.sh"], cwd=build_script_dir, stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, check=True)
    except subprocess.CalledProcessError as e:
        stop_event.set()
        thread.join()
        print(f"\n❌ Build failed: {e}")
        return
    except FileNotFoundError:
        stop_event.set()
        thread.join()
        print(f"\n❌ Could not find build script at: {build_script}")
        return

    stop_event.set()
    thread.join()
    print("✅ Arsenal Kit rebuilt successfully.")
    if mode_label == "original":
        print("🛡 AV Bypass Disabled.")
    elif mode_label == "bypass":
        print("🧬 AV Bypass Enabled.")

# === Menu ===
def show_menu():
    print("\n==== Artifact Kit Patch Switcher ====")
    print("1. Use ORIGINAL files (no AV bypass)")
    print("2. Use BYPASS files (AV evasion)")
    print("3. Exit")

def main():
    ensure_dirs()
    show_menu()
    choice = input("Choose an option (1-3): ").strip()
    if choice == "1":
        switch_files(artifact_kit_original_dir, resource_kit_original_dir)
        rebuild_artifact_kit("original")
    elif choice == "2":
        switch_files(artifact_kit_bypass_dir, resource_kit_bypass_dir)
        rebuild_artifact_kit("bypass")
    elif choice == "3":
        print("👋 Exiting...")
    else:
        print("❌ Invalid choice. Exiting.")

if __name__ == "__main__":
    main()

```

#### Improved Script - Testing Switch Options
- `--noavbypass` → uses the **original** files (AV bypass off)
- `--avbypass` → uses the **bypass** files (AV bypass on)
```python
import os
import shutil
import time
import subprocess
import threading
import itertools
import sys
import argparse
from colorama import init, Fore, Style

# Initialize colorama
init(autoreset=True)

# === BASE DIRECTORY SETUP ===
base_dir = "/opt/cobaltstrike/arsenal-kit/arsenal-kit-mod"
artifact_dir = os.path.join(base_dir, "artifact-kit")
resource_dir = os.path.join(base_dir, "resource-kit")

# === COBALT STRIKE ACTIVE FILE LOCATIONS ===
artifact_kit_replace_dir = "/opt/cobaltstrike/arsenal-kit/kits/artifact/src-common"
resource_kit_replace_path = "/opt/cobaltstrike/arsenal-kit/kits/resource/compress.ps1"

# === MOD KIT DIRECTORY STRUCTURE ===
artifact_kit_original_dir = os.path.join(artifact_dir, "originals")
artifact_kit_bypass_dir   = os.path.join(artifact_dir, "bypass")
artifact_backup_dir       = os.path.join(artifact_dir, "backups")

resource_kit_original_dir = os.path.join(resource_dir, "originals")
resource_kit_bypass_dir   = os.path.join(resource_dir, "bypass")
resource_backup_dir       = os.path.join(resource_dir, "backups")

# === BUILD SCRIPT LOCATION ===
build_script_dir = "/opt/cobaltstrike/arsenal-kit"
build_script = os.path.join(build_script_dir, "build_arsenal_kit.sh")

# === FILE CONFIG ===
files_to_swap = ["patch.c", "bypass-pipe.c"]
resource_file_name = "compress.ps1"

def ensure_dirs():
    for d in [
        artifact_kit_original_dir,
        artifact_kit_bypass_dir,
        artifact_backup_dir,
        resource_kit_original_dir,
        resource_kit_bypass_dir,
        resource_backup_dir
    ]:
        if not os.path.exists(d):
            os.makedirs(d)

def timestamp():
    return time.strftime("%Y%m%d-%H%M%S")

def backup_files():
    ts = timestamp()
    for filename in files_to_swap:
        src = os.path.join(artifact_kit_replace_dir, filename)
        dst = os.path.join(artifact_backup_dir, f"{filename}.{ts}.bak")
        if os.path.exists(src):
            shutil.copy2(src, dst)

    if os.path.exists(resource_kit_replace_path):
        dst = os.path.join(resource_backup_dir, f"{resource_file_name}.{ts}.bak")
        shutil.copy2(resource_kit_replace_path, dst)

def switch_files(source_dir, resource_dir):
    backup_files()
    for filename in files_to_swap:
        src = os.path.join(source_dir, filename)
        dst = os.path.join(artifact_kit_replace_dir, filename)
        if os.path.exists(src):
            shutil.copy2(src, dst)

    resource_src = os.path.join(resource_dir, resource_file_name)
    if os.path.exists(resource_src):
        shutil.copy2(resource_src, resource_kit_replace_path)

def spider_loader(stop_event):
    spinner = ["[=         ]", "[==        ]", "[===       ]", "[====      ]",
               "[=====     ]", "[======    ]", "[=======   ]", "[========  ]",
               "[========= ]", "[==========]"]
    for frame in itertools.cycle(spinner):
        if stop_event.is_set():
            break
        sys.stdout.write(f"\r🛠  Compiling Arsenal Kit {frame}")
        sys.stdout.flush()
        time.sleep(0.1)
    sys.stdout.write("\r\033[K")

def rebuild_artifact_kit(mode_label, silent=False):
    stop_event = threading.Event()
    thread = threading.Thread(target=spider_loader, args=(stop_event,))
    thread.start()
    try:
        subprocess.run(["bash", "build_arsenal_kit.sh"], cwd=build_script_dir,
                       stdout=subprocess.DEVNULL, stderr=subprocess.DEVNULL, check=True)
    except Exception:
        stop_event.set()
        thread.join()
        if not silent:
            print("\n❌ Build failed.")
        return

    stop_event.set()
    thread.join()

    if silent:
        if mode_label == "original":
            announce_disarmed()
        elif mode_label == "bypass":
            announce_armed()
    else:
        print("✅ Arsenal Kit rebuilt successfully.")
        print("🛡 AV Bypass Disabled." if mode_label == "original" else "🧬 AV Bypass Enabled.")

def announce_disarmed():
    print("\n" + Fore.YELLOW + "[+] Shutting down AV Bypass subsystem...")
    time.sleep(0.5)
    print(Fore.YELLOW + "[*] Restoring integrity modules...")
    time.sleep(0.5)
    print(Fore.YELLOW + "[!] Defensive protocols re-initialized.\n")
    print(Fore.RED + Style.BRIGHT + "🔻 SYSTEM DISARMED – AV BYPASS OFF 🔻")

def announce_armed():
    print("\n" + Fore.CYAN + "[+] Injecting memory patch routines...")
    time.sleep(0.5)
    print(Fore.CYAN + "[*] Obfuscating artifact signatures...")
    time.sleep(0.5)
    print(Fore.CYAN + "[!] Evasion subsystem armed.\n")
    print(Fore.GREEN + Style.BRIGHT + "🔺 SYSTEM ARMED – AV BYPASS ON 🔺")

def show_menu():
    print("\n============================================")
    print("         Arsenal Kit AV Control Panel")
    print("============================================")
    print(" [1] Use ORIGINAL files  (No AV Evasion)")
    print(" [2] Use BYPASS files    (AV evasion)")
    print(" [3] Exit")
    print("============================================\n")

def main():
    ensure_dirs()

    parser = argparse.ArgumentParser(description="Switch Cobalt Strike artifact kit mode.")
    parser.add_argument("--noavbypass", action="store_true", help="Use original (non-bypass) files")
    parser.add_argument("--avbypass", action="store_true", help="Use AV bypass files")
    args = parser.parse_args()

    if args.noavbypass:
        print(Fore.YELLOW + "\n🛡 Deactivating AV Bypass...\n")
        time.sleep(0.4)
        switch_files(artifact_kit_original_dir, resource_kit_original_dir)
        rebuild_artifact_kit("original", silent=True)

    elif args.avbypass:
        print(Fore.CYAN + "\n🧬 Enabling AV Bypass...\n")
        time.sleep(0.4)
        switch_files(artifact_kit_bypass_dir, resource_kit_bypass_dir)
        rebuild_artifact_kit("bypass", silent=True)

    else:
        show_menu()
        choice = input("Choose an option (1-3): ").strip()
        if choice == "1":
            switch_files(artifact_kit_original_dir, resource_kit_original_dir)
            rebuild_artifact_kit("original")
        elif choice == "2":
            switch_files(artifact_kit_bypass_dir, resource_kit_bypass_dir)
            rebuild_artifact_kit("bypass")
        elif choice == "3":
            print("👋 Exiting...")
        else:
            print("❌ Invalid choice. Exiting.")

if __name__ == "__main__":
    main()

```
#### Directory Structure - Make sure to setup the folders properly
```bash
arsenal-kit-mod/
├── arsenal-mod-kit.py
├── build_arsenal_kit.sh
├── artifact-kit/
│   ├── src-common/                # Place patch.c, bypass-pipe.c output here
│   ├── originals/
│   ├── bypass/
│   └── backups/
├── resource-kit/
│   ├── originals/
│   ├── bypass/
│   └── target/                    # Final compress.ps1 will be dropped here
```

#### Running for the `1st` time
![[Pasted image 20250409184522.png]]

#### Running Completion ( switches)

![[Pasted image 20250409210845.png]]

#### Running Completion ( Menu)
![[Pasted image 20250409210956.png]]