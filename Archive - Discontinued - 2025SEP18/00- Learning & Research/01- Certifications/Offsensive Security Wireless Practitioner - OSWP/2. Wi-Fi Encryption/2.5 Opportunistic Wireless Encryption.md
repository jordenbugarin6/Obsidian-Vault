
Marketed as Enhanced Open[1](https://portal.offsec.com/courses/pen-210-9545/learning/wi-fi-encryption-15794/wi-fi-protected-access-3-15856/wi-fi-protected-access-3-16051#fn-local_id_125-1) by the Wi-Fi Alliance, OWE[2](https://portal.offsec.com/courses/pen-210-9545/learning/wi-fi-encryption-15794/wi-fi-protected-access-3-15856/wi-fi-protected-access-3-16051#fn-local_id_125-2) allows for the mitigation of attacks and eavesdropping on open networks by encrypting the connections.

As mentioned above, in an Open network situation, the authentication and association is a straightforward process, which leads to network access immediately. There is no authentication or encryption.

With OWE, a Diffie-Hellman exchange is done during the association phase and the result is then used as the secret to do a 4-way handshake. The client, upon noticing the access point supports OWE, will add his public key to the Association request which will be followed by the access point's public key in the Association response.

![Figure 14: Opportunistic Wireless encryption connection](https://static.offsec.com/offsec-courses/PEN-210/images/Encryption/a2f093359723c14cc5234066a299acbe-Picture14.png)

Figure 14: Opportunistic Wireless encryption connection

Diffie-Hellman Exchange may sound similar to public key encryption (such as RSA). It is asymmetric/public key technology but it differs in the fact that it isn't an encryption algorithm, it is aimed to generate and exchange a key which is then used for symmetric encryption. In this case, for the 4-way handshake.

Like WPA3, it also depends upon PMF and it must set as 'required' on the AP in order for OWE to be available (as opposed to 'optional'). When available, it will be indicated in the Beacon and Probe responses. Specifically, in the Authentication and Key Management (AKM) suite list in the RSN IE.

APs will likely support Transition mode, which allows Open networks and OWE at the same time, so legacy devices can still connect. Transition mode APs may have a separate BSSID/ESSID to handle both types of clients.

The hash algorithm will depend on the size of the key, which is linked to the DH group used. For Elliptic Curve Cryptography (ECC), with keys up to 256bits, SHA-256 is used. Until 384 bits, SHA-384 and for anything above, SHA-512. Using Finite Field Cryptography (FFC), up to 2048bits, SHA-256 will be used. Until 3072 bits, SHA-384 and for anything above, SHA-512.

While the Diffie-Hellman groups referenced are the sames as in WPA3, it is believed that only group 19, 20 and 21, which are ECC, will be used in OWE.

When connecting to the Access Point, two specific Information Elements (IE) must present in the association request sent by the client:

1. The RSN IE must indicate OWE AKM
2. An IE (ID 255) containing the public key and the group. Its content will be as follows:

- Element ID extension, which is a one octet and has the value of 32
- Element-specific data, subdivided in two parts, a two-octet field (in little endian), indicating the group used, followed by the public key

The public key encoding depends on its type. If it is FFC, then it must be encoded based on the integer-to-octet-string conversion of RFC6090.[3](https://portal.offsec.com/courses/pen-210-9545/learning/wi-fi-encryption-15794/wi-fi-protected-access-3-15856/wi-fi-protected-access-3-16051#fn-local_id_125-3) ECC is a bit more complex, as it depends on the curve used, which is defined in RFC6090 or RFC7748. On top of it, compact representation[4](https://portal.offsec.com/courses/pen-210-9545/learning/wi-fi-encryption-15794/wi-fi-protected-access-3-15856/wi-fi-protected-access-3-16051#fn-local_id_125-4) must be used if the curve is from RFC6090.

Additional checks must be performed by the receiver of the frames to ensure the validity of the public key and the group before generating the PMK.

Each party needs to perform the following:

1. Diffie-Hellman on one's private key and the other peer's public key
2. Feed the result to a element-to-scalar mapping function. We'll call the result z
3. Concatenate one's public key, the other party's public key, the Diffie-Hellman group as octets. This will be used as the salt in HKDF-extract[5](https://portal.offsec.com/courses/pen-210-9545/learning/wi-fi-encryption-15794/wi-fi-protected-access-3-15856/wi-fi-protected-access-3-16051#fn-local_id_125-5) along with the key, 'z'. It will generate a pseudo-random key called 'prk'. As mentioned above, the HMAC function used will depend on the key size (HMAC-SHA256, HMAC-SHA384 or HMAC-SHA512)
4. Generate the PMK to be used in the 4-way handshake with HKDF-expand.[5:1](https://portal.offsec.com/courses/pen-210-9545/learning/wi-fi-encryption-15794/wi-fi-protected-access-3-15856/wi-fi-protected-access-3-16051#fn-local_id_125-5) The parameters will be the pseudorandom key, the string "OWE Key Generation" as the context and the length in bits of the hashing algorithm used (256, 384 or 512)

A PMKID will be generated as well, by hashing the concatenation of both party's public keys using SHA256/384 or 512 (depending on the Diffie-Hellman used) and keeping the leftmost 128 bits. The client may choose to do PMK caching to avoid redoing the expensive authentication and indicate the PMKID in its association request. Both client and AP can cache the keys for a certain amount of time. If the access points accepts the PMKID, it will indicate it in the association response. Otherwise, the normal OWE association process will start.