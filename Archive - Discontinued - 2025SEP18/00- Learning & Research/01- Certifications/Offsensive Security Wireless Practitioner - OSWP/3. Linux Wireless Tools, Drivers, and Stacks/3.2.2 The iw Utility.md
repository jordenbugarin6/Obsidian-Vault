Even though we could still use iwconfig and other tools thanks to a compatibility layer, they are deprecated and we shouldn't use them anymore. The iw utility and its variety of options is the only command we need for configuring a Wi-Fi device.

Assuming the drivers have been loaded properly, runningÂ iw listÂ will provide us with lots of detailed information about the wireless devices and their capabilities:


 shows the card supports a `number of modes`, including IBSS (ad hoc), monitor mode, managed mode (client), and AP mode. It also lists frequencies allowed.
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[14Apr2025 23:52:53]-[/opt/cobaltstrike]
â””â”€# sudo iw list               
Wiphy phy0
        wiphy index: 0
        max # scan SSIDs: 4
        max scan IEs length: 2257 bytes
        max # sched scan SSIDs: 0
        max # match sets: 0
        Retry short long limit: 2
        Coverage class: 0 (up to 0m)
        Device supports RSN-IBSS.
        Supported Ciphers:
                * WEP40 (00-0f-ac:1)
                * WEP104 (00-0f-ac:5)
                * TKIP (00-0f-ac:2)
                * CCMP-128 (00-0f-ac:4)
                * CCMP-256 (00-0f-ac:10)
                * GCMP-128 (00-0f-ac:8)
                * GCMP-256 (00-0f-ac:9)
                * CMAC (00-0f-ac:6)
                * CMAC-256 (00-0f-ac:13)
                * GMAC-128 (00-0f-ac:11)
                * GMAC-256 (00-0f-ac:12)
        Available Antennas: TX 0 RX 0
        Supported interface modes:
                 * IBSS
                 * managed
                 * AP
                 * AP/VLAN
                 * monitor
                 * mesh point
        Band 1:
                Capabilities: 0x17e
                        HT20/HT40
                        SM Power Save disabled
                        RX Greenfield
                        RX HT20 SGI
                        RX HT40 SGI
                        RX STBC 1-stream
                        Max AMSDU length: 3839 bytes
                        No DSSS/CCK HT40
                Maximum RX AMPDU length 32767 bytes (exponent: 0x002)
                Minimum RX AMPDU time spacing: 2 usec (0x04)
                HT TX/RX MCS rate indexes supported: 0-7, 32
                Bitrates (non-HT):
                        * 1.0 Mbps
                        * 2.0 Mbps (short preamble supported)
                        * 5.5 Mbps (short preamble supported)
                        * 11.0 Mbps (short preamble supported)
                        * 6.0 Mbps
                        * 9.0 Mbps
                        * 12.0 Mbps
                        * 18.0 Mbps
                        * 24.0 Mbps
                        * 36.0 Mbps
                        * 48.0 Mbps
                        * 54.0 Mbps
                Frequencies:
                        * 2412.0 MHz [1] (20.0 dBm)
                        * 2417.0 MHz [2] (20.0 dBm)
                        * 2422.0 MHz [3] (20.0 dBm)
                        * 2427.0 MHz [4] (20.0 dBm)
                        * 2432.0 MHz [5] (20.0 dBm)
                        * 2437.0 MHz [6] (20.0 dBm)
                        * 2442.0 MHz [7] (20.0 dBm)
                        * 2447.0 MHz [8] (20.0 dBm)
                        * 2452.0 MHz [9] (20.0 dBm)
                        * 2457.0 MHz [10] (20.0 dBm)
                        * 2462.0 MHz [11] (20.0 dBm)
                        * 2467.0 MHz [12] (20.0 dBm) (no IR)
                        * 2472.0 MHz [13] (20.0 dBm) (no IR)
                        * 2484.0 MHz [14] (20.0 dBm) (no IR)
        Supported commands:
                 * new_interface
                 * set_interface
                 * new_key
                 * start_ap
                 * new_station
                 * new_mpath
                 * set_mesh_config
                 * set_bss
                 * authenticate
                 * associate
                 * deauthenticate
                 * disassociate
                 * join_ibss
                 * join_mesh
                 * remain_on_channel
                 * set_tx_bitrate_mask
                 * frame
                 * frame_wait_cancel
                 * set_wiphy_netns
                 * set_channel
                 * probe_client
                 * set_noack_map
                 * register_beacons
                 * start_p2p_device
                 * set_mcast_rate
                 * connect
                 * disconnect
                 * set_qos_map
                 * set_multicast_to_unicast
        software interface modes (can always be added):
                 * AP/VLAN
                 * monitor
        valid interface combinations:
                 * #{ AP, mesh point } <= 8,
                   total <= 8, #channels <= 1
        HT Capability overrides:
                 * MCS: ff ff ff ff ff ff ff ff ff ff
                 * maximum A-MSDU length
                 * supported channel width
                 * short GI for 40 MHz
                 * max A-MPDU length exponent
                 * min MPDU start spacing
        Device supports TX status socket option.
        Device supports HT-IBSS.
        Device supports SAE with AUTHENTICATE command
        Device supports low priority scan.
        Device supports scan flush.
        Device supports AP scan.
        Device supports per-vif TX power setting
        Driver supports full state transitions for AP/GO clients
        Driver supports a userspace MPM
        Device supports configuring vdev MAC-addr on create.
        max # scan plans: 1
        max scan plan interval: -1
        max scan plan iterations: 0
        Supported TX frame types:
                 * IBSS: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
                 * managed: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
                 * AP: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
                 * AP/VLAN: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
                 * mesh point: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
                 * P2P-client: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
                 * P2P-GO: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
                 * P2P-device: 0x00 0x10 0x20 0x30 0x40 0x50 0x60 0x70 0x80 0x90 0xa0 0xb0 0xc0 0xd0 0xe0 0xf0
        Supported RX frame types:
                 * IBSS: 0x40 0xb0 0xc0 0xd0
                 * managed: 0x40 0xb0 0xd0
                 * AP: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0
                 * AP/VLAN: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0
                 * mesh point: 0xb0 0xc0 0xd0
                 * P2P-client: 0x40 0xd0
                 * P2P-GO: 0x00 0x20 0x40 0xa0 0xb0 0xc0 0xd0
                 * P2P-device: 0x40 0xd0
        Supported extended features:
                * [ RRM ]: RRM
                * [ FILS_STA ]: STA FILS (Fast Initial Link Setup)
                * [ CQM_RSSI_LIST ]: multiple CQM_RSSI_THOLD records
                * [ CONTROL_PORT_OVER_NL80211 ]: control port over nl80211
                * [ TXQS ]: FQ-CoDel-enabled intermediate TXQs
                * [ SCAN_RANDOM_SN ]: use random sequence numbers in scans
                * [ SCAN_MIN_PREQ_CONTENT ]: use probe request with only rate IEs in scans
                * [ CONTROL_PORT_NO_PREAUTH ]: disable pre-auth over nl80211 control port support
                * [ DEL_IBSS_STA ]: deletion of IBSS station support
                * [ SCAN_FREQ_KHZ ]: scan on kHz frequency support
                * [ CONTROL_PORT_OVER_NL80211_TX_STATUS ]: tx status for nl80211 control port support
                * [ POWERED_ADDR_CHANGE ]: can change MAC address while up

```
To get a listing of wireless access points that are within range of our wireless card, we will useÂ iwÂ with theÂ dev wlan0Â option, which specifies our device. Next, we'll add theÂ scanÂ parameter. We then pipe this command throughÂ grep SSIDÂ to filter our output to only wireless network names:

`this` didnt show anything for me
```bash
kali@kali:~$ sudo iw dev wlan0 scan | grep SSID
	SSID: wifu
	SSID: 6F36E6
```
The channel number that a target access point is transmitting is a critical piece of information. TheÂ iw dev scanÂ output can be further refined by piping the results withÂ egrepÂ using the logical OR operator (|) to output strings which either contain "DS Parameter set" or "SSID:":
```bash
kali@kali:~$ sudo iw dev wlan0 scan | egrep "DS Parameter set|SSID:"
	SSID: wifu
	DS Parameter set: channel 3
	SSID: 6F36E6
	DS Parameter set: channel 11
```
With some of the basic commands out of the way, we will create a new Virtual Interface (VIF) named "wlan0mon" in monitor mode. These iw commands will seem complex but once we break them down a bit, we'll notice that the logic they follow is pretty simple.

We again specify our device withÂ iw dev wlan0. Then we add an interface with theÂ interfaceÂ option and theÂ addÂ parameter followed by its name (wlan0mon). Lastly theÂ typeÂ option withÂ monitorÂ places our new interface in monitor mode:
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[15Apr2025 00:37:02]-[/opt/cobaltstrike]
â””â”€# sudo iw dev wlan0 interface add wlan0mon type monitor
```
As with many commands, when there is no output displayed, we know the command was successful. With the new interface created, we need to bring it up withÂ ipÂ (newly created interfaces are down by default):
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[15Apr2025 00:37:04]-[/opt/cobaltstrike]
â””â”€# sudo ip link set wlan0mon up
```
Using theÂ `iw dev info`Â command, we will be able to inspect our newly created monitor mode interface:
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[15Apr2025 00:37:33]-[/opt/cobaltstrike]
â””â”€# sudo iw dev wlan0mon info
Interface wlan0mon
        ifindex 4
        wdev 0x2
        addr 00:c0:ca:96:a0:93
        type monitor
        wiphy 0
        txpower 20.00 dBm
```
Let's verify our card is in monitor mode by starting a sniffer,Â tcpdump, to capture wireless frames:
- this isnt what its supposed to look like
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[15Apr2025 00:38:38]-[/opt/cobaltstrike]
â””â”€# sudo tcpdump -i wlan0mon
tcpdump: verbose output suppressed, use -v[v]... for full protocol decode
listening on wlan0mon, link-type IEEE802_11_RADIO (802.11 plus radiotap header), snapshot length 262144 bytes
^C
0 packets captured
0 packets received by filter
0 packets dropped by kernel
```
- what it is supposed to look like
```bash
kali@kali:~$ sudo tcpdump -i wlan0mon
tcpdump: verbose output suppressed, use -v or -vv for full protocol decode
listening on wlan0mon, link-type IEEE802_11_RADIO (802.11 plus radiotap header), capture size 262144 bytes
13:39:17.873700 2964927396us tsft 1.0 Mb/s 2412 MHz 11b -20dB signal antenna 1 [bit 14] Beacon (wifu) [1.0* 2.0* 5.5* 11.0* 9.0 18.0 36.0 54.0 Mbit] ESS CH: 3, PRIVACY[|802.11]
```
Running this command in our lab environment will display a great deal of traffic on the wlan0mon interface. PressingÂ C+cÂ will stop the capture.

In the example above, we notice a beacon on channel 3 with the SSID "wifu".

Once we have finished with our VAP, we will want to delete it with theÂ iwÂ command and theÂ delÂ option. Once we've done that, let's confirm it worked withÂ info:

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[15Apr2025 00:42:41]-[/opt/cobaltstrike]
â””â”€# sudo iw dev wlan0mon interface del

â”Œâ”€â”€(rootðŸ’€gobots)-[15Apr2025 01:03:35]-[/opt/cobaltstrike]
â””â”€# sudo iw dev wlan0mon info
command failed: No such device (-19)
```
Central Regulatory Domain Agent (CRDA),[1](https://portal.offsec.com/courses/pen-210-9545/learning/linux-wireless-tools,-drivers,-and-stacks-15799/wireless-tools-15881/the-iw-utility-16009#fn-local_id_11-1)Â helps radios stay compliant with wireless regulations around the world. It is used by the cfg80211 wireless subsystem to enforce the regulatory domain settings for a given location. Countries' regulations can be fairly complex, and CRDA sets the radio to operate within the regulations of the operating country. Specifically, it enforces transmit power limits on the radio, prevents the radio from transmitting on restricted frequencies, and abides by any other limitation such as DFS. TheÂ iw regÂ command interacts with CRDA to query, and in some cases, change it.

Manufacturers may also set limitations on the hardware of a device depending on where it is sold. For example, Intel wireless cards sold in the US cannot go beyond channel 11. In addition, Mikrotik prevents their international models with greater frequency ranges from being sold in the US.

To display the current regulatory domain, we useÂ `iw reg` get:

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[15Apr2025 01:09:22]-[/opt/cobaltstrike]
â””â”€# sudo iw reg get
global
country 00: DFS-UNSET
        (755 - 928 @ 2), (N/A, 20), (N/A), PASSIVE-SCAN
        (2402 - 2472 @ 40), (N/A, 20), (N/A)
        (2457 - 2482 @ 20), (N/A, 20), (N/A), AUTO-BW, PASSIVE-SCAN
        (2474 - 2494 @ 20), (N/A, 20), (N/A), NO-OFDM, PASSIVE-SCAN
        (5170 - 5250 @ 80), (N/A, 20), (N/A), AUTO-BW, PASSIVE-SCAN
        (5250 - 5330 @ 80), (N/A, 20), (0 ms), DFS, AUTO-BW, PASSIVE-SCAN
        (5490 - 5730 @ 160), (N/A, 20), (0 ms), DFS, PASSIVE-SCAN
        (5735 - 5835 @ 80), (N/A, 20), (N/A), PASSIVE-SCAN
        (57240 - 63720 @ 2160), (N/A, 0), (N/A)
```

By default, Kali is set to global regulatory domain (00).
To change or set the regulatory domain, we runÂ iw reg set `<COUNTRY>`Â where`"COUNTRY"` is the 2 letter code (ISO/IEC 3166-1 alpha 2 more preciselyÂ for the country we are currently in. For the `US`, we would runÂ `iw reg set US`. The command will not output anything when successful.
The change is not permanent as the setting is only in memory. To make sure it is always set at boot time, editÂ `/etc/default/crda`Â with a text editor, and fill in theÂ `REGDOMAIN`Â variable:

my `/etc/default/crda` is empty - reason is is the `crda` is deprecated, just manually set with the command above
![[Pasted image 20250415164606.png]]

In summary, here is what we can learn from the output:

- In the 2.4GHz band, transmitting is allowed between 2.402GHz and 2.472GHz with up to 40MHz channel width and up to 30dBi power.
- In the 5GHz band, 5.170 to 5.250GHz is allowed with up to 80MHz channels at 23dBi, 5.250 to 5330GHz with up to 80MHz channels at 23dBi with DFS, 5.490 to 5.730GHz with up to 160MHz channels at 23dBi and DFS, 5.735 to 5.835 with up to 80MHz channels and up to 30dBi.
- In the 60GHz band, 57.240 to 63.720 GHz is allowed with channels up to 2.160GHz at 40dBi.

The regulatory domain we set can sometimes be overridden.
A wireless card can sometimes advertise their regulatory domain through the driver. When plugging in the `Alfa AWUS036NHA`, it advertises its regulatory domain as GB:

```bash
kali@kali:~$ sudo iw reg get
global
country US: DFS-FCC
        (2402 - 2472 @ 40), (N/A, 30), (N/A)
        (5170 - 5250 @ 80), (N/A, 23), (N/A), AUTO-BW
        (5250 - 5330 @ 80), (N/A, 23), (0 ms), DFS, AUTO-BW
        (5490 - 5730 @ 160), (N/A, 23), (0 ms), DFS
        (5735 - 5835 @ 80), (N/A, 30), (N/A)
        (57240 - 71000 @ 2160), (N/A, 40), (N/A)

phy#0
country GB: DFS-ETSI
        (2402 - 2482 @ 40), (N/A, 20), (N/A)
        (5170 - 5250 @ 80), (N/A, 20), (N/A), AUTO-BW
        (5250 - 5330 @ 80), (N/A, 20), (0 ms), DFS, AUTO-BW
        (5490 - 5710 @ 160), (N/A, 27), (0 ms), DFS
        (57000 - 66000 @ 2160), (N/A, 40), (N/A)
```

Since our card is 2.4GHz only, the GB's regulatory domain allows 2402 to 2482MHz, which would allow channel 12 and 13, while the US only allows channel 1 to 11. For this reason, the output ofÂ iw listÂ shows channels 12 and 13 disabled, following the more restrictive regulation from the US regulatory domain.
```bash
kali@kali:~$ sudo iw list
...
                Frequencies:
                        * 2412 MHz [1] (20.0 dBm)
                        * 2417 MHz [2] (20.0 dBm)
                        * 2422 MHz [3] (20.0 dBm)
                        * 2427 MHz [4] (20.0 dBm)
                        * 2432 MHz [5] (20.0 dBm)
                        * 2437 MHz [6] (20.0 dBm)
                        * 2442 MHz [7] (20.0 dBm)
                        * 2447 MHz [8] (20.0 dBm)
                        * 2452 MHz [9] (20.0 dBm)
                        * 2457 MHz [10] (20.0 dBm)
                        * 2462 MHz [11] (20.0 dBm)
                        * 2467 MHz [12] (disabled)
                        * 2472 MHz [13] (disabled)
                        * 2484 MHz [14] (disabled)
```