This Learning Unit covers the following Learning Objectives:

1. Understand what a Directory Listing is.
2. Understand how to analyze a web application's parameter for directory listing.
3. Understand what successful exploitation of directory listings looks like.

Let's open our web browser and navigate to http://directorylisting/ to examine the web application and parameters available to us.

In this example, we will attempt to abuse improper input sanitization on a demo version of a _PHP File Browser_. Users typically rely on applications such as these to easily navigate through web-related directories as well as potentially upload, manage, or download files from the server. We'll use the example machine that appears in the Lab Control Panel as _directorylisting_. Our version (v1.0) currently only supports listing the directories and files present on the target web server.

Below is figure of the application presented to us at http://directorylisting/.

---------------
#### 9.4. Directory Listing
This Learning Unit covers the following Learning Objectives:

1. Understand what a Directory Listing is.
2. Understand how to analyze a web application's parameter for directory listing.
3. Understand what successful exploitation of directory listings looks like.

Let's open our web browser and navigate to http://directorylisting/ to examine the web application and parameters available to us.

In this example, we will attempt to abuse improper input sanitization on a demo version of a _PHP File Browser_. Users typically rely on applications such as these to easily navigate through web-related directories as well as potentially upload, manage, or download files from the server. We'll use the example machine that appears in the Lab Control Panel as _directorylisting_. Our version (v1.0) currently only supports listing the directories and files present on the target web server.

Below is figure of the application presented to us at http://directorylisting/.

![[Pasted image 20240916160407.png]]

It quickly becomes clear that we only have a few directories to choose from. Let's select the CSS folder to begin understanding how this application works.
![[Pasted image 20240916160640.png]]

It would seem that the web application is working fine and the end-user can peruse directories at their leisure. If we further inspect the URL Address bar, we'll notice something that stands out and suggests we test the _path_ parameter. We will examine this more closely in the next section, Parameter Analysis.

-----------------

#### 9.4.1. Parameter Analysis

Next, we'll notice an interesting parameter in the URL Address Bar in the browser.

The value of the path parameter in the query string is /var/www/html/demo/css/, which suggests that we might be dealing with absolute file pathing. Given the /var/www/html/ section, we can assume that the underlying OS is Linux.

In addition to learning that the target is most likely running Linux, the _path_ parameter also suggests the existence of a web-root because /var/www/html/ is very commonly used as such. This might be the web-root for the current application or another application, and we'll need to conduct a bit more testing to discover what exactly we have found.

In the next section, we will discuss evidence of a directory listing finding.

------
#### 9.4.2. Evidence of Directory Listing

To confirm the presence of a directory listing, let's first replace the "/var/www/html/file-browser-demo/demo/css/" value with `..%2F`. The `..%2F` is a standard URL-encoded variable equally represented by `../`
![[Pasted image 20240916161256.png]]

We can confirm that the path variable is indeed vulnerable to directory listing. We have traversed outside of the web application's working directory and back to /var/www/html/, only to list out the directories and files present in that path.

Next, let's try to abuse this directory listing and inspect the /var/ directory of the Linux root file system. With this particular application, we have two options for reaching our goal. We could, for example, specify traversal strings by appending three traversal strings to the path variable - `..%2F..%2F..%2F`. This equates directly to `../../../`, instructing the path variable to move backwards from the web application's working directory three times.

Let's take the other option and attempt to exploit this directory listing into the /var/ directory by supplementing the value of the _path_ parameter with /var/ as an Absolute Path.

![[Pasted image 20240916161509.png]]
As shown above, we are now located in the /var/ directory and have listed its contents (other directories and files) by specifying an absolute path to the _path_ parameter.

Now that we've practiced directory listing and worked with the _path_ parameter, let's attempt data exfiltration. As discussed earlier, data exfiltration is one of the core differences between directory traversal and directory listing. In our attempt to retrieve the contents of /etc/passwd, we notice that we run into some challenges exploiting this directory listing finding.

![[Pasted image 20240916165205.png]]
The figure above indicates that the target application does not permit us to read files from the operating system; however it _does_ allow us to list the files and directories. This information further confirms that we are dealing with a directory listing finding as opposed to a directory traversal. In a genuine directory traversal, we would have simply extracted the contents of /etc/passwd. We are not entirely out of luck, however.

Although we are not able to display the contents of /etc/passwd, our file browsing permissions nevertheless enable us to attempt traversal into specific directories with the intent of finding a service running on the target machine. Although we cannot display its configuration data, we can gather more information to help us with further attacks on the target system.

Let's attempt to probe into the home directory of the target system to gather _system-level users_. These users can be added to our enumeration data in our master note file for further attacks either on this machine, or across the network at large.

To begin our inspection, we'll modify the payload value to `..%2F..%2F..%2F..%2F..%2F..home%2F`. This will equate to `../../../../../home/` when the URL encoding is decoded.

![[Pasted image 20240916200622.png]]

Wonderful, we have discovered a valid system-level user, which means that we can next attempt brute-forcing on this machine or perform what is known as a _Credential Spray_[1](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-listing-31278/evidence-of-directory-listing-31019#fn-local_id_348-1) attack across the network. The results of any _Credential Spray_ attack are essential to include in our security reporting. In essence, a _Credential Spray_ attack is the act of taking a list of gathered credentials and _spraying_ them across an entire network (as opposed to a single machine) and across a variety of protocols that support authentication.

It's important for us to keep in mind that directory listing is only one of many findings we may encounter with traversal strings. We should always verify opportunities that might seem like a directory listing finding, but in reality could be much more useful.

##### Labs
`OS{directory_listingFlagOne}`
![[Pasted image 20240916200802.png]]
![[Pasted image 20240916200719.png]]