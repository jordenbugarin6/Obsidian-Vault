In this Learning Module, we will cover the following Learning Units:

- Introduction to SQL Injection
- Testing for SQL Injection
- Exploiting SQL Injection
- Database dumping with Automated Tools
- Case Study: Error-based SQLi in Piwigo

In this Learning Module, we'll learn about _SQL injection_, [1](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/sql-injection-31515#fn-local_id_63-1) a common web vulnerability. We'll start this Learning Module by discussing how SQL injection vulnerabilities occur and how to identify them in web applications. Next, we'll cover several techniques for exploitation and a tool for automating SQL injection attacks. Finally, we will examine an error-based SQL injection case study found in a real-world application.

[https://en.wikipedia.org/wiki/SQL_injection](https://en.wikipedia.org/wiki/SQL_injection) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/sql-injection-31515#fnref-local_id_63-1)

---------------------
#### 8.1 Introduction to SQL Injection
This Learning Unit covers the following Learning Objectives:

1. Understand the concept of SQL injection
2. Understand how the OR operator can modify the results of a SQL query

#### 8.1.1 Introduction to SQL Injection
_SQL Injection_[1](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/introduction-to-sql-injection-31304/introduction-to-sql-injection-31514#fn-local_id_65-1) is a common web application vulnerability that occurs when unsanitized user input is inserted into _queries_[2](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/introduction-to-sql-injection-31304/introduction-to-sql-injection-31514#fn-local_id_65-2) and subsequently passed to a database for execution. If we can inject malicious input into a query, we can "break out" of the original query intended by the developers and introduce our own malicious actions.

To better understand this, we'll continue working with the SQL sandbox application. Suppose an application is running a query such as SELECT * FROM menu WHERE id = 10;, but we have control over the _id_ value being used. Rather than submitting "10", what would happen if we submitted "10 or id=11"? If the application inserts the user input to the query and does not perform input validation, it could end up executing the following query.

A modified query:
```sql
SELECT * FROM menu WHERE id = 10 or id = 11;
```

If an application were to run this query, it would return two rows since an `OR` operator was used in the `WHERE` clause. The database would return any record with an `id` of 10 or 11. This basic SQL injection example illustrates how the original intent of the query was modified by our input.

We've mentioned input validation, but SQL injection can also be prevented by using _parameterized queries_.[3](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/introduction-to-sql-injection-31304/what-is-sql-injection%3F-31037#fn-local_id_128-3) Most programming languages support parameterized queries that allow developers to mark values in a SQL query as placeholders, or parameters. The application then provides the values that will be used instead of the placeholders, creating a layer of separation between the SQL code and user-supplied data.

Our abilities with a potential SQL injection attack are limited by factors including our knowledge of SQL, our knowledge of the underlying database software and structure, where in the SQL statement we are able to inject, and which characters we can inject.

Depending on these conditions listed above, attackers can leverage SQL injection vulnerabilities to bypass application logic (such as login checks), exfiltrate or modify data, write files on the database server, or perform remote code execution. Some of these attacks, such as writing files or achieving remote code execution, depend on the permissions of the exploited database user account.

Before we're ready to exploit a SQL injection vulnerability, we need to learn how to identify it. We will cover discovery and enumeration in the next section.

(Wikipedia, 2021), [https://en.wikipedia.org/wiki/SQL_injection](https://en.wikipedia.org/wiki/SQL_injection) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/introduction-to-sql-injection-31304/what-is-sql-injection%3F-31037#fnref-local_id_128-1)
(Wikipedia, 2021), [https://en.wikipedia.org/wiki/SQL](https://en.wikipedia.org/wiki/SQL) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/introduction-to-sql-injection-31304/what-is-sql-injection%3F-31037#fnref-local_id_128-2)
(CheatSheets Series Team, 2021), [https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/Query_Parameterization_Cheat_Sheet.html) [↩︎](https://portal.offsec.com/courses/web-200-28380/learning/sql-injection-30958/introduction-to-sql-injection-31304/what-is-sql-injection%3F-31037#fnref-local_id_128-3)


##### Labs
https://portal.offsec.com/courses/osa-web-200-43711/learning/week-5-sql-injection-47189/live-session-47190/live-session-47188
1. `OS{introToSQLinjection}`
![[Pasted image 20240816115743.png]]
```mysql
2 or 1=1--
```

1st thing to do is identify input that could be used in a query
We need to figure out the tables / columns
![[Pasted image 20240816114041.png]]
Entering the number `2` doesnt return anything
![[Pasted image 20240816114233.png]]
trying the generic `' or 1=1--` throws an error but shows the query that is being utilized `SELECT id, name, description, price FROM menu WHERE id =` then it pics up with our input
![[Pasted image 20240816114501.png]]
so instead of utilizing `' or 1=1--` use `2 or 1=1--` which is essentially saying `SELECT id, name, description, price FROM menu WHERE id = 2 OR 1=1--` so displays everything
![[Pasted image 20240816114815.png]]
2. `OS{introToPostgreSQLinjection}`
![[Pasted image 20240816121544.png]]
```mysql
TEST
```
utilizing `TEST` to identify where the field is being injected 
![[Pasted image 20240816120926.png]]
```mysql
2 or 1=1--
```
 `SELECT id, name, description, price FROM menu WHERE id = 2 or 1=1--` then it pics up with our input and throws up everything
![[Pasted image 20240816121451.png]]

3. `OS{introToSQLinjectionOracleStyle}`
![[Pasted image 20240816122830.png]]
utilizing `TEST` to identify where the injection starts
`SELECT id, name, description, price FROM menu WHERE id = TEST` shows the injection point
![[Pasted image 20240816122437.png]]
```sql
2 or 1=1--
```
`SELECT id, name, description, price FROM menu WHERE id = 2 or 1=1--` displays all fields in this `Oracle` database
![[Pasted image 20240816122658.png]]
4. `OS{introToSQLinjectionInSQLServer}`
![[Pasted image 20240816123524.png]]
```sql
2 or 1=1--
```
Displays the flag
![[Pasted image 20240816123216.png]]
testing with no input shows where the field of injection is, kind of - entering nothing shows that the field that our input is picking up after is the `=`
![[Pasted image 20240816123348.png]]


