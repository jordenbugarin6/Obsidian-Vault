This Learning Unit covers the following Learning Objectives:

1. Understand how to identify the version of a SQL Server database
2. Understand how to identify the current user of a SQL Server database
3. Understand how to identify the databases within a SQL Server instance
4. Understand how to identify the tables within a database in a SQL Server instance
5. Understand how to identify the column names and data types in a table in a SQL Server database

-------------
#### 7.3.1 Microsoft SQL Server Specific Functions and Tables

We can obtain the version of SQL Server we need by selecting `@@VERSION`.

***When using a SQL Server command line tool, we must submit our SQL statement ending with a semicolon followed by GO on a separate line. When working with the SQL Console, we can omit the GO.***

```sql
1> select @@version;

2> GO
 
-------------------------------------------------------------------------
Microsoft SQL Server 2019 (RTM-CU11) (KB5003249) - 15.0 (X64) 
	May 27 2021 17:34:14 
	Copyright (C) 2019 Microsoft Corporation
	Express Edition (64-bit) on Linux (Ubuntu 18.04.5 LTS) <X64>  
(1 rows affected)
```
Selecting the version of MS SQL Server - when interacting with the `MSSQL` server practicing ui do not need to utilize `SELECT`
`version: 15.0.4138.2`
![[Pasted image 20240815173303.png]]
We can obtain the name of the user account currently connected to the database by selecting `SYSTEM_USER`. As with MySQL, this user is specific to the database and may not be a system-level user.
```sql
1> SELECT SYSTEM_USER;

2> GO

-------------------------------------------------------------------------
sa                  
(1 rows affected)
```
Selecting the current user connected to MS SQL Server
![[Pasted image 20240815173445.png]]
While it can be renamed or disabled, "sa" is the default name for an administrator-level account in SQL Server. If we can exploit SQL injection with a query run by the sa account, we will typically receive full access to all functionality with SQL Server, meaning we should be able to completely compromise it.

We can obtain a list of databases from the _databases_ table in the _system catalog_, abbreviated as _sys_ in queries. The system catalog contains metadata about the database.

```sql
1> SELECT name FROM sys.databases;

2> GO
name                                                                                          
-------------------------------------------------------------------------
master
tempdb
model
msdb
app
exercise
sqlmap  
(7 rows affected)
```
this does not work for me
![[Pasted image 20240815174040.png]]

#### Fix:
You have to be working in the `SQL CONSOLE` page, not the `introduction`

Listing databases in MS SQL Server
```sql
1> SELECT name FROM sys.databases;

2> GO
name                                                                                          
-------------------------------------------------------------------------
master
tempdb
model
msdb
app
exercise
sqlmap  
(7 rows affected)
```
![[Pasted image 20240815183822.png]]
We can obtain a list of table names within a database by querying the _tables_ table in the corresponding _information_schema_. In current versions of SQL Server, we can also query _app.sys.tables_ for the same information.
Listing tables in MS SQL Server
```sql
1> select * from app.information_schema.tables;

2> GO
TABLE_CATALOG    TABLE_SCHEMA   TABLE_NAME       TABLE_TYPE
------------------------------------------------------------
app              dbo            menu              BASE TABLE
app              dbo            users             BASE TABLE
app              dbo            flags             BASE TABLE

(3 rows affected)
```
![[Pasted image 20240815183959.png]]
Once we know a table's name, we can query the _columns_ table in the _information_schema_ to obtain its column names.
```sql
1> select COLUMN_NAME, DATA_TYPE from app.information_schema.columns where TABLE_NAME = 'menu';

2> GO
COLUMN_NAME    DATA_TYPE                         
------------------------------------------------------------
id             int
name           varchar
description    varchar
price          decimal        

(4 rows affected)
```
![[Pasted image 20240815184106.png]]

##### Labs

1. `15.0.4138.2`
![[Pasted image 20240815184344.png]]
```sql
select @@version;
```
![[Pasted image 20240815184240.png]]
2. `OS{DontLookHere}`
![[Pasted image 20240815200303.png]]
using previous notes can see that a table named `secretTable` exists, utilized sql query below to get column name of `flag`
```sql
select COLUMN_NAME, DATA_TYPE from app.information_schema.columns where TABLE_NAME = 'secretTable';
```
![[Pasted image 20240815184639.png]]
Building the path:
Start small to identify what to add the the `sql` query
```sql
select * from app.information_schema.columns
```
This command shows all `COLUMNS` on the top in red/pink
![[Pasted image 20240815195948.png]]
Now we know what we are looking for in order to query for the flag, the command is below:
you are essentially just navigating to the file with the fields of the columns, like changing directories
```sql
SELECT flag FROM app.dbo.secretTable;
```

![[Pasted image 20240815200207.png]]



