#### 12.0 Introduction to SSRF

This Learning Unit covers the following Learning Objectives:

1. Understand the concept of Server-Side Request Forgery
2. Understand how SSRF can interact with the loopback interface
3. Understand how SSRF can interact with back-end systems
4. Understand how SSRF can interact with private IP ranges

Applications are vulnerable to SSRF when they process user-supplied input and generate a request to a resource based on that input. The requested resource might be another web page. However, if we have full control over the generated URL, we can potentially interact with non-HTTP services in some capacity. Essentially, an SSRF vulnerability allows attackers to use the application as a proxy server. However, the vulnerable application may limit us to certain kinds of requests. For example, most SSRF vulnerabilities will generate an HTTP GET request.

It is important to understand that the forged request originates from the vulnerable server, not our browser. This means we can use SSRF vulnerabilities to interface with the vulnerable server itself and send requests across network boundaries based on the server's access.

The impact of an SSRF vulnerability depends on what data it can access and whether the SSRF returns any resulting data to the attacker. However, SSRF vulnerabilities can be especially effective against _microservice architecture_.[1](https://portal.offsec.com/courses/web-200-28380/learning/server-side-request-forgery-34430/server-side-request-forgery-34551#fn-local_id_65-1) Microservices will often have fewer security controls in place and instead rely upon an API gateway or reverse proxy to implement those controls.[2](https://portal.offsec.com/courses/web-200-28380/learning/server-side-request-forgery-34430/server-side-request-forgery-34551#fn-local_id_65-2) If the microservices are in a _flat network_,[3](https://portal.offsec.com/courses/web-200-28380/learning/server-side-request-forgery-34430/server-side-request-forgery-34551#fn-local_id_65-3) we could use an SSRF vulnerability to make one microservice talk directly to another one. Any controls enforced by the API gateway would not apply to the traffic between the two microservices, allowing an SSRF exploit to gather information about the internal network and open new attack vectors.

--------------

#### 12.1.1. Interacting with the Vulnerable Server
We can use an SSRF vulnerability to interact with the _loopback interface_[1](https://portal.offsec.com/courses/web-200-28380/learning/server-side-request-forgery-34430/introduction-to-ssrf-34516/introduction-to-ssrf-34547#fn-local_id_93-1) of the vulnerable server. If we can control the URL and submit `http://127.0.0.1` or `http://localhost`, the vulnerable application will send a request to its own server. Such a request can access ports that are not externally accessible.

Let's review an example of this on our Kali host with Burp Suite running. By default, Burp Suite will start a listener on port 8080 of the loopback interface. We can verify this by running netstat with -l to list all listening sockets, -n to disable name resolution on the sockets, and -t to limit the results to TCP sockets.
```bash
kali@kali:~$ netstat -lnt
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State      
tcp6       0      0 127.0.0.1:8080          :::*                    LISTEN     
tcp6       0      0 127.0.0.1:38901         :::*                    LISTEN   
```
The results in Listing 1 verify that Burp Suite is listening on the loopback interface.
Let's try using curl to access port `8080` on the loopback interface.

```bash
kali@kali:~$ curl http://127.0.0.1:8080 
<html><head><title>Burp Suite Community Edition</title>
...
</head>
<body>
<div id="container">
<div class="title"><h1>Burp Suite Community Edition</h1></div>
<div class="navbar"><ul>
<li><a href="/cert">CA Certificate</a></li>
</ul></div>
<p>Welcome to Burp Suite Community Edition.</p><p>&nbsp;</p>
</div>
</body>
</html>
```
We were able to access the web page running on port 8080 through the loopback interface.
Next, let's try accessing it with our Kali VM's actual IP address.

```bash
kali@kali:~$ curl http://192.168.48.3:8080
curl: (7) Failed to connect to 192.168.48.3 port 8080: Connection refused
```

Since Burp Suite is listening on the loopback interface and we tried to access it with our VM's external IP address, our VM refused the connection. If we were running a web application vulnerable to SSRF on our Kali VM, an attacker could use the vulnerability to access the Burp Suite page through the loopback interface.

This example used an HTTP service, but suppose we had an SSH service or a database listening on the loopback interface. The SSRF vulnerability would be able to interact with those services as well. Even if the internal services don't return valid HTML content, we can still perform basic service enumeration through SSRF by checking for common TCP ports. Depending on the _user agent_[2](https://portal.offsec.com/courses/web-200-28380/learning/server-side-request-forgery-34430/introduction-to-ssrf-34516/interacting-with-the-vulnerable-server-34435#fn-local_id_93-2) generating the forged request, we might be able to make non-HTTP calls. We will discuss these attacks in a later Learning Unit.

----------
#### 12.1.2. Interacting with Back-end Systems and Private IP Ranges

In addition to the loopback interface, we can use SSRF attacks to interact with backend servers that are not publicly accessible. However, this task can be difficult unless we have some idea of hostnames or private IP addresses.

There are three established ranges for private IP addresses.

| **IP address range** | **Number of addresses** |
| -------------------- | ----------------------- |
| 10.0.0.0/8           | 16,777,216              |
| 172.16.0.0/12        | 1,048,576               |
| 192.168.0.0/16       | 65,536                  |

Locating a valid IP address on a /8 or /12 network can be very time consuming and the approach is beyond the scope of this Learning Module. Even a /16 network would require scripting or automation beyond what we will cover here.

However, some cloud providers run special services on set _link-local addresses_[1](https://portal.offsec.com/courses/web-200-28380/learning/server-side-request-forgery-34430/introduction-to-ssrf-34516/interacting-with-back-end-systems-and-private-ip-ranges-34432#fn-local_id_210-1) or predefined hostnames. For example, AWS EC2 instances can access metadata services[2](https://portal.offsec.com/courses/web-200-28380/learning/server-side-request-forgery-34430/introduction-to-ssrf-34516/interacting-with-back-end-systems-and-private-ip-ranges-34432#fn-local_id_210-2) at 169.254.169.254. An attacker exploiting an SSRF vulnerability in an AWS cloud environment could potentially access this metadata service and obtain sensitive data. Many other cloud computing providers use the same link-local address for their equivalent services. We'll cover interacting with these types of metadata services in more detail in a subsequent Learning Unit.