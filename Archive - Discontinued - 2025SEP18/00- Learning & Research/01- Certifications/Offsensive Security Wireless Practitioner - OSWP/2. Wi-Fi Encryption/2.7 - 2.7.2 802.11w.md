
While encryption protects data transmitted on the network, it is still vulnerable to Denial of Service through common attack using frames such as deauthentication or disassociation.

Also known as Protected Management Frames, 802.11w was released in July 2009. It aims to improve the Medium Access Control layer by adding integrity to some critical management frames on WPA (TKIP or CCMP) networks to prevent replay protection. It is a mandatory requirement for 802.11ac or Passpoint certification. It became part of the 802.11 standard in March 2012.[1](https://portal.offsec.com/courses/pen-210-9545/learning/wi-fi-encryption-15794/80211w-15886/80211w-16044#fn-local_id_131-1)

The following frames are protected:

- Disassociation
- Deauthentication
- Action frames: Block ACK (request and response), QoS Admission Control, Radio Measurement, Spectrum Management and Fast BSS Transition
- Channel switch announcement (when directed to a client)
- Security Association Query
- Protected Dual of Public Action frame
- Vendor-specific Protected

Some of the frames mentioned above are unicast, while others are multicast/broadcast. The encryption used for the unicast is the same PTK used for unicast data frames. For the multicast ones, a new Integrity Group Temporal Key (IGTK) is received during the 4-way handshake, at the same time as the GTK.

Without 802.11w, when sending a deauth, the AP or one or all clients blindly accepts it and disconnects. In most cases, the client will reconnect automatically without the user knowing, and doing a 4-way handshake. Access points do send deauthentication and disassociation from time to time as part of normal operations but these frames can also be used to attack clients.

The first scenario, it will force the client (or all clients) to disconnect and reconnect. A 4-way handshake will happen, which can later be cracked offline. It is also useful for attacks against WEP.

The second scenario is a denial of service, when the deauthentication is sustained, as it will prevent one or more clients to connect.

While most of the time, denial of service is manually done, Wireless Intrusion Prevention System sometimes have an option to "contain" an AP, for example, when the administrator has identified it as a rogue. It will automatically and immediately disconnect clients attempting to connect to the rogue. In some cases, this option can be misused.

----------

### 2.7.1. Connection

PMF status is indicated in the beacon, in the RSN IE, and two bits show the settings, in the RSN capabilities.

First one, bit 6, is about PMF requirement. If set, if the client doesn't support PMF (either capable or required), it won't be able to connect.

Bit 7 indicates if the AP is PMF capable. It is automatically set when bit 6 is set. In this case, an AP will accept clients with and without PMF. Those with (capable or required), will benefit from the added protection while still allowing clients that cannot handle it as well.

When connecting, the client will have a RSN IE in its association request with its own settings for PMF.

The following table details the outcome of connection depending on the client and AP settings' for PMF:

|AP|Client|Connection|PMF|
|---|---|---|---|
|No|No|Yes|No|
|No|Capable|Yes|No|
|No|Required|No||
|Capable|No|Yes|No|
|Capable|Capable|Yes|Yes|
|Capable|Required|Yes|Yes|
|Required|No|No||
|Required|Capable|Yes|Yes|
|Required|Required|Yes|Yes|

In case a client or AP has invalid settings, no connection should occur. When a station does and tries to associate to an AP, association will be rejected.

--------

### 2.7.2. Security Association Teardown Protection

This mechanism prevents attacks using unprotected association, disassociation or deauthentication frames from tearing down a connection.

A client who's lost the key will try to associate again, using an unprotected association frame. The AP seeing that, will decline the authentication asking the client to try again later, usually 10-20 seconds later. In the meantime, the AP will send a SA Query frame. Since the client doesn't have the key anymore, it isn't able to respond, and thus the AP will send a protected disassociation/deauthentication and clear the encryption keys. When it is time to associate again, it will work. In the event an attacker tries to associate, while the real client is still there, it will get that same "come back in XXX" association response. The real client, still having the encryption keys, is able to respond to the SA Query and thus nothing happens, it doesn't get disconnected.

On the other side, when the AP loses the keys, at some point, the associated client will send a encrypted data frame to the AP, since it has the encryption keys. The AP, not having the client in its list anymore (or just not the keys anymore), will send a deauthentication/disassociation frame to the client (most likely a frame with reason code 6 or 7: class 2 frame received from nonauthenticated STA or class 3 frame received from nonassociated STA). The client will then send a protected SA Query to the AP, to make sure it is the legitimate access point. Since the AP doesn't have the keys, it isn't able to answer within the alloted time. The connection will be torn down and it will have to reconnect. In the event it is a fake or rogue AP, since both have the keys, the real AP will answer the SA Query and the connection will remain.

There are a few scenarios where a client or an AP can lose the keys and they are handled with this mechanism. It can happen in the event of a hardware or software issue and the device/connection is reset. Such as a firmware issue where the device crashes and is reset, or power went down for a second, thus resetting the device.

**Note**: A device only transmits when it needs to, and there may be periods of time when there is no traffic whatsoever between the AP and a specific client.