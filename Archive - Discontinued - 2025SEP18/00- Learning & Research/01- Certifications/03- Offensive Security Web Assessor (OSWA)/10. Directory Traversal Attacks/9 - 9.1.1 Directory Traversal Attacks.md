
In this Learning Module, we will cover the following Learning Units:

- Directory Traversal Illustration
- Understanding Suggestive Parameters
- Relative vs. Absolute Pathing
- Directory Listing
- Directory Traversal Sandbox
- Case Study: Home Assistant

In this section, we'll explore a type of attack known asÂ _Directory Traversal_.[1](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-attacks-31457#fn-local_id_204-1)

Directory Traversal vulnerabilities can occur in web applications due to poor input sanitization. When applications perform file operations with unsanitized user-supplied data, attackers might be able to manipulate file paths to "traverse" into unintended directories. A successful directory traversal attack can exfiltrate sensitive data from a machine.

The types of parameters most often vulnerable to a Directory Traversal attack are those that work with endpoints on the system, which may range from mundane image files to more interesting file types. Any parameters that manage loading objects will also be targets for us.

In the upcoming Learning Unit, we will go over Traversal Strings, Relative Pathing, and Absolute Pathing usage with Directory Traversal.

-----------------
#### 9.1. Directory Traversal Overview

This Learning Unit covers the following Learning Objectives:

1. Understand what a Traversal String is.
2. Understand basics of Relative Pathing.
3. Understand basics of Absolute Pathing.

Now that we have defined Directory Traversals and developed an understanding of how we can leverage common sanitization vulnerabilities to exfiltrate sensitive data, let's put our knowledge into practice.

We don't need to be in a web application to illustrate path traversal. In fact, we can perform directory traversal straight from our attacking machine. Let's start by examining the below commands. We'll specifically note that our present working directory (pwd) isÂ /home/kaliÂ in our Kali Linux VM.
```bash
kali@kali:~$ pwd
/home/kali>
                           
kali@kali:~$ cat ../../etc/passwd                                  
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
systemd-timesync:x:101:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
```

Following these steps, we have performed a legitimate Directory Traversal.

The command above enabled us to traverse outside ofÂ /home/kaliÂ and read the file contents ofÂ /etc/passwdÂ by prefixing the location with twoÂ _Traversal Strings_Â ("../../").

We were able to read the contents of a file outside theÂ /home/kaliÂ directory with an absolute path by using traversal strings. Traversal strings are, in their simplest format, two dots followed by a slash.

For example, "../" means "entity before this", whereas "../../" indicates a pair of traversal strings meaning "take me back two directories". Because we perform the command from theÂ /home/kaliÂ directory, weÂ _traverse_Â a total of two times, or two directories back to the root file system location ("/").

When working with a Windows machine, we can specify both the "../" and "..\\" traversal strings. Windows considers these statements as equal and one in the same.[1](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-overview-31295/directory-traversal-overview-31456#fn-local_id_205-1)

Reviewing potential candidate files to perform a successful directory traversal attack on Windows, we'll find several options. The most likely target file we'll encounter isÂ C:\Windows\win.ini, which is similarly common asÂ /etc/passwdÂ on Linux. We can also review file inclusion wordlists to confirm the file names and paths of Windows files.

Even when an endpoint is susceptible to directory traversal, conventional traversal attacks might not work, instead re-routing us to a separate endpoint due toÂ _normalization_.[2](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-overview-31295/directory-traversal-overview-31456#fn-local_id_205-2)Â Normalization is responsible for resolving endpoints before we send the request.

For example, lets suppose that we useÂ curl[3](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-overview-31295/directory-traversal-overview-31456#fn-local_id_205-3)Â on the megacorpone domain.[4](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-overview-31295/directory-traversal-overview-31456#fn-local_id_205-4)Â We will provideÂ curlÂ with theÂ -vÂ argument to increase the verbosity of the output followed by a specific, known URI (/about.html), as well as appending aÂ _single traversal string_Â and index.html ("/../index.html"). Finally, we save the page contents to a file with the -o argument to clean up the output so we can examine the results of the GET method.

```bash
â”Œâ”€â”€(rootðŸ’€gobots)-[16Sep2024 16:15:52]-[/home/kali]                                                                                                                                                        
â””â”€# curl -v http://www.megacorpone.com/about.html/../index.html -o megacorp.txt                                                                                                                            
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current                                                                                                                            
                                 Dload  Upload   Total   Spent    Left  Speed                                                                                                                              
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0* Host www.megacorpone.com:80 was resolved.                                                                                  
* IPv6: (none)                                                                                                                                                                                             
* IPv4: 149.56.244.87                                                                                                                                                                                      
  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0*   Trying 149.56.244.87:80...                                                                                               
* Connected to www.megacorpone.com (149.56.244.87) port 80                                                                                                                                                 
> GET /index.html HTTP/1.1                                                                                                                                                                                 
> Host: www.megacorpone.com                                                                                                                                                                                
> User-Agent: curl/8.7.1                                                                                                                                                                                   
> Accept: */*                                                                                                                                                                                              
>                                                                                                                                                                                                          
* Request completely sent off                                                                                                                                                                              
< HTTP/1.1 200 OK                                                                                                                                                                                          
< Date: Mon, 16 Sep 2024 16:16:02 GMT                                                                                                                                                                      
< Server: Apache/2.4.61 (Debian)                                                                                                                                                                           
< Last-Modified: Wed, 06 Nov 2019 15:04:14 GMT                                                                                                                                                             
< ETag: "390b-596aedca79780"                                                                                                                                                                               
< Accept-Ranges: bytes                                                                                                                                                                                     
< Content-Length: 14603                                                                                                                                                                                    
< Vary: Accept-Encoding                                                                                                                                                                                    
< Content-Type: text/html                                                                                                                                                                                  
<                                                                                                                                                                                                          
{ [14345 bytes data]                                                                                                                                                                                       
100 14603  100 14603    0     0  50237      0 --:--:-- --:--:-- --:--:-- 50182                                                                                                                             
* Connection #0 to host www.megacorpone.com left intact           
```

UsingÂ curlÂ will ensure that the web browser is removed from the equation if traversal is being re-routed back to the web-root. Instead of using the standard traversal string "../", we'll URL-encode this value to be "..%2F". We encode our URLs[5](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-overview-31295/directory-traversal-overview-31456#fn-local_id_205-5)Â so we can deliver what we need to the target machine in a format the remote server can read.

By definition, any ASCII character can beÂ _URL encoded_. However, we should familiarize ourselves more specifically with theÂ _%2f_Â (forward slash "/"),Â _%20_Â (single space " "), andÂ _%3D_Â (equal sign "="). We can investigate more encoding values on the public web (there's one for each ASCII character). For now, these are the three primary ASCII values that we need to know for our payloads to reach the target web server.

The example below demonstrates how we might send a URL-encoded sample GET request.

```bash
GET /files/..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd HTTP/1.1 
```
Our sample GET request might test more efficiently for directory traversal if the target web server is using programmatic endpoints.Â [6](https://portal.offsec.com/courses/WEB-200-28380/learning/directory-traversal-attacks-30962/directory-traversal-overview-31295/directory-traversal-overview-31456#fn-local_id_205-6)Â A programmatic endpoint is an endpoint that, when visited, redirects you to a separate URI using the backend web technology's programmatic logic. Some endpoint sanitization, for example, will interpret "../../../" and simply redirect an individual back to "/webApp/login". We can utilize Burp Suite'sÂ _Repeater_Â and send the request with URL encoding to conduct very thorough traversal checks on a programmatic endpoint.

Now that we've covered some theory on directory traversal, briefly explored URL encoding, and provided some sample endpoints with traversal strings, let's examine the next concept, known asÂ _Suggestive Parameters_.

--------------
#### 9.1.1 Accessing The Lab Machines

For connectivity purposes, we'll use the links below to practice directory listing and directory traversal. We can find these machines in our Online Portal.
http://directorylisting/Â http://dirTravSandbox/
In order to access these servers, we have createdÂ _hosts_Â file entries for "directorylisting" and "dirtravsandbox" on our Kali Linux VM.
We can confirm that our entries resolve properly by performing the curl command on the hostname entry we added to ourÂ /etc/hostsÂ file.
\
```bash
kali@kali:~$ curl -I http://dirtravsandbox
HTTP/1.1 200 OK
Date: Wed, 22 Sep 2021 16:34:54 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.2.34
Content-Type: text/html; charset=UTF-8

kali@kali:~$ curl -I http://directorylisting
HTTP/1.1 200 OK
Date: Wed, 22 Sep 2021 16:37:00 GMT
Server: Apache/2.4.38 (Debian)
X-Powered-By: PHP/7.2.34
Content-Type: text/html; charset=UTF-8
```
In the next coming Section, we will be discussing what we mean by the term "Suggestive Parameter".

------------
